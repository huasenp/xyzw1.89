window.__require=function t(e,i,o){function n(s,r,c){if(!i[s]){if(!e[s]){var l=s;if(s.includes("./")&&(l=(l=s.split("/"))[l.length-1]),!e[l]){var h="function"==typeof __require&&__require;if(!r&&h)return h(l,!0);if(a)return a(l,!0);throw new Error("Cannot find module '"+s+"'")}s=l}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){return n(e[s][1][t]||t,void 0,t.includes("./")?void 0:t)},u,u.exports,t,e,i,o)}return c&&i[s]&&!i[c]&&(i[c]=i[s]),i[s].exports}for(var a="function"==typeof __require&&__require,s=0;s<o.length;s++)n(o[s]);return n}({AABB:[function(t,e,i){"use strict";cc._RF.push(e,"6fdd8cVeOFL3KM/vdzLcl7c","AABB"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./CBB")),n=__importDefault(t("./ColliderBase")),a=t("./Manager"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enter=function(){},e.exit=function(){},e.isInArea=!1,e.isTrigger=!1,e.graphics=null,e}var i;return __extends(e,t),i=e,Object.defineProperty(e.prototype,"size",{get:function(){return cc.v2(this.node.width,this.node.height).multiplyScalar(this.node.scale).multiplyScalar(this.node.parent.scale)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"halfMaxPos",{get:function(){return this.center.add(this.size.div(2))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"halfMinPos",{get:function(){return this.center.sub(this.size.div(2))},enumerable:!1,configurable:!0}),e.prototype.moveToClose=function(t,e){return t instanceof i?a.FindCraftColliderManager.AABBcloseToAABB(t,e,this):(console.error("no implement"),t.center)},e.prototype.overlap=function(t){return t instanceof i?a.FindCraftColliderManager.testAABBAABB(this,t):t instanceof o.default&&a.FindCraftColliderManager.testAABBCBB(this,t)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.graphics&&(this.graphics.clear(),this.graphics.strokeColor=cc.Color.CYAN,this.graphics.lineWidth=5,this.graphics.rect(this.halfMinPos.x,this.halfMinPos.y,this.size.x,this.size.y),this.graphics.stroke())},__decorate([c],e.prototype,"isTrigger",void 0),__decorate([c(cc.Graphics)],e.prototype,"graphics",void 0),i=__decorate([r],e)}(n.default);i.default=l,cc._RF.pop()},{"./CBB":"CBB","./ColliderBase":"ColliderBase","./Manager":"Manager"}],AlphaSparkle:[function(t,e,i){"use strict";cc._RF.push(e,"c69d2QrZGpLA5hhXnxuRcZr","AlphaSparkle"),Object.defineProperty(i,"__esModule",{value:!0}),i.AlphaSparkle=void 0;var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.center=.5,e.strength=.5,e.frequency=1,e.time=0,e}return __extends(e,t),e.prototype.update=function(t){var e=t/1e3;this.time+=e;var i=Math.sin(this.time*Math.PI*2*this.frequency)*this.strength+this.center;this.node.opacity=255*i},__decorate([a],e.prototype,"center",void 0),__decorate([a],e.prototype,"strength",void 0),__decorate([a],e.prototype,"frequency",void 0),__decorate([n],e)}(cc.Component);i.AlphaSparkle=s,cc._RF.pop()},{}],AnagramsData:[function(t,e,i){"use strict";cc._RF.push(e,"58746/WQ85J2blr1fudL+uY","AnagramsData"),Object.defineProperty(i,"__esModule",{value:!0}),i.AnagramsWordData=void 0;var o=cc._decorator,n=o.ccclass,a=o.property,s=function(){function t(){this._word="",this._preWordData=new Map,this._nextWordData=new Map}return Object.defineProperty(t.prototype,"word",{get:function(){return this._word},set:function(t){this._word=t},enumerable:!1,configurable:!0}),t.prototype.getPreWordData=function(t){return this._preWordData.get(t)},t.prototype.addPreWordData=function(t,e){this._preWordData.has(t)||this._preWordData.set(t,new Map),this._preWordData.get(t).set(t,e)},t.prototype.getNextWordData=function(t){return this._nextWordData.get(t)},t.prototype.addNextWordData=function(t,e){this._nextWordData.has(t)||this._nextWordData.set(t,new Map),this._nextWordData.get(t).set(t,e)},t}();i.AnagramsWordData=s;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectedNode=null,e.unselectedNode=null,e.lbWord=null,e.root=null,e._wordData=null,e._isEliminate=!1,e._isSelected=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"wordData",{get:function(){return this._wordData},set:function(t){this._wordData=t,this.lbWord.string=t.word},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEliminate",{get:function(){return this._isEliminate},set:function(t){this._isEliminate=t,this.root.active=!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){return this._isSelected},set:function(t){this._isSelected=t,this.selectedNode.active=this._isSelected,this.unselectedNode.active=!this._isSelected},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.isSelected=!1},__decorate([a(cc.Node)],e.prototype,"selectedNode",void 0),__decorate([a(cc.Node)],e.prototype,"unselectedNode",void 0),__decorate([a(cc.Label)],e.prototype,"lbWord",void 0),__decorate([a(cc.Node)],e.prototype,"root",void 0),__decorate([n],e)}(cc.Component);i.default=r,cc._RF.pop()},{}],AnagramsGame:[function(t,e,i){"use strict";cc._RF.push(e,"085b4Gd95lOypNA51i2qVwU","AnagramsGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=__importStar(t("./AnagramsData")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._model=null,e.item=null,e.layout=null,e.m_btnBack=null,e._curSelectedWords=[],e._mapDataList=[],e._wordMap=new Map,e._wordList=[],e._index=0,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this._model=o.default.instance.getModel(),this.m_btnBack.on(cc.Node.EventType.TOUCH_END,function(){return t._model.gameExit()},this),this._wordList=this._model.data;for(var e=0;e<this._wordList.length;e++)for(var i=this._wordList[e],n=0;n<i.length;n++)this._genDict(i,n);for(this._mapDataList=this.shuffle(this._mapDataList),e=0;e<this._mapDataList.length;e++)i=this._mapDataList[e],this.layout.addChild(i.node)},e.prototype.shuffle=function(t){for(var e=[];t.length>0;){var i=Math.floor(Math.random()*t.length);e.push(t[i]),t.splice(i,1)}return e},e.prototype._genDict=function(t,e){var i=t[e];if(!this._wordMap.has(i)){var o=new n.AnagramsWordData;o.word=i,this._wordMap.set(i,o)}var a=this._wordMap.get(i);if(e<this._wordList.length-1){var s=e+1,r=t[s],c=new n.AnagramsWordData;c.word=r,a.addNextWordData(t[s],c)}this._genNode(a)},e.prototype._genNode=function(t){var e=cc.instantiate(this.item),i=e.getComponent(cc.Button),o=e.getComponent(n.default),a=new cc.Component.EventHandler;this._mapDataList.push(o),o.wordData=t,a.target=this.node,a.component="AnagramsGame",a.handler="onClickWord",i.clickEvents.push(a)},e.prototype._clearSelectedWords=function(){this._curSelectedWords=[];for(var t=0;t<this._curSelectedWords.length;t++)this._curSelectedWords[t].isSelected=!1},e.prototype._eliminateWord=function(){for(var t=[],e=0;e<this._curSelectedWords.length;e++){var i=this._curSelectedWords[e];t.push(i.wordData.word)}var o=!1;for(e=0;e<this._wordList.length;e++){var n=this._wordList[e];if(n.length===t.length){for(var a=t.concat(),s=0;s<n.length;s++){i=n[s];var r=a.indexOf(i);r>-1&&a.splice(r,1)}if(!(a.length>0)){o=!0;break}}}if(o){for(e=0;e<this._curSelectedWords.length;e++)(i=this._curSelectedWords[e]).isEliminate=!0;this._curSelectedWords=[]}this._isGameOver()&&this._gameOver()},e.prototype._isGameOver=function(){for(var t=0;t<this._mapDataList.length;t++)if(!this._mapDataList[t].isEliminate)return!1;return!0},e.prototype._gameOver=function(){o.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype.onClickWord=function(t){var e=t.target.getComponent(n.default);if(!e.isEliminate){var i=this._curSelectedWords.indexOf(e);e.isSelected=!e.isSelected,i>-1&&!e.isSelected?this._curSelectedWords.splice(i,1):e.isSelected&&this._curSelectedWords.push(e),this._eliminateWord()}},e.prototype.onDisable=function(){var t=this;this.m_btnBack.off(cc.Node.EventType.TOUCH_END,function(){return t._model.gameExit()},this)},__decorate([r(cc.Prefab)],e.prototype,"item",void 0),__decorate([r(cc.Node)],e.prototype,"layout",void 0),__decorate([r(cc.Node)],e.prototype,"m_btnBack",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./AnagramsData":"AnagramsData"}],AnagramsModel:[function(t,e,i){"use strict";cc._RF.push(e,"de936NB0o9NK494oDvwK3yP","AnagramsModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.AnagramsModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=["\u82b1\u5343\u9aa8","\u68a6\u534e\u5f55","\u6b22\u4e50\u9882","\u77e5\u5426\u77e5\u5426","\u5e86\u4f59\u5e74","\u9999\u871c\u6c89\u6c89\u70ec\u5982\u971c","\u4e09\u5341\u800c\u5df2","\u6c89\u9999\u5982\u5c51","\u4ed9\u5251\u5947\u4fa0\u4f20","\u4e09\u751f\u4e09\u4e16\u5341\u91cc\u6843\u82b1","\u7504\u5b1b\u4f20","\u6597\u7834\u82cd\u7a79","\u4eb2\u7231\u7684\u70ed\u7231\u7684","\u5929\u624d\u57fa\u672c\u6cd5","\u8d58\u5a7f"],e}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/anagramsGame/anagramsGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.anagramsGame)],e)}(n.default);i.AnagramsModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],BallFallGameWindow:[function(t,e,i){"use strict";cc._RF.push(e,"0d3d72B005Cv6emWXSl/3DP","BallFallGameWindow"),Object.defineProperty(i,"__esModule",{value:!0}),i.BallFallGameWindow=void 0;var o=__importStar(t("../../miniGamePackage/SubPackageManager")),n=t("./BallFallModel"),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.m_btnReturn=null,e.m_keyBtn1=null,e.m_keyBtn2=null,e.m_keyBtn3=null,e.m_aniNode=null,e.m_lineNode=null,e.m_ballNode=null,e.m_keyNode=null,e.m_wallContainer=null,e.m_ballContainer=null,e.m_keyContainer=null,e.m_checkResultNode=null,e.m_checkBeginNode=null,e.key=null,e.plane=null,e.ball=null,e._model=null,e.isDebug=!1,e.world=null,e.factor=15,e.linefactor=15,e.lineList=[],e.ballList=[],e.keyList=[],e.checkResultBody=null,e.checkBeginBody=null,e.wallMaterial=null,e.ballMaterial=null,e.ballWallCM=null,e.isFinish=!1,e.isBegin=!1,e.saveFrameRate=30,e._lastUpdateTime=-1,e._maxDtTime=100,e.maxWaitResultTime=5e3,e._isAllSleep=!1,e._pause=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.m_btnReturn.on(cc.Node.EventType.TOUCH_END,this.exitGame,this),this.m_keyBtn1.on(cc.Node.EventType.TOUCH_START,this.tap1Btn,this),this.m_keyBtn2.on(cc.Node.EventType.TOUCH_START,this.tap2Btn,this),this.m_keyBtn3.on(cc.Node.EventType.TOUCH_START,this.tap3Btn,this)},e.prototype.onEnable=function(){this.saveFrameRate=cc.game.getFrameRate(),cc.game.setFrameRate(60),cc.game.on(cc.game.EVENT_HIDE,this.wxOnShow,this),cc.game.on(cc.game.EVENT_HIDE,this.wxOnHide,this),this._lastUpdateTime=(new Date).getTime(),this._model=o.default.instance.getModel(),this.world=new o.P2.World,this.world.sleepMode=o.P2.World.BODY_SLEEPING,this.world.setGlobalRelaxation(5),this.world.gravity=[0,-100],this.world.defaultContactMaterial.friction=.1,this.createLineWithImg(),this.createBallWithImg(),this.createKeyWithImg(),this.createResultWithImg(),this.createBeginWithImg()},e.prototype.createLineWithImg=function(){for(var t=0;t<this.m_lineNode.childrenCount;t++){var e=this.m_lineNode.children[t],i=e.position,a=new o.P2.Box({collisionMask:n.ColiderMask.Ball,collisionGroup:n.ColiderMask.Wall,width:e.width/this.linefactor,height:e.height/this.linefactor}),s=new o.P2.Body({angle:-e.rotation/180*Math.PI,mass:0,position:[i.x/this.linefactor,i.y/this.linefactor]});s.addShape(a),this.world.addBody(s);var r=this.createPlane(t);r.width=a.width*this.linefactor,r.height=a.height*this.linefactor,r.anchorX=.5,r.anchorY=.5,r.opacity=0,s.displays=[r],this.m_wallContainer.addChild(r),this.lineList.push(s)}this.m_lineNode.active=!1},e.prototype.createBallWithImg=function(){for(var t=0;t<this.m_ballNode.childrenCount;t++){var e=this.m_ballNode.children[t],i=e.position,a=new o.P2.Circle({radius:e.width/2/this.linefactor,collisionMask:n.ColiderMask.Ball|n.ColiderMask.Key|n.ColiderMask.Wall,collisionGroup:n.ColiderMask.Ball}),s=new o.P2.Body({angle:-e.rotation/180*Math.PI,mass:1,position:[i.x/this.linefactor,i.y/this.linefactor]});s.addShape(a),this.world.addBody(s);var r=this.createRealBall(t);r.width=2*a.radius*this.linefactor,r.height=2*a.radius*this.linefactor,r.anchorX=.5,r.anchorY=.5,s.displays=[r],this.m_ballContainer.addChild(r),this.ballList.push(s)}this.m_ballNode.active=!1},e.prototype.createKeyWithImg=function(){for(var t=0;t<this.m_keyNode.childrenCount;t++){var e=this.m_keyNode.children[t],i=e.position,a=new o.P2.Box({collisionMask:n.ColiderMask.Ball,collisionGroup:n.ColiderMask.Key,width:e.width/this.linefactor,height:e.height/this.linefactor}),s=new o.P2.Body({angle:-e.rotation/180*Math.PI,mass:0,position:[i.x/this.linefactor,i.y/this.linefactor]});s.addShape(a),this.world.addBody(s);var r=this.createKey(t);r.width=a.width*this.linefactor,r.height=80,r.anchorX=.5,r.anchorY=.5,s.displays=[r],this.m_keyContainer.addChild(r),this.keyList.push(s)}this.m_keyNode.active=!1},e.prototype.createResultWithImg=function(){var t=this.m_checkResultNode,e=t.position,i=new o.P2.Box({collisionMask:n.ColiderMask.None,collisionGroup:n.ColiderMask.Result,width:t.width/this.linefactor,height:t.height/this.linefactor}),a=new o.P2.Body({angle:-t.rotation/180*Math.PI,mass:0,position:[e.x/this.linefactor,e.y/this.linefactor]});a.addShape(i),this.world.addBody(a);var s=this.createPlane(2e3);s.width=i.width*this.linefactor,s.height=i.height*this.linefactor,s.anchorX=.5,s.anchorY=.5,s.opacity=0,a.displays=[s],this.node.addChild(s),this.m_checkResultNode.active=!1,this.checkResultBody=a},e.prototype.createBeginWithImg=function(){var t=this.m_checkBeginNode,e=t.position,i=new o.P2.Box({collisionMask:n.ColiderMask.None,collisionGroup:n.ColiderMask.Result,width:t.width/this.linefactor,height:t.height/this.linefactor}),a=new o.P2.Body({angle:-t.rotation/180*Math.PI,mass:0,position:[e.x/this.linefactor,e.y/this.linefactor]});a.addShape(i),this.world.addBody(a);var s=this.createPlane(2001);s.width=i.width*this.linefactor,s.height=i.height*this.linefactor,s.anchorX=.5,s.anchorY=.5,s.opacity=0,a.displays=[s],this.node.addChild(s),this.m_checkBeginNode.active=!1,this.checkBeginBody=a},e.prototype.update=function(t){if(!this._pause){t=Math.min(1e3*t,this._maxDtTime),this.world.step(1/60),cc.winSize.height;var e=this.world.bodies.length;this._isAllSleep=!0;for(var i=0;i<e;i++){var n=this.world.bodies[i];if(n.displays&&!(n.displays.length<=0)){var a=n.displays[0],s=this.linefactor;a&&(a.x=n.position[0]*s,a.y=n.position[1]*s,a.angle=180*(n.angle+n.shapes[0].angle)/Math.PI,n.sleepState!=o.P2.Body.SLEEPING&&(this._isAllSleep=!1))}}if(!this.isFinish)if(this.checkResultBody){for(i=0;i<this.ballList.length;i++)if(this.checkResultBody.aabb.overlaps(this.ballList[i].aabb))return console.log("\u5c0f\u7403\u548c\u7ed3\u679c\u68c0\u6d4b\u76d2\u5b50\u78b0\u649e\u4e86:"),this.isFinish=!0,this.node.getComponent(cc.AudioSource).stop(),cc.audioEngine.uncache(this.getComponent(cc.AudioSource).clip),void o.default.instance.gotoResultWithLoading(!0,this.node.parent);if(this.checkBeginBody){if(this._lastUpdateTime+=t,!this.isBegin)for(i=0;i<this.ballList.length;i++)if(this.checkBeginBody.aabb.overlaps(this.ballList[i].aabb)){console.log("\u5c0f\u7403\u548c\u7ed3\u679c\u68c0\u6d4bbegin\u76d2\u5b50\u78b0\u649e\u4e86:"),this.isBegin=!0,this._lastUpdateTime=0;break}if(this.isBegin&&(this._isAllSleep||this._lastUpdateTime>=this.maxWaitResultTime)){this.isFinish=!0;var r=this.getComponent(cc.AudioSource).clip;this.node.getComponent(cc.AudioSource).stop(),cc.audioEngine.uncache(r),o.default.instance.gotoResultWithLoading(!1,this.node.parent)}return!0}console.log("\u5f53\u524d\u5173\u5361\u6ca1\u6709\u5f00\u59cb\u68c0\u6d4bbody")}else console.log("\u5f53\u524d\u5173\u5361\u6ca1\u6709\u7ed3\u7b97\u68c0\u6d4bbody")}},e.prototype.onDisable=function(){cc.game.off(cc.game.EVENT_HIDE,this.wxOnShow,this),cc.game.off(cc.game.EVENT_HIDE,this.wxOnHide,this),this.ballList=[],this.lineList=[],this.keyList=[],this.checkResultBody=null,this.checkBeginBody=null,this.world.clear(),this.world=null,this._pause=!1,this.isFinish=!1,this.isBegin=!1,this._lastUpdateTime=-1,cc.game.setFrameRate(this.saveFrameRate)},e.prototype.createRealBall=function(){return cc.instantiate(this.ball)},e.prototype.createPlane=function(){return cc.instantiate(this.plane)},e.prototype.createKey=function(){return cc.instantiate(this.key)},e.prototype.tap1Btn=function(){this.keyList[0].velocity=[-30,0];for(var t=0;t<this.ballList.length;t++)this.ballList[t].wakeUp()},e.prototype.tap2Btn=function(){this.keyList[1].velocity=[-30,0];for(var t=0;t<this.ballList.length;t++)this.ballList[t].wakeUp()},e.prototype.tap3Btn=function(){this.keyList[2].velocity=[-30,0];for(var t=0;t<this.ballList.length;t++)this.ballList[t].wakeUp()},e.prototype.exitGame=function(){this._model.gameExit()},e.prototype.wxOnHide=function(){this._pause=!0},e.prototype.wxOnShow=function(){this._pause=!1},__decorate([r(cc.Node)],e.prototype,"m_btnReturn",void 0),__decorate([r(cc.Node)],e.prototype,"m_keyBtn1",void 0),__decorate([r(cc.Node)],e.prototype,"m_keyBtn2",void 0),__decorate([r(cc.Node)],e.prototype,"m_keyBtn3",void 0),__decorate([r(cc.Node)],e.prototype,"m_aniNode",void 0),__decorate([r(cc.Node)],e.prototype,"m_lineNode",void 0),__decorate([r(cc.Node)],e.prototype,"m_ballNode",void 0),__decorate([r(cc.Node)],e.prototype,"m_keyNode",void 0),__decorate([r(cc.Node)],e.prototype,"m_wallContainer",void 0),__decorate([r(cc.Node)],e.prototype,"m_ballContainer",void 0),__decorate([r(cc.Node)],e.prototype,"m_keyContainer",void 0),__decorate([r(cc.Node)],e.prototype,"m_checkResultNode",void 0),__decorate([r(cc.Node)],e.prototype,"m_checkBeginNode",void 0),__decorate([r(cc.Node)],e.prototype,"key",void 0),__decorate([r(cc.Node)],e.prototype,"plane",void 0),__decorate([r(cc.Node)],e.prototype,"ball",void 0),__decorate([s],e)}(cc.Component);i.BallFallGameWindow=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./BallFallModel":"BallFallModel"}],BallFallModel:[function(t,e,i){"use strict";cc._RF.push(e,"acb893iE91LuK2GAnU44N55","BallFallModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.BallFallModel=i.ColiderMask=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame");(function(t){t[t.None=Math.pow(2,0)]="None",t[t.Wall=Math.pow(2,1)]="Wall",t[t.Ball=Math.pow(2,2)]="Ball",t[t.Key=Math.pow(2,3)]="Key",t[t.Result=Math.pow(2,4)]="Result",t[t.All=Math.pow(2,31)]="All"})(i.ColiderMask||(i.ColiderMask={}));var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/ballFall/ballFall",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.ballFall)],e)}(n.default);i.BallFallModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],BaseFish:[function(t,e,i){"use strict";cc._RF.push(e,"b07332uGkxOhbxSex9W83OA","BaseFish"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../FishGrowUtil"),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._dir=cc.Vec2.ZERO,e.fishLevel=1,e.fishType=0,e.fishState=o.FishState.Idle,e}return __extends(e,t),e.prototype.onLoad=function(){if(this.fishLevel=this.fishType+1,o.FishGrowConst.DEBUG){var t=o.FishGrowConst.InitFishesSize[this.fishType],e=this.addComponent(cc.Graphics);e.rect(-t[0]/2,-t[1]/2,t[0],t[1]),e.stroke()}},e.prototype.getFishType=function(){return this.fishType},e.prototype.setFishType=function(t){if(this.fishType=t,this.fishLevel=t+1,o.FishGrowConst.DEBUG){var e=o.FishGrowConst.InitFishesSize[this.fishType],i=this.getComponent(cc.Graphics);i.clear(),i.rect(-e[0]/2,-e[1]/2,e[0],e[1]),i.stroke()}},__decorate([s({type:cc.Integer,range:[0,9,1]})],e.prototype,"fishType",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"../FishGrowUtil":"FishGrowUtil"}],BladeFlyBlade:[function(t,e,i){"use strict";cc._RF.push(e,"8caa4rxX9dIxYW2PnJ8e0vJ","BladeFlyBlade"),Object.defineProperty(i,"__esModule",{value:!0}),i.BladeFlyBlade=void 0;var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=t("./BladeFlyGameWindow"),a=t("./BladeFlyModel"),s=t("./config_BladeFly"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bladeSprite=null,e.bladeEffect=null,e.dir=cc.Vec2.ZERO,e.isOver=!0,e.mode=0,e.selfCollider=!1,e.lines=[],e.effects=[],e.curLineDist=0,e.curIndex=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"pos",{get:function(){return o.default.V2(this.node.position)},set:function(t){this.node.position=o.default.V3(t)},enumerable:!1,configurable:!0}),e.prototype.update=function(t){this.bladeSprite.node.angle+=s.BladeFly.flyRot*t,this.isOver||a.BF_S.Ins.mgr.curState==n.GameState.over||(0==this.mode&&this.stepByWithPath(t),1==this.mode&&this.stepByRealTime(t))},e.prototype.excuteEffect=function(t){console.log(t),t.hitCallBack&&t.hitCallBack(),t.reflect&&(this.dir=t.reflect),t.disappear?this.over():t.enemyDie?(this.over(),a.BF_S.Ins.mgr.enemyDie()):t.selfDie?(this.over(),a.BF_S.Ins.mgr.selfDie()):t.friendDie&&(this.over(),a.BF_S.Ins.mgr.friendDie())},e.prototype.init=function(){this.bladeSprite.enabled=!0,this.bladeEffect.enabled=!1},e.prototype.over=function(){this.bladeSprite.enabled=!1,this.bladeEffect.enabled=!0,this.bladeEffect.setAnimation(0,"animation",!1),this.isOver=!0,a.BF_S.Ins.mgr.bladeOver()},e.prototype.startRealTime=function(t,e){this.pos=t,this.dir=e,this.selfCollider=!1,this.isOver=!1,this.mode=1,this.init()},e.prototype.stepByRealTime=function(t){var e=this,i=s.BladeFly.flySpeed*t,o=a.BF_S.Ins.mgr.calc(this.pos,this.dir,i,!1);!this.selfCollider&&o.effects.some(function(t){return t.selfDie})&&(o=a.BF_S.Ins.mgr.calc(this.pos,this.dir,i,!0),this.selfCollider=!0),o.effects.forEach(function(t){return e.excuteEffect(t)}),this.pos=o.lines[o.lines.length-1].end},e.prototype.startWithPath=function(t,e){this.lines=t,this.effects=e,this.curLineDist=0,this.curIndex=0,this.isOver=!1,this.mode=0,this.init()},e.prototype.hit=function(){if(this.curLineDist=0,!(this.curIndex>=this.effects.length)){var t=this.effects[this.curIndex];this.excuteEffect(t),this.curIndex++}},e.prototype.end=function(){},e.prototype.stepByWithPath=function(t){var e=s.BladeFly.flySpeed*t;if(!this.isOver){if(this.curIndex>=this.lines.length)return this.over(),void(this.pos=this.lines[this.lines.length-1].end);var i=this.lines[this.curIndex],n=i.length,a=e+this.curLineDist;if(n){if(!(a>=n)){var r=o.default.Clamp(0,1,a/n);return this.curLineDist=a,this.pos=o.default.Lerp2(i.start,i.end,r),void this.end()}e=a-n,this.hit(),this.stepByWithPath(e)}else console.error("path: \u8def\u5f84\u7ebf\u957f\u5ea6\u51fa\u9519")}},__decorate([l(cc.Sprite)],e.prototype,"bladeSprite",void 0),__decorate([l(sp.Skeleton)],e.prototype,"bladeEffect",void 0),__decorate([c],e)}(cc.Component);i.BladeFlyBlade=h,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt","./BladeFlyGameWindow":"BladeFlyGameWindow","./BladeFlyModel":"BladeFlyModel","./config_BladeFly":"config_BladeFly"}],BladeFlyGameWindow:[function(t,e,i){"use strict";cc._RF.push(e,"d7173AJ3JpG8q8KG2FNHjpE","BladeFlyGameWindow"),Object.defineProperty(i,"__esModule",{value:!0}),i.BladeFlyGameWindow=i.GameState=void 0;var o,n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=t("../../miniGamePackage/utils/Line"),s=__importDefault(t("../../miniGamePackage/utils/MathExt")),r=t("./BladeFlyBlade"),c=t("./BladeFlyModel"),l=__importDefault(t("./BladeFlyProgressBar")),h=t("./ColliderObjs/Enemy"),u=t("./ColliderObjs/Friend"),d=t("./ColliderObjs/Self"),p=t("./ColliderObjs/Wall"),m=t("./config_BladeFly"),f=__importDefault(t("./LineLoader")),g=cc._decorator,_=g.ccclass,y=g.property;(function(t){t[t.ready=0]="ready",t[t.running=1]="running",t[t.wait=2]="wait",t[t.over=3]="over"})(o=i.GameState||(i.GameState={}));var v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mapGraphic=null,e.promptGraphic=null,e.enemyGraphic=null,e.wallLoader=null,e.playerNode=null,e.enemyNode=null,e.friendNode=null,e.blade=null,e.root=null,e.progressBar=null,e.envs=[],e.enemy=null,e.friend=null,e.playerAnim=null,e.friendAnim=null,e.enemyAnim=null,e.changeAnim=null,e.hurtAnim=null,e.dirSprite=null,e.lifeBar=null,e.zombieData=null,e.curState=o.wait,e.life=3,e.lifeSprites=[],e.startTime=0,e.bladePath=[],e.bladeEffect=[],e.isZombie=!1,e.moving=!1,e.isOverlap=!1,e}return __extends(e,t),e.prototype.onLoad=function(){c.BF_S.Ins.mgr=this},e.prototype.exit=function(){n.default.instance.getModel().gameExit()},e.prototype.start=function(){var t=this;this.initMap();var e=new d.BladeFlySelf(s.default.V2(this.playerNode.position),cc.v2(this.playerNode.width,this.playerNode.height));m.BladeFly.frameDebug&&e.showEdge(this.mapGraphic),this.envs.push(e);var i=new u.BladeFlyFriend(s.default.V2(this.friendNode.position),cc.v2(this.friendNode.width,this.friendNode.height));this.friend=i,m.BladeFly.frameDebug&&i.showEdge(this.mapGraphic),this.envs.push(i);var n=new h.BladeFlyEnemy(s.default.V2(this.enemyNode.position),cc.v2(this.enemyNode.width,this.enemyNode.height));this.enemy=n,m.BladeFly.frameDebug&&n.showEdge(this.enemyGraphic),this.envs.push(n),this.curState=o.wait,this.playerAnim.setCompleteListener(function(){t.playerAnim.setAnimation(0,"idle",!0),t.playerAnim.setCompleteListener(function(){})}),this.playerAnim.setAnimation(0,"fall",!1),this.friendAnim.setCompleteListener(function(){t.friendAnim.setAnimation(0,"idle",!0),t.friendAnim.setCompleteListener(function(){})}),this.friendAnim.setAnimation(0,"fall",!1),this.enemyAnim.setCompleteListener(function(){t.enemyAnim.setAnimation(0,"idle",!0),t.enemyAnim.setCompleteListener(function(){})}),this.enemyAnim.setAnimation(0,"fall",!1)},e.prototype.enemyDie=function(){this.enemyAnim.setAnimation(0,"die",!1),this.win()},e.prototype.lifeIconFlyAnim=function(){var t=this,e=this.lifeSprites[this.lifeSprites.length-this.life],i=e.node.parent.position;e.node.parent=this.playerNode.parent,e.node.position=e.node.position.add(i),cc.tween(e.node).to(.5,{position:this.playerNode.position}).call(function(){t.dirSprite.active=!0,t.curState=o.wait,e.enabled=!1}).start()},e.prototype.selfDie=function(){var t=this;this.life--,this.life>0?this.playerAnim.setCompleteListener(function(){t.playerAnim.setCompleteListener(function(){t.playerAnim.setCompleteListener(function(){}),t.lifeIconFlyAnim(),t.playerAnim.setAnimation(0,"idle",!0)}),t.playerAnim.setAnimation(0,"fall",!1)}):this.lose(),this.playerAnim.setAnimation(0,"die",!1)},e.prototype.friendDie=function(){var t=this;this.life--,this.life>0?this.friendAnim.setCompleteListener(function(){t.friendAnim.setCompleteListener(function(){t.friendAnim.setCompleteListener(function(){}),t.lifeIconFlyAnim(),t.playerAnim.setAnimation(0,"idle",!0),t.friendAnim.setAnimation(0,t.isZombie?"idle2":"idle",!0)}),t.friendAnim.setAnimation(0,"fall",!1)}):this.lose(),this.friendAnim.setAnimation(0,"die",!1)},e.prototype.win=function(){var t=this;setTimeout(function(){n.default.instance.gotoResultWithLoading(!0,t.node.parent)},500),this.curState=o.over},e.prototype.lose=function(){var t=this;setTimeout(function(){n.default.instance.gotoResultWithLoading(!1,t.node.parent)},500),this.curState=o.over},e.prototype.bladeOver=function(){},e.prototype.initMap=function(){var t=this,e=this.wallLoader.load();this.envs.push(new p.BladeFlyWall(e)),m.BladeFly.frameDebug&&this.envs.forEach(function(e){return e.showEdge(t.mapGraphic)}),this.startTime=Date.now()},e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.down,this),this.node.on(cc.Node.EventType.TOUCH_END,this.up,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.move,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.up,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.down,this),this.node.off(cc.Node.EventType.TOUCH_END,this.up,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.move,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.up,this)},e.prototype.startFly=function(t){var e=this;this.playerAnim.setCompleteListener(function(){e.playerAnim.setAnimation(0,"idle",!0),e.playerAnim.setCompleteListener(function(){})}),this.playerAnim.setAnimation(0,"attack",!1),setTimeout(function(){return e.blade.startRealTime(s.default.V2(e.playerNode.position),t)},200)},e.prototype.down=function(){this.curState==o.wait&&(this.curState=o.ready)},e.prototype.move=function(t){if(this.curState==o.ready){this.promptGraphic.clear();var e=this.node.convertToNodeSpaceAR(t.getLocation()),i=s.default.V2(this.playerNode.position),n=e.sub(i).normalize();if(this.dirSprite.active=!0,this.dirSprite.angle=s.default.getRad(n)*s.default.Rad2Ang,m.BladeFly.frameDebug){var a=this.calc(i,n,5e3);this.bladePath=a.lines,this.bladeEffect=a.effects,this.showPrompt(a.lines)}}},e.prototype.up=function(t){if(this.curState==o.ready){var e=this.node.convertToNodeSpaceAR(t.getLocation()),i=s.default.V2(this.playerNode.position),n=e.sub(i).normalize();this.startFly(n),this.curState=o.running,this.promptGraphic.clear(),this.dirSprite.angle=0,this.dirSprite.active=!1}},e.prototype.showPrompt=function(t){var e=this;m.BladeFly.frameDebug&&t.forEach(function(t){return t.showLine(e.promptGraphic,5,cc.Color.CYAN)})},e.prototype.calc=function(t,e,i,o){var n=this;void 0===i&&(i=500);var s=[],r=[],c=!1;if(this.envs){var l=function(t,e,i){for(var h={point:t,dir:e,dist:i},u={},d=Number.MAX_VALUE,p=0;p<n.envs.length;p++){var m=n.envs[p].collisionRet(h);if(m.point){if(o||m.selfDie&&!c&&null==o){c=!0;continue}(_=cc.Vec2.distance(m.point,h.point))<d&&(d=_,u=m)}}if(!u.point)return s.push(a.Line.Vec2Line(e,t,i)),{lines:s,effects:r};if(u.reflect){var f=u.point,g=u.reflect,_=cc.Vec2.distance(t,f);s.push(a.Line.Vec2Line(e,t,_)),r.push(u),l(f,g,i-_)}else f=u.point,_=cc.Vec2.distance(t,f),s.push(a.Line.Vec2Line(e,t,_)),r.push(u)};l(t,e,i)}else console.error("\u627e\u4e0d\u5230\u73af\u5883"),s.push(a.Line.Vec2Line(e,t,i));return{lines:s,effects:r}},e.prototype.update=function(t){var e=this;if(this.curState!=o.over)if(Date.now()>this.startTime+m.BladeFly.enemyWaitTime)this.progressBar.node.active&&(this.progressBar.node.active=!1),this.isZombie||(this.isZombie=!0,this.friendAnim.setCompleteListener(function(){e.friendAnim.setAnimation(0,"idle2",!0),e.friendAnim.setCompleteListener(function(){})}),this.friendAnim.setAnimation(0,"scare",!1),this.changeAnim.enabled=!1,this.enemyAnim.skeletonData=this.zombieData,this.enemyAnim.setAnimation(0,"idle",!0),this.changeAnim.enabled=!0,this.changeAnim.setCompleteListener(function(){e.enemyAnim.setAnimation(0,"run",!0),e.moving=!0,e.changeAnim.setCompleteListener(function(){})}),this.changeAnim.setAnimation(0,"animation",!1)),this.moving&&(this.enemy.moveBy(cc.v2(-1,0).mul(m.BladeFly.enemyMoveSpeed*t)),this.enemyNode.position=s.default.V3(this.enemy.center)),this.enemyGraphic.clear(),m.BladeFly.frameDebug&&this.enemy.showEdge(this.enemyGraphic),this.enemy.overlap(this.friend)&&!this.isOverlap&&(this.isOverlap=!0,this.moving=!1,this.enemyAnim.setCompleteListener(function(){e.enemyAnim.setCompleteListener(function(){}),console.log(e.curState),e.curState!=o.over&&(e.friendAnim.setAnimation(0,"die",!1),e.hurtAnim.enabled=!0,e.hurtAnim.setAnimation(0,"animation",!1),e.lose())}),this.enemyAnim.setAnimation(0,"attack",!1));else{var i=(Date.now()-this.startTime)/m.BladeFly.enemyWaitTime;this.progressBar.refresh(i)}},__decorate([y(cc.Graphics)],e.prototype,"mapGraphic",void 0),__decorate([y(cc.Graphics)],e.prototype,"promptGraphic",void 0),__decorate([y(cc.Graphics)],e.prototype,"enemyGraphic",void 0),__decorate([y(f.default)],e.prototype,"wallLoader",void 0),__decorate([y(cc.Node)],e.prototype,"playerNode",void 0),__decorate([y(cc.Node)],e.prototype,"enemyNode",void 0),__decorate([y(cc.Node)],e.prototype,"friendNode",void 0),__decorate([y(r.BladeFlyBlade)],e.prototype,"blade",void 0),__decorate([y(cc.Node)],e.prototype,"root",void 0),__decorate([y(l.default)],e.prototype,"progressBar",void 0),__decorate([y(sp.Skeleton)],e.prototype,"playerAnim",void 0),__decorate([y(sp.Skeleton)],e.prototype,"friendAnim",void 0),__decorate([y(sp.Skeleton)],e.prototype,"enemyAnim",void 0),__decorate([y(sp.Skeleton)],e.prototype,"changeAnim",void 0),__decorate([y(sp.Skeleton)],e.prototype,"hurtAnim",void 0),__decorate([y(cc.Node)],e.prototype,"dirSprite",void 0),__decorate([y(cc.Node)],e.prototype,"lifeBar",void 0),__decorate([y(sp.SkeletonData)],e.prototype,"zombieData",void 0),__decorate([y(cc.Sprite)],e.prototype,"lifeSprites",void 0),__decorate([_],e)}(cc.Component);i.BladeFlyGameWindow=v,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/utils/Line":"Line","../../miniGamePackage/utils/MathExt":"MathExt","./BladeFlyBlade":"BladeFlyBlade","./BladeFlyModel":"BladeFlyModel","./BladeFlyProgressBar":"BladeFlyProgressBar","./ColliderObjs/Enemy":"Enemy","./ColliderObjs/Friend":"Friend","./ColliderObjs/Self":"Self","./ColliderObjs/Wall":"Wall","./LineLoader":"LineLoader","./config_BladeFly":"config_BladeFly"}],BladeFlyModel:[function(t,e,i){"use strict";cc._RF.push(e,"dfbeaXKK4JP3qLHWj2hZ1kj","BladeFlyModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.BladeFlyModel=i.BF_S=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return e.getInst()},enumerable:!1,configurable:!0}),e}(t("../../miniGamePackage/utils/SingleClass").SingleClass);i.BF_S=s;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/bladeFly/bladeFly",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.bladeFly)],e)}(n.default);i.BladeFlyModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame","../../miniGamePackage/utils/SingleClass":"SingleClass"}],BladeFlyProgressBar:[function(t,e,i){"use strict";cc._RF.push(e,"299c8IW5M9Ic5sTAlWFyFqE","BladeFlyProgressBar"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.drawer=null,e.wid=200,e.hei=20,e.stroke=5,e.color=cc.color(207,115,207,255),e}return __extends(e,t),e.prototype.refresh=function(t){this.drawer.clear();var e=cc.Vec2.ZERO.sub(cc.v2(this.wid/2,this.hei/2));this.drawer.fillColor=this.drawer.strokeColor=this.color,this.drawer.lineWidth=this.stroke,this.drawer.roundRect(e.x,e.y,this.wid*t,this.hei,this.hei/2),this.drawer.fill(),this.drawer.roundRect(e.x,e.y,this.wid,this.hei,this.hei/2),this.drawer.stroke()},__decorate([a(cc.Node)],e.prototype,"label",void 0),__decorate([a(cc.Graphics)],e.prototype,"drawer",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],BrickGameEdit:[function(t,e,i){"use strict";cc._RF.push(e,"28d64NzoedOULm47xm3Vh+D","BrickGameEdit"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=t("./BrickItem"),s=t("./BrickModel"),r=__importDefault(t("./BrickWallItem")),c=cc._decorator,l=c.ccclass,h=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._mapRow=23,e.brickPrefab=null,e.wallPrefab=null,e._wallItems=[],e._brickItems=[],e}return __extends(e,t),e.prototype.onLoad=function(){for(var t=s.BrickColor.DEFAULT;t<s.BrickColor.MAX;t++){var e=cc.instantiate(this.brickPrefab),i=e.getComponent(a.BrickItem);e.parent=this.node,e.y=-800,e.x=40*(t-1),i.brickColor=t,i.selectedButton.node.active=!0}this._createMap(),this._createWall(),this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this)},e.prototype._onTouchMove=function(t){for(var e=t.getLocation(),i=t.getCurrentTarget().convertToNodeSpaceAR(e),o=n.default.getInst().getModel(),a=0;a<this._brickItems.length;a++)for(var s=0;s<this._brickItems.length;s++)(r=this._brickItems[a][s]).node.getBoundingBox().contains(i)&&(r.brickColor=o.curColor);for(a=0;a<this._wallItems.length;a++){var r;(r=this._wallItems[a]).node.getBoundingBox().contains(i)&&r.setColor(o.curColor)}},e.prototype.test=function(){this.genMapData(),n.default.instance.miniGameAdapter.eventMgr.emit(o.MiniGameEvent.EventGameWin)},e.prototype.genMapData=function(){for(var t=n.default.getInst().getModel(),e=[],i=[],o=0;o<this._brickItems.length;o++){e[o]=[];for(var a=0;a<this._brickItems.length;a++)(r=this._brickItems[o][a]).brickColor>s.BrickColor.DEFAULT?e[o][a]=r.brickColor:e[o][a]=s.BrickColor.DEFAULT}for(o=0;o<this._wallItems.length;o++){var r=this._wallItems[o];i.push(r.wallColor)}console.log("#####\u5730\u56fe\u6570\u636e####"),console.log(JSON.stringify(e)),console.log("#####\u5899\u6570\u636e####"),console.log(JSON.stringify(i)),t.mapColorData=JSON.stringify(e),t.wallColorData=JSON.stringify(i)},e.prototype._createMap=function(){var t=this.brickPrefab.data.width,e=this.brickPrefab.data.height,i=this._mapRow*t/2-t/2,o=this._mapRow*e/2-e/2;this.node.setPosition(cc.v2(-i,o));for(var n=0;n<this._mapRow;n++){this._brickItems[n]=[];for(var r=0;r<this._mapRow;r++){var c=cc.instantiate(this.brickPrefab);c.parent=this.node;var l=c.getComponent(a.BrickItem);l.init(n,r,s.BrickColor.DEFAULT),this._brickItems[n][r]=l}}},e.prototype._createWall=function(){for(var t=0;t<4;t++){var e=cc.instantiate(this.wallPrefab);e.parent=this.node,this._wallItems.push(e.getComponent(r.default))}var i=this.brickPrefab.data.width,o=i/2,n=i*this._mapRow,a=i*this._mapRow,c=this._wallItems[s.BrickWallDirType.LEFT],l=this._wallItems[s.BrickWallDirType.RIGHT],h=this._wallItems[s.BrickWallDirType.TOP],u=this._wallItems[s.BrickWallDirType.BOTTOM];c.node.setPosition(cc.v2(-i,-n/2+o)),c.setColor(s.BrickColor.BLACK),l.node.setPosition(cc.v2(a,-n/2+o)),l.setColor(s.BrickColor.BLACK),u.node.setPosition(cc.v2(a/2-o,-n)),u.setColor(s.BrickColor.BLACK),h.node.setPosition(cc.v2(a/2-o,i)),h.setColor(s.BrickColor.BLACK),c.node.angle=0,l.node.angle=180,h.node.angle=90,u.node.angle=-90},e.prototype.onWallTextChange=function(t){var e=n.default.getInst().getModel();e.wallColorData=t;try{for(var i=JSON.parse(e.wallColorData),o=0;o<this._wallItems.length;o++)this._wallItems[o].setColor(i[o])}catch(a){console.log(a)}},e.prototype.onBrickTextChange=function(t){var e=n.default.getInst().getModel();e.mapColorData=t;try{for(var i=JSON.parse(e.mapColorData),o=0;o<this._brickItems.length;o++)for(var a=0;a<this._brickItems[o].length;a++)this._brickItems[o][a].brickColor=i[o][a]}catch(s){console.log(s)}},e.prototype.start=function(){},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this)},__decorate([h(cc.Prefab)],e.prototype,"brickPrefab",void 0),__decorate([h(cc.Prefab)],e.prototype,"wallPrefab",void 0),__decorate([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../../../../game/scripts/mini-adapter/types-miniPre":void 0,"../../miniGamePackage/SubPackageManager":"SubPackageManager","./BrickItem":"BrickItem","./BrickModel":"BrickModel","./BrickWallItem":"BrickWallItem"}],BrickItem:[function(t,e,i){"use strict";cc._RF.push(e,"95cb2A2ZhRFu6srlKEVDy0G","BrickItem"),Object.defineProperty(i,"__esModule",{value:!0}),i.BrickItem=void 0;var o=cc._decorator,n=o.ccclass,a=o.property,s=__importDefault(t("../../miniGamePackage/SubPackageManager")),r=t("./BrickModel"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.nodes=[],e.skeleton=null,e.editButton=null,e.selectedButton=null,e._tween=null,e._brickState=r.BrickItemState.NORMAL,e._rowIndex=0,e._columnIndex=0,e._brickColor=r.BrickColor.DEFAULT,e._curPos=cc.v2(0,0),e._targetPos=cc.v2(0,0),e}return __extends(e,t),Object.defineProperty(e.prototype,"brickState",{get:function(){return this._brickState},set:function(t){this._brickState=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columnIndex",{get:function(){return this._columnIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowIndex",{get:function(){return this._rowIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"brickColor",{get:function(){return this._brickColor},set:function(t){this._brickColor=t,this._updateColor()},enumerable:!1,configurable:!0}),e.prototype.init=function(t,e,i){this.brickColor=i,this._rowIndex=t,this._columnIndex=e,this._curPos=this._getPos(),this.node.setPosition(this._curPos),this.updatePos(t,e)},e.prototype._updateColor=function(){for(var t=0;t<this.nodes.length;t++)this.nodes[t]&&(this.nodes[t].active=t==this.brickColor)},e.prototype.updatePos=function(t,e){this._rowIndex=t,this._columnIndex=e,this._targetPos=this._getPos(),this.moveToTargetPos()},e.prototype._getPos=function(){return cc.v2(this._columnIndex*this.node.width,-this._rowIndex*this.node.height)},e.prototype.moveToTargetPos=function(){var t=this;if(this.brickState!==r.BrickItemState.REMOVE){var e=Math.abs(this.node.x-this._targetPos.x)/1600,i=Math.abs(this.node.y-this._targetPos.y)/1600,o=Math.max(Math.max(e,i),.001);this.brickState===r.BrickItemState.REMOVING?(this._tween&&this._tween.stop(),this._tween=cc.tween(this.node).to(o,{x:this._targetPos.x,y:this._targetPos.y}).call(function(){t.skeleton.node.active=!0,t.skeleton.loop=!1,t.skeleton.setSkin(t._getSkinName()),t.skeleton.animation="animation"}).delay(o).call(function(){t.node.active=!1}).start()):(this._tween&&this._tween.stop(),this._tween=cc.tween(this.node).to(o,{x:this._targetPos.x,y:this._targetPos.y}).start())}},e.prototype._getSkinName=function(){switch(this.brickColor){case r.BrickColor.BLUE:return"p7";case r.BrickColor.GREEN:return"p6";case r.BrickColor.RED:return"p3";case r.BrickColor.YELLOW:return"p4";case r.BrickColor.GRAY:return"p5";case r.BrickColor.BLACK:return"p2";case r.BrickColor.PINK:return"p1"}return"p1"},e.prototype.onClickSelected=function(){s.default.getInst().getModel().curColor=this.brickColor},e.prototype.onDisable=function(){this._tween&&this._tween.stop()},e.prototype.onClickEdit=function(){var t=s.default.getInst().getModel();this.brickColor=t.curColor},__decorate([a([cc.Node])],e.prototype,"nodes",void 0),__decorate([a(sp.Skeleton)],e.prototype,"skeleton",void 0),__decorate([a(cc.Button)],e.prototype,"editButton",void 0),__decorate([a(cc.Button)],e.prototype,"selectedButton",void 0),__decorate([n],e)}(cc.Component);i.BrickItem=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./BrickModel":"BrickModel"}],BrickLogic:[function(t,e,i){"use strict";cc._RF.push(e,"f0be0NwuGdD3rLRf19EyEjP","BrickLogic"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=t("./BrickItem"),s=t("./BrickModel"),r=__importDefault(t("./BrickWallItem")),c=cc._decorator,l=c.ccclass,h=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mapData="",e.brickPrefab=null,e.backGround=null,e.wallPrefab=null,e.shuffleIcon=null,e.leftWallColor=[],e.wallColorData=[],e.brickColorData=[],e._wallItems=[],e._brickItems=[],e._map=[],e._model=null,e._isGameOver=!1,e}return __extends(e,t),e.prototype._createMap=function(){for(var t=this._map,e=0;e<t.length;e++){this._brickItems[e]=[];for(var i=0;i<t[e].length;i++)if(t[e][i]!=s.BrickColor.DEFAULT){var o=cc.instantiate(this.brickPrefab),n=o.getComponent(a.BrickItem);o.parent=this.node,n.init(e,i,t[e][i]),this._brickItems[e][i]=n}}var r=this.brickPrefab.data.width,c=this.brickPrefab.data.height,l=t[0].length*r/2-r/2,h=t.length*c/2-c/2+40;this.node.setPosition(cc.v2(-l,h)),this.backGround&&this.backGround.setPosition(cc.v2(l,-h))},e.prototype._createWall=function(){for(var t=0;t<4;t++){var e=cc.instantiate(this.wallPrefab);e.parent=this.node,this._wallItems.push(e.getComponent(r.default))}var i=this.wallColorData[this._model.mapIndex];this.leftWallColor=i?JSON.parse(i):this.leftWallColor;var o=this.brickPrefab.data.width,n=o/2,a=o*this._map.length,c=o*this._map[0].length,l=this._wallItems[s.BrickWallDirType.LEFT],h=this._wallItems[s.BrickWallDirType.RIGHT],u=this._wallItems[s.BrickWallDirType.TOP],d=this._wallItems[s.BrickWallDirType.BOTTOM];l.node.setPosition(cc.v2(-o,-a/2+n)),l.setColor(this.leftWallColor[s.BrickWallDirType.LEFT]),h.node.setPosition(cc.v2(c,-a/2+n)),h.setColor(this.leftWallColor[s.BrickWallDirType.RIGHT]),d.node.setPosition(cc.v2(c/2-n,-a)),d.setColor(this.leftWallColor[s.BrickWallDirType.BOTTOM]),u.node.setPosition(cc.v2(c/2-n,o)),u.setColor(this.leftWallColor[s.BrickWallDirType.TOP]),l.node.angle=0,h.node.angle=180,u.node.angle=90,d.node.angle=-90},e.prototype.onLoad=function(){var t;this._model=n.default.instance.getModel();var e=this._model.mapIndex;e>=this.brickColorData.length&&(this._model.mapIndex=e=this.brickColorData.length,this._generateRandomLevel());var i=this.brickColorData[e];this._map=JSON.parse(i||this.mapData),this._model.mapRow=this._map.length,this._createWall(),this._createMap(),this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this),null===(t=this.shuffleIcon)||void 0===t||t.node.on(cc.Node.EventType.TOUCH_START,this._onShuffleIconTouch,this)},e.prototype._onShuffleIconTouch=function(){this._shuffleBricks()},e.prototype._onTouchStart=function(){},e.prototype._onTouchMove=function(){},e.prototype._onTouchEnd=function(t){if(!this._isGameOver){var e=t.getLocation(),i=t.getStartLocation(),o=e.sub(i);Math.abs(o.x)<10&&Math.abs(o.y)<10||(Math.abs(o.x)>Math.abs(o.y)?o.x>0?this._moveRight():this._moveLeft():o.y>0?this._moveUp():this._moveDown(),this._updateBrickItems())}},e.prototype._moveRight=function(){for(var t=this._wallItems[s.BrickWallDirType.RIGHT],e=0;e<this._map.length;e++)for(var i=(o=this._map[e]).length-1;i>=0;i--)if((a=this._brickItems[e][i])&&a.brickColor!==s.BrickColor.DEFAULT&&a.brickState!==s.BrickItemState.REMOVING){if(a.brickColor!==t.wallColor)break;a.brickState=s.BrickItemState.REMOVING,a.updatePos(e,this._map[0].length)}for(e=0;e<this._map.length;e++){var o=this._map[e],n=this._map[0].length-1;for(i=o.length-1;i>=0;i--){var a;(a=this._brickItems[e][i])&&a.brickColor!==s.BrickColor.DEFAULT&&a.brickState!==s.BrickItemState.REMOVING&&a.updatePos(a.rowIndex,n--)}}},e.prototype._moveLeft=function(){for(var t=this._wallItems[s.BrickWallDirType.LEFT],e=0;e<this._map.length;e++)for(var i=this._map[e],o=0;o<i.length;o++)if((a=this._brickItems[e][o])&&a.brickColor!==s.BrickColor.DEFAULT&&a.brickState!==s.BrickItemState.REMOVING){if(a.brickColor!==t.wallColor)break;a.brickState=s.BrickItemState.REMOVING,a.updatePos(a.rowIndex,-1)}for(e=0;e<this._map.length;e++){i=this._map[e];var n=0;for(o=0;o<i.length;o++){var a;(a=this._brickItems[e][o])&&a.brickColor!==s.BrickColor.DEFAULT&&a.brickState!==s.BrickItemState.REMOVING&&a.updatePos(a.rowIndex,n++)}}},e.prototype._moveUp=function(){for(var t=this._wallItems[s.BrickWallDirType.TOP],e=0;e<this._map[0].length;e++)for(var i=0;i<this._map.length;i++)if((n=this._brickItems[i][e])&&n.brickColor!==s.BrickColor.DEFAULT&&n.brickState!==s.BrickItemState.REMOVING){if(n.brickColor!==t.wallColor)break;n.brickState=s.BrickItemState.REMOVING,n.updatePos(-1,n.columnIndex)}for(e=0;e<this._map[0].length;e++){var o=0;for(i=0;i<this._map.length;i++){var n;(n=this._brickItems[i][e])&&n.brickColor!==s.BrickColor.DEFAULT&&n.brickState!==s.BrickItemState.REMOVING&&n.updatePos(o++,n.columnIndex)}}},e.prototype._moveDown=function(){for(var t=this._wallItems[s.BrickWallDirType.BOTTOM],e=0;e<this._map[0].length;e++)for(var i=this._map.length-1;i>=0;i--)if((n=this._brickItems[i][e])&&n.brickColor!==s.BrickColor.DEFAULT&&n.brickState!==s.BrickItemState.REMOVING){if(n.brickColor!==t.wallColor)break;n.brickState=s.BrickItemState.REMOVING,n.updatePos(this._map.length,n.columnIndex)}for(e=0;e<this._map[0].length;e++){var o=this._map.length-1;for(i=this._map.length-1;i>=0;i--){var n;(n=this._brickItems[i][e])&&n.brickColor!==s.BrickColor.DEFAULT&&n.brickState!==s.BrickItemState.REMOVING&&n.updatePos(o--,n.columnIndex)}}},e.prototype._shuffleBricks=function(){for(var t=[],e=0;e<this._map.length;e++)for(var i=0;i<this._map[e].length;i++)(r=this._brickItems[e][i])&&r.brickColor!==s.BrickColor.DEFAULT&&r.brickState!==s.BrickItemState.REMOVING&&t.push(r);for(e=t.length-1;e>0;e--){i=Math.floor(Math.random()*(e-1));var o=t[e];t[e]=t[i],t[i]=o}var n=[];for(e=0;e<t.length;e++)n.push({row:t[e].rowIndex,column:t[e].columnIndex});var a=0;for(e=0;e<this._map.length;e++)for(i=0;i<this._map[e].length;i++){var r;if((r=this._brickItems[e][i])&&r.brickColor!==s.BrickColor.DEFAULT&&r.brickState!==s.BrickItemState.REMOVING){var c=n[a++];r.updatePos(c.row,c.column)}}this._updateBrickItems()},e.prototype._updateBrickItems=function(){for(var t=[],e=0,i=0;i<this._map.length;i++)t.push([]);for(i=0;i<this._map.length;i++)for(var o=this._map[i],n=0;n<o.length;n++){var a=this._brickItems[i][n];a&&(a.brickState===s.BrickItemState.REMOVING?(this._brickItems[i][n]=null,a.brickState=s.BrickItemState.REMOVE):(e++,t[a.rowIndex][a.columnIndex]=a))}this._brickItems=t,0===e&&this._gameOver()},e.prototype._gameOver=function(){var t=this;this._isGameOver=!0,this._model.mapIndex;var e=n.default.instance.miniGameAdapter.eventMgr;cc.tween(this.node).delay(1).call(function(){t.brickColorData.length,e.emit(o.MiniGameEvent.EventLevelComplete)}).start()},e.prototype.onDisable=function(){var t;this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this),null===(t=this.shuffleIcon)||void 0===t||t.node.off(cc.Node.EventType.TOUCH_START,this._onShuffleIconTouch,this)},e.prototype._generateRandomLevel=function(){for(var t=[],e=0;e<4;e++)t.push(Math.floor(7*Math.random())+1);var i=[];for(e=0;e<23;e++){i[e]=[];for(var o=0;o<23;o++)if(Math.random()>.25){var n=[];e>0&&n.push(i[e-1][o]),o>0&&n.push(i[e][o-1]);var a;a=n.length>0&&Math.random()>.5?n[Math.floor(Math.random()*n.length)]:t[Math.floor(Math.random()*t.length)],i[e].push(a)}else i[e].push(0)}this.wallColorData.push(JSON.stringify(t)),this.brickColorData.push(JSON.stringify(i))},__decorate([h()],e.prototype,"mapData",void 0),__decorate([h(cc.Prefab)],e.prototype,"brickPrefab",void 0),__decorate([h(cc.Node)],e.prototype,"backGround",void 0),__decorate([h(cc.Prefab)],e.prototype,"wallPrefab",void 0),__decorate([h(cc.Button)],e.prototype,"shuffleIcon",void 0),__decorate([h({type:cc.Enum(s.BrickColor),displayName:"\u5899\u4f53\u989c\u8272"})],e.prototype,"leftWallColor",void 0),__decorate([h({type:[cc.String],displayName:"\u5899\u4f53\u989c\u8272\u6570\u636e"})],e.prototype,"wallColorData",void 0),__decorate([h({type:[cc.String],displayName:"\u7816\u5757\u989c\u8272\u6570\u636e"})],e.prototype,"brickColorData",void 0),__decorate([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../../../../game/scripts/mini-adapter/types-miniPre":void 0,"../../miniGamePackage/SubPackageManager":"SubPackageManager","./BrickItem":"BrickItem","./BrickModel":"BrickModel","./BrickWallItem":"BrickWallItem"}],BrickModel:[function(t,e,i){"use strict";cc._RF.push(e,"172fe0x8JFPTIDX37KDfDis","BrickModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.BrickModel=i.BrickItemState=i.BrickWallDirType=i.BrickColor=void 0;var o,n=t("../../miniGamePackage/SubPackageManager"),a=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),s=t("../../miniGamePackage/types-miniGame");(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.GREEN=1]="GREEN",t[t.YELLOW=2]="YELLOW",t[t.BLACK=3]="BLACK",t[t.RED=4]="RED",t[t.PINK=5]="PINK",t[t.GRAY=6]="GRAY",t[t.BLUE=7]="BLUE",t[t.MAX=8]="MAX"})(o=i.BrickColor||(i.BrickColor={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(i.BrickWallDirType||(i.BrickWallDirType={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.REMOVING=1]="REMOVING",t[t.REMOVE=2]="REMOVE"}(i.BrickItemState||(i.BrickItemState={}));var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._mapRow=23,e._wallColorData=null,e._mapColorData=null,e._curColor=o.DEFAULT,e}return __extends(e,t),Object.defineProperty(e.prototype,"mapRow",{get:function(){return this._mapRow},set:function(t){this._mapRow=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curColor",{get:function(){return this._curColor},set:function(t){this._curColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wallColorData",{get:function(){return this._wallColorData},set:function(t){this._wallColorData=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapColorData",{get:function(){return this._mapColorData},set:function(t){this._mapColorData=t},enumerable:!1,configurable:!0}),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/brickGame/brickGame",[2,!0]})})},__decorate([n.addSubPackage(s.SubPackageKey.brickGame)],e)}(a.default);i.BrickModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],BrickWallItem:[function(t,e,i){"use strict";cc._RF.push(e,"66e32rJoKhB3YqJVbYtfQSr","BrickWallItem"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=t("./BrickModel"),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wallColor=s.BrickColor.DEFAULT,e.nodes=[],e._brickGameWallType=s.BrickWallDirType.LEFT,e}return __extends(e,t),Object.defineProperty(e.prototype,"brickGameWallType",{get:function(){return this._brickGameWallType},set:function(t){this._brickGameWallType=t},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._updateColor()},e.prototype.setColor=function(t){this.wallColor=t,this._updateColor()},e.prototype._updateColor=function(){for(var t=0;t<this.nodes.length;t++)this.nodes[t].active=t==this.wallColor},__decorate([a({type:cc.Enum(s.BrickColor),displayName:"\u7816\u5757\u989c\u8272"})],e.prototype,"wallColor",void 0),__decorate([a([cc.Node])],e.prototype,"nodes",void 0),__decorate([n],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./BrickModel":"BrickModel"}],BridgeCraftMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"b06bbaRDhxACKmNF0QIUSef","BridgeCraftMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=t("../../miniGamePackage/SubPackageManager"),s=cc._decorator,r=s.ccclass,c=s.property;(function(t){t[t.T=2]="T",t[t.L=3]="L",t[t.MIRRORED_L=4]="MIRRORED_L",t[t.I=5]="I"})(o||(o={}));var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.world=null,e.groundBody=null,e.groundNode=new cc.Node,e.spLvBu=null,e.nodeDiaoChan=null,e.dangerousFish=null,e.countdown=null,e.default_SpriteFrame=null,e.bridgeMaterialParentNode=null,e.trueIconFrame=null,e.shapeTSpriteFrame=null,e.shapeLSpriteFrame=null,e.shapeISpriteFrame=null,e.level1Scene=null,e.level2Scene=null,e._isDragging=!1,e._selectedBridgeMaterialIndex=null,e._bodyLvBu=null,e._sizeLvBu=160,e.bridgeMaterialNodes=[],e.bridgeMaterialBodies=[],e.levelData1=[[1,1,1,111111,1e4,1e4,1e4,0,0],[1e4,1e4,1e4,1111111,1,1,1],[],[0],[0],[]],e.levelData2=[[1,111111,10011,10011,0,0,0,0,0,0],[100,100,1111111,1,1],[0,1,2,3],[0,1,2,3],[0,1,2,3],[0,1]],e.nowLevelData=[],e.nowLevel=1,e._remainingTime=3,e._oriTime=3,e._yOverXinValley=1,e._gameOver=!1,e._timeToDangerousFish=5,e}return __extends(e,t),e.prototype.start=function(){this.node.addChild(this.groundNode),this.groundNode.opacity=200,this._initWorld(),this._startLevel(1)},e.prototype._onBind=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onSceneTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onSceneTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onSceneTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onSceneTouchEnd,this)},e.prototype._offBind=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onSceneTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onSceneTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onSceneTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onSceneTouchEnd,this)},e.prototype._clearAllAndInit=function(){for(this.groundNode.destroyAllChildren(),this.groundBody&&this.world.removeBody(this.groundBody);this.bridgeMaterialBodies.length;)this.world.removeBody(this.bridgeMaterialBodies.shift());for(;this.bridgeMaterialNodes.length;)this.bridgeMaterialNodes.shift().destroy();this._bodyLvBu&&this.world.removeBody(this._bodyLvBu),this.spLvBu&&this.spLvBu.setAnimation(0,"idle",!0),this._gameOver=!1,this._remainingTime=this._oriTime},e.prototype._startLevel=function(t){if(this.nowLevel>2)n.default.instance.gotoResultWithLoading(!0,this.node.parent);else{this._clearAllAndInit(),this.level1Scene&&(this.level1Scene.active=!1),this.level2Scene&&(this.level2Scene.active=!1),1===t?(this.nowLevelData=this.levelData1,this.level1Scene&&(this.level1Scene.active=!0)):2===t&&(this.nowLevelData=this.levelData2,this.level2Scene&&(this.level2Scene.active=!0)),this._onBind(),this._createValley();for(var e=-300,i=500,o=2;o<6;o++)for(var a=this.nowLevelData[o],s=0;s<a.length;s++)this._createBridgeMaterial(o,[e,i],Math.PI/2*a[s]),(e+=100)>300&&(i-=100,e=-300);this._createCharacter()}},e.prototype._initWorld=function(){this.world=new a.P2.World,this.world.gravity=[0,-200]},e.prototype._decodeValleyNumbers=function(t,e,i){var o=this,n=[];return t.forEach(function(a,s){var r=a.toString().padStart(7,"0");console.log(r);var c=s*e-t.length*e/2+e/2;r.split("").forEach(function(t,a){if("1"===t){var s=i+a*e*o._yOverXinValley;n.push([c,s])}})}),n},e.prototype._createValley=function(){for(var t=this._yOverXinValley,e=-195*t+90,i=[],o=0;o<this.nowLevelData[0].length;o++)i.push(this.nowLevelData[0][o]);for(o=0;o<20-this.nowLevelData[0].length-this.nowLevelData[1].length;o++)i.push(0);for(o=0;o<this.nowLevelData[1].length;o++)i.push(this.nowLevelData[1][o]);var n=this._decodeValleyNumbers(i,30,e);this.groundBody=new a.P2.Body({position:[0,0],mass:0});for(var s=0,r=n;s<r.length;s++){var c=r[s];this._createBoxShape(this.groundBody,30,30*t,c[0],c[1])}this.world.addBody(this.groundBody)},e.prototype._createBoxShape=function(t,e,i,o,n){var s=new a.P2.Box({width:e,height:i});t.addShape(s),s.position=[o,n]},e.prototype._createBridgeMaterial=function(t,e,i){var n=new a.P2.Body({position:e,mass:1});n.sleep(),n.angle=i,this.world.addBody(n);var s=new cc.Node;this.bridgeMaterialParentNode&&this.bridgeMaterialParentNode.addChild(s);var r=s.addComponent(cc.Sprite);switch(t){case o.T:this.shapeTSpriteFrame&&(r.spriteFrame=this.shapeTSpriteFrame),this._createBoxShape(n,60,60,-60,-30),this._createBoxShape(n,60,60,0,-30),this._createBoxShape(n,60,60,60,-30),this._createBoxShape(n,60,60,0,30);break;case o.L:this.shapeLSpriteFrame&&(r.spriteFrame=this.shapeLSpriteFrame),this._createBoxShape(n,60,60,-60,30),this._createBoxShape(n,60,60,0,30),this._createBoxShape(n,60,60,60,30),this._createBoxShape(n,60,60,-60,-30);break;case o.MIRRORED_L:this.shapeLSpriteFrame&&(r.spriteFrame=this.shapeLSpriteFrame),r.node.scaleX=-1,this._createBoxShape(n,60,60,-60,30),this._createBoxShape(n,60,60,0,30),this._createBoxShape(n,60,60,60,30),this._createBoxShape(n,60,60,60,-30);break;case o.I:this.shapeISpriteFrame&&(r.spriteFrame=this.shapeISpriteFrame),r.node.setContentSize(180,60),this._createBoxShape(n,60,60,0,0),this._createBoxShape(n,60,60,60,0),this._createBoxShape(n,60,60,-60,0)}this.bridgeMaterialNodes.push(s),this.bridgeMaterialBodies.push(n)},e.prototype._createCharacter=function(){var t=new a.P2.Body({mass:5,position:[-270,90+this._sizeLvBu/2]});this.spLvBu&&this.spLvBu.node.setPosition(t.position[0],t.position[1]),t.sleep();var e=this._sizeLvBu,i=new a.P2.Circle({radius:e/2});t.addShape(i),this.world.addBody(t),this._bodyLvBu=t},e.prototype.update=function(t){this.world&&(this._remainingTime-=t,this._timeToDangerousFish-=t,this._isDragging&&(this._remainingTime=this._oriTime),this._remainingTime<=0&&this._offBind(),this.world.step(t),this._updateGraphics(),this._checkGameOver())},e.prototype._checkGameOver=function(){var t=this;if(!this._gameOver){var e=Math.round(10+this._remainingTime);if(e>10&&(e-=10),this.countdown&&(this.countdown.string=e.toString()),this._remainingTime<-10)this._clearAllAndInit(),this._gameOver=!0,n.default.instance.gotoResultWithLoading(!1,this.node.parent);else if(this.spLvBu&&this.nodeDiaoChan&&(this.spLvBu.node.getPosition().y<-1200&&(this._clearAllAndInit(),this._gameOver=!0,n.default.instance.gotoResultWithLoading(!1,this.node.parent)),this.spLvBu.node.getPosition().sub(this.nodeDiaoChan.getPosition()).mag()<60)){"idle"!=this.spLvBu.animation&&this.spLvBu.setAnimation(0,"idle",!0),this._gameOver=!0,this.nowLevel++;var i=new cc.Node;i.parent=this.node,i.setPosition(0,0);var o=i.addComponent(cc.Sprite);this.trueIconFrame&&(o.spriteFrame=this.trueIconFrame),o.sizeMode=cc.Sprite.SizeMode.CUSTOM,i.setContentSize(400,300),cc.tween(i).to(.1,{scale:1.5}).to(.1,{scale:.8}).to(.1,{scale:1.2}).to(.1,{scale:.9}).to(.6,{scale:1}).call(function(){t._startLevel(t.nowLevel),i.destroy()}).start()}}},e.prototype._updateGraphics=function(){var t=this;if(this.groundBody&&this.groundNode&&!0!==this._gameOver){if(this.groundNode.setPosition(this.groundBody.position[0],this.groundBody.position[1]),this.groundNode.angle=180*this.groundBody.angle/Math.PI,this.bridgeMaterialBodies.forEach(function(e,i){var o=t.bridgeMaterialNodes[i];o.setPosition(e.position[0],e.position[1]),o.angle=180*e.angle/Math.PI,t._remainingTime<0&&(o.getPosition().y<200?e.wakeUp():(t.world.removeBody(e),o.active=!1))}),this.spLvBu&&this._bodyLvBu){var e=this._bodyLvBu;this._remainingTime<=0&&this.spLvBu&&("run"!=this.spLvBu.animation&&this.spLvBu.setAnimation(0,"run",!0),e.applyForce([300,0],[0,0]),e.wakeUp()),this.spLvBu.node.setPosition(e.position[0],e.position[1]-this._sizeLvBu/2)}if(this.dangerousFish&&this._timeToDangerousFish<0){var i=cc.v2(300*Math.random()-150,-500);this.dangerousFish.node.setPosition(i),this.dangerousFish.setAnimation(0,"animation",!1),this._timeToDangerousFish=3*Math.random()+3}}},e.prototype._onSceneTouchStart=function(t){for(var e=t.getLocation(),i=this.node.convertToNodeSpaceAR(e),o=0;o<this.bridgeMaterialNodes.length;o++)this.bridgeMaterialNodes[o].getPosition().sub(i).mag()<100&&(this._selectedBridgeMaterialIndex=o,this._isDragging=!0);console.log(this._selectedBridgeMaterialIndex)},e.prototype._onSceneTouchMove=function(t){if(this._isDragging&&null!==this._selectedBridgeMaterialIndex){var e=t.getLocation(),i=this.node.convertToNodeSpaceAR(e),o=this.bridgeMaterialBodies[this._selectedBridgeMaterialIndex],n=this.bridgeMaterialNodes[this._selectedBridgeMaterialIndex];o.position=[i.x,i.y],n.setPosition(i.x,i.y),o.velocity=[0,0],o.angularVelocity=0}},e.prototype._onSceneTouchEnd=function(){this._isDragging=!1,this._selectedBridgeMaterialIndex=null},e.prototype.onClickExit=function(){n.default.instance.getModel().gameExit()},e.prototype.onDisable=function(){this._offBind()},__decorate([c(sp.Skeleton)],e.prototype,"spLvBu",void 0),__decorate([c(cc.Node)],e.prototype,"nodeDiaoChan",void 0),__decorate([c(sp.Skeleton)],e.prototype,"dangerousFish",void 0),__decorate([c(cc.Label)],e.prototype,"countdown",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"default_SpriteFrame",void 0),__decorate([c(cc.Node)],e.prototype,"bridgeMaterialParentNode",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"trueIconFrame",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"shapeTSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"shapeLSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"shapeISpriteFrame",void 0),__decorate([c(cc.Node)],e.prototype,"level1Scene",void 0),__decorate([c(cc.Node)],e.prototype,"level2Scene",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],BridgeCraftModel:[function(t,e,i){"use strict";cc._RF.push(e,"24534iGOotAY62yQURIb/VK","BridgeCraftModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.BridgeCraftModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),s=cc._decorator,r=(s.ccclass,s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/bridgeCraft/bridgeCraftMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.bridgeCraft)],e)}(a.default));i.BridgeCraftModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],CBB:[function(t,e,i){"use strict";cc._RF.push(e,"f7dd7VxOthEKpbdU1fMllhV","CBB"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./AABB")),n=__importDefault(t("./ColliderBase")),a=t("./Manager"),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enter=function(){},e.exit=function(){},e.isInArea=!1,e.isTrigger=!1,e}var i;return __extends(e,t),i=e,e.prototype.moveToClose=function(){return console.error("no implement"),cc.Vec2.ZERO},Object.defineProperty(e.prototype,"radius",{get:function(){return this.node.width},enumerable:!1,configurable:!0}),e.prototype.overlap=function(t){return t instanceof o.default?a.FindCraftColliderManager.testAABBCBB(t,this):t instanceof i&&a.FindCraftColliderManager.testCBBCBB(t,this)},__decorate([c],e.prototype,"isTrigger",void 0),i=__decorate([r],e)}(n.default);i.default=l,cc._RF.pop()},{"./AABB":"AABB","./ColliderBase":"ColliderBase","./Manager":"Manager"}],Catch:[function(t,e,i){"use strict";cc._RF.push(e,"31c3aZghedPhJMAQLBFlZbM","Catch"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGameState_Catch=void 0;var o=t("./StateBase"),n=function(t){function e(e){var i=t.call(this,e)||this;return i.target=null,i}return __extends(e,t),e.prototype.onEnterState=function(t){t.target&&(this.target=t.target)},e.prototype.onUpdateState=function(t){!this.target||this.target.isDie||cc.Vec2.distance(this.target.center,this.owner.center)>this.owner.real_catchRadius+this.target.size/2?this.owner.onSwitch(o.FishGameState.idle):this.target.score!=this.owner.score?(this.owner.moveOn(this.target.center.sub(this.owner.center).normalize(),t),this.testEscape()):this.owner.onSwitch(o.FishGameState.patrol)},e.prototype.onExitState=function(){this.target=null},e}(o.FishGameStateBase);i.FishGameState_Catch=n,cc._RF.pop()},{"./StateBase":"StateBase"}],CocosHelper:[function(t,e,i){"use strict";cc._RF.push(e,"9df1bMYiZdOxq1MXlxs0qca","CocosHelper"),Object.defineProperty(i,"__esModule",{value:!0}),i.LoadProgress=void 0;var o=t("./SysDefine"),n=function(){this.url="",this.completedCount=0,this.totalCount=0};i.LoadProgress=n;var a=function(){function t(){}return t.runRepeatTweenSync=function(t,e){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2,new Promise(function(){for(var o=cc.tween(t),n=0,a=i;n<a.length;n++){var s=a[n];o=o.then(s)}e<0?cc.tween(t).repeatForever(o).start():cc.tween(t).repeat(e,o).start()})]})})},t.runTweenSync=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return __awaiter(this,void 0,Promise,function(){return __generator(this,function(){return[2,new Promise(function(i){for(var o=cc.tween(t),n=0,a=e;n<a.length;n++){var s=a[n];o=o.then(s)}o.call(function(){i()}).start()})]})})},t.prototype.stopTween=function(t){cc.Tween.stopAllByTarget(t)},t.prototype.stopTweenByTag=function(t){cc.Tween.stopAllByTag(t)},t.runActionSync=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return!e||e.length<=0?[2]:[2,new Promise(function(i){e.push(cc.callFunc(function(){i(!0)})),t.runAction(cc.sequence(e))})]})})},t.runAnimSync=function(e,i){return __awaiter(this,void 0,void 0,function(){var o,n,a,s;return __generator(this,function(r){switch(r.label){case 0:if(!(o=e.getComponent(cc.Animation)))return[2];if(n=null,i){if(a=o.getClips(),"number"==typeof i)n=a[i];else if("string"==typeof i)for(s=0;s<a.length;s++)if(a[s].name===i){n=a[s];break}}else n=o.defaultClip;return n?[4,t.sleepSync(n.duration)]:[2];case 1:return r.sent(),[2]}})})},t.loadResThrowErrorSync=function(){return null},t.loadResSync=function(e,i,o){var n=this;return e&&i?(t.loadProgress.url=e,o&&(this.loadProgress.cb=o),new Promise(function(o){cc.loader.loadRes(e,i,n._progressCallback,function(i,n){i?(cc.error(e+" [\u8d44\u6e90\u52a0\u8f7d] \u9519\u8bef "+i),o(null)):o(n),t.loadProgress.url="",t.loadProgress.completedCount=0,t.loadProgress.totalCount=0,t.loadProgress.item=null,t.loadProgress.cb=null})})):(cc.error("\u53c2\u6570\u9519\u8bef",e,i),null)},t._progressCallback=function(e,i,o){t.loadProgress.completedCount=e,t.loadProgress.totalCount=i,t.loadProgress.item=o,t.loadProgress.cb&&t.loadProgress.cb(e,i,o)},t.findChildInNode=function(t,e){if(e.name==t)return e;for(var i=0;i<e.childrenCount;i++){var o=this.findChildInNode(t,e.children[i]);if(o)return o}return null},t.checkNodePrefix=function(t){return t[0]===o.SysDefine.SYS_STANDARD_Prefix},t.checkBindChildren=function(t){return t[t.length-1]!==o.SysDefine.SYS_STANDARD_End},t.getPrefixNames=function(t){if(null!==t)return t.split(o.SysDefine.SYS_STANDARD_Separator)},t.getComponentName=function(t){var e=t.name.match(/<.*>$/);return e&&e.length>0?e[0].slice(1,-1):t.name},t.loadBundleSync=function(t,e){return new Promise(function(i){cc.assetManager.loadBundle(t,e,function(e,o){e?i(o):(cc.error("\u52a0\u8f7dbundle\u5931\u8d25, url: "+t+", err:"+e),i(null))})})},t.loadAssetFromBundleSync=function(t,e){var i=cc.assetManager.getBundle(t);return i?new Promise(function(t){i.load(e,function(i,o){i?(cc.error("\u52a0\u8f7dbundle\u4e2d\u7684\u8d44\u6e90\u5931\u8d25, \u672a\u627e\u5230asset, url:"+e+", err:"+i),t(null)):t(o)})}):(cc.error("\u52a0\u8f7dbundle\u4e2d\u7684\u8d44\u6e90\u5931\u8d25, \u672a\u627e\u5230bundle, bundleUrl:"+t),null)},t.loadAssetSync=function(t){var e=this;return new Promise(function(i){cc.resources.load(t,function(o,n){o?(e.addRef(n),i(n)):(cc.error("\u52a0\u8f7dasset\u5931\u8d25, url:"+t+", err: "+o),i(null))})})},t.releaseAsset=function(t){this.decRes(t)},t.addRef=function(t){if(t instanceof Array)for(var e=0,i=t;e<i.length;e++)i[e].addRef();else t.addRef()},t.decRes=function(t){if(t instanceof Array)for(var e=0,i=t;e<i.length;e++)i[e].decRef();else t.decRef()},t.testForCallback=function(t){return setTimeout(function(){t(1)},1e3),1},t.captureScreen=function(t,e){var i=new cc.RenderTexture,o=t.targetTexture,n=cc.rect(0,0,cc.visibleRect.width,cc.visibleRect.height);e&&(n=e instanceof cc.Node?e.getBoundingBoxToWorld():e),i.initWithSize(cc.visibleRect.width,cc.visibleRect.height,cc.game._renderContext.STENCIL_INDEX8),t.targetTexture=i,t.render(),t.targetTexture=o;var a=new ArrayBuffer(n.width*n.height*4),s=new Uint8Array(a);return i.readPixels(s,n.x,n.y,n.width,n.height),s},t.loadProgress=new n,t.sleepSync=function(t){return new Promise(function(e){setTimeout(function(){e(!0)},1e3*t)})},t}();i.default=a,cc._RF.pop()},{"./SysDefine":"SysDefine"}],ColliderBase:[function(t,e,i){"use strict";cc._RF.push(e,"5c764NV1oNIrLfizFtPa4Iv","ColliderBase"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../../miniGamePackage/utils/MathExt")),n=t("../FindCraftModel"),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isTrigger=!1,e.isInArea=!1,e.enter=function(){},e.exit=function(){},e.center=cc.Vec2.ZERO,e.followParentPos=!0,e}return __extends(e,t),e.prototype.start=function(){n.FC_S.Ins.cmgr.envs.push(this)},e.prototype.update=function(){this.followParentPos&&(this.center=o.default.V2(this.node.position.mul(this.node.scale*this.node.parent.scale).add(this.node.parent.position)))},__decorate([r],e.prototype,"followParentPos",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../../miniGamePackage/utils/MathExt":"MathExt","../FindCraftModel":"FindCraftModel"}],ColliderObjBase:[function(t,e,i){"use strict";cc._RF.push(e,"edf57SfZntF979PdnPgcUSC","ColliderObjBase"),Object.defineProperty(i,"__esModule",{value:!0}),i.BladeFlyColliderObjBase=void 0;var o=function(){function t(t){this.ACCURACY=.001,this.edge=t}return t.prototype.showEdge=function(t){this.edge.forEach(function(e){return e.showLine(t)})},t}();i.BladeFlyColliderObjBase=o,cc._RF.pop()},{}],CommonUtils:[function(t,e,i){"use strict";cc._RF.push(e,"8b6beX0V1FJFZyuHoWTokdf","CommonUtils"),Object.defineProperty(i,"__esModule",{value:!0}),i.CommonUtils=void 0;var o=__importDefault(t("./CocosHelper")),n=t("./TextureMathUtil"),a={nextInt:function(t,e){return Math.floor(Math.random()*(e-t))+t},next01:function(){return Math.random()}},s=function(){function t(){}return t.isArray=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},t.foramtDate=function(t,e){var i={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),"S+":t.getMilliseconds()};for(var o in/(y+)/i.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,("00"+i[o]).substr((""+i[o]).length)));return e},t.getElemClamped=function(t,e){return t[Math.max(0,Math.min(t.length-1,e))]},t.randomIntClosedRange=function(t,e){return Math.floor(Math.random()*(e-t+.9999)+t)},t.indexOf=function(t,e){for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1},t.indexOfArr=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var o=e.length,n=!1,a=0;a<=t.length-o;a+=o){n=!0;for(var s=0;s<o;s++)if(t[a+s]!==e[s]){n=!1;break}if(n)return a}return-1},t.floatEqual=function(t,e,i){return void 0===i&&(i=1e-6),Math.abs(t-e)<i},t.formatTimeInterval=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),e=i||e;var o="",n=Math.floor(t/3600);t%=3600;var a=Math.floor(t/60);return(i||n>0)&&(n<10&&(o+="0"),o+=n+":"),(e||a>0||n>0)&&(a<10&&(o+="0"),o+=a+":"),(t=Math.floor(t%60))<10&&(o+="0"),o+t},t.alignNumber=function(t,e){return t-Math.floor(t/e)*e},t.formatNumber=function(t){var e=""+Math.floor(t),i="",o=0;if(-1==e.indexOf(".")){for(var n=e.length-1;n>=0;n--)i=o%3==0&&0!=o?e.charAt(n)+","+i:e.charAt(n)+i,o++;return i}for(n=e.indexOf(".")-1;n>=0;n--)i=o%3==0&&0!=o?e.charAt(n)+","+i:e.charAt(n)+i,o++;return i+(e+"00").substr((e+"00").indexOf("."),3)},t.updateLabelSize=function(t){t._updateRenderData(!0)},t.lerp=function(t,e,i){return t+(e-t)*i},t.shuffle=function(t,e,i,o){void 0===e&&(e=a),void 0===i&&(i=0),void 0===o&&(o=-1),e=e||a,o<0&&(o=t.length-i);for(var n=0;n<o;n++){var s=e.nextInt(i,i+o-n),r=t[s];t[s]=t[o-n-1+i],t[o-n-1+i]=r}},t.setItemSpriteFrame=function(t,e,i){void 0===i&&(i=null),t.spriteFrameName=e,o.default.loadResSync(e,cc.SpriteFrame).then(function(o){var n=t.spriteFrameName;t.isValid&&n==e&&(t.spriteFrame=o,i&&i(t))})},t.addSimpleClick=function(t,e){var i=t,o=null;i.on(cc.Node.EventType.TOUCH_START,function(t){o=t.getLocation()},this),i.on(cc.Node.EventType.TOUCH_END,function(t){o&&o.subSelf(t.getLocation()).mag()<3&&e()},this)},t.isGoodNumber=function(t){return"number"==typeof t&&!Number.isNaN(t)},t.getVisibleRect=function(){var t=cc.view.getViewportRect();return cc.rect(t.origin.x/-cc.view.getScaleX(),t.origin.y/-cc.view.getScaleY(),(t.size.width+2*t.origin.x)/cc.view.getScaleX(),(t.size.height+2*t.origin.y)/cc.view.getScaleY())},t.httpGet=function(t,e){var i=cc.loader.getXMLHttpRequest();i.onreadystatechange=function(){if(4===i.readyState&&200==i.status){var t=i.responseText,o=JSON.parse(t);e(o)}else 4===i.readyState&&401==i.status&&e({ret:1})},i.withCredentials=!0,i.open("GET",t,!0),i.withCredentials=!1,i.setRequestHeader("Access-Control-Allow-Origin","*"),i.setRequestHeader("Access-Control-Allow-Methods","GET, POST"),i.setRequestHeader("Access-Control-Allow-Headers","x-requested-with,content-type,authorization"),i.setRequestHeader("Content-Type","application/json"),i.timeout=8e3,i.send()},t.randomGaussian=function(t,e,i){void 0===i&&(i=a);var o=(i=i||a).next01(),n=i.next01();return Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*n)*e+t},t.deepCopy=function(t,e){for(var i in e)this._deepCopyFields(t,e,i)},t.constructObjectMap=function(t){var e=new Map;for(var i in t){var o=t[i];"object"==typeof o?e.set(i,this.constructObjectMap(o)):e.set(i,o)}return e},t._deepCopyFields=function(t,e,i){var o=e[i];if("number"==typeof o||"string"==typeof o)t[i]=o;else if(this.isArray[o])for(var n=t[i]=[],a=0;a<o.length;a++)this._deepCopyFields(n,o,a);else if(null==o)t[i]=null;else if("object"==typeof o){var s=new o.constructor;for(var r in e)this._deepCopyFields(s,o,r)}},t.formatNumberToEng=function(e){if(e<1&&e>0)return"1";e=Math.floor(e);var i=Math.floor(t.getExponent(e));if(i<13){if(i<4)return e+"";var o=Math.floor(i/t.constNum),n=i%t.constNum;return String(e/Math.pow(10,o*t.constNum)).substr(0,t.constNum+n)+t.getUnit(i)}return(e/Math.pow(10,i)).toFixed(3)+"e"+i},t.getExponent=function(t){for(var e=0;t>=10;)e++,t/=10;return e},t.getUnit=function(e){var i=Math.floor(e/t.constNum);return e<13?t.unitArr[i]:"e"+(i=Math.floor(e/t.constNum))*t.constNum},t.formatEngNumber=function(t,e){var i,o;return void 0===e&&(e=2),(t=t)>=1e6?(o=t/1e6,i=(.001*Math.floor(o/.001)).toFixed(e),this.formatEndingZero(i)+"M"):t>=1e3?(o=t/1e3,i=(.001*Math.floor(o/.001)).toFixed(e),this.formatEndingZero(i)+"K"):t+""},t.formatEndingZero=function(t){if(-1!=t.indexOf(".")){if(this.endWith(t,"00"))return t.substring(0,t.length-3);if(this.endWith(t,"0"))return t.substring(0,t.length-1)}return t},t.endWith=function(t,e){return e==t.substring(t.length-e.length)},t.makeMaxWidthLabel=function(t,e){var i={};return i.__proto__=t,Object.defineProperty(i,"string",{configurable:!0,enumerable:!0,get:function(){return t.string},set:function(i){t.overflow=cc.Label.Overflow.NONE,t.string=i,t._updateRenderData(!0),t.node.width>e&&(t.overflow=cc.Label.Overflow.RESIZE_HEIGHT,t.node.setContentSize(e,1),t.string=i)}}),i},t.climeUserName=function(t,e){void 0===e&&(e=14);for(var i=t.length;this.strlen(t)>e;)t=t.substring(0,t.length-1);return t.length!=i&&(t+="..."),t},t.strlen=function(t){for(var e=0,i=0;i<t.length;i++){var o=t.charCodeAt(i);o>=1&&o<=126||65376<=o&&o<=65439?e++:e+=2}return e},t.shuffleArr=function(t){for(var e,i,o,n=t.length,a=0;a<n;a++){i=n-a-1,void 0,o=t[e=Math.floor(Math.random()*(n-a))],t[e]=t[i],t[i]=o}return t},t.binarySearch=function(t,e,i){void 0===i&&(i=!1);for(var o=0,n=t.length-1;n-o>1;){var a=Math.floor((o+n)/2);if(e<t[a])n=a;else{if(!(e>t[a]))return a;o=a}}return i?o==t.length-1?t.length:n:0==n?-1:o},t.isInTriangle=function(t,e,i,o){var n=i.sub(e),a=o.sub(e),s=o.sub(i),r=t.sub(e),c=t.sub(i);return n.cross(a)>=0^n.cross(r)<0&&n.cross(a)>=0^a.cross(r)>=0&&s.cross(n)>0^s.cross(c)>=0},t.isInPolygon=function(t,e){var i,o,n,a,s=0,r=e.length;for(n=e[0],i=1;i<=r;i++)a=e[i%r],t.x>Math.min(n.x,a.x)&&t.x<=Math.max(n.x,a.x)&&t.y<=Math.max(n.y,a.y)&&n.x!=a.x&&(o=(t.x-n.x)*(a.y-n.y)/(a.x-n.x)+n.y,(n.y==a.y||t.y<=o)&&s++),n=a;return s%2!=0},t.splitPolygon=function(t){if(t.length<=3)return[0,1,2];for(var e={},i=0;i<t.length;i++){var o=t[i];e[o.x+"-"+o.y]=i}var n=function(t){return e[t.x+"-"+t.y]};t=t.concat([]);for(var a=[],s=0;t.length>3;){var r=t[s%t.length],c=t[(s+1)%t.length],l=t[(s+2)%t.length],h=(s+1)%t.length,u=c.sub(r),d=l.sub(c);if(u.cross(d)<0)s=(s+1)%t.length;else{for(var p=!1,m=0,f=t;m<f.length;m++)if((o=f[m])!=r&&o!=c&&o!=l&&this.isInTriangle(o,r,c,l)){p=!0;break}p?s=(s+1)%t.length:(a.push(n(r),n(c),n(l)),t.splice(h,1))}}for(var g=0,_=t;g<_.length;g++)o=_[g],a.push(n(o));return a},t.computeUv=function(t,e,i){for(var o=[],a=0,s=t;a<s.length;a++){var r=s[a],c=n.TextureMathUtils.clamp(0,1,(r.x+e/2)/e),l=n.TextureMathUtils.clamp(0,1,1-(r.y+i/2)/i);o.push(cc.v2(c,l))}return o},t.splitPolygonByLine=function(t,e){t.x,t.y,e.x,e.y},t.unitArr=["","K","M","B"],t.constNum=3,t}();i.CommonUtils=s,cc._RF.pop()},{"./CocosHelper":"CocosHelper","./TextureMathUtil":"TextureMathUtil"}],DrawLineData:[function(t,e,i){"use strict";cc._RF.push(e,"91f8fI3CztAJrmFxK5jGQLJ","DrawLineData"),Object.defineProperty(i,"__esModule",{value:!0}),i.DrawLineType=void 0;var o=__importDefault(t("./DrawLineHeroComp")),n=cc._decorator,a=n.ccclass,s=n.property;i.DrawLineType=cc.Enum({START_POINT:1,TRANSFER_STATION:2,TERMINUS:3});var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.touchGroup=0,e.lineType=i.DrawLineType.TERMINUS,e.heroData=null,e._prePos=null,e._lastPos=cc.v2(),e._initPos=cc.v2(),e._paths=[],e._isFinish=!1,e._hasVisitedPath=!1,e._otherData=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"prePos",{get:function(){return this._prePos?this._prePos:this._initPos},set:function(t){this._prePos=t},enumerable:!1,configurable:!0}),e.prototype.getLastPos=function(){var t=this._paths.length;return 0===t?this._initPos:this._paths[t-1]},Object.defineProperty(e.prototype,"initPos",{get:function(){return this._initPos},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._initPos.x=this.node.x,this._initPos.y=this.node.y,this._lastPos=this._initPos},Object.defineProperty(e.prototype,"paths",{get:function(){return this._paths},enumerable:!1,configurable:!0}),e.prototype.clearPaths=function(){this._paths=[]},Object.defineProperty(e.prototype,"isFinish",{get:function(){return this._isFinish},set:function(t){this._isFinish=t},enumerable:!1,configurable:!0}),e.prototype.addPath=function(t){this._paths.push(t)},e.prototype.addPathList=function(t){this._paths=this._paths.concat(t)},e.prototype.shiftPath=function(){return this._paths.length<=0?null:this._paths.shift()},Object.defineProperty(e.prototype,"hasVisitedPath",{get:function(){return this._hasVisitedPath},set:function(t){this._hasVisitedPath=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"otherData",{get:function(){return this._otherData},set:function(t){this._otherData=t},enumerable:!1,configurable:!0}),__decorate([s()],e.prototype,"touchGroup",void 0),__decorate([s({type:cc.Enum(i.DrawLineType),displayName:"\u753b\u7ebf\u7c7b\u578b"})],e.prototype,"lineType",void 0),__decorate([s(o.default)],e.prototype,"heroData",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./DrawLineHeroComp":"DrawLineHeroComp"}],DrawLineGame:[function(t,e,i){"use strict";cc._RF.push(e,"71d0aK0c0JNCLVP1FGaaLQU","DrawLineGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=__importDefault(t("./DrawLineLogic")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._model=null,e.levels=[],e.m_btnBack=null,e._curLevel=null,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this._model=o.default.instance.getModel(),this.m_btnBack.on(cc.Node.EventType.TOUCH_END,function(){return t._model.gameExit()},this),this.nextLevel()},e.prototype.nextLevel=function(){this._curLevel&&this.levels.length>0&&this._curLevel.node.destroy(),this._curLevel=this.levels.shift(),this._curLevel?(this._curLevel.bindGame(this),this._curLevel.node.active=!0):o.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype.onDisable=function(){var t=this;this.m_btnBack.off(cc.Node.EventType.TOUCH_END,function(){return t._model.gameExit()},this)},__decorate([r([n.default])],e.prototype,"levels",void 0),__decorate([r(cc.Node)],e.prototype,"m_btnBack",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./DrawLineLogic":"DrawLineLogic"}],DrawLineHeroComp:[function(t,e,i){"use strict";cc._RF.push(e,"433e304ZB9EmZP+v5B4djtz","DrawLineHeroComp"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.winAnim=null,e.winSprite=null,e.heroSk=null,e.heroSkins=[],e.failSprite=null,e.skFly=null,e}return __extends(e,t),e.prototype.onLoad=function(){this._init(),this.skFly.animation="animation"},e.prototype.start=function(){},e.prototype.setSkin=function(t){this.heroSk.skeletonData=this.heroSkins[Math.min(t,this.heroSkins.length-1)],this.heroSk.animation="idle"},e.prototype._init=function(){this.winSprite.node.active=!1,this.winAnim.node.active=!1,this.failSprite.node.active=!1,this.heroSk.node.color=cc.color(100,100,100)},e.prototype.playIdleAnim=function(){this.heroSk.node.color=cc.color(100,100,100),this.skFly.node.active=!0},e.prototype.playWinAnim=function(){this.winAnim.node.active=!0,this.winSprite.node.active=!0,this.heroSk.node.color=cc.color(255,255,255),this.winAnim.loop=!1,this.winAnim.animation="animation",this.skFly.node.active=!1},e.prototype.playFailAnim=function(){this.failSprite.node.active=!0,this.skFly.node.active=!0},__decorate([a(sp.Skeleton)],e.prototype,"winAnim",void 0),__decorate([a(cc.Sprite)],e.prototype,"winSprite",void 0),__decorate([a(sp.Skeleton)],e.prototype,"heroSk",void 0),__decorate([a([sp.SkeletonData])],e.prototype,"heroSkins",void 0),__decorate([a(cc.Sprite)],e.prototype,"failSprite",void 0),__decorate([a(sp.Skeleton)],e.prototype,"skFly",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],DrawLineLogic:[function(t,e,i){"use strict";cc._RF.push(e,"c378d9L1aNPuLCc9hlGkIBo","DrawLineLogic"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=__importStar(t("./DrawLineData")),a=__importDefault(t("./DrawLineHeroComp")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.drawingBoard=null,e.drawingBoard2=null,e.root=null,e.subNodes=[],e.obstacleNodes=[],e.heroList=[],e._startingTest=!1,e._dataList=[],e._moveGroups=[],e._connectedDataList=[],e._drawLineGame=null,e._waitTime=0,e}return __extends(e,t),e.prototype.bindGame=function(t){this._drawLineGame=t},e.prototype.onLoad=function(){this.root.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.root.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.drawingBoard.moveTo(this.root.x,this.root.y),this.drawingBoard2.moveTo(this.root.x,this.root.y),this._dataList.push(this.root.getComponent(n.default));for(var t=0;t<this.subNodes.length;t++){var e=this.subNodes[t];this._dataList.push(e.getComponent(n.default))}for(t=0;t<this._dataList.length;t++)e=this._dataList[t],this._registerClickEvent(e);for(t=0;t<this.heroList.length;t++)(e=this.heroList[t]).setSkin(t)},e.prototype._onTouchStart=function(t){if(!this._startingTest){var e=t.getCurrentTarget().getComponent(n.default).getLastPos();this.drawingBoard.moveTo(e.x,e.y)}},e.prototype._onTouchMove=function(t){if(!this._startingTest){var e=t.getCurrentTarget(),i=e.getComponent(n.default);if(!i.isFinish){for(var o=t.getLocation(),a=this.node.convertToNodeSpaceAR(o),s=!1,r=0;r<this.obstacleNodes.length;r++){var c=this.obstacleNodes[r];this._isCollide(a,c.getPosition(),Math.floor(c.width/2))&&(s=!0)}if(!s){var l=e.getPosition();Math.abs(l.sub(a).len())>50||(this._addPath(e,i,a),this._updateLineStatus(e,i))}}}},e.prototype._addPath=function(t,e,i){this.drawingBoard.lineTo(i.x,i.y),this.drawingBoard.stroke(),t.setPosition(i.x,i.y),e.addPath(i)},e.prototype.startTest=function(){this._startingTest=!0},e.prototype.update=function(t){if(this._startingTest){for(var e=!0,i=function(t){var i=o._dataList[t];if(0===o._moveGroups.filter(function(t){return t===i.touchGroup}).length)return"continue";var a=i.shiftPath(),s=i.prePos;if(i.prePos=a,!a){if(i.otherData&&i.otherData.lineType===n.DrawLineType.TERMINUS&&(o._connectedDataList.push(i.otherData),i.otherData.heroData.playWinAnim()),i.otherData&&i.otherData.lineType!==n.DrawLineType.TERMINUS){var r=i.otherData.touchGroup;o._moveGroups.push(r),e=!1}return i.otherData=null,"continue"}s&&o.drawingBoard2.moveTo(s.x,s.y),o.drawingBoard2.lineTo(a.x,a.y),o.drawingBoard2.stroke(),e=!1},o=this,a=0;a<this._dataList.length;a++)i(a);e&&(this._waitTime+=t),e&&this._waitTime>1&&(this._startingTest=!1,this._gameOver())}},e.prototype._updateLineStatus=function(t,e){for(var i=!0,o=0;o<this._dataList.length;o++)if((h=this._dataList[o]).node!==e.node&&!h.isFinish){var a=h.node.getPosition(),s=e.node.getPosition();if(this._isCollide(a,s,30)){h.isFinish=!0,e.isFinish=!0,h.otherData=e,e.otherData=h;for(var r=1;r<=5;r++){var c=cc.misc.lerp(s.x,a.x,.2*r),l=cc.misc.lerp(s.y,a.y,.2*r);this._addPath(t,e,cc.v2(c,l))}}}for(o=0;o<this._dataList.length;o++){var h;(h=this._dataList[o]).isFinish||(i=!1)}if(i){var u=this.root.getComponent(n.default);this._checkMapValidity(u),this._moveGroups.push(u.touchGroup),this._startingTest=!0}},e.prototype._isCollide=function(t,e,i){var o=cc.v2(e.x+i,e.y-i),n=cc.v2(e.x-i,e.y-i),a=cc.v2(e.x-i,e.y+i),s=cc.v2(e.x+i,e.y+i),r=this._isInTriangle(t,o,n,a),c=this._isInTriangle(t,o,s,a);return r||c},e.prototype._isInTriangle=function(t,e,i,o){var n=i.sub(e),a=o.sub(e),s=o.sub(i),r=t.sub(e),c=t.sub(i);return n.cross(a)>=0!=n.cross(r)<0&&n.cross(a)>=0!=a.cross(r)>=0&&s.cross(n)>0!=s.cross(c)>=0},e.prototype._checkMapValidity=function(t){for(var e=[t.touchGroup],i=[],o=function(){for(var t=e.shift(),o=a._dataList.filter(function(e){return e.touchGroup===t}),s=0;s<o.length;s++){var r=o[s];if(r.touchGroup===t&&-1===i.indexOf(r)){i.push(r),i.push(r.otherData);var c=r.otherData.touchGroup;r.otherData.lineType!==n.DrawLineType.TERMINUS&&e.push(c),r.addPathList(r.otherData.paths.reverse()),r.otherData.clearPaths()}}},a=this;e.length>0;)o()},e.prototype._registerClickEvent=function(t){var e=t.node;e.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),e.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this)},e.prototype._unregisterClickEvent=function(t){var e=t.node;e.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),e.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this)},e.prototype._gameOver=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a;return __generator(this,function(){for(t=!0,e=function(e){var o=i._dataList[e];if(o.lineType!==n.DrawLineType.TERMINUS)return"continue";i._connectedDataList.filter(function(t){return t===o}).length>0||(o.heroData&&o.heroData.playFailAnim(),t=!1)},i=this,a=0;a<this._dataList.length;a++)e(a);return t?this._drawLineGame.nextLevel():o.default.instance.gotoResultWithLoading(t,this.node.parent),[2]})})},e.prototype.onDisable=function(){for(var t=0;t<this._dataList.length;t++){var e=this._dataList[t];this._unregisterClickEvent(e)}},__decorate([c(cc.Graphics)],e.prototype,"drawingBoard",void 0),__decorate([c(cc.Graphics)],e.prototype,"drawingBoard2",void 0),__decorate([c(cc.Node)],e.prototype,"root",void 0),__decorate([c(cc.Node)],e.prototype,"subNodes",void 0),__decorate([c(cc.Node)],e.prototype,"obstacleNodes",void 0),__decorate([c([a.default])],e.prototype,"heroList",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./DrawLineData":"DrawLineData","./DrawLineHeroComp":"DrawLineHeroComp"}],DrawLineModel:[function(t,e,i){"use strict";cc._RF.push(e,"3e065UzTq5B6I8jT+vqX2Zr","DrawLineModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.DrawLineModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/drawLine/drawLine",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.drawLine)],e)}(n.default);i.DrawLineModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],EnemyFish:[function(t,e,i){"use strict";cc._RF.push(e,"83d23FA2bdHv74x/iam2Qv3","EnemyFish"),Object.defineProperty(i,"__esModule",{value:!0}),i.EnemyFish=void 0;var o=__importDefault(t("../FishGrowGame")),n=t("../FishGrowUtil"),a=__importDefault(t("./BaseFish")),s=__importDefault(t("./FishCollider")),r=cc._decorator,c=r.ccclass,l=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=300,e.startPosition=cc.Vec2.ZERO,e.endPosition=cc.Vec2.ZERO,e._player=null,e._fishEnable=!0,e._camera=null,e._winSize=cc.size(0,0),e._rotateTime=3,e._monsterManager=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"fishEnable",{get:function(){return this._fishEnable},set:function(t){this._fishEnable!=t&&(this._fishEnable=t,t?(this.node.opacity=255,this.getComponent(s.default).enabled=!0,this._monsterManager.visibleFishes.add(this)):(this.node.opacity=0,this.getComponent(s.default).enabled=!1,this._monsterManager.visibleFishes.delete(this)))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mainSize",{get:function(){var t=n.FishGrowConst.InitFishesSize[this.fishType];return cc.size(t[0],t[1])},enumerable:!1,configurable:!0}),e.prototype.setStartPosition=function(t){this.startPosition=t,this.node.setPosition(t)},e.prototype.changeState=function(t){this.fishState!=t&&(t==n.FishState.Move&&this.startMove(),this.fishState=t)},e.prototype.startMove=function(){this.startPosition=cc.v2(this.node.x,this.node.y);var t=n.FishGrowConst.MapBorder;this.endPosition=cc.v2(t.x*Math.random(),t.y*Math.random()),this._dir=this.endPosition.sub(this.startPosition).normalizeSelf(),this.node.setPosition(this.startPosition)},e.prototype.setTrackStep=function(){this.startPosition=cc.v2(this.node.x,this.node.y),this.endPosition=cc.v2(this._player.node.x,this._player.node.y),this._dir=this.endPosition.sub(this.startPosition).normalizeSelf()},Object.defineProperty(e.prototype,"fishAngle",{get:function(){return this._dir.equals(cc.Vec2.ZERO)?0:180*cc.Vec2.RIGHT.signAngle(this._dir)/Math.PI},enumerable:!1,configurable:!0}),e.prototype.destroyFish=function(){var t=this;return this.changeState(n.FishState.Destroy),this.getComponent(s.default).enabled=!0,this._monsterManager.visibleFishes.delete(this),new Promise(function(e){cc.tween(t.node).to(.3,{opacity:0}).call(function(){e()}).start()})},e.prototype.onLoad=function(){t.prototype.onLoad.call(this)},e.prototype.start=function(){this._camera=o.default.instance.followManager.getComponent(cc.Camera),this._winSize=cc.Canvas.instance.node.getContentSize(),this._player=o.default.instance.playerManager,this._monsterManager=o.default.instance.monsterManager},e.prototype.updateFish=function(t){if(this.fishState!=n.FishState.Destroy&&(this._checkVisible(),this.fishState==n.FishState.Move||this.fishState==n.FishState.Track)){switch(this._checkTrack(),this.fishState){case n.FishState.Move:if(this._checkMoveEnd())return this.changeState(n.FishState.Idle),void this.changeState(n.FishState.Move);break;case n.FishState.Track:this.setTrackStep()}var e=this._dir.mul(n.FishGrowConst.MonsterSpeed*t).add(cc.v2(this.node.x,this.node.y));this._checkBorder(e),this.node.setPosition(e);var i=this.node.angle,o=this.fishAngle,a=o-i;a>180?a+=-360:a<-180&&(a+=360),i=o-a,this.node.angle=cc.misc.lerp(i,o,this._rotateTime*t)}},e.prototype._checkBorder=function(t){t.x=Math.max(0,Math.min(n.FishGrowConst.MapBorder.x,t.x)),t.y=Math.max(0,Math.min(n.FishGrowConst.MapBorder.y,t.y))},e.prototype._checkMoveEnd=function(){return cc.Vec2.len(cc.v2(this.node.x,this.node.y).sub(this.startPosition))>=cc.Vec2.len(this.endPosition.sub(this.startPosition))},e.prototype._checkVisible=function(){var t=this.node.parent.convertToWorldSpaceAR(cc.v2(this.node.x,this.node.y)),e=this._camera.getWorldToScreenPoint(t),i=this.mainSize;e.x+i.width/2<0||e.x-i.width/2>this._winSize.width||e.y+i.height/2<0||e.y-i.height/2>this._winSize.height?this.fishEnable=!1:this.fishEnable=!0},e.prototype._checkTrack=function(){this.fishState!=n.FishState.Move&&this.fishState!=n.FishState.Track||(this.fishEnable&&this._player.mainLevel>=n.FishGrowConst.TrackLevel&&this.fishLevel>this._player.mainLevel?this.changeState(n.FishState.Track):this.changeState(n.FishState.Move))},__decorate([c],e)}(a.default));i.EnemyFish=l,cc._RF.pop()},{"../FishGrowGame":"FishGrowGame","../FishGrowUtil":"FishGrowUtil","./BaseFish":"BaseFish","./FishCollider":"FishCollider"}],Enemy:[function(t,e,i){"use strict";cc._RF.push(e,"c6574dBKj1Ek7XCf19EPHjK","Enemy"),Object.defineProperty(i,"__esModule",{value:!0}),i.BladeFlyEnemy=void 0;var o=t("../../../miniGamePackage/utils/Line"),n=function(t){function e(e,i){var n=this,a=[o.Line.Vec2Line(cc.v2(1,0),cc.v2(e.x-i.x/2,e.y+i.y/2),i.x),o.Line.Vec2Line(cc.v2(0,-1),cc.v2(e.x+i.x/2,e.y+i.y/2),i.y),o.Line.Vec2Line(cc.v2(-1,0),cc.v2(e.x+i.x/2,e.y-i.y/2),i.x),o.Line.Vec2Line(cc.v2(0,1),cc.v2(e.x-i.x/2,e.y-i.y/2),i.y)];return(n=t.call(this,a)||this).center=e,n.size=i,n}return __extends(e,t),e.prototype.collisionRet=function(t){var e={},i=t.point.add(t.dir.mul(this.ACCURACY)),n=o.Line.Vec2Line(t.dir,i,t.dist),a=Number.MAX_VALUE;return this.edge.forEach(function(t){var o=t.intersect(n);if(o){var s=cc.Vec2.distance(o,i);s<a&&(e.enemyDie=!0,e.point=o,a=s)}}),e},e.prototype.moveBy=function(t){this.edge.forEach(function(e){return e.moveSelfBy(t)}),this.center.addSelf(t)},e.prototype.overlap=function(t){return this.center.x+this.size.x/2>=t.center.x-t.size.x/2&&t.center.x+t.size.x/2>=this.center.x-this.size.x/2&&this.center.y+this.size.y/2>=t.center.y-t.size.y/2&&t.center.y+t.size.y/2>=this.center.y-this.size.y/2},e}(t("./ColliderObjBase").BladeFlyColliderObjBase);i.BladeFlyEnemy=n,cc._RF.pop()},{"../../../miniGamePackage/utils/Line":"Line","./ColliderObjBase":"ColliderObjBase"}],Escape:[function(t,e,i){"use strict";cc._RF.push(e,"a5fa9ANKxVI0oejWUyzHp/R","Escape"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGameState_Escape=void 0;var o=__importDefault(t("../../../miniGamePackage/utils/MathExt")),n=t("../config_FishGame"),a=t("./StateBase"),s=function(t){function e(e){var i=t.call(this,e)||this;return i.safeTime=0,i.hasTarget=!0,i.escapeDir=cc.Vec2.ZERO,i.hasTarget=!0,i}return __extends(e,t),e.prototype.onEnterState=function(){this.escapeDir=this.owner.dir},e.prototype.onUpdateState=function(t){var e=this,i=this.owner.getAreaInfo(this.owner.center,this.owner.real_visiualRadius),s=i.targets.filter(function(t){return t.score>e.owner.score});if(0!=s.length){var r=cc.Vec2.ZERO;if(s.forEach(function(t){return r.addSelf(o.default.V2(e.owner.node.position.sub(t.node.position)))}),r.divSelf(s.length).normalizeSelf(),i.xLimit&&!i.yLimit){var c=Math.abs(i.xLimit-this.owner.center.x),l=1-o.default.Clamp(0,1,c/this.owner.size/2),h=cc.v2(0,r.y>0?1:-1);r=o.default.Slerp(r,h,l)}else if(i.yLimit&&!i.xLimit)h=cc.v2(r.x>0?1:-1,0),c=Math.abs(i.yLimit-this.owner.center.y),l=1-o.default.Clamp(0,1,c/this.owner.size/2),r=o.default.Slerp(r,h,l);else if(i.xLimit&&i.yLimit){var u=cc.v2(this.owner.center.x-i.xLimit,0),d=cc.v2(0,this.owner.center.y-i.yLimit);r.dot(u)>r.dot(d)?(c=Math.abs(i.yLimit-this.owner.center.y),l=1-o.default.Clamp(0,1,c/this.owner.size/2),r=o.default.Slerp(r,u,l)):(c=Math.abs(i.xLimit-this.owner.center.x),l=1-o.default.Clamp(0,1,c/this.owner.size/2),r=o.default.Slerp(r,d,l))}this.escapeDir=r,this.hasTarget=!0}else if(this.hasTarget)this.hasTarget=!1,this.safeTime=Date.now()+Math.random()*n.FishGame.escapeRemainTime;else if(!this.hasTarget&&Date.now()>this.safeTime)return void this.owner.onSwitch(a.FishGameState.idle);this.owner.moveOn(this.escapeDir,t)},e}(a.FishGameStateBase);i.FishGameState_Escape=s,cc._RF.pop()},{"../../../miniGamePackage/utils/MathExt":"MathExt","../config_FishGame":"config_FishGame","./StateBase":"StateBase"}],FindCraftBuyMenu:[function(t,e,i){"use strict";cc._RF.push(e,"877d2kLB4VHlrokQZEjrlbG","FindCraftBuyMenu"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./config_FindCraft"),n=t("./FindCraftModel"),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speedGoods=null,e.speedCosts=null,e.speedMax=null,e.loadGoods=null,e.loadCosts=null,e.loadMax=null,e.board=null,e.hideEvent_once=function(){},e.isShow=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"speedLv",{get:function(){return n.FC_S.Ins.mgr.speedLv},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadLv",{get:function(){return n.FC_S.Ins.mgr.loadLv},enumerable:!1,configurable:!0}),e.prototype.show=function(){var t=this;this.isShow||(this.getComponent(cc.Widget).enabled=!1,this.isShow=!0,this.node.active=!0,this.node.position=cc.v3(0,-n.FC_S.Ins.mgr.node.height,0),cc.tween(this.node).to(.5,{position:cc.Vec3.ZERO},{easing:"backOut"}).call(function(){t.getComponent(cc.Widget).enabled=!0}).start(),this.refresh())},e.prototype.hide=function(){var t=this;this.isShow&&(this.isShow=!1,this.node.position=cc.v3(0,0,0),cc.tween(this.node).to(.5,{position:cc.v3(0,n.FC_S.Ins.mgr.node.height,0)},{easing:"backIn"}).call(function(){t.isShow||(t.node.active=!1),t.hideEvent_once(),t.hideEvent_once=function(){}}).start())},e.prototype.onLoad=function(){this.board.on(cc.Node.EventType.TOUCH_START,function(){},this),this.node.on(cc.Node.EventType.TOUCH_START,this.hide,this)},e.prototype.refresh=function(){this.speedLv>=o.FindCraft.speedPriceCfg.length?(this.speedGoods.string="",this.speedMax.active=!0,this.speedCosts.string=""):(this.speedGoods.string=""+(o.FindCraft.speedPriceCfg[this.speedLv].value+o.FindCraft.playerSpeed),this.speedMax.active=!1,this.speedCosts.string=""+o.FindCraft.speedPriceCfg[this.speedLv].price),this.loadLv>=o.FindCraft.maxLoadPriceCfg.length?(this.loadGoods.string="",this.loadMax.active=!0,this.loadCosts.string=""):(this.loadGoods.string=""+(o.FindCraft.maxLoadPriceCfg[this.loadLv].value+o.FindCraft.maxLoad),this.loadCosts.string=""+o.FindCraft.maxLoadPriceCfg[this.loadLv].price,this.loadMax.active=!1)},__decorate([r(cc.Label)],e.prototype,"speedGoods",void 0),__decorate([r(cc.Label)],e.prototype,"speedCosts",void 0),__decorate([r(cc.Node)],e.prototype,"speedMax",void 0),__decorate([r(cc.Label)],e.prototype,"loadGoods",void 0),__decorate([r(cc.Label)],e.prototype,"loadCosts",void 0),__decorate([r(cc.Node)],e.prototype,"loadMax",void 0),__decorate([r(cc.Node)],e.prototype,"board",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"./FindCraftModel":"FindCraftModel","./config_FindCraft":"config_FindCraft"}],FindCraftGameWindow:[function(t,e,i){"use strict";cc._RF.push(e,"9c5245lu5VP3Y+gVPxlZvz+","FindCraftGameWindow"),Object.defineProperty(i,"__esModule",{value:!0}),i.FindCraftGameWindow=void 0;var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=__importDefault(t("./Collider/ColliderBase")),a=t("./Collider/Manager"),s=t("./config_FindCraft"),r=__importDefault(t("./FindCraftBuyMenu")),c=t("./FindCraftModel"),l=__importDefault(t("./FindCraftPlayer")),h=__importDefault(t("./FindCraftJoyStick")),u=__importDefault(t("../../miniGamePackage/SubPackageManager")),d=cc._decorator,p=d.ccclass,m=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.root=null,e.player=null,e.moneyLabel=null,e.buyMenu=null,e.soldMenu=null,e.soldMenuLabel=[],e.soldArea=null,e.buyArea=null,e.viewRect=null,e.joy=null,e.coin=null,e.resSpriteFrames=[],e.resDescription=["\u7cae\u98df","\u8349\u579b","\u6811\u6869"],e.speedLv=0,e.loadLv=0,e.res=[],e.money=0,e.value=0,e.load=0,e.totalMoney=0,e.progressFill=null,e.progressLabel=null,e.isInBuyArea=!1,e.gameOver=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"maxLoad",{get:function(){return(this.loadLv>0?s.FindCraft.maxLoadPriceCfg[this.loadLv-1].value:0)+s.FindCraft.maxLoad},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return(this.speedLv>0?s.FindCraft.speedPriceCfg[this.speedLv-1].value:0)+s.FindCraft.playerSpeed},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){c.FC_S.Ins.mgr=this,c.FC_S.Ins.cmgr=new a.FindCraftColliderManager},e.prototype.randomResPos=function(){return cc.v2(s.FindCraft.resArea[0].x+Math.random()*(s.FindCraft.resArea[1].x-s.FindCraft.resArea[0].x),s.FindCraft.resArea[0].y+Math.random()*(s.FindCraft.resArea[1].y-s.FindCraft.resArea[0].y))},e.prototype.getGuidePosAndDirInView=function(t,e,i){var n=function(t,e,i){return e.convertToNodeSpaceAR(t.convertToWorldSpaceAR(i))},a=this.node,r=cc.v2(this.node.width/2,this.node.height/2),c=n(e.parent,a,e.position),l=n(e,a,i),h=o.default.V3(o.default.ClampRect(r.mul(-1).add(s.FindCraft.promptSizeOffset),r.sub(s.FindCraft.promptSizeOffset),o.default.V2(l))),u=c.sub(h).normalize();return{localPos:n(a,t.parent,h),dir:u}},e.prototype.start=function(){this.soldArea.enter=this.enterSold.bind(this),this.soldArea.exit=this.exitSold.bind(this),this.soldArea.center=o.default.V2(this.soldArea.node.position),this.buyArea.enter=this.enterBuy.bind(this),this.buyArea.exit=this.exitBuy.bind(this),this.buyArea.center=o.default.V2(this.buyArea.node.position);for(var t=0;t<s.FindCraft.resCfg.length;t++)this.soldMenuLabel[t].string=s.FindCraft.resCfg[t].value.toString()},e.prototype.enterRes=function(t){var e=t.collected(this.maxLoad-this.load);e>0&&(this.load+=e*t.loadCost,this.value+=e*t.value,this.player.getRes(t,e))},e.prototype.update=function(t){if(this.moneyLabel.string=""+Math.ceil(this.money),this.progressFill.fillRange=this.totalMoney/s.FindCraft.targetMoney,this.progressLabel.string=Math.ceil(this.totalMoney)+"/"+s.FindCraft.targetMoney,!this.gameOver){var e=this.joy.v.normalize();this.player.moveOn(e.normalize(),t)}},e.prototype.enterSold=function(){console.log("enterSold"),this.player.soldAll(),this.soldMenu.position=cc.v3(-this.node.width,0,0),this.soldMenu.active=!0,cc.tween(this.soldMenu).to(.5,{position:cc.v3(0,0,0)},{easing:"backOut"}).start()},e.prototype.exitSold=function(){var t=this;console.log("exitSold"),this.soldMenu.stopAllActions(),cc.tween(this.soldMenu).to(.5,{position:cc.v3(this.node.width,0,0)},{easing:"backIn"}).call(function(){t.soldMenu.active=!1}).start()},e.prototype.enterBuy=function(){var t=this;this.isInBuyArea=!0,this.buyMenu.show(),this.joy.upEvent_once=function(){if(t.isInBuyArea){var e=t.joy.node.getSiblingIndex(),i=t.buyMenu.node.getSiblingIndex();e>i&&t.joy.node.setSiblingIndex(i)}}},e.prototype.exitBuy=function(){var t=this;this.isInBuyArea=!1,this.buyMenu.hide(),this.joy.downEvent_once=function(){if(!t.isInBuyArea){var e=t.joy.node.getSiblingIndex(),i=t.buyMenu.node.getSiblingIndex();e<i&&t.joy.node.setSiblingIndex(i)}}},e.prototype.buySpeed=function(){if(!(this.speedLv>=s.FindCraft.speedPriceCfg.length)){var t=s.FindCraft.speedPriceCfg[this.speedLv].price;this.money>t&&(this.money-=t,this.speedLv++,this.buyMenu.refresh())}},e.prototype.onPlayerMove=function(t){var e=o.default.V3(t).mul(-1),i=o.default.V2(this.viewRect.position).add(cc.v2(this.viewRect.width/2,this.viewRect.height/2)),n=o.default.V2(this.viewRect.position).sub(cc.v2(this.viewRect.width/2,this.viewRect.height/2)),a=cc.v2(this.node.width/2,this.node.height/2),s=n.add(a).mul(-1),r=i.sub(a).mul(-1);e.x=o.default.Clamp(r.x,s.x,e.x),e.y=o.default.Clamp(r.y,s.y,e.y),this.root.position=e},e.prototype.buyMaxLoad=function(){var t=this;if(!(this.loadLv>=s.FindCraft.maxLoadPriceCfg.length)){this.buyMenu.hideEvent_once=function(){t.player.upgradeLoadAnim()},this.player.upgradeLoad();var e=s.FindCraft.maxLoadPriceCfg[this.loadLv].price;this.money>e&&(this.money-=e,this.loadLv++,this.buyMenu.refresh())}},e.prototype.getCoinAnim=function(t){var e=this.moneyLabel.node;e.stopAllActions(),e.scale=1.6,this.money+=t,this.totalMoney+=t,this.totalMoney>s.FindCraft.targetMoney&&this.win(),cc.tween(e).to(.8,{scale:1},{easing:"sineOut"}).start()},e.prototype.exit=function(){u.default.instance.getModel().gameExit()},e.prototype.win=function(){this.gameOver||(this.gameOver=!0,u.default.instance.gotoResultWithLoading(!0,this.node.parent))},__decorate([m(cc.Node)],e.prototype,"root",void 0),__decorate([m(l.default)],e.prototype,"player",void 0),__decorate([m(cc.Label)],e.prototype,"moneyLabel",void 0),__decorate([m(r.default)],e.prototype,"buyMenu",void 0),__decorate([m(cc.Node)],e.prototype,"soldMenu",void 0),__decorate([m(cc.Label)],e.prototype,"soldMenuLabel",void 0),__decorate([m(n.default)],e.prototype,"soldArea",void 0),__decorate([m(n.default)],e.prototype,"buyArea",void 0),__decorate([m(cc.Node)],e.prototype,"viewRect",void 0),__decorate([m(h.default)],e.prototype,"joy",void 0),__decorate([m(cc.SpriteFrame)],e.prototype,"coin",void 0),__decorate([m(cc.SpriteFrame)],e.prototype,"resSpriteFrames",void 0),__decorate([m],e.prototype,"resDescription",void 0),__decorate([m(cc.Sprite)],e.prototype,"progressFill",void 0),__decorate([m(cc.Label)],e.prototype,"progressLabel",void 0),__decorate([p],e)}(cc.Component);i.FindCraftGameWindow=f,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/utils/MathExt":"MathExt","./Collider/ColliderBase":"ColliderBase","./Collider/Manager":"Manager","./FindCraftBuyMenu":"FindCraftBuyMenu","./FindCraftJoyStick":"FindCraftJoyStick","./FindCraftModel":"FindCraftModel","./FindCraftPlayer":"FindCraftPlayer","./config_FindCraft":"config_FindCraft"}],FindCraftJoyStick:[function(t,e,i){"use strict";cc._RF.push(e,"8a31dO5DCdIKp3yL+u/3R3V","FindCraftJoyStick"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.outRadius=100,e.inRadius=20,e.delayFadeTime=600,e.fadeTime=600,e.outRing=null,e.inRing=null,e.upEvent_once=function(){},e.downEvent_once=function(){},e.center=cc.Vec2.ZERO,e.pos=cc.Vec2.ZERO,e.lastTime=0,e.isTouching=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.outRing.opacity=0,this.inRing.opacity=0},Object.defineProperty(e.prototype,"v",{get:function(){return this.isTouching?this.pos.div(this.outRadius):cc.Vec2.ZERO},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.down,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.move,this),this.node.on(cc.Node.EventType.TOUCH_END,this.up,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.up,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.down,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.move,this),this.node.off(cc.Node.EventType.TOUCH_END,this.up,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.up,this)},e.prototype.down=function(t){this.isTouching=!0,this.center=this.node.convertToNodeSpaceAR(t.getLocation()),this.pos=cc.Vec2.ZERO,this.downEvent_once(),this.downEvent_once=function(){}},e.prototype.move=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation()),i=cc.Vec2.distance(e,this.center);this.pos=e.sub(this.center).normalize().multiplyScalar(i>this.outRadius?this.outRadius:i)},e.prototype.up=function(){this.lastTime=Date.now(),this.isTouching=!1,this.pos=cc.Vec2.ZERO,this.upEvent_once(),this.upEvent_once=function(){}},e.prototype.refresh=function(t){this.outRing.opacity=255*t,this.outRing.position=o.default.V3(this.center),this.inRing.opacity=255*t,this.inRing.position=o.default.V3(this.pos)},e.prototype.update=function(){if(this.isTouching||Date.now()-this.lastTime<this.delayFadeTime)this.refresh(1);else if(Date.now()-this.lastTime-this.delayFadeTime<this.fadeTime){var t=Date.now()-this.lastTime-this.delayFadeTime;this.refresh(1-t/this.fadeTime)}else this.outRing.opacity=this.inRing.opacity=0},__decorate([s],e.prototype,"outRadius",void 0),__decorate([s],e.prototype,"inRadius",void 0),__decorate([s],e.prototype,"delayFadeTime",void 0),__decorate([s],e.prototype,"fadeTime",void 0),__decorate([s(cc.Node)],e.prototype,"outRing",void 0),__decorate([s(cc.Node)],e.prototype,"inRing",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt"}],FindCraftModel:[function(t,e,i){"use strict";cc._RF.push(e,"46bd9xXSQ5DHrC0H2R7N6gF","FindCraftModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.FindCraftModel=i.FC_S=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return e.getInst()},enumerable:!1,configurable:!0}),e}(t("../../miniGamePackage/utils/SingleClass").SingleClass);i.FC_S=s;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/findCraft/findCraft",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.findCraft)],e)}(n.default);i.FindCraftModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame","../../miniGamePackage/utils/SingleClass":"SingleClass"}],FindCraftPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"5fa4dTmy5pGEoVEflRltgkb","FindCraftPlayer"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=t("../../miniGamePackage/utils/Pool"),a=t("../../miniGamePackage/utils/Queue"),s=__importDefault(t("./Collider/ColliderBase")),r=t("./config_FindCraft"),c=t("./FindCraftModel"),l=cc._decorator,h=l.ccclass,u=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.collider=null,e.anim=null,e.animGrp=null,e.fishType=[],e.attachList=[],e.grade=0,e.effect=null,e.playerSoldViewLayer=null,e.soldViewRect=null,e.coinPosNode=null,e.loadFill=null,e.coinPos=cc.Vec3.ZERO,e.topLabelPrefab=null,e.topLabelFolder=null,e.topLabelPool=new n.Pool(function(){var t=cc.instantiate(e.topLabelPrefab);return t.opacity=255,t.active=!0,t.parent=e.topLabelFolder,t.position=cc.v3(0,0,0),t},function(t){t.opacity=255,t.position=cc.v3(0,0,0)},function(t){return t.opacity=0}),e.dir=cc.Vec2.RIGHT,e.size=20,e.goodsPool=new n.Pool(function(){var t=new cc.Node;return t.addComponent(cc.Sprite),t.parent=e.node,t.scale=1.5,t},function(t){t.active=!0,t.parent=e.goodsNode,t.setSiblingIndex(e.goodsNode.children.length-1)},function(t){t.active=!1,t.parent=e.node}),e.soldViewObjPool=new n.Pool(function(){var t=new cc.Node;return t.addComponent(cc.Sprite),t.parent=e.playerSoldViewLayer,t.opacity=255,t.scale=1,t},function(t){return t.active=!0},function(t){return t.active=!1}),e.valueList=[],e.itemTypeQueue=new a.Queue,e.labelIdx=0,e.isInGetResAnim=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"goodsNode",{get:function(){return this.attachList[this.grade]},enumerable:!1,configurable:!0}),e.prototype.start=function(){console.log("player"),this.coinPos=this.playerSoldViewLayer.convertToNodeSpaceAR(this.coinPosNode.parent.convertToWorldSpaceAR(this.coinPosNode.position)),this.loadFill.fillRange=c.FC_S.Ins.mgr.load/c.FC_S.Ins.mgr.maxLoad},e.prototype.update=function(){var t=cc.color(74,234,60),e=cc.color(234,60,60);this.loadFill.node.color=cc.Color.lerp(this.loadFill.node.color,t,e,this.loadFill.fillRange)},e.prototype.moveOn=function(t,e){this.animGrp.scaleX=Math.sign(this.dir.x)*Math.abs(this.animGrp.scaleX),o.default.isZero(t)?"idle"!=this.anim.animation&&this.anim.setAnimation(0,"idle",!0):(this.dir=o.default.Slerp(this.dir,t.normalize(),r.FindCraft.rotSpeed*e).normalize(),this.moveAt(this.dir.mul(c.FC_S.Ins.mgr.speed*e).add(o.default.V2(this.node.position))),"run"!=this.anim.animation&&this.anim.setAnimation(0,"run",!0))},e.prototype.moveAt=function(t){var e=o.default.V2(this.node.position).sub(this.collider.center),i=t.sub(e);c.FC_S.Ins.cmgr.testOverlap(this.collider,i);var n=c.FC_S.Ins.cmgr.moveCollision(this.collider,i.sub(this.collider.center));this.collider.center=n;var a=o.default.V3(n.add(e));this.node.position=a,c.FC_S.Ins.mgr.onPlayerMove(o.default.V2(a))},e.prototype.upgradeLoadAnim=function(){var t=this;this.grade>=this.fishType.length&&(this.grade=this.fishType.length-1),this.effect.enabled=!0,this.effect.setCompleteListener(function(){t.effect.enabled=!1,t.effect.setCompleteListener(function(){})}),this.effect.setAnimation(0,"animation",!1),this.anim.node.active=!1,this.fishType[this.grade].node.active=!0,this.anim=this.fishType[this.grade],this.anim.setAnimation(0,"idle",!0)},e.prototype.upgradeLoad=function(){if(!(this.grade>=this.fishType.length-1)){var t=this.goodsNode;this.grade++;for(var e=this.goodsNode;t.childrenCount>0;)t.children[0].parent=e}},e.prototype.soldAll=function(){var t=this;this.coinPos=this.playerSoldViewLayer.convertToNodeSpaceAR(this.coinPosNode.parent.convertToWorldSpaceAR(this.coinPosNode.position));var e=function(){var i=t.goodsPool.peek;if(i){var o=t.soldViewObjPool.newObj();o.parent=t.soldViewRect,o.getComponent(cc.Sprite).spriteFrame=i.getComponent(cc.Sprite).spriteFrame,o.position=o.parent.convertToNodeSpaceAR(i.parent.convertToWorldSpaceAR(i.position));var n=cc.v3(t.soldViewRect.width*(Math.random()-.5),t.soldViewRect.height*(Math.random()-.5),0),a=t.coinPos;t.goodsPool.delObj(i),cc.tween(o).to(.8,{position:n},{easing:"sineInOut"}).to(.4,{scale:0},{easing:"sineIn"}).call(function(){for(var e=t.valueList.pop(),i=Math.ceil(e/r.FindCraft.coinValue),n=e/i,s=function(){var e=t.soldViewObjPool.newObj();e.parent=t.playerSoldViewLayer,e.getComponent(cc.Sprite).spriteFrame=c.FC_S.Ins.mgr.coin,e.position=e.parent.convertToNodeSpaceAR(o.parent.convertToWorldSpaceAR(o.position)),e.scale=0,cc.tween(e).parallel(cc.tween(e).by(.2*Math.random()+.3,{position:cc.v3(200*Math.random()-100,200*Math.random()-100,0)}),cc.tween(e).to(.4,{scale:1})).to(.8,{position:a},{easing:"sineIn"}).call(function(){c.FC_S.Ins.mgr.getCoinAnim(n),t.soldViewObjPool.delObj(e),e.active=!1}).start()},l=0;l<i;l++)s();t.soldViewObjPool.delObj(o)}).start(),setTimeout(e,50)}else c.FC_S.Ins.mgr.load=c.FC_S.Ins.mgr.value=0};cc.tween(this.loadFill).to(.5,{fillRange:0}).start(),e()},e.prototype.getRes=function(t,e){for(var i=this,o=function(){var t=i.itemTypeQueue.deq();if(null!=t){var e=c.FC_S.Ins.mgr.resSpriteFrames[t],n=c.FC_S.Ins.mgr.resDescription[t],a=i.topLabelPool.newObj().getComponent(cc.Label);a.string=n+"+1",cc.tween(a.node).parallel(cc.tween(a.node).to(.7,{position:cc.v3(0,100,0)}),cc.tween(a.node).delay(.4).to(.3,{opacity:0})).start();var s=i.goodsPool.newObj();s.opacity=0,s.getComponent(cc.Sprite).spriteFrame=e;var l=cc.v3(0,(i.goodsPool.objsLen-1)*r.FindCraft.itemHei,0);s.position=l.add(cc.v3(0,20,0)),cc.tween(s).to(1,{position:l,opacity:255},{easing:"backOut"}).start(),setTimeout(function(){o()},110)}else i.isInGetResAnim=!1},n=0;n<e;n++)this.itemTypeQueue.enq(t.itemType),this.valueList.push(t.value);cc.tween(this.loadFill).to(.4,{fillRange:c.FC_S.Ins.mgr.load/c.FC_S.Ins.mgr.maxLoad}).start(),this.isInGetResAnim||(this.isInGetResAnim=!0,o())},__decorate([u(s.default)],e.prototype,"collider",void 0),__decorate([u(sp.Skeleton)],e.prototype,"anim",void 0),__decorate([u(cc.Node)],e.prototype,"animGrp",void 0),__decorate([u(sp.Skeleton)],e.prototype,"fishType",void 0),__decorate([u(cc.Node)],e.prototype,"attachList",void 0),__decorate([u(sp.Skeleton)],e.prototype,"effect",void 0),__decorate([u(cc.Node)],e.prototype,"playerSoldViewLayer",void 0),__decorate([u(cc.Node)],e.prototype,"soldViewRect",void 0),__decorate([u(cc.Node)],e.prototype,"coinPosNode",void 0),__decorate([u(cc.Sprite)],e.prototype,"loadFill",void 0),__decorate([u(cc.Prefab)],e.prototype,"topLabelPrefab",void 0),__decorate([u(cc.Node)],e.prototype,"topLabelFolder",void 0),__decorate([h],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt","../../miniGamePackage/utils/Pool":"Pool","../../miniGamePackage/utils/Queue":"Queue","./Collider/ColliderBase":"ColliderBase","./FindCraftModel":"FindCraftModel","./config_FindCraft":"config_FindCraft"}],FindCraftResource:[function(t,e,i){"use strict";cc._RF.push(e,"3b718Dji+dAw4DMgtBHB+eH","FindCraftResource"),Object.defineProperty(i,"__esModule",{value:!0}),i.FindCraftResource=void 0;var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=t("../../miniGamePackage/utils/Pool"),a=__importDefault(t("./Collider/AABB")),s=t("./config_FindCraft"),r=t("./FindCraftModel"),c=cc._decorator,l=c.ccclass,h=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemFolders=[],e.trigger=null,e.itemType=0,e.promptLabel=null,e.promptArrow=null,e.promptNode=null,e.promptPosNode=null,e.orientPosNode=null,e.itemHei=15,e.num=0,e.generateTimer=0,e.itemPool=new n.Pool(function(){var t=new cc.Node;return t.addComponent(cc.Sprite).spriteFrame=r.FC_S.Ins.mgr.resSpriteFrames[e.itemType],t.parent=e.node,t}),e.isInLoseAnim=!1,e.reduceNum=0,e.heapIdx=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"generate",{get:function(){return s.FindCraft.resCfg[this.itemType].generate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadCost",{get:function(){return s.FindCraft.resCfg[this.itemType].loadCost},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return s.FindCraft.resCfg[this.itemType].value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originNum",{get:function(){return s.FindCraft.resCfg[this.itemType].originNum},enumerable:!1,configurable:!0}),e.prototype.start=function(){var t=this;this.num=this.originNum,this.generateTimer=this.generate,r.FC_S.Ins.mgr.res.push(this),this.trigger.enter=function(){r.FC_S.Ins.mgr.enterRes(t)};for(var e=0;e<this.num;e++)this.getItemView(!1)},e.prototype.update=function(t){this.generateTimer-=t,this.generateTimer<0&&(this.generateTimer=this.generate,this.num<s.FindCraft.resCfg[this.itemType].maxNum&&(this.num++,this.getItemView()));var e=r.FC_S.Ins.mgr.getGuidePosAndDirInView(this.promptNode,this.orientPosNode,this.promptPosNode.position);this.promptNode.position=e.localPos,this.promptArrow.angle=o.default.getRad(o.default.V2(e.dir))*o.default.Rad2Ang,this.promptLabel.string=this.num.toString()},e.prototype.collected=function(t){var e=this,i=Math.floor(t/this.loadCost);if(i=Math.min(i,this.num),this.num,this.num-=i,this.reduceNum+=i,!this.isInLoseAnim){this.isInLoseAnim=!0;var o=function(){e.reduceNum<=0?e.isInLoseAnim=!1:(e.reduceNum--,e.loseItemView(),setTimeout(function(){return o()},50))};o()}return i},e.prototype.getItemView=function(t){void 0===t&&(t=!0);var e=this.itemFolders[this.heapIdx];this.heapIdx=(this.heapIdx+1)%this.itemFolders.length;var i=this.itemPool.newObj();if(i.parent=e,t){var o=cc.v3(0,1,0).mul((e.childrenCount-1)*this.itemHei);i.opacity=0,i.position=o.sub(cc.v3(0,30,0)),cc.tween(i).to(.5,{position:o,opacity:255}).start()}else i.position=cc.v3(0,1,0).mul((e.childrenCount-1)*this.itemHei)},e.prototype.loseItemView=function(){this.itemFolders[this.heapIdx],this.heapIdx=(this.heapIdx-1+this.itemFolders.length)%this.itemFolders.length;var t=this.itemPool.peek;if(t){t.stopAllActions();var e=this.node.convertToNodeSpaceAR(t.parent.convertToWorldSpaceAR(t.position));this.itemPool.delObj(t),t.parent=this.node,t.position=e,cc.tween(t).to(.5,{position:e.add(cc.v3(0,30,0)),opacity:0}).start()}},__decorate([h(cc.Node)],e.prototype,"itemFolders",void 0),__decorate([h(a.default)],e.prototype,"trigger",void 0),__decorate([h],e.prototype,"itemType",void 0),__decorate([h(cc.Label)],e.prototype,"promptLabel",void 0),__decorate([h(cc.Node)],e.prototype,"promptArrow",void 0),__decorate([h(cc.Node)],e.prototype,"promptNode",void 0),__decorate([h(cc.Node)],e.prototype,"promptPosNode",void 0),__decorate([h(cc.Node)],e.prototype,"orientPosNode",void 0),__decorate([l],e)}(cc.Component);i.FindCraftResource=u,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt","../../miniGamePackage/utils/Pool":"Pool","./Collider/AABB":"AABB","./FindCraftModel":"FindCraftModel","./config_FindCraft":"config_FindCraft"}],FindCraftSortingManager:[function(t,e,i){"use strict";cc._RF.push(e,"139b7zBw5JMkIWhfzbakHin","FindCraftSortingManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.update=function(){var t=__spreadArrays(this.node.children);t.sort(function(t,e){return Math.sign(t.y-e.y)}),t.forEach(function(t){t.setSiblingIndex(0)})},__decorate([n],e)}(cc.Component));i.default=a,cc._RF.pop()},{}],FishCollider:[function(t,e,i){"use strict";cc._RF.push(e,"b8f46Slj1BAgKmjGfXnLFN7","FishCollider"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offset=cc.v2(0,0),e.size=cc.size(0,0),e}return __extends(e,t),e.prototype.start=function(){},__decorate([a(cc.Vec2)],e.prototype,"offset",void 0),__decorate([a(cc.Size)],e.prototype,"size",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],FishGameActorDisplay:[function(t,e,i){"use strict";cc._RF.push(e,"4b760bYSElBjaycNIf77M4r","FishGameActorDisplay"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=__importDefault(t("./FishGameDynamicObjBase")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.owner=null,e.graphics=null,e}return __extends(e,t),e.prototype.refresh=function(t,e,i){void 0===i&&(i=cc.Color.WHITE),this.node.angle=o.default.getRad(e)*o.default.Rad2Ang,this.graphics.clear();var n=t/2;this.graphics.fillColor=i,this.graphics.lineWidth=2,this.graphics.moveTo(-n/Math.SQRT2,n/Math.SQRT2),this.graphics.lineTo(0,0),this.graphics.lineTo(-n/Math.SQRT2,-n/Math.SQRT2),this.graphics.lineTo(-n/Math.SQRT2,n/Math.SQRT2),this.graphics.close(),this.graphics.moveTo(0,n),this.graphics.lineTo(n,0),this.graphics.lineTo(0,-n),this.graphics.lineTo(0,n),this.graphics.close(),this.graphics.fill(),this.owner&&(this.graphics.strokeColor=i,this.graphics.circle(0,0,this.owner.size/2),this.graphics.stroke())},__decorate([r(n.default)],e.prototype,"owner",void 0),__decorate([r(cc.Graphics)],e.prototype,"graphics",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt","./FishGameDynamicObjBase":"FishGameDynamicObjBase"}],FishGameBean:[function(t,e,i){"use strict";cc._RF.push(e,"a5557yr/HNI5plpPsRJn0UM","FishGameBean"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=t("./config_FishGame"),a=t("./FishGameSingleton"),s=cc._decorator,r=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isDie=!1,e.score=1,e.dir=cc.Vec3.ZERO,e.isInAbsorb=!1,e.targetPos=cc.Vec3.ZERO,e.blockCrd=cc.Vec2.ZERO,e}return __extends(e,t),e.prototype.onEaten=function(){a.FG_S.Ins.mgr.destoryBean(this)},e.prototype.onEatenByMove=function(t,e){var i=this;this.isDie=!0;var n=a.FG_S.Ins.mgr.findBlockCrd(o.default.V2(this.node.position));cc.tween(this.node).to(.05,{position:o.default.V3(t)}).call(function(){var t,o=null===(t=a.FG_S.Ins.mgr.getBlockInfo(n))||void 0===t?void 0:t.info;if(o){var s=o.beans.findIndex(function(t){return t==i});s>=0&&o.beans.splice(s,1)}e&&e(),i.node.destroy()}).start()},e.prototype.absorbTo=function(t){return this.isDie=!0,this.isInAbsorb=!0,this.dir=t.node.position.sub(this.node.position).normalizeSelf(),this.targetPos=t.node.position,this.blockCrd=a.FG_S.Ins.mgr.findBlockCrd(o.default.V2(this.node.position)),cc.Vec3.distance(this.node.position,t.node.position)/n.FishGame.magnetSpeed},e.prototype.update=function(t){var e,i=this;if(this.isInAbsorb){var o=this.node.position.add(this.dir.mul(n.FishGame.magnetSpeed*t));if(o.sub(this.targetPos).dot(this.node.position.sub(this.targetPos))<0){this.node.position=this.targetPos;var s=null===(e=a.FG_S.Ins.mgr.getBlockInfo(this.blockCrd))||void 0===e?void 0:e.info.beans;s&&s.findIndex(function(t){return t==i})&&s.splice(s.findIndex(function(t){return t==i}),1),this.node.destroy()}else this.node.position=o}},__decorate([r],e)}(cc.Component));i.default=c,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt","./FishGameSingleton":"FishGameSingleton","./config_FishGame":"config_FishGame"}],FishGameDynamicObjBase:[function(t,e,i){"use strict";cc._RF.push(e,"ad354ctwk1O7pwHZfCAXf8S","FishGameDynamicObjBase"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=t("./config_FishGame"),a=__importDefault(t("./FishGameBean")),s=t("./FishGameSingleton"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.body=null,e.monthPos=cc.Vec2.ZERO,e.skeleton=null,e.env={beans:[],targets:[]},e.isDie=!1,e._score=0,e.txtScore=0,e.dir=cc.Vec2.RIGHT,e.isInAnim=!1,e.isInScaleAnim=!1,e.scaleProgressParam={v:0},e.curSize=0,e}var i;return __extends(e,t),i=e,Object.defineProperty(e.prototype,"center",{get:function(){return o.default.V2(this.node.position)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t,this.onScoreChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return n.FishGame.f(this.score/n.FishGame.scoreGradient)*n.FishGame.baseSpeed*(s.FG_S.Ins.mgr.k+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return n.FishGame.g(this.score/n.FishGame.scoreGradient)*n.FishGame.baseSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"moveSpeed",{get:function(){return this.speed},enumerable:!1,configurable:!0}),e.prototype.init=function(){this.onScoreChange(),this.txtScore=this.score,this.curSize=this.size},e.prototype.logicUpdate=function(t){var e=this,i=~~o.default.Lerp(this.txtScore,this.score,n.FishGame.textIncrement*t);if(i>this.score-30&&(i=~~o.default.StepTo(i,this.score,n.FishGame.textIncrement)),this.txtScore=i,this.label.string=""+this.txtScore,this.label.node.position=cc.v3(0,this.size/2+(this.label.node.height/2+n.FishGame.labelOffset)*this.label.node.scale,0),this.label.node.scale=.015*n.FishGame.baseSize*(1+s.FG_S.Ins.mgr.k),!this.isDie){var a=o.default.getRad(this.dir)*o.default.Rad2Ang;this.body.angle=a,this.isInScaleAnim?this.body.scale=this.scaleProgressParam.v:this.body.scale=this.size/this.skeleton.node.width,Math.floor(a/180-.5)%2==0&&(this.body.scaleY=-Math.abs(this.body.scaleY));var r=[],c=this.getAreaInfo(this.center,this.size/2);if(r.push.apply(r,c.beans),r.push.apply(r,c.targets.filter(function(t){return t.score<e.score})),c.magnets&&r.push.apply(r,c.magnets),!this.isInAnim)for(var l=0;l<r.length&&!this.isInAnim;l++)r[l].isDie||this.eat(r[l])}},e.prototype.fillToBlock=function(){for(var t=s.FG_S.Ins.mgr.overlapBlockCrds(this),e=0;e<t.length;e++)s.FG_S.Ins.mgr.getBlockInfo(t[e]).info.targets.push(this)},e.prototype.eatAnim=function(t,e){var i=this,n=t.sub(this.center).normalizeSelf(),a=this.monthPos.mul(this.body.scale),s=t.sub(n.mul(a.mag()));this.skeleton.setAnimation(0,"eat2",!1),this.dir=n;var r=o.default.getRad(n)*o.default.Rad2Ang,c=r-this.body.angle;c>180?r=this.body.angle-(360-c):c<-180&&(r=this.body.angle+(360+c)),r%=360,cc.tween(this.body).to(.3,{angle:r}).start(),cc.tween(this.node).to(.3,{position:o.default.V3(s)},{easing:"sineOut"}).call(function(){i.skeleton.setAnimation(0,"idle",!0),e()}).start()},e.prototype.onScoreChange=function(){},e.prototype.overlap=function(t){var e;return e=t instanceof a.default?this.size/2:this.size/2+t.size/2,cc.Vec3.distance(t.node.position,this.node.position)<e},e.prototype.getAreaInfo=function(t,e){for(var i=this,a=s.FG_S.Ins.mgr.findBlockCrd(t),r=s.FG_S.Ins.mgr.blockAreas,c=Math.ceil(e/s.FG_S.Ins.mgr.blockSize.x),l=Math.ceil(e/s.FG_S.Ins.mgr.blockSize.y),h=[],u=[],d=[],p=a.x-c;p<=a.x+c;p++)for(var m=a.y-l;m<=a.y+l;m++)if(!(p<0||p>=n.FishGame.blockNum.x||m<0||m>=n.FishGame.blockNum.y)){var f=r[p][m];f.overlapWithCircle(t,e)&&(u.push.apply(u,f.info.beans.filter(function(i){return!i.isDie&&cc.Vec2.distance(o.default.V2(i.node.position),t)<e})),f.info.magnets&&d.push.apply(d,f.info.magnets.filter(function(i){return!i.isDie&&cc.Vec2.distance(o.default.V2(i.node.position),t)<e+i.radius})),f.info.targets.forEach(function(o){var n=cc.Vec2.distance(o.center,t);o!=i&&n<e+o.size/2&&h.findIndex(function(t){return o==t})<0&&h.push(o)}))}var g=!1,_=!1,y=0,v=0;return t.x+e>s.FG_S.Ins.maxMapPos.x?(y=s.FG_S.Ins.maxMapPos.x,g=!0):t.x-e<s.FG_S.Ins.minMapPos.x&&(y=s.FG_S.Ins.minMapPos.x,g=!0),t.y+e>s.FG_S.Ins.maxMapPos.y?(v=s.FG_S.Ins.maxMapPos.y,_=!0):t.y-e<s.FG_S.Ins.minMapPos.y&&(v=s.FG_S.Ins.minMapPos.y,_=!0),{beans:u,targets:h,magnets:d,xLimit:g?y:void 0,yLimit:_?v:void 0}},e.prototype.onEaten=function(){this.isDie=!0},e.prototype.eat=function(t,e){var s=this;if(t instanceof i){var r=t.score;t.onEaten();var c=t;this.isInAnim=!0,this.eatAnim(o.default.V2(c.node.position),function(){s.isInScaleAnim=!0,s.isInAnim=!1,s.score+=r;var t=s.size/s.skeleton.node.width;s.scaleProgressParam.v=s.body.scale,cc.tween(s.scaleProgressParam).to(n.FishGame.fishScaleTime/2e3,{v:1.2*t},{easing:"sineOut"}).to(n.FishGame.fishScaleTime/2e3,{v:t},{easing:"sineOut"}).call(function(){s.isInScaleAnim=!1,s.onScoreChange()}).start(),e&&e()})}else if(t instanceof a.default){"idle"==this.skeleton.animation&&(this.skeleton.setCompleteListener(function(){s.skeleton.setCompleteListener(function(){}),s.skeleton.setAnimation(0,"idle",!0)}),this.skeleton.setAnimation(0,"eat",!1)),this.score+=t.score;var l=o.default.alignVec(cc.Vec2.RIGHT,this.monthPos.mul(this.body.scale),this.dir).add(this.center);t.onEatenByMove(l)}},e.prototype.moveOn=function(t,e){o.default.isZero(t)||(this.dir=o.default.Slerp(this.dir,t.normalize(),n.FishGame.rotSpeed*e).normalize(),this.moveAt(this.dir.mul(this.moveSpeed*e).add(o.default.V2(this.node.position))))},e.prototype.moveTo=function(t,e){this.moveOn(t.sub(o.default.V2(this.node.position)).normalize(),e)},e.prototype.moveAt=function(t){var e=s.FG_S.Ins.mgr.mapPos,i=s.FG_S.Ins.mgr.mapPos.add(n.FishGame.mapSize);t.y=o.default.Clamp(e.y+this.size/2,i.y-this.size/2,t.y),t.x=o.default.Clamp(e.x+this.size/2,i.x-this.size/2,t.x),this.node.position=cc.v3(t.x,t.y)},__decorate([l(cc.Label)],e.prototype,"label",void 0),__decorate([l(cc.Node)],e.prototype,"body",void 0),__decorate([l(sp.Skeleton)],e.prototype,"skeleton",void 0),i=__decorate([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt","./FishGameBean":"FishGameBean","./FishGameSingleton":"FishGameSingleton","./config_FishGame":"config_FishGame"}],FishGameEnemy:[function(t,e,i){"use strict";cc._RF.push(e,"c6426P/IMFLm5bYb6kK9e7l","FishGameEnemy"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=t("./config_FishGame"),a=t("./EnemyState/Catch"),s=t("./EnemyState/Escape"),r=t("./EnemyState/Idle"),c=t("./EnemyState/Patrol"),l=t("./EnemyState/StateBase"),h=__importDefault(t("./FishGameBean")),u=__importDefault(t("./FishGameDynamicObjBase")),d=__importDefault(t("./FishGameMagnet")),p=t("./FishGameSingleton"),m=cc._decorator,f=m.ccclass,g=m.property,_=function(t){function e(){var e=t.call(this)||this;return e.graphicDebug=null,e.typeIndex=0,e.stateMap=new Map,e.destination=cc.Vec2.ZERO,e.halfBean=!1,e.stateMap.set(l.FishGameState.idle,new r.FishGameState_Idle(e)),e.stateMap.set(l.FishGameState.patrol,new c.FishGameState_Patrol(e)),e.stateMap.set(l.FishGameState.escape,new s.FishGameState_Escape(e)),e.stateMap.set(l.FishGameState.catch,new a.FishGameState_Catch(e)),e.curState=e.stateMap.get(l.FishGameState.idle),e}return __extends(e,t),Object.defineProperty(e.prototype,"real_visiualRadius",{get:function(){return n.FishGame.escapeVisualRange+this.size/2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"real_catchRadius",{get:function(){return n.FishGame.catchVisualRange+this.size/2},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){this.curState.onEnterState()},e.prototype.onSwitch=function(t,e,i){void 0===i&&(i=!1);var o=this.stateMap.get(t);(o!=this.curState||i)&&(this.curState.onExitState(),this.curState=o,this.curState.onEnterState(e))},e.prototype.eat=function(e,i){var n=this;if(!(e instanceof d.default))if(e instanceof h.default){"idle"==this.skeleton.animation&&(this.skeleton.setCompleteListener(function(){n.skeleton.setCompleteListener(function(){}),n.skeleton.setAnimation(0,"idle",!0)}),this.skeleton.setAnimation(0,"eat",!1)),this.halfBean?(this.score+=e.score,this.halfBean=!1):this.halfBean=!0;var a=o.default.alignVec(cc.Vec2.RIGHT,this.monthPos.mul(this.body.scale),this.dir).add(this.center);e.onEatenByMove(a)}else t.prototype.eat.call(this,e,i)},e.prototype.onEaten=function(){var t=this;this.isDie=!0,cc.tween(this.node).to(.5,{scale:.05}).call(function(){return p.FG_S.Ins.mgr.destoryEnemy(t)}).start()},e.prototype.logicUpdate=function(e){if(this.graphicDebug.clear(),!this.isDie&&(t.prototype.logicUpdate.call(this,e),this.isInAnim||p.FG_S.Ins.mgr.pause||this.curState.onUpdateState(e),n.FishGame.activeDebug)){for(var i=p.FG_S.Ins.mgr.overlapBlockCrds(this),o=0;o<i.length;o++)p.FG_S.Ins.mgr.showBlock(i[o],cc.color(255,50,50,40));this.graphicDebug.fillColor=cc.color(255,50,50,50),this.graphicDebug.circle(0,0,this.real_visiualRadius),this.graphicDebug.fill(),this.graphicDebug.fillColor=cc.color(255,50,50,100),this.graphicDebug.circle(0,0,this.real_catchRadius),this.graphicDebug.fill()}},__decorate([g(cc.Graphics)],e.prototype,"graphicDebug",void 0),__decorate([f],e)}(u.default);i.default=_,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt","./EnemyState/Catch":"Catch","./EnemyState/Escape":"Escape","./EnemyState/Idle":"Idle","./EnemyState/Patrol":"Patrol","./EnemyState/StateBase":"StateBase","./FishGameBean":"FishGameBean","./FishGameDynamicObjBase":"FishGameDynamicObjBase","./FishGameMagnet":"FishGameMagnet","./FishGameSingleton":"FishGameSingleton","./config_FishGame":"config_FishGame"}],FishGameIFood:[function(t,e,i){"use strict";cc._RF.push(e,"33f24DxX2tCEJ6lj7LQzgx+","FishGameIFood"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],FishGameMagnet:[function(t,e,i){"use strict";cc._RF.push(e,"05c27ZU75dFGYCr8j8pp5Pg","FishGameMagnet"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./FishGameSingleton"),n=cc._decorator,a=n.ccclass,s=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.score=0,e.radius=50,e.isDie=!1,e}return __extends(e,t),e.prototype.onEaten=function(){var t=this;this.isDie=!0,cc.tween(this.node).to(.5,{scale:.05}).call(function(){return o.FG_S.Ins.mgr.destoryMagnet(t)}).start()},__decorate([a],e)}(cc.Component));i.default=s,cc._RF.pop()},{"./FishGameSingleton":"FishGameSingleton"}],FishGameManager:[function(t,e,i){"use strict";cc._RF.push(e,"7497aGwYcpLgbcPdD7DFbdY","FishGameManager"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=t("./FishGameRectArea"),a=t("./config_FishGame"),s=__importDefault(t("./FishGameBean")),r=__importDefault(t("./FishGameEnemy")),c=__importDefault(t("./FishGamePlayer")),l=t("./FishGameSingleton"),h=__importDefault(t("../../miniGamePackage/SubPackageManager")),u=__importDefault(t("./FishGameMagnet")),d=cc._decorator,p=d.ccclass,m=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.beanPrefab=null,e.player=null,e.root=null,e.enemyFolder=null,e.beanFolder=null,e.enemyPrefab=null,e.magnetPrefab=null,e.fishSkeletonData=[],e.envPrefab=null,e.envFolder=null,e.bubblePrefab=null,e.scoreLabel=null,e.pause=!1,e.enemys=[],e.magnets=[],e.scale=1,e.targetScale=e.scale,e.gameOver=!1,e.k=1,e.blockAreas=[],e.blockSize=cc.v2(a.FishGame.mapSize.x/a.FishGame.blockNum.x,a.FishGame.mapSize.y/a.FishGame.blockNum.y),e.mapPos=cc.Vec2.ZERO,e.isWin=!1,e.blockGraphics=null,e.showBlocksBuffer=[],e.showBlocksColor=[],e}return __extends(e,t),Object.defineProperty(e.prototype,"viewSize",{get:function(){return cc.v2(this.node.width,this.node.height)},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._model=h.default.instance.getModel(),l.FG_S.Ins.mgr=this,this.gameOver=!1},e.prototype.findBlockCrd=function(t){var e=t.sub(this.mapPos),i=Math.floor(e.x/this.blockSize.x),o=Math.floor(e.y/this.blockSize.y);return cc.v2(i,o)},e.prototype.onPlayerMovePos=function(t){var e=cc.v3(-t.x*this.scale,-t.y*this.scale);this.root.position=e,this.clampRootPosToView()},e.prototype.scaleMapTo=function(t){this.targetScale=t},e.prototype.scaleMapAt=function(t){var e=this,i=t/this.scale;this.root.position=this.root.position.mul(i),this.scale=this.root.scale=t,this.magnets.forEach(function(t){t.isDie||(t.node.scale=e.node.width*a.FishGame.magnetScaleRatio/t.node.width/e.scale)}),this.clampRootPosToView()},e.prototype.clampRootPosToView=function(){var t=this.root.position,e=a.FishGame.mapSize.div(2).mul(this.scale).sub(this.viewSize.div(2));t.x=o.default.Clamp(-e.x,e.x,t.x),t.y=o.default.Clamp(-e.y,e.y,t.y),this.root.position=t},e.prototype.randomMapPos=function(){return cc.v2(Math.random()*a.FishGame.mapSize.x+this.mapPos.x,Math.random()*a.FishGame.mapSize.y+this.mapPos.y)},e.prototype.overlapBlockCrds=function(t){for(var e=[],i=l.FG_S.Ins.mgr.findBlockCrd(t.center),o=l.FG_S.Ins.mgr.blockAreas,n=Math.ceil(t.size/l.FG_S.Ins.mgr.blockSize.x),s=Math.ceil(t.size/l.FG_S.Ins.mgr.blockSize.y),r=i.x-n;r<=i.x+n;r++)for(var c=i.y-s;c<=i.y+s;c++)r<0||r>=a.FishGame.blockNum.x||c<0||c>=a.FishGame.blockNum.y||o[r][c].overlapWithCircle(t.center,t.size)&&e.push(cc.v2(r,c));return e},e.prototype.getBlockInfo=function(t){return this.blockAreas[t.x][t.y]?this.blockAreas[t.x][t.y]:(console.error("\u9519\u8bef\u5750\u6807:"+t),null)},e.prototype.exit=function(){this._model.gameExit()},e.prototype.validPos=function(t){if(t.x<this.mapPos.x||t.x>=this.mapPos.x+a.FishGame.mapSize.x||t.y<this.mapPos.y||t.y>=this.mapPos.y+a.FishGame.mapSize.y)return!1;var e=this.findBlockCrd(t);return!(e.x<0||e.x>=a.FishGame.blockNum.x||e.y<0||e.y>=a.FishGame.blockNum.y)},e.prototype.initMap=function(){var t,e=this;this.envFolder.width=a.FishGame.mapSize.x,this.envFolder.height=a.FishGame.mapSize.y;var i=100/a.FishGame.beanDensity,r=a.FishGame.mapSize.div(2);this.mapPos=r.mul(-1);for(var c=Math.ceil(a.FishGame.mapSize.x/a.FishGame.envWidth),l=0;l<c;l++){var h=cc.instantiate(this.envPrefab);h.parent=this.envFolder,h.position=cc.v3(this.mapPos.x+l*a.FishGame.envWidth,this.mapPos.y,0)}var u=function(t){!e.gameOver&&cc.isValid(t)&&(t.enabled=!0,t.node.position=cc.v3(Math.random()*a.FishGame.mapSize.x+e.mapPos.x,e.mapPos.y,0),t.setAnimation(0,"idle",!1))},d=function(){var t=cc.instantiate(p.bubblePrefab);t.parent=p.envFolder,t.setSiblingIndex(1),t.position=o.default.V3(p.randomMapPos());var i=t.getComponent(sp.Skeleton);i.setCompleteListener(function(){return t=i,void(!e.gameOver&&cc.isValid(t)&&(t.enabled=!1,setTimeout(function(){return u(t)},Math.random()*(a.FishGame.bubbleMaxRandTime-a.FishGame.bubbleMinRandTime)+a.FishGame.bubbleMinRandTime)));var t}),setTimeout(function(){return u(i)},Math.random()*a.FishGame.bubbleMinRandTime)},p=this;for(l=0;l<a.FishGame.bubbleNum;l++)d();for(l=0;l<a.FishGame.blockNum.x;l++){this.blockAreas.push([]);for(var m=0;m<a.FishGame.blockNum.y;m++)this.blockAreas[l].push(new n.FishGameBlockArea(cc.v2(l*this.blockSize.x,m*this.blockSize.y).add(this.mapPos),this.blockSize))}for(var f=-r.x;f<=r.x;f+=i)for(var g=-r.y;g<=r.y;g+=i){var _=(2*Math.random()-1)*a.FishGame.randomVolume,y=(2*Math.random()-1)*a.FishGame.randomVolume,v=cc.v2(f+_,g+y);if(this.validPos(v)){var b=cc.instantiate(this.beanPrefab).getComponent(s.default);b.node.angle=360*Math.random(),b.name="bean"+f+"-"+g,b.node.parent=this.beanFolder;var P=this.findBlockCrd(v);b.node.position=o.default.V3(v),null===(t=this.getBlockInfo(P))||void 0===t||t.info.beans.push(b)}}},e.prototype.initEnemy=function(){for(var t=a.FishGame.enemyCfg,e=function(e){var n,s=0,c=!1;do{if(n=o.default.V3(i.randomMapPos()),c=!1,s++>1e3){console.error("\u6ca1\u6709\u4f4d\u7f6e\u53ef\u4ee5\u751f\u6210\u654c\u4eba");break}i.enemys.forEach(function(t){cc.Vec3.distance(t.node.position,n)<t.size+a.FishGame.spawnCircle&&(c=!0)}),cc.Vec3.distance(i.player.node.position,n)<i.player.size+a.FishGame.spawnCircle&&(c=!0)}while(c);var l=cc.instantiate(i.enemyPrefab).getComponent(r.default);l.node.parent=i.enemyFolder,l.node.position=n,l.monthPos=a.FishGame.monthPosList[t[e][0]],l.skeleton.skeletonData=i.fishSkeletonData[t[e][0]],l.typeIndex=t[e][0],l.skeleton.setAnimation(0,"idle",!0),l.score=t[e][1],l.init(),i.enemys.push(l)},i=this,n=0;n<t.length;n++)e(n)},e.prototype.initMagnet=function(){for(var t,e=0;e<a.FishGame.magnetNum;e++){var i=this.randomMapPos(),n=cc.instantiate(this.magnetPrefab).getComponent(u.default);n.node.parent=this.beanFolder,n.node.position=o.default.V3(i),this.magnets.push(n);var s=null===(t=this.getBlockInfo(this.findBlockCrd(i)))||void 0===t?void 0:t.info;s&&(s.magnets?s.magnets.push(n):s.magnets=[n])}},e.prototype.start=function(){this.initMap(),this.initEnemy(),this.initMagnet(),this.player.score=a.FishGame.originScore,this.player.init(),this.scaleMapAt(this.node.width/this.player.size*a.FishGame.ratio)},e.prototype.destoryBean=function(t){var e,i=this.findBlockCrd(o.default.V2(t.node.position)),n=null===(e=this.getBlockInfo(i))||void 0===e?void 0:e.info;if(n){var a=n.beans.findIndex(function(e){return e==t});a>=0&&n.beans.splice(a,1)}t.node.destroy()},e.prototype.destoryEnemy=function(t){var e=this,i=this.enemys.findIndex(function(e){return e==t});i>=0&&this.enemys.splice(i,1),this.overlapBlockCrds(t).forEach(function(i){var o,n=null===(o=e.getBlockInfo(i))||void 0===o?void 0:o.info;if(n){var a=n.targets.findIndex(function(e){return e==t});a>=0&&n.targets.splice(a,1)}}),t.node.destroy()},e.prototype.destoryMagnet=function(t){var e,i=this.magnets.findIndex(function(e){return e==t});i>0&&this.magnets.splice(i,1);var n=this.findBlockCrd(o.default.V2(t.node.position)),a=null===(e=this.getBlockInfo(n))||void 0===e?void 0:e.info;if(a&&a.magnets){var s=a.magnets.findIndex(function(e){return e==t});s>=0&&a.magnets.splice(s,1)}t.node.destroy()},e.prototype.lose=function(){var t=this;setTimeout(function(){h.default.instance.gotoResultWithLoading(!1,t.node.parent),t.gameOver=!0},200),this.pause=!0},e.prototype.win=function(){var t=this;this.isWin||(this.isWin=!0,setTimeout(function(){h.default.instance.gotoResultWithLoading(!0,t.node.parent),t.gameOver=!0},200),this.pause=!0)},e.prototype.update=function(t){if(!this.gameOver){for(var e=0;e<this.blockAreas.length;e++)for(var i=0;i<this.blockAreas[e].length;i++)this.blockAreas[e][i].info.targets=[];var n=[];for(n.push.apply(n,this.enemys),n.push(this.player),n.sort(function(t,e){return t.score<e.score?1:t.score>e.score?-1:0}),n.forEach(function(t){t.node.setSiblingIndex(0),t.isDie||t.fillToBlock()}),this.blockGraphics.clear(),e=0;e<this.showBlocksBuffer.length;e++){var s=this.getBlockInfo(this.showBlocksBuffer[e]);this.blockGraphics.fillColor=this.showBlocksColor[e],this.blockGraphics.fillRect(s.zero.x,s.zero.y,s.size.x,s.size.y)}this.showBlocksBuffer=[],this.showBlocksColor=[],this.enemys.forEach(function(e){return e.logicUpdate(t)}),this.player.logicUpdate(t),this.scaleMapAt(o.default.Lerp(this.scale,this.targetScale,a.FishGame.viewScaleStep*t))}},e.prototype.showBlock=function(t,e){void 0===e&&(e=cc.color(0,255,255,30)),this.showBlocksBuffer.push(t),this.showBlocksColor.push(e)},__decorate([m(cc.Prefab)],e.prototype,"beanPrefab",void 0),__decorate([m(c.default)],e.prototype,"player",void 0),__decorate([m(cc.Node)],e.prototype,"root",void 0),__decorate([m(cc.Node)],e.prototype,"enemyFolder",void 0),__decorate([m(cc.Node)],e.prototype,"beanFolder",void 0),__decorate([m(cc.Prefab)],e.prototype,"enemyPrefab",void 0),__decorate([m(cc.Prefab)],e.prototype,"magnetPrefab",void 0),__decorate([m(sp.SkeletonData)],e.prototype,"fishSkeletonData",void 0),__decorate([m(cc.Prefab)],e.prototype,"envPrefab",void 0),__decorate([m(cc.Node)],e.prototype,"envFolder",void 0),__decorate([m(cc.Prefab)],e.prototype,"bubblePrefab",void 0),__decorate([m(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([m(cc.Graphics)],e.prototype,"blockGraphics",void 0),__decorate([p],e)}(cc.Component);i.default=f,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/utils/MathExt":"MathExt","./FishGameBean":"FishGameBean","./FishGameEnemy":"FishGameEnemy","./FishGameMagnet":"FishGameMagnet","./FishGamePlayer":"FishGamePlayer","./FishGameRectArea":"FishGameRectArea","./FishGameSingleton":"FishGameSingleton","./config_FishGame":"config_FishGame"}],FishGameModel:[function(t,e,i){"use strict";cc._RF.push(e,"e5ee2u1n8pG1axP2JIt90Un","FishGameModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGameModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/fishGame/fishGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.fishGame)],e)}(n.default);i.FishGameModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],FishGamePlayer:[function(t,e,i){"use strict";cc._RF.push(e,"43c54rlsDlDx45h81on9BJK","FishGamePlayer"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=t("./config_FishGame"),a=__importDefault(t("./FishGameBean")),s=__importDefault(t("./FishGameDynamicObjBase")),r=__importDefault(t("./FishGameMagnet")),c=t("./FishGameSingleton"),l=cc._decorator,h=l.ccclass,u=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.absorbEffect=null,e.bubbleEffect=null,e}return __extends(e,t),e.prototype.start=function(){this.onScoreChange(),this.absorbEffect.node.scale=n.FishGame.magnetRange/this.absorbEffect.node.width,this.monthPos=n.FishGame.playerMonthPos},e.prototype.logicUpdate=function(e){if(!this.isDie&&(t.prototype.logicUpdate.call(this,e),o.default.isZero(c.FG_S.Ins.joy.v)||this.isInAnim||this.moveOn(c.FG_S.Ins.joy.v,e),this.moveAt(this.center),n.FishGame.activeDebug))for(var i=c.FG_S.Ins.mgr.overlapBlockCrds(this),a=0;a<i.length;a++)c.FG_S.Ins.mgr.showBlock(i[a])},e.prototype.onScoreChange=function(){cc.isValid(c.FG_S.Ins.mgr)&&(c.FG_S.Ins.mgr.k=(this.score-n.FishGame.originScore)/n.FishGame.scoreGradient,this.isInScaleAnim||(t.prototype.onScoreChange.call(this),c.FG_S.Ins.mgr.scoreLabel.string=""+Math.max(0,n.FishGame.scoreTheWin-this.score),c.FG_S.Ins.mgr.scaleMapTo(c.FG_S.Ins.mgr.node.width/this.size*n.FishGame.ratio*(1+c.FG_S.Ins.mgr.k/1.5)),this.score>=n.FishGame.scoreTheWin&&c.FG_S.Ins.mgr.win()))},e.prototype.moveAt=function(e){t.prototype.moveAt.call(this,e),c.FG_S.Ins.mgr.onPlayerMovePos(e)},e.prototype.eat=function(e){var i=this,s=function(){i.bubbleEffect.enabled=!0,i.bubbleEffect.setCompleteListener(function(){return i.bubbleEffect.enabled=!1}),i.bubbleEffect.node.angle=o.default.getRad(i.dir)*o.default.Rad2Ang,i.bubbleEffect.setAnimation(0,"eat",!1)};e instanceof r.default?(this.isInAnim=!0,e.onEaten(),this.eatAnim(o.default.V2(e.node.position),function(){s(),i.skeleton.setAnimation(0,"citie2",!1);for(var t=i.getAreaInfo(i.center,n.FishGame.magnetRange),e=(t.targets,t.beans),o=e.length,a=0,r=0;r<e.length;r++)e[r].isDie||(a=Math.max(a,e[r].absorbTo(i)));i.absorbEffect.enabled=!0,i.absorbEffect.setAnimation(0,"animation",!0),c.FG_S.Ins.mgr.pause=!0,setTimeout(function(){i.score+=o,i.isInAnim=!1,c.FG_S.Ins.mgr.pause=!1,i.skeleton.setAnimation(0,"change",!1),i.skeleton.setCompleteListener(function(){i.skeleton.setCompleteListener(function(){}),i.skeleton.setAnimation(0,"idle",!0)}),i.absorbEffect.enabled=!1,i.isInScaleAnim=!0;var t=i.size/i.skeleton.node.width;i.scaleProgressParam.v=i.body.scale,cc.tween(i.scaleProgressParam).to(n.FishGame.fishScaleTime/2e3,{v:1.2*t},{easing:"sineOut"}).to(n.FishGame.fishScaleTime/2e3,{v:t},{easing:"sineOut"}).call(function(){i.isInScaleAnim=!1,i.onScoreChange()}).start()},1e3*a)})):e instanceof a.default?t.prototype.eat.call(this,e):t.prototype.eat.call(this,e,function(){s(),i.isDie||0!=c.FG_S.Ins.mgr.enemys.length||c.FG_S.Ins.mgr.win()})},e.prototype.onEaten=function(){this.isDie=!0,cc.tween(this.node).to(.5,{scale:.05}).call(function(){return c.FG_S.Ins.mgr.lose()}).start()},__decorate([u(sp.Skeleton)],e.prototype,"absorbEffect",void 0),__decorate([u(sp.Skeleton)],e.prototype,"bubbleEffect",void 0),__decorate([h],e)}(s.default);i.default=d,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt","./FishGameBean":"FishGameBean","./FishGameDynamicObjBase":"FishGameDynamicObjBase","./FishGameMagnet":"FishGameMagnet","./FishGameSingleton":"FishGameSingleton","./config_FishGame":"config_FishGame"}],FishGameRectArea:[function(t,e,i){"use strict";cc._RF.push(e,"344388akjtOiLg5q0o3xorg","FishGameRectArea"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGameBlockArea=void 0;var o=function(){function t(t,e){this.info={targets:[],beans:[]},this.size=e,this.zero=t}return t.prototype.overlapWithCircle=function(t,e){var i=t.sub(this.zero),o=t.sub(this.zero.add(this.size));return i.x>=0&&i.y>=0&&o.x<=0&&o.y<=0||i.x>=-e&&i.y>=-e||o.x<=e&&o.y<=e},t}();i.FishGameBlockArea=o,cc._RF.pop()},{}],FishGameSingleton:[function(t,e,i){"use strict";cc._RF.push(e,"8a05dp6nUhPGohTPo77A6Ge","FishGameSingleton"),Object.defineProperty(i,"__esModule",{value:!0}),i.FG_S=void 0;var o=t("../../miniGamePackage/utils/SingleClass"),n=t("./config_FishGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return e.getInst()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"player",{get:function(){return this.mgr.player},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"areas",{get:function(){return this.mgr.blockAreas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minMapPos",{get:function(){return this.mgr.mapPos},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxMapPos",{get:function(){return this.mgr.mapPos.add(n.FishGame.mapSize)},enumerable:!1,configurable:!0}),e}(o.SingleClass);i.FG_S=a,cc._RF.pop()},{"../../miniGamePackage/utils/SingleClass":"SingleClass","./config_FishGame":"config_FishGame"}],FishGrowCollider:[function(t,e,i){"use strict";cc._RF.push(e,"6b8bcvTdD9Ne6KHdCLfYY5Y","FishGrowCollider"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./FishGrowGame")),n=t("./FishGrowUtil"),a=__importDefault(t("./fish/FishCollider")),s=cc._decorator,r=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._playerManager=null,e._monsterManager=null,e}return __extends(e,t),e.prototype.start=function(){this._playerManager=o.default.instance.playerManager,this._monsterManager=o.default.instance.monsterManager},e.prototype._dealCollider=function(t,e){t.onCollisionEnter(e.getComponent(a.default),t.getComponent(a.default))},e.prototype.updateCollider=function(){var t=this,e=this._monsterManager.visibleFishes,i=this._playerManager.node,o=n.FishGrowConst.InitFishesSize;e.forEach(function(e){var a=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO);a=i.convertToNodeSpaceAR(a);var s=o[t._playerManager.mainLevel-1],r=o[e.fishType];if(!(cc.Vec2.distance(cc.Vec2.ZERO,a)>cc.Vec2.distance(cc.Vec2.ZERO,cc.v2(s[0]/2,s[1]/2))+cc.Vec2.distance(cc.Vec2.ZERO,cc.v2(r[0]/2,r[1]/2)))){for(var c=[],l=0,h=[cc.v2(-r[0]/2,-r[1]/2),cc.v2(-r[0]/2,r[1]/2),cc.v2(r[0]/2,r[1]/2),cc.v2(r[0]/2,-r[1]/2)];l<h.length;l++){var u=h[l];u=e.node.convertToWorldSpaceAR(u),u=i.convertToNodeSpaceAR(u),c.push(u)}c.push(c[0]);for(var d=cc.rect(-s[0]/2,-s[1]/2,s[0],s[1]),p=0;p<c.length-1;p++)if(cc.Rect,n.FishGrowUtils.lineRect(c[p],c[p+1],d)){t._dealCollider(t._playerManager,e);break}}})},__decorate([r],e)}(cc.Component));i.default=c,cc._RF.pop()},{"./FishGrowGame":"FishGrowGame","./FishGrowUtil":"FishGrowUtil","./fish/FishCollider":"FishCollider"}],FishGrowEnvs:[function(t,e,i){"use strict";cc._RF.push(e,"e1803VEw7xOj4uIwqWkRxIB","FishGrowEnvs"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.envPrefab=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.preInit=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(){return t=cc.instantiate(this.envPrefab),this.node.addChild(t),[2,!0]})})},e.prototype.start=function(){},__decorate([a(cc.Prefab)],e.prototype,"envPrefab",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],FishGrowGame:[function(t,e,i){"use strict";cc._RF.push(e,"fb93cf7hRNLrYZ3t/P9xAOw","FishGrowGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=__importDefault(t("./FishGrowCollider")),a=__importDefault(t("./FishGrowEnvs")),s=__importDefault(t("./FishGrowJoyStack")),r=__importDefault(t("./FishGrowMonster")),c=__importDefault(t("./FishGrowPlayer")),l=__importDefault(t("./FishGrowUI")),h=t("./FishGrowUtil"),u=__importDefault(t("./FollowTarget")),d=cc._decorator,p=d.ccclass,m=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.followManager=null,e.envsManager=null,e.joyStackManager=null,e.playerManager=null,e.monsterManager=null,e.fishUIManager=null,e.colliderManager=null,e._mapNode=null,e._isInit=!1,e._isGameOver=!1,e._invincibleTime=5,e._nowInvincible=0,e}var i;return __extends(e,t),i=e,Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInvincible",{get:function(){return this._nowInvincible>=0},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){var t=this;i._instance=this,this._mapNode=this.node.getChildByName("mapNode"),this.colliderManager=this.getComponent(n.default),this.initGame().then(function(){t.startGame()})},e.prototype.initGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.followManager.initPosition(h.FishGrowConst.InitPos),[4,this.envsManager.preInit()];case 1:return t.sent(),[4,this.playerManager.preInit()];case 2:return t.sent(),[4,this.monsterManager.preInit()];case 3:return t.sent(),this.review(),[2,!0]}})})},e.prototype.startGame=function(){this._isInit=!0},e.prototype.gameOver=function(t){if(!this._isGameOver){this._isGameOver=!0;var e=this.node.getChildByName("CameraMove").getComponent(cc.Camera),i=this.node.getChildByName("CameraUI").getComponent(cc.Camera);e.node.active=!1,i.node.active=!1;var n=cc.Canvas.instance.node.getContentSize(),a=this.playerManager.node.position;this._mapNode.setPosition(a.sub(cc.v3(n.width/2,n.height/2,0)).mul(-1)),t?o.default.instance.gotoResultWithLoading(t,this.node.parent):this.fishUIManager.showResult(!0)}},e.prototype.review=function(){this._isGameOver=!1,this._nowInvincible=this._invincibleTime;var t=this.node.getChildByName("CameraMove").getComponent(cc.Camera),e=this.node.getChildByName("CameraUI").getComponent(cc.Camera);t.node.active=!0,e.node.active=!0,this._mapNode.setPosition(0,0),this.fishUIManager.showResult(!1),this.playerManager.review()},e.prototype.start=function(){},e.prototype.update=function(t){this._isInit&&(this._isGameOver||(this._nowInvincible>=0&&(this._nowInvincible-=t),this.monsterManager.updateMonster(t),this.playerManager.updatePlayer(t),this.colliderManager.updateCollider(t)))},e.prototype.onEnable=function(){},e.prototype.onDisable=function(){},e.prototype.onDestroy=function(){},e._instance=null,__decorate([m(u.default)],e.prototype,"followManager",void 0),__decorate([m(a.default)],e.prototype,"envsManager",void 0),__decorate([m(s.default)],e.prototype,"joyStackManager",void 0),__decorate([m(c.default)],e.prototype,"playerManager",void 0),__decorate([m(r.default)],e.prototype,"monsterManager",void 0),__decorate([m(l.default)],e.prototype,"fishUIManager",void 0),i=__decorate([p],e)}(cc.Component);i.default=f,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./FishGrowCollider":"FishGrowCollider","./FishGrowEnvs":"FishGrowEnvs","./FishGrowJoyStack":"FishGrowJoyStack","./FishGrowMonster":"FishGrowMonster","./FishGrowPlayer":"FishGrowPlayer","./FishGrowUI":"FishGrowUI","./FishGrowUtil":"FishGrowUtil","./FollowTarget":"FollowTarget"}],FishGrowJoyStack:[function(t,e,i){"use strict";cc._RF.push(e,"cb160wGAlhIv7E8Tbbg0QAO","FishGrowJoyStack"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=(o.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._beganPos=cc.v2(0,0),e._dir=cc.v2(0,0),e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},e.prototype.start=function(){},e.prototype._onTouchStart=function(t){this._beganPos=t.getLocation()},e.prototype._onTouchMove=function(t){var e=t.getLocation();this._dir=e.sub(this._beganPos).normalizeSelf()},e.prototype._onTouchEnd=function(){this._dir.x=0,this._dir.y=0},e.prototype._onTouchCancel=function(t){this._onTouchEnd(t)},Object.defineProperty(e.prototype,"playerDir",{get:function(){return this._dir},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerAngel",{get:function(){return this._dir.equals(cc.Vec2.ZERO)?0:180*cc.Vec2.RIGHT.signAngle(this._dir)/Math.PI},enumerable:!1,configurable:!0}),__decorate([n],e)}(cc.Component));i.default=a,cc._RF.pop()},{}],FishGrowModel:[function(t,e,i){"use strict";cc._RF.push(e,"2bdf36wIQZDQrdky7UPLyGc","FishGrowModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGrowModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,Promise,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/fishGrow/fishGrow",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.fishGrow)],e)}(n.default);i.FishGrowModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],FishGrowMonster:[function(t,e,i){"use strict";cc._RF.push(e,"b7742ejB0JJJYDpKLyPFOkl","FishGrowMonster"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./FishGrowUtil"),n=t("./fish/EnemyFish"),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fishPrefabs=[],e.fishPools=[],e.fishesObj=new Set,e.visibleFishes=new Set,e._initIdx=0,e._initStap=20,e._initTotal=0,e._loadMonsterDone=!1,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.preInit=function(){for(var t=this,e=o.FishGrowConst.InitFishes,i=0;i<e.length;i++)this.fishPools.push(new cc.NodePool),this._initTotal+=e[i];return new Promise(function(e){t._initResolve=e})},e.prototype._initMonster=function(){for(var t,e=this._initIdx,i=this._initIdx+this._initStap,o=e;o<i&&o<this._initTotal;o++)this._initMonsterItem(o),this._initIdx++,o==this._initTotal-1&&(this._loadMonsterDone=!0,null===(t=this._initResolve)||void 0===t||t.call(this,!0))},e.prototype._initMonsterItem=function(t){for(var e=0,i=o.FishGrowConst.InitFishes,a=0,s=0;s<i.length;s++)if(t<(a+=i[s])){e=s;break}for(var r=cc.instantiate(this.fishPrefabs[e]),c=r.getComponent(n.EnemyFish),l=o.FishGrowConst.MapBorder,h=cc.v2(l.x*Math.random(),l.y*Math.random()),u=o.FishGrowConst.InitPos,d=o.FishGrowConst.InitExclSize;h.x>=u.x-d.width/2&&h.x<=u.x+d.width/2&&h.y>=u.y-d.height/2&&h.y<=u.y+d.height/2;)h=cc.v2(l.x*Math.random(),l.y*Math.random());c.setStartPosition(h),this.fishesObj.add(c),this.visibleFishes.add(c),this.node.addChild(r),c.changeState(o.FishState.Move)},e.prototype.update=function(){this._loadMonsterDone||this._initMonster()},e.prototype.updateMonster=function(t){this.fishesObj.forEach(function(e){e.updateFish(t)})},e.prototype.destroyMonster=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return(e=t.getComponent(n.EnemyFish))?(this.fishesObj.delete(e),[4,e.destroyFish()]):[2];case 1:return i.sent(),this.fishPools[e.fishType].put(e.node),[2]}})})},e.prototype.checkEmpty=function(){return this.fishesObj.size<=0},e.prototype.onDestroy=function(){for(var t=0;t<this.fishPools.length;t++)this.fishPools[t].clear();this.fishPools.length=0},__decorate([r([cc.Prefab])],e.prototype,"fishPrefabs",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"./FishGrowUtil":"FishGrowUtil","./fish/EnemyFish":"EnemyFish"}],FishGrowPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"e11ff+Xa2lOhZadowKhsLGc","FishGrowPlayer"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./FishGrowGame")),n=t("./FishGrowUtil"),a=t("./fish/EnemyFish"),s=__importDefault(t("./fish/FishCollider")),r=t("./fish/PlayerFish"),c=cc._decorator,l=c.ccclass,h=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fishPrefab=null,e.fishesNode=null,e._fishesPool=new cc.NodePool,e._joyStack=null,e.totalLevel=0,e.mainLevel=0,e.fishes=new Map,e._rotateTime=5,e._fishUIManager=null,e}return __extends(e,t),e.prototype.preInit=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return this._addFish(1),[2]})})},e.prototype.review=function(){cc.tween(this.node).blink(5,15).start()},e.prototype.onLoad=function(){},e.prototype.start=function(){this._joyStack=o.default.instance.joyStackManager,this._fishUIManager=o.default.instance.fishUIManager,this._fishUIManager.updateScore(this.totalLevel)},e.prototype.updatePlayer=function(t){var e=this._joyStack.playerDir;if(!e.equals(cc.Vec2.ZERO)){var i=e.mul(n.FishGrowConst.PlayerSpeed*t).add(cc.v2(this.node.position.x,this.node.position.y));this._checkBorder(i),this.node.setPosition(i);var o=this.node.angle%360,a=this._joyStack.playerAngel;o<0&&(o+=360),a<0&&(a+=360),a-o<-180&&(a+=360),a-o>180&&(a-=360),this.node.angle=cc.misc.lerp(o,a,this._rotateTime*t)}},e.prototype._checkBorder=function(t){t.x=Math.max(0,Math.min(n.FishGrowConst.MapBorder.x,t.x)),t.y=Math.max(0,Math.min(n.FishGrowConst.MapBorder.y,t.y))},e.prototype._getFishFromPool=function(){return this._fishesPool.size()<=0?cc.instantiate(this.fishPrefab):this._fishesPool.get()},e.prototype._putFishFromPool=function(t){this._fishesPool.put(t)},e.prototype.eatFish=function(t){var e=t.getComponent(a.EnemyFish);return!(e.fishLevel>this.mainLevel||(this._addFish(e.fishType),0))},e.prototype._addFish=function(t){var e;if(this.fishes.has(t)?this.fishes.set(t,this.fishes.get(t)+1):this.fishes.set(t,1),this.fishes.get(t)>=3)for(var i=t;i>=0&&this.fishes.get(i)>=3&&9!=i;){this.fishes.set(i,0);var o=i+1;this.fishes.has(o)?this.fishes.set(o,this.fishes.get(o)+1):this.fishes.set(o,1),i=o}this.totalLevel+=t+1;for(var n=this.fishesNode.children,a=n.length-1;a>=0;a--)this._putFishFromPool(n[a]);this._resortFish(),this._changeCollider(),null===(e=this._fishUIManager)||void 0===e||e.updateScore(this.totalLevel)},e.prototype._resortFish=function(){var t=[];this.fishes.forEach(function(e,i){e>0&&t.push(i)}),t.sort(function(t,e){return e-t}),this.mainLevel=t[0]+1;for(var e=n.FishGrowConst.InitFishesSize,i=0,o=0;o<t.length;o++){var a=t[o],s=this.fishes.get(a),c=e[a],l=1/3;c[0]<50&&(l=.5),o<t.length-1&&e[t[o+1]][0]<50&&(l=.5);for(var h=-(c[1]*s+1*(s-1))/2,u=0;u<s;u++){var d=this._getFishFromPool();this.fishesNode.addChild(d),d.getComponent(r.PlayerFish).initFish(a);var p=h+c[1]/2,m=0==o?0:i-1-c[0]*l;d.setPosition(cc.v2(m,p)),u==s-1&&(i=m-c[0]*l),h=p+c[1]/2+1}}},e.prototype._changeCollider=function(){var t=this.mainLevel-1,e=n.FishGrowConst.InitFishesSize[t];this.getComponent(s.default).size=cc.size(e[0],e[1])},e.prototype.onCollisionEnter=function(t){this.eatFish(t)?(o.default.instance.monsterManager.destroyMonster(t),o.default.instance.monsterManager.checkEmpty()&&o.default.instance.gameOver(!0)):o.default.instance.isInvincible||o.default.instance.gameOver(!1)},__decorate([h(cc.Prefab)],e.prototype,"fishPrefab",void 0),__decorate([h(cc.Node)],e.prototype,"fishesNode",void 0),__decorate([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"./FishGrowGame":"FishGrowGame","./FishGrowUtil":"FishGrowUtil","./fish/EnemyFish":"EnemyFish","./fish/FishCollider":"FishCollider","./fish/PlayerFish":"PlayerFish"}],FishGrowUI:[function(t,e,i){"use strict";cc._RF.push(e,"1ab720aXiBCWYHeTxEvJU9f","FishGrowUI"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("./FishGrowGame")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblScore=null,e.result=null,e.lblResScore=null,e.shareNode=null,e.tipNode=null,e._shareNum=0,e}return __extends(e,t),e.prototype.onEnable=function(){this.showResult(!1)},e.prototype.start=function(){},e.prototype.updateScore=function(t){this.lblScore.string=""+t},e.prototype.onClickBack=function(){o.default.instance.getModel().gameExit()},e.prototype.onClickResBack=function(){var t=o.default.instance.getModel();t&&t.gameExit()},e.prototype.onClickShare=function(){var t=this;this._shareNum>0?this.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareNode,{miniGame:n.SubPackageKey.fishGrow}).then(function(e){e?(t._shareNum<1&&(t.showTip("\u5206\u4eab\u6210\u529f"),a.default.instance.review()),t._shareNum++):t.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.showTip=function(t){var e=new cc.Node,i=e.addComponent(cc.Label);e.zIndex=1,i.string=t,i.fontSize=44,e.parent=this.tipNode,e.setPosition(0,0),e.color=new cc.Color(233,241,243),e.opacity=255,cc.tween(e).by(1,{y:50}).by(.5,{y:50,opacity:-255}).call(function(){e.destroy()}).start()},e.prototype.showResult=function(t){this.result.active=t,t&&(this.lblResScore.string=this.lblScore.string)},__decorate([c(cc.Label)],e.prototype,"lblScore",void 0),__decorate([c(cc.Node)],e.prototype,"result",void 0),__decorate([c(cc.Label)],e.prototype,"lblResScore",void 0),__decorate([c(cc.Node)],e.prototype,"shareNode",void 0),__decorate([c(cc.Node)],e.prototype,"tipNode",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","./FishGrowGame":"FishGrowGame"}],FishGrowUtil:[function(t,e,i){"use strict";cc._RF.push(e,"fec30X950ZJW51oHzynYRnC","FishGrowUtil"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGrowUtils=i.FishState=i.FishGrowConst=void 0;var o=function(){function t(){}return t.PlayerSpeed=160,t.MonsterSpeed=80,t.MapBorder=cc.v2(3900,1900),t.InitPos=t.MapBorder.mul(.5),t.InitFishes=[30,20,10,10,10,5,5,5,5,5],t.InitExclSize=cc.size(600,700),t.InitFishesSize=[[33,24],[45,21],[58,32],[71,41],[80,80],[101,63],[107,96],[143,120],[220,92],[212,116]],t.TrackLevel=6,t.DEBUG=!1,t}();i.FishGrowConst=o,function(t){t[t.Idle=0]="Idle",t[t.Move=1]="Move",t[t.Track=2]="Track",t[t.Pause=3]="Pause",t[t.Resume=4]="Resume",t[t.Destroy=5]="Destroy"}(i.FishState||(i.FishState={}));var n=function(){function t(){}return t.lineLine=function(t,e,i,o){var n=(o.x-i.x)*(t.y-i.y)-(o.y-i.y)*(t.x-i.x),a=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),s=(o.y-i.y)*(e.x-t.x)-(o.x-i.x)*(e.y-t.y);if(0!==s){var r=n/s,c=a/s;if(0<=r&&r<=1&&0<=c&&c<=1)return!0}return!1},t.lineRect=function(e,i,o){var n=new cc.Vec2(o.x,o.y),a=new cc.Vec2(o.x,o.yMax),s=new cc.Vec2(o.xMax,o.yMax),r=new cc.Vec2(o.xMax,o.y);return!!(t.lineLine(e,i,n,a)||t.lineLine(e,i,a,s)||t.lineLine(e,i,s,r)||t.lineLine(e,i,r,n))},t}();i.FishGrowUtils=n,cc._RF.pop()},{}],FollowTarget:[function(t,e,i){"use strict";cc._RF.push(e,"1508ctw4FxMXKBCqtc3aSQL","FollowTarget"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.target=null,e._dir=cc.Vec3.ZERO,e._moveTime=5,e}return __extends(e,t),e.prototype.initPosition=function(t){this.node.setPosition(t),this.target.setPosition(t)},e.prototype.start=function(){this._dir=this.target.position.sub(this.node.position)},e.prototype.lateUpdate=function(t){var e=this.target.position.sub(this._dir),i=cc.v3();cc.Vec3.lerp(i,this.node.position,e,this._moveTime*t),this.node.setPosition(i)},__decorate([a(cc.Node)],e.prototype,"target",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],Friend:[function(t,e,i){"use strict";cc._RF.push(e,"175e32nCwpO741zNs9p8puS","Friend"),Object.defineProperty(i,"__esModule",{value:!0}),i.BladeFlyFriend=void 0;var o=t("../../../miniGamePackage/utils/Line"),n=function(t){function e(e,i){var n=this,a=[o.Line.Vec2Line(cc.v2(1,0),cc.v2(e.x-i.x/2,e.y+i.y/2),i.x),o.Line.Vec2Line(cc.v2(0,-1),cc.v2(e.x+i.x/2,e.y+i.y/2),i.y),o.Line.Vec2Line(cc.v2(-1,0),cc.v2(e.x+i.x/2,e.y-i.y/2),i.x),o.Line.Vec2Line(cc.v2(0,1),cc.v2(e.x-i.x/2,e.y-i.y/2),i.y)];return(n=t.call(this,a)||this).center=e,n.size=i,n}return __extends(e,t),e.prototype.collisionRet=function(t){var e={},i=t.point.add(t.dir.mul(this.ACCURACY)),n=o.Line.Vec2Line(t.dir,i,t.dist),a=Number.MAX_VALUE;return this.edge.forEach(function(t){var o=t.intersect(n);if(o){var s=cc.Vec2.distance(o,i);s<a&&(e.friendDie=!0,e.point=o,a=s)}}),e},e}(t("./ColliderObjBase").BladeFlyColliderObjBase);i.BladeFlyFriend=n,cc._RF.pop()},{"../../../miniGamePackage/utils/Line":"Line","./ColliderObjBase":"ColliderObjBase"}],Idle:[function(t,e,i){"use strict";cc._RF.push(e,"1e3dfTvh6FLIJoSFt5j7Jih","Idle"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGameState_Idle=void 0;var o=t("../config_FishGame"),n=t("../FishGameSingleton"),a=t("./StateBase"),s=function(t){function e(e){var i=t.call(this,e)||this;return i.nextPatrolTime=0,i}return __extends(e,t),e.prototype.onEnterState=function(){this.nextPatrolTime=Date.now()+Math.random()*o.FishGame.idleTime},e.prototype.onUpdateState=function(){if(Date.now()>this.nextPatrolTime){var t=n.FG_S.Ins.mgr.randomMapPos();this.owner.onSwitch(a.FishGameState.patrol,{destination:t})}else this.testEscape()||this.testCatch()},e}(a.FishGameStateBase);i.FishGameState_Idle=s,cc._RF.pop()},{"../FishGameSingleton":"FishGameSingleton","../config_FishGame":"config_FishGame","./StateBase":"StateBase"}],IslandGameLogic:[function(t,e,i){"use strict";cc._RF.push(e,"3c74b+DyIRIraQtiWp6fRsi","IslandGameLogic"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=t("../../miniGamePackage/texturePlus/PolygonUtil"),s=__importDefault(t("../../miniGamePackage/texturePlus/TexturePlus")),r=__importDefault(t("./IslandHeroItem")),c=cc._decorator,l=c.ccclass,h=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.graphics=null,e.texture=null,e.textures=[],e.hero1Textures=[],e.heroNodes=[],e.scissors=null,e.leftCountLabel=null,e._startPoint=null,e._endPoint=null,e._tween=null,e._isGameOver=!1,e._cutCount=2,e._leftCount=2,e._isCanCut=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"isCanCut",{get:function(){return this._isCanCut&&this._leftCount>0},set:function(t){this._isCanCut=t},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this);for(var t=0;t<this.heroNodes.length;t++)this.heroNodes[t].node.parent.zIndex=100+t;this.graphics.node.zIndex=200},e.prototype._onTouchStart=function(t){for(var e=t.getLocation(),i=0;i<this.heroNodes.length;i++)if(this.heroNodes[i].node.getBoundingBox().contains(e))return;this.isCanCut=!0,this._startPoint=this.node.convertToNodeSpaceAR(e),this.graphics.moveTo(this._startPoint.x,this._startPoint.y)},e.prototype._onTouchMove=function(t){if(0!=this.isCanCut){var e=t.getLocation();this.graphics.clear();var i=this.node.convertToNodeSpaceAR(e);this.graphics.moveTo(this._startPoint.x,this._startPoint.y),this.graphics.lineTo(i.x,i.y),this.graphics.stroke(),this._isInPolygon(e)}},e.prototype._isInPolygon=function(t){for(var e=!1,i=0;i<this.heroNodes.length;i++){var o=this.heroNodes[i],n=this.node.convertToWorldSpaceAR(this._startPoint);this._getPolygon(o.texturePlus,n,t).length>1?(o.setColor(cc.Color.RED),e=!0):o.setColor(cc.Color.WHITE)}return e},e.prototype.onLoad=function(){this._refreshLeftCount()},e.prototype._refreshLeftCount=function(){this.leftCountLabel.string=this._leftCount+""},e.prototype._onTouchEnd=function(t){if(0!=this.isCanCut){var e=t.getLocation();this.graphics.clear(),this._endPoint=this.node.convertToNodeSpaceAR(e),this._isInPolygon(e)?this._clearColor():(this.useLineCutPolygon(this._startPoint,this._endPoint)&&this._leftCount--,this.isCanCut=!1,this._refreshLeftCount())}},e.prototype._clearColor=function(){for(var t=0;t<this.heroNodes.length;t++)this.heroNodes[t].setColor(cc.Color.WHITE)},e.prototype.update=function(){if(!(this._isGameOver||this._leftCount>0)){this._isGameOver=!0;for(var t=!0,e=function(e){for(var o=i.textures[e],n=[],s=0;s<i.heroNodes.length;s++){var r=i.heroNodes[s],c=r.node.parent.convertToWorldSpaceAR(cc.v2(0,0)),l=o.node.convertToNodeSpaceAR(c);0===a.PolygonUtil.relationPointToPolygon(l,o.polygon)&&n.push(r)}if(n.length>=2){t=!1;var h=n[0].node.parent.getPosition(),u=n[1].node.parent.getPosition(),d=h.add(u).div(2);n[0].node.parent.zIndex=200,cc.tween(n[0].node.parent).parallel(cc.tween().to(.7,{y:d.y,x:d.x}),cc.tween().call(function(){n[0].playAttackAnim()})).delay(.8).call(function(){n[0].playIdleAnim()}).start(),cc.tween(n[1].node.parent).parallel(cc.tween().to(.7,{y:d.y,x:d.x}),cc.tween().call(function(){n[1].playAttackAnim()})).call(function(){n[1].playDieAnim()}).start();for(var p=0;p<n.length;p++){var m=n[p];m.node.parent.x>d.x&&(m.node.parent.scaleX=-1)}for(var f=function(t){var e=n[t],i=100*Math.random()-50;cc.tween(e.node.parent).parallel(cc.tween().to(.7+.1*t,{y:d.y+i,x:d.x+i}),cc.tween().call(function(){e.playAttackAnim()})).call(function(){e.playDieAnim()}).start()},g=2;g<n.length;g++)f(g)}},i=this,s=0;s<this.textures.length;s++)e(s);this._tween=cc.tween(this.node).delay(1).call(function(){var e=n.default.instance.miniGameAdapter.eventMgr;t?e.emit(o.MiniGameEvent.EventLevelComplete):e.emit(o.MiniGameEvent.EventGameFail)}).start()}},e.prototype.splitTexture=function(t,e,i,o){var n=e[0];t.polygon=n;var a=t.node.getPosition(),r=this._isLeft(this._startPoint,this._endPoint,n,a),c=this._endPoint.sub(this._startPoint);c.y<0&&(c=cc.v2(-c.x,Math.abs(c.y)));var l=c.rotate(Math.PI/180*90).normalize(),h=c.rotate(Math.PI/180*-90).normalize(),u=r?l:h,d=r?h:l;t.node.setPosition(a.add(u.mul(20))),this._updateHeroPos(t,20,u);for(var p=1;p<e.length;p++){var m=cc.instantiate(t.node),f=m.getComponent(s.default);m.parent=this.node,m.zIndex=1,f.texture=i,f.polygon=e[p],m.setPosition(a.add(d.mul(20))),this._updateHeroPos(f,20,d),o.push(f)}},e.prototype._updateHeroPos=function(t,e,i){for(var o=0;o<this.heroNodes.length;o++){var n=this.heroNodes[o],s=n.node.parent.convertToWorldSpaceAR(cc.v2(0,0)),r=t.node.convertToNodeSpaceAR(s);0==a.PolygonUtil.relationPointToPolygon(r,t.polygon)&&n.node.parent.setPosition(n.node.parent.getPosition().add(i.mul(e)))}},e.prototype._isLeft=function(t,e,i,o){for(var n=(e.y-t.y)/(e.x-t.x),a=t.y-n*t.x,s=0;s<i.length;s++){var r=i[s],c=cc.v2(r.x+o.x,r.y+o.y);if(Math.floor(c.y)>Math.floor(n*c.x+a))return n>0;if(Math.floor(c.y)<Math.floor(n*c.x+a))return n<0}return!1},e.prototype.useLineCutPolygon=function(t,e){for(var i=this.node.convertToWorldSpaceAR(t),o=this.node.convertToWorldSpaceAR(e),n=!1,a=this.textures.length-1;a>=0;a--){var s=this.textures[a],r=this._getPolygon(s,i,o);r.length<=0||(r.length>1&&(n=!0),this.splitTexture(s,r,this.texture,this.textures))}return n},e.prototype._getPolygon=function(t,e,i){var o=e.clone(),n=i.clone();return o=t.node.convertToNodeSpaceAR(e),n=t.node.convertToNodeSpaceAR(i),a.PolygonUtil.lineCutPolygon(o,n,t.polygon)},e.prototype._unRegisterEvent=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this)},e.prototype.onDisable=function(){this._unRegisterEvent(),this._tween&&this._tween.stop()},__decorate([h(cc.Graphics)],e.prototype,"graphics",void 0),__decorate([h(cc.Texture2D)],e.prototype,"texture",void 0),__decorate([h([s.default])],e.prototype,"textures",void 0),__decorate([h([s.default])],e.prototype,"hero1Textures",void 0),__decorate([h([r.default])],e.prototype,"heroNodes",void 0),__decorate([h(sp.Skeleton)],e.prototype,"scissors",void 0),__decorate([h(cc.Label)],e.prototype,"leftCountLabel",void 0),__decorate([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../../../../game/scripts/mini-adapter/types-miniPre":void 0,"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/texturePlus/PolygonUtil":"PolygonUtil","../../miniGamePackage/texturePlus/TexturePlus":"TexturePlus","./IslandHeroItem":"IslandHeroItem"}],IslandHeroItem:[function(t,e,i){"use strict";cc._RF.push(e,"d2556akQCtKyqdl4aJjzjcS","IslandHeroItem"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/texturePlus/TexturePlus")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroNode=null,e.texturePlus=null,e.skeleton=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.playIdleAnim()},e.prototype.setColor=function(t){this.heroNode.color=t},e.prototype.playAttackAnim=function(){this.skeleton.setAnimation(0,"attack",!1)},e.prototype.playDieAnim=function(){this.skeleton.setAnimation(0,"die",!1)},e.prototype.playIdleAnim=function(){this.skeleton.setAnimation(0,"idle",!0)},__decorate([s(cc.Node)],e.prototype,"heroNode",void 0),__decorate([s(o.default)],e.prototype,"texturePlus",void 0),__decorate([s(sp.Skeleton)],e.prototype,"skeleton",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"../../miniGamePackage/texturePlus/TexturePlus":"TexturePlus"}],IslandModel:[function(t,e,i){"use strict";cc._RF.push(e,"644afPsDNVHvYhhnSqSE0R9","IslandModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.IslandModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/islandGame/islandGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.islandGame)],e)}(n.default);i.IslandModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],JigsawItem:[function(t,e,i){"use strict";cc._RF.push(e,"444bfNX63xKrbxKksxNKCUr","JigsawItem"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isDrag=!1,e.targetNode=null,e.curSprite=null,e._isCollision=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"isCollision",{get:function(){return this._isCollision},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.curSprite.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.curSprite.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.curSprite.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.curSprite.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this),this.init()},e.prototype.init=function(){var t=this.curSprite.spriteFrame;this.curSprite.node.setContentSize(t.getOriginalSize())},e.prototype._onTouchStart=function(){this._isDrag=!0},e.prototype._onTouchMove=function(t){if(this._isDrag){var e=t.getLocation(),i=this.curSprite.node.parent.convertToNodeSpaceAR(e);this.curSprite.node.setPosition(i)}},e.prototype._onTouchEnd=function(){this._isDrag=!1,this._checkIsInTarget(),n.default.instance.miniGameAdapter.eventMgr.emit(o.MiniGameEvent.EventTouchEnd)},e.prototype._checkIsInTarget=function(){this._isInTarget()&&(this._isCollision=!0,this.curSprite.node.setPosition(this.targetNode.getPosition()),this.unRegisterEvent())},e.prototype._isInTarget=function(){var t=this.curSprite.node.getPosition(),e=this.targetNode.getBoundingBox();return this._isInRect(e,t)},e.prototype._isInRect=function(t,e){return t.contains(e)},e.prototype.unRegisterEvent=function(){this.curSprite.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.curSprite.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.curSprite.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.curSprite.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this)},e.prototype.onDisable=function(){this.unRegisterEvent()},__decorate([r(cc.Node)],e.prototype,"targetNode",void 0),__decorate([r(cc.Sprite)],e.prototype,"curSprite",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../../../game/scripts/mini-adapter/types-miniPre":void 0,"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],JigsawLogic:[function(t,e,i){"use strict";cc._RF.push(e,"b8d13zZXURJBZujXZkY4qGW","JigsawLogic"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=__importDefault(t("./JigsawItem")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.allItem=[],e.progress=null,e.countdownLabel=null,e.openBoxPrefab=null,e._curProgress=0,e._countdown=0,e._totalTime=60,e._isGameOver=!1,e._tween=null,e}return __extends(e,t),e.prototype._checkAllItemIsCollision=function(){for(var t=0;t<this.allItem.length;t++)if(!this.allItem[t].isCollision)return!1;return!0},e.prototype.onLoad=function(){n.default.instance.miniGameAdapter.eventMgr.on(o.MiniGameEvent.EventTouchEnd,this._onTouchEnd,this)},e.prototype._onTouchEnd=function(){this._gameOver()},e.prototype._gameOver=function(){var t=this;this._checkAllItemIsCollision()&&(this._isGameOver=!0,n.default.instance.miniGameAdapter.eventMgr.off(o.MiniGameEvent.EventTouchEnd,this._onTouchEnd,this),this._tween=cc.tween(this.node).delay(1).call(function(){var e=cc.instantiate(t.openBoxPrefab);e.parent=t.node,e.zIndex=1e4}).start())},e.prototype.update=function(t){if(!this._isGameOver){this._countdown+=t;var e=Math.max(0,this._totalTime-this._countdown);if(this._curProgress=e/this._totalTime,this.progress.progress=this._curProgress,this.countdownLabel.string=Math.ceil(e)+"s",this._countdown>this._totalTime+2){this._gameFail();for(var i=0;i<this.allItem.length;i++)this.allItem[i].unRegisterEvent()}}},e.prototype._gameFail=function(){this._isGameOver=!0;var t=n.default.instance.miniGameAdapter.eventMgr;t.off(o.MiniGameEvent.EventTouchEnd,this._onTouchEnd,this),t.emit(o.MiniGameEvent.EventGameFail)},e.prototype.onDisable=function(){this._tween&&this._tween.stop(),n.default.instance.miniGameAdapter.eventMgr.off(o.MiniGameEvent.EventTouchEnd,this._onTouchEnd,this)},__decorate([c([a.default])],e.prototype,"allItem",void 0),__decorate([c(cc.ProgressBar)],e.prototype,"progress",void 0),__decorate([c(cc.Label)],e.prototype,"countdownLabel",void 0),__decorate([c(cc.Prefab)],e.prototype,"openBoxPrefab",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../../../game/scripts/mini-adapter/types-miniPre":void 0,"../../miniGamePackage/SubPackageManager":"SubPackageManager","./JigsawItem":"JigsawItem"}],JigsawModel:[function(t,e,i){"use strict";cc._RF.push(e,"1a042eTiM5HDLzG4eKOI7L3","JigsawModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.JigsawModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/jigsawGame/jigsawGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.jigsawGame)],e)}(n.default);i.JigsawModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],JigsawOpenBox:[function(t,e,i){"use strict";cc._RF.push(e,"8a5e6NW1ftJppabDVtg4yBl","JigsawOpenBox"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skeletonData=[],e.skeleton=null,e.skeletonName=[],e.skeletonWork=[],e.skeletonClub=[],e.workLabel=null,e.nameLabel=null,e.clubNode=[],e._model=null,e}return __extends(e,t),e.prototype.onLoad=function(){this._model=n.default.instance.getModel();var t=this._model.mapIndex;this.workLabel.string=this.skeletonWork[t],this.nameLabel.string=this.skeletonName[t],this.skeleton.skeletonData=this.skeletonData[t],this.clubNode[this.skeletonClub[t]].active=!0},e.prototype.openOpenBox=function(){n.default.instance.miniGameAdapter.eventMgr.emit(o.MiniGameEvent.EventLevelComplete),this._model.mapIndex++},e.prototype.playAnim=function(){this.skeleton.setAnimation(0,"idle",!0)},__decorate([r([sp.SkeletonData])],e.prototype,"skeletonData",void 0),__decorate([r(sp.Skeleton)],e.prototype,"skeleton",void 0),__decorate([r({type:[cc.String]})],e.prototype,"skeletonName",void 0),__decorate([r({type:[cc.String]})],e.prototype,"skeletonWork",void 0),__decorate([r({type:[cc.Integer]})],e.prototype,"skeletonClub",void 0),__decorate([r(cc.Label)],e.prototype,"workLabel",void 0),__decorate([r(cc.Label)],e.prototype,"nameLabel",void 0),__decorate([r([cc.Node])],e.prototype,"clubNode",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../../../game/scripts/mini-adapter/types-miniPre":void 0,"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],JoyStick:[function(t,e,i){"use strict";cc._RF.push(e,"d4040xiZytMvbl9YlpDLiKT","JoyStick"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./FishGameSingleton"),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.outRadius=100,e.inRadius=20,e.graphic=null,e.delayFadeTime=600,e.fadeTime=600,e.center=cc.Vec2.ZERO,e.pos=cc.Vec2.ZERO,e.lastTime=0,e.isTouching=!1,e}return __extends(e,t),e.prototype.onLoad=function(){o.FG_S.Ins.joy=this},Object.defineProperty(e.prototype,"v",{get:function(){return this.isTouching?this.pos.sub(this.center).div(this.outRadius):cc.Vec2.ZERO},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.down,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.move,this),this.node.on(cc.Node.EventType.TOUCH_END,this.up,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.up,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.down,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.move,this),this.node.off(cc.Node.EventType.TOUCH_END,this.up,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.up,this)},e.prototype.down=function(t){this.isTouching=!0,this.pos=this.center=this.graphic.node.convertToNodeSpaceAR(t.getLocation())},e.prototype.move=function(t){var e=this.graphic.node.convertToNodeSpaceAR(t.getLocation()),i=cc.Vec2.distance(e,this.center);this.pos=e.sub(this.center).normalize().multiplyScalar(i>this.outRadius?this.outRadius:i).addSelf(this.center)},e.prototype.up=function(){this.lastTime=Date.now(),this.isTouching=!1,this.pos=this.center},e.prototype.refresh=function(t){this.graphic.clear(),this.graphic.circle(this.center.x,this.center.y,this.outRadius),this.graphic.lineWidth=10,this.graphic.strokeColor=cc.color(255,255,255,255*t),this.graphic.stroke(),this.graphic.fillColor=cc.color(255,255,255,50*t),this.graphic.fill(),this.graphic.circle(this.pos.x,this.pos.y,this.inRadius),this.graphic.fillColor=cc.color(255,255,255,255*t),this.graphic.fill()},e.prototype.update=function(){if(this.isTouching||Date.now()-this.lastTime<this.delayFadeTime)this.refresh(1);else if(Date.now()-this.lastTime-this.delayFadeTime<this.fadeTime){var t=Date.now()-this.lastTime-this.delayFadeTime;this.refresh(1-t/this.fadeTime)}else this.graphic.clear()},__decorate([s],e.prototype,"outRadius",void 0),__decorate([s],e.prototype,"inRadius",void 0),__decorate([s(cc.Graphics)],e.prototype,"graphic",void 0),__decorate([s],e.prototype,"delayFadeTime",void 0),__decorate([s],e.prototype,"fadeTime",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./FishGameSingleton":"FishGameSingleton"}],LCDNumber:[function(t,e,i){"use strict";cc._RF.push(e,"0b7806EHOxMxI7AZHN+PDHA","LCDNumber"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.graphics=null,e.label=null,e.size=110,e.offsetX=.3,e.offsetY=-.5,e.number=0,e.segmentDefs=[new cc.Rect(.5,.95,.315,.09),new cc.Rect(.5,.5,.315,.09),new cc.Rect(.5,.05,.315,.09),new cc.Rect(.275,.725,.09,.315),new cc.Rect(.275,.275,.09,.315),new cc.Rect(.725,.725,.09,.315),new cc.Rect(.725,.275,.09,.315)],e.segments=[[0,2,3,4,5,6],[5,6],[0,1,2,4,5],[0,1,2,5,6],[1,3,5,6],[0,1,2,3,6],[0,1,2,3,4,6],[0,5,6],[0,1,2,3,4,5,6],[0,1,2,3,5,6]],e.isSayGood=!1,e}return __extends(e,t),e.prototype.start=function(){this.graphics=this.node.addComponent(cc.Graphics),this.size=this.node.height,this.label&&(this.label.string=""),this.drawLCDNumber(0)},e.prototype.drawLCDNumber=function(t){var e=this;if(this.graphics){this.graphics.clear();var i=function(t,i){e.drawLCDNumber2(8,cc.color(128,0,0,96),.8*i),e.drawLCDNumber2(t,cc.color(255,0,0,255),.8*i)};if(t>999&&t<1e4)if(this.isSayGood){this.label&&(this.label.string=""),this.offsetX=.8;for(var o=0;o<4;o++)i((t=Math.floor(t))%10,o),t/=10}else this.label&&(this.label.string="\u5389 \u5bb3"),this.isSayGood=!0;else if(t>=1e4)this.label&&(this.label.string="    \u771f \u5389 \u5bb3 \uff01\uff01");else for(this.label&&(this.label.string=""),this.isSayGood=!1,this.offsetX=.3,o=0;o<3;o++)i((t=Math.floor(t))%10,o),t/=10}},e.prototype.drawLCDNumber2=function(t,e,i){var o=this;if(this.graphics){this.graphics.fillColor=e;for(var n=this.segments[t].map(function(t){return o.segmentDefs[t]}),a=0;a<n.length;a++){var s=new cc.Rect((n[a].x-i-n[a].width/2+this.offsetX)*this.size,(n[a].y-n[a].height/2+this.offsetY)*this.size,n[a].width*this.size,n[a].height*this.size);this.graphics.rect(s.x,s.y,s.width,s.height),this.graphics.fill();var r=Math.min(s.width,s.height)*Math.sqrt(3)/2;s.width<s.height?(this.graphics.moveTo(s.x+s.width/2,s.y-s.width/2),this.graphics.lineTo(s.x+s.width/2-r/2,s.y),this.graphics.lineTo(s.x+s.width/2+r/2,s.y),this.graphics.close(),this.graphics.fill(),this.graphics.moveTo(s.x+s.width/2,s.y+s.height+s.width/2),this.graphics.lineTo(s.x+s.width/2-r/2,s.y+s.height),this.graphics.lineTo(s.x+s.width/2+r/2,s.y+s.height),this.graphics.close(),this.graphics.fill()):(this.graphics.moveTo(s.x-s.height/2,s.y+s.height/2),this.graphics.lineTo(s.x,s.y+s.height/2-r/2),this.graphics.lineTo(s.x,s.y+s.height/2+r/2),this.graphics.close(),this.graphics.fill(),this.graphics.moveTo(s.x+s.width+s.height/2,s.y+s.height/2),this.graphics.lineTo(s.x+s.width,s.y+s.height/2-r/2),this.graphics.lineTo(s.x+s.width,s.y+s.height/2+r/2),this.graphics.close(),this.graphics.fill())}this.graphics.fill()}},__decorate([a(cc.Label)],e.prototype,"label",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],LineLoader:[function(t,e,i){"use strict";cc._RF.push(e,"eea96xcImBDLq6TS5xOLC2l","LineLoader"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/utils/Line"),n=__importDefault(t("../../miniGamePackage/utils/MathExt")),a=cc._decorator,s=a.ccclass,r=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(){for(var t=this.node.children,e=[],i=0;i<t.length;i++){var a=n.default.V2(t[i].position),s=n.default.V2(t[(i+1)%t.length].position),r=a,c=s.sub(a).normalize(),l=s.sub(a).mag();e.push(o.Line.Vec2Line(c,r,l))}return e},__decorate([s],e)}(cc.Component));i.default=r,cc._RF.pop()},{"../../miniGamePackage/utils/Line":"Line","../../miniGamePackage/utils/MathExt":"MathExt"}],LinePoint:[function(t,e,i){"use strict";cc._RF.push(e,"76409FLf5dG1on3M9h3fOWH","LinePoint"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),__decorate([n],e)}(cc.Component));i.default=a,cc._RF.pop()},{}],Line:[function(t,e,i){"use strict";cc._RF.push(e,"192ccUpaldDTLMVH0Vjgb4n","Line"),Object.defineProperty(i,"__esModule",{value:!0}),i.Line=void 0;var o=function(){function t(t,e,i,o,n){void 0===e&&(e=0),void 0===o&&(o=!0),void 0===n&&(n=!1),this.a=t,this.b=e,this.range=i,this.inverseFunc=n,this.dirSign=o}return Object.defineProperty(t.prototype,"start",{get:function(){var t=this.dirSign?this.range.min:this.range.max;return null==t?null:this.inverseFunc?cc.v2(this.a*t+this.b,t):cc.v2(t,this.a*t+this.b)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){var t=this.dirSign?this.range.max:this.range.min;return null==t?null:this.inverseFunc?cc.v2(this.a*t+this.b,t):cc.v2(t,this.a*t+this.b)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){var t=this.inverseFunc?cc.v2(this.a,1).normalizeSelf():cc.v2(1,this.a).normalizeSelf();return t.mulSelf(this.dirSign?1:-1),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nor",{get:function(){var t=this.dir;return cc.v2(-t.y,t.x).normalizeSelf()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.start&&this.end?cc.Vec2.distance(this.start,this.end):null},enumerable:!1,configurable:!0}),t.Vec2Line=function(e,i,o){if(void 0===i&&(i=cc.Vec2.ZERO),0==e.x&&0==e.y)return new t(0,0,{min:null,max:null});if(0==e.x)return new t(n=0,a=i.x,e.y>0?{min:i.y,max:o?i.add(e.normalize().mulSelf(o)).y:null}:{min:o?i.add(e.normalize().mulSelf(o)).y:null,max:i.y},e.y>0,!0);var n=e.y/e.x,a=i.y-i.x*n,s=null!=o?i.add(e.normalize().mulSelf(o)):null;return new t(n,a,e.x>0?{min:i.x,max:null!=s?s.x:null}:{min:null!=s?s.x:null,max:i.x},e.x>0)},t.prototype.randomPointInLine=function(){return this.start||this.end||(this.inverseFunc?cc.v2(this.a+this.b,1):cc.v2(1,this.a+this.b))},t.prototype.getOrthocenter=function(t){var e=this.randomPointInLine(),i=t.sub(e),o=this.nor,n=o.dot(i);return n<0?t.add(o.mul(-n)):t.sub(o.mul(n))},t.prototype.inRange=function(t){return(!this.range.min||t>=this.range.min)&&(!this.range.max||t<=this.range.max)},t.prototype.inLineRange=function(t){return this.inverseFunc?this.inRange(t.y):this.inRange(t.x)},t.prototype.startOrEnd=function(t){var e=this.start,i=this.end;return!e&&i?i:e&&!i?e:e&&i?cc.Vec2.distance(e,t)>cc.Vec2.distance(i,t)?i:e:t},t.prototype.closetPointWithPoint=function(t){var e=this.getOrthocenter(t);return this.inLineRange(e)?e:this.startOrEnd(t)},t.prototype.closetPointWithLine=function(t){var e=this.clone();e.range={min:null,max:null};var i=t.clone();i.range={min:null,max:null};var o=e.intersect(i);if(!o)return this.randomPointInLine();if(!this.inLineRange(o)&&t.inLineRange(o))return this.startOrEnd(o);if(this.inLineRange(o)&&!t.inLineRange(o)){var n=t.startOrEnd(o),a=this.getOrthocenter(n);return this.inLineRange(a)?a:this.startOrEnd(a)}return this.inLineRange(o)&&t.inLineRange(o)?o:(n=t.startOrEnd(o),a=this.getOrthocenter(n),this.inLineRange(a)?a:this.startOrEnd(a))},t.prototype.intersect=function(t){var e=cc.Vec2.ZERO;if(t.inverseFunc||this.inverseFunc){if(t.inverseFunc&&!this.inverseFunc){if(this.a*t.a==1)return null;if(e.y=(this.a*t.b+this.b)/(1-this.a*t.a),e.x=t.a*e.y+t.b,!this.inRange(e.x)||!t.inRange(e.y))return null}else if(!t.inverseFunc&&this.inverseFunc){if(this.a*t.a==1)return null;if(e.y=(t.a*this.b+t.b)/(1-t.a*this.a),e.x=this.a*e.y+this.b,!this.inRange(e.y)||!t.inRange(e.x))return null}else if(!t.inverseFunc&&!this.inverseFunc){if(this.a==t.a)return null;if(e.y=(t.b-this.b)/(this.a-t.a),e.x=this.a*e.y+this.b,!this.inRange(e.y)||!t.inRange(e.y))return null}}else{if(this.a==t.a)return null;if(e.x=(t.b-this.b)/(this.a-t.a),e.y=this.a*e.x+this.b,!this.inRange(e.x)||!t.inRange(e.x))return null}return e},t.prototype.showLine=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=cc.Color.WHITE);var o=cc.Vec2.ZERO,n=cc.Vec2.ZERO;if(this.inverseFunc){var a=null!=this.range.min?this.range.min:-1e3,s=null!=this.range.max?this.range.max:1e3;o=cc.v2(this.a*a+this.b,a),n=cc.v2(this.a*s+this.b,s)}else{var r=null!=this.range.min?this.range.min:-1e3,c=null!=this.range.max?this.range.max:1e3;o=cc.v2(r,this.a*r+this.b),n=cc.v2(c,this.a*c+this.b)}t.strokeColor=i,t.lineWidth=e,t.moveTo(o.x,o.y),t.lineTo(n.x,n.y),t.stroke()},t.prototype.reflect=function(t){if(0==t.x&&0==t.y)return t;var e=cc.Vec2.ZERO;e=this.inverseFunc?cc.v2(-1,this.a).normalize():cc.v2(this.a,-1).normalize();var i=t.dot(e);return i>0?e.mulSelf(-1):i=-i,t.add(e.mul(2*i))},t.prototype.clone=function(){return new t(this.a,this.b,{min:this.range.min,max:this.range.max},this.dirSign,this.inverseFunc)},t.prototype.moveBy=function(t){return this.clone().moveSelfBy(t)},t.prototype.moveSelfBy=function(t){var e=this.b,i={min:this.range.min,max:this.range.max};return this.inverseFunc?(e+=t.x-this.a*t.y,i.min&&(i.min+=t.y),i.max&&(i.max+=t.y)):(e+=t.y-this.a*t.x,i.min&&(i.min+=t.x),i.max&&(i.max+=t.x)),this.b=e,this.range=i,this},t}();i.Line=o,cc._RF.pop()},{}],MIniGameUIFeature:[function(t,e,i){"use strict";cc._RF.push(e,"2483aYR1atH76DeDNba+Sfp","MIniGameUIFeature"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameUIFeature=void 0;var o=function(){function t(){this.uiBase=null}return t.prototype.init=function(){return __awaiter(this,void 0,Promise,function(){return __generator(this,function(){return[2,!0]})})},t.prototype.onLoad=function(){},t.prototype.onDestroy=function(){},t}();i.MiniGameUIFeature=o,cc._RF.pop()},{}],Manager:[function(t,e,i){"use strict";cc._RF.push(e,"731d4xMVFhEJ63a0QR+vUbX","Manager"),Object.defineProperty(i,"__esModule",{value:!0}),i.FindCraftColliderManager=void 0;var o=function(){function t(){this.envs=[]}return t.prototype.testOverlap=function(t,e){var i=t.center;t.center=e;var o=!1;return this.envs.forEach(function(e){if(e!=t){var i=e.overlap(t);e.isTrigger&&!i&&e.isInArea?(e.exit(),e.isInArea=!1):e.isTrigger&&i&&!e.isInArea&&(e.enter(),e.isInArea=!0),i&&!e.isTrigger&&(o=!0)}}),t.center=i,o},t.prototype.moveCollision=function(t,e){var i=t.center,o=t.center.add(e),n=o.clone();return this.envs.forEach(function(a){if(a!=t&&!a.isTrigger){t.center=o;var s=a.overlap(t);if(t.center=i,s){var r=a.moveToClose(t,e),c=n.sub(i),l=r.sub(i);n.x=Math.abs(l.x)<Math.abs(c.x)?r.x:n.x,n.y=Math.abs(l.y)<Math.abs(c.y)?r.y:n.y}}}),n},t.testAABBCBB=function(t,e){var i=e.center.sub(t.center);return cc.v2(Math.max(0,Math.abs(i.x)),Math.max(0,Math.abs(i.y))).mag()<e.radius},t.testAABBAABB=function(t,e){return t.halfMaxPos.x>e.halfMinPos.x&&t.halfMaxPos.y>e.halfMinPos.y&&t.halfMinPos.x<e.halfMaxPos.x&&t.halfMinPos.y<e.halfMaxPos.y},t.testCBBCBB=function(t,e){return cc.Vec2.distance(t.center,e.center)<t.radius+e.radius},t.AABBcloseToAABB=function(t,e,i){if(i.isTrigger)return t.center;var o=t.center;t.center=t.center.add(e);var n=t.center.clone();if(this.testAABBAABB(t,i)){var a=cc.v2(Math.sign(-e.x),0),s=cc.v2(i.center.add(a.mul(t.size.x/2+i.size.x/2+this.closeDist)).x,t.center.y),r=s.sub(o),c=cc.v2(0,Math.sign(-e.y)),l=cc.v2(t.center.x,i.center.add(c.mul(t.size.y/2+i.size.y/2+this.closeDist)).y),h=l.sub(o);n=r.dot(a)<=0?s:h.dot(c)<=0?l:o}return t.center=o,n},t.closeDist=.1,t}();i.FindCraftColliderManager=o,cc._RF.pop()},{}],MathExt:[function(t,e,i){"use strict";cc._RF.push(e,"3aa569mJ51Bm5TAuR4e3Yf9","MathExt"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.V3=function(t,e){return void 0===e&&(e=0),cc.v3(t.x,t.y,e)},t.V2=function(t){return cc.v2(t.x,t.y)},t.Lerp=function(t,e,i){return t*(1-i)+e*i},t.Lerp2=function(t,e,i){return t.mul(1-i).add(e.mul(i))},t.Clamp=function(t,e,i){return Math.max(t,Math.min(i,e))},t.ClampRect=function(t,e,i){var o=i.clone();return o.x=this.Clamp(t.x,e.x,i.x),o.y=this.Clamp(t.y,e.y,i.y),o},t.Slerp=function(t,e,i){var o=t.mag(),n=e.mag(),a=cc.Vec2.RIGHT.angle(t);cc.Vec2.RIGHT.cross(t)<0&&(a=2*Math.PI-a);var s=t.angle(e),r=a+s;t.cross(e)<0&&(r=a-s);var c=this.Lerp(o,n,i),l=this.Lerp(a,r,i);return cc.v2(Math.cos(l),Math.sin(l)).normalizeSelf().multiplyScalar(c)},t.getDiffRad=function(t,e){var i=t.angle(e);return t.cross(e)<0&&(i=-i),i},t.alignVec=function(t,e,i){if(0==e.x&&0==e.y)return cc.Vec2.ZERO;var o=this.getDiffRad(t,i),n=this.getRad(e)+o;return cc.v2(Math.cos(n),Math.sin(n)).mulSelf(e.mag())},t.StepTo=function(t,e,i){i=Math.abs(i),e<t&&(i=-i);var o=t+i;return(e-t)*(e-o)<=0?e:o},t.isZero=function(t){return 0==t.x&&0==t.y},t.PointStepTo=function(t,e,i){var o=e.sub(t).normalizeSelf(),n=t.add(o.mul(i));return e.sub(n).dot(o)<=0?e:n},t.DirStepTo=function(t,e,i){if(this.isZero(t)||this.isZero(e))return t;i=Math.abs(i);var o=cc.Vec2.RIGHT.angle(t);cc.Vec2.RIGHT.cross(t)<0&&(o=2*Math.PI-o);var n=t.angle(e),a=o+n;t.cross(e)<0&&(a=o-n,i=-i);var s=o+i;return(a-o)*(a-s)<=0?e:cc.v2(Math.cos(s),Math.sin(s)).multiplyScalar(this.Lerp(t.mag(),e.mag(),(s-o)/(a-o)))},Object.defineProperty(t,"Rad2Ang",{get:function(){return 180/Math.PI},enumerable:!1,configurable:!0}),t.getRad=function(t){var e=cc.Vec2.RIGHT.angle(t);return cc.Vec2.RIGHT.cross(t)<0&&(e=2*Math.PI-e),e},t}();i.default=o,cc._RF.pop()},{}],MazeLineMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"f6872JMTS9NTaFNitwV1Rvm","MazeLineMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=cc._decorator,s=a.ccclass,r=a.property;(function(t){t[t.none=0]="none",t[t.corner=1]="corner",t[t.wall=2]="wall"})(o||(o={}));var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wallSpriteFrame=null,e.aimSpriteFrame=null,e.backgroundNode=null,e.zhangfei=null,e._maze=[],e._mazeWidth=21,e._mazeHeight=21,e._tileSize=32,e._offsetX=(-e._mazeHeight*e._tileSize+e._tileSize)/2,e._offsetY=-e._mazeHeight*e._tileSize/2-1,e._graphics=null,e._path=[],e._enterPosition=cc.v2(0,0),e._exitPosition=cc.v2(0,0),e._targetLocation=cc.v2(0,0),e._isTouch=!1,e}return __extends(e,t),e.prototype.onLoad=function(){var t=new cc.Node("Line");t.parent=this.backgroundNode,this._graphics=t.addComponent(cc.Graphics),this._graphics.lineWidth=10,this._graphics.strokeColor=cc.color(254,240,179),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},e.prototype.start=function(){this._maze=this._generateMaze(this._mazeWidth,this._mazeHeight),this._addEntranceAndExit(),this._renderMaze(),this._path.push(this._getRopeStart()),this._path.push(this._getRopeStart())},e.prototype.update=function(){this._isTouch&&this._updateRopeEnd(this._targetLocation)},e.prototype.exit=function(){n.default.getInst().getModel().gameExit()},e.prototype._generateMaze=function(t,e){var i=new Array(e).fill(null).map(function(){return new Array(t).fill(1)}),o=2*Math.floor(Math.random()*(t-2)/2)+1,n=2*Math.floor(Math.random()*(e-2)/2)+1,a=function(i,o){return i>0&&i<t-1&&o>0&&o<e-1},s=function(t){for(var e,i=t.length-1;i>0;i--){var o=Math.floor(Math.random()*(i+1));e=[t[o],t[i]],t[i]=e[0],t[o]=e[1]}return t},r=function(t,e){var o=s([[0,-2],[2,0],[0,2],[-2,0]]);i[e][t]=0;for(var n=0,c=o;n<c.length;n++){var l=c[n],h=l[0],u=l[1],d=t+h,p=e+u;if(a(d,p)&&1===i[p][d]){var m=t+h/2;i[e+u/2][m]=0,r(d,p)}}};return r(o,n),i},e.prototype._addEntranceAndExit=function(){for(var t,e,i=0;i<this._mazeWidth;i++)if(0===this._maze[1][i]){this._maze[0][i]=0,this._exitPosition=new cc.Vec2(i*this._tileSize+this._offsetX,this._offsetY-2*this._tileSize);break}for(i=this._mazeWidth-1;i>=0;i--)if(0===this._maze[this._mazeHeight-2][i]){this._maze[this._mazeHeight-1][i]=0,this._enterPosition=new cc.Vec2(i*this._tileSize+this._offsetX-2*this._tileSize,(this._mazeHeight-1)*this._tileSize+this._offsetY+2*this._tileSize),null===(t=this.zhangfei)||void 0===t||t.setPosition(this._enterPosition.x-200,this._enterPosition.y-170),null===(e=this.zhangfei)||void 0===e||e.setContentSize(2*this._tileSize,2*this._tileSize);break}},e.prototype._renderMaze=function(){for(var t=0;t<this._mazeHeight;t++)for(var e=0;e<this._mazeWidth;e++){(o=new cc.Node("Tile")).setParent(this.node);var i=o.addComponent(cc.Sprite);1===this._maze[t][e]&&(i.spriteFrame=this.wallSpriteFrame),o.setPosition(e*this._tileSize+this._offsetX,t*this._tileSize+this._offsetY),o.setContentSize(this._tileSize,this._tileSize)}var o;(o=new cc.Node("Tile")).setParent(this.node),(i=o.addComponent(cc.Sprite)).spriteFrame=this.aimSpriteFrame,o.setPosition(this._exitPosition),o.setContentSize(3*this._tileSize,3*this._tileSize)},e.prototype.onTouchMove=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation());this._targetLocation=e},e.prototype.onTouchStart=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation());this._isTouch=!0,this._targetLocation=e},e.prototype.onTouchEnd=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation());this._isTouch=!1,this._targetLocation=e},e.prototype._checkVictory=function(){this._path[this._path.length-1].sub(this._exitPosition).mag()<=2*this._tileSize&&(this._isTouch=!1,n.default.instance.gotoResultWithLoading(!0,this.node.parent))},e.prototype._updateRopeEnd=function(t){var e=this._path[this._path.length-1],i=t.sub(e).mag(),n=t.sub(e).normalize();t=e.add(n.mul(Math.min(5,i))),this._path.pop();var a=this._path[this._path.length-1],s=this._path.length>=2?this._path[this._path.length-2]:null,r=e.clone(),c=this._getTargetPosition(e,new cc.Vec2(t.x,e.y));if(e=c.pos,e=(c=this._getTargetPosition(e,new cc.Vec2(e.x,t.y))).pos,e=(c=this._getTargetPosition(e,t)).pos,(c=this._getTargetPosition(e,a)).situation!==o.wall){if(s&&(this._getTargetPosition(a,s),this._getTargetPosition(e,s).situation===o.none))return this._path.pop(),this._path.push(e),void this._updateRopeEnd(t);c.situation===o.corner&&this._path.push(c.pos),this._path.push(e),this._drawRope(this._path),this._checkVictory()}else{e=r,this._path.push(e);var l=t.sub(e).mag();l>.1&&this._updateRopeEnd(e.add(t.sub(e).normalize().mul(l/2)))}},e.prototype._getTargetPosition=function(t,e){var i=t.clone(),n=2,a=1,s=e.sub(i).normalize();i=i.sub(s.mul(n));for(var r=200,c=o.none;n>.1&&--r;){var l=i.add(s.mul(n)),h=Math.floor((l.x+this._tileSize/2-this._offsetX)/this._tileSize),u=Math.floor((l.y+this._tileSize/2-this._offsetY)/this._tileSize),d=this._maze[u]&&1===this._maze[u][h];l.sub(e).mag()<a||d?(c=d?o.wall:o.none,n/=2,a/=2):i=l}if(c===o.wall){var p=this._isNearCorner(i.add(s.mul(n)),a);if(p)return{pos:p,situation:c=o.corner}}return o.none,{pos:i,situation:c}},e.prototype._getRopeStart=function(){return this._enterPosition},e.prototype._drawRope=function(t){if(this._graphics){this._graphics.clear();for(var e=0,i=0,o=t;i<o.length;i++){var n=o[i];0===e?(e=1,this._graphics.moveTo(this._getRopeStart().x,this._getRopeStart().y)):this._graphics.lineTo(n.x,n.y)}this._graphics.stroke()}console.log(this._path.length)},e.prototype._isNearCorner=function(t){var e=Math.floor((t.x+this._tileSize/2-this._offsetX)/this._tileSize),i=Math.floor((t.y+this._tileSize/2-this._offsetY)/this._tileSize);if(!this._maze[i]||1!==this._maze[i][e])return!1;for(var o=null,n=new cc.Vec2(0,0),a=1/0,s=0,r=[[-.6,-.6],[.6,-.6],[.6,.6],[-.6,.6]];s<r.length;s++){var c=r[s],l=c[0],h=c[1],u=e+l,d=i+h,p=Math.round(e+2*l),m=Math.round(i+2*h),f=new cc.Vec2(u*this._tileSize+this._offsetX,d*this._tileSize+this._offsetY),g=t.sub(f).mag();g<a&&(a=g,o=[p,m],n=f)}if(a>10)return!1;var _=o,y=_[0],v=_[1],b=0;return this._maze[v]&&1===this._maze[v][e]&&b++,this._maze[i]&&1===this._maze[i][y]&&b++,0===b&&n},e.prototype._offBind=function(){this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},e.prototype.onDisable=function(){this._offBind()},__decorate([r(cc.SpriteFrame)],e.prototype,"wallSpriteFrame",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"aimSpriteFrame",void 0),__decorate([r(cc.Node)],e.prototype,"backgroundNode",void 0),__decorate([r(cc.Node)],e.prototype,"zhangfei",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],MazeLineModle:[function(t,e,i){"use strict";cc._RF.push(e,"c52756m9OlB5Ksvd2Dzr9xB","MazeLineModle"),Object.defineProperty(i,"__esModule",{value:!0}),i.LazeLineModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=cc._decorator,r=(s.ccclass,s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/mazeLine/mazeLineGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.mazeLine)],e)}(n.default));i.LazeLineModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],MiniGameDataManager:[function(t,e,i){"use strict";cc._RF.push(e,"2088ca0tlxOQoFPyAAFof3Z","MiniGameDataManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameDataManager=void 0;var o=__importDefault(t("./SubPackageManager")),n=t("./types-miniGame"),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._miniGames=new Map([[n.SubPackageKey.match3,{key:n.SubPackageKey.match3,name:"\u6728\u6709\u9c7c\u4e38",path:"xyx_btn_muyouyuwan",desc:"\u51d1\u9f50\u4e09\u4e2a\uff0c\u4eab\u7528\u9c7c\u4e38\uff01"}],[n.SubPackageKey.carCross,{key:n.SubPackageKey.carCross,name:"\u89c1\u7f1d\u63d2\u8f66",path:"xyx_btn_fasheqiche",desc:"\u5feb\u8dd1\uff01"}],[n.SubPackageKey.building,{key:n.SubPackageKey.building,name:"\u7f50\u5934\u53e0\u53e0\u4e50",path:"xyx_btn_mitianguantou",desc:"\u5de7\u5999\u53e0\u7f50\u5934\uff0c\u6311\u6218\u9ad8\u5206\uff01"}],[n.SubPackageKey.watermelonMerge,{key:n.SubPackageKey.watermelonMerge,name:"\u7b79\u7801\u5927\u4ea8",path:"xyx_btn_choumadaheng",desc:"\u52a9\u4f60\u6210\u4e3a\u7b79\u7801\u5927\u4ea8\uff01"}],[n.SubPackageKey.skiRush,{key:n.SubPackageKey.skiRush,name:"\u54b8\u9c7c\u6ed1\u96ea",path:"xyx_btn_xianyuhuaxue",desc:"\u6ed1\u96ea\u51b2\u523a\uff0c\u5192\u9669\u65e0\u9650\uff01"}],[n.SubPackageKey.digitMatch,{key:n.SubPackageKey.digitMatch,name:"\u6570\u5b57\u70b9\u70b9\u6d88",path:"xyx_btn_shuzidiandianxiao",desc:"\u6d88\u9664\u76f8\u540c\u6570\u5b57\uff0c\u6311\u6218\u9ad8\u5206\uff01"}],[n.SubPackageKey.hanoiTower,{key:n.SubPackageKey.hanoiTower,name:"\u9c7c\u751f\u4e00\u4e32",path:"xyx_btn_yushengyichuan",desc:"\u6210\u4e3a\u4e32\u4e32\u738b\uff01"}],[n.SubPackageKey.loadCarRun,{key:n.SubPackageKey.loadCarRun,name:"\u54b8\u9c7c\u7269\u6d41",path:"xyx_btn_xianyuwuliu",desc:"\u5c0f\u8f66\u4e00\u5f00\uff0c\u8d22\u6e90\u6eda\u6eda\uff01"}],[n.SubPackageKey.card2048,{key:n.SubPackageKey.card2048,name:"\u4e00\u628a\u597d\u724c",path:"xyx_btn_yishouhaopai",desc:"\u4e00\u628a\u597d\u724c\u8d62\u5927\u94b1\uff01"}],[n.SubPackageKey.unblock,{key:n.SubPackageKey.unblock,name:"\u7bad\u5934\u6d88\u6d88\u6d88",path:"xyx_btn_jiantouxiaoxiaoxiao",desc:"\u6d88\u9664\u76f8\u540c\u65b9\u5411\u7684\u7bad\u5934"}],[n.SubPackageKey.numberMuzzle,{key:n.SubPackageKey.numberMuzzle,name:"\u6570\u5b57\u8ff7\u5bab",path:"xyx_btn_shuzidiandianxiao",desc:"\u89e3\u5f00\u8c1c\u9898\uff0c\u627e\u5230\u51fa\u53e3\uff01"}],[n.SubPackageKey.plates,{key:n.SubPackageKey.plates,name:"\u8c01\u662f\u8001\u53f8\u673a",path:"xyx_btn_sheishilaosiji",desc:"\u5c55\u793a\u4f60\u7684\u9a7e\u9a76\u7ecf\u9a8c\uff01"}],[n.SubPackageKey.oilRush,{key:n.SubPackageKey.oilRush,name:"\u75af\u72c2\u94bb\u5934",path:"xyx_btn_fengkuangzuantou",desc:"\u63a7\u5236\u94bb\u5934\uff0c\u7a7f\u8d8a\u969c\u788d\uff01"}],[n.SubPackageKey.basketball,{key:n.SubPackageKey.basketball,name:"\u66b4\u6263\u6cb3\u8c5av1.1",path:"xyx_btn_baokouxianyu",desc:"\u5c55\u793a\u4f60\u7684\u7bee\u7403\u6280\u5de7\uff01"}],[n.SubPackageKey.huntEvolution,{key:n.SubPackageKey.huntEvolution,name:"\u54b8\u9c7c\u5e78\u5b58\u8005v1.4",path:"xyx_btn_xianyuxingcunzhe",desc:"\u5728\u6076\u52a3\u73af\u5883\u4e2d\u751f\u5b58\u4e0b\u6765\uff01"}],[n.SubPackageKey.fishGrow,{key:n.SubPackageKey.fishGrow,name:"\u8fdb\u5316\u5403\u9c7c",path:"xyx_btn_chiyujinhua",desc:"\u5403\u6389\u66f4\u591a\u7684\u9c7c\uff0c\u8fdb\u5316\u6210\u5f3a\u8005\uff01"}],[n.SubPackageKey.brickGame,{key:n.SubPackageKey.brickGame,name:"\u7816\u5757",path:"xyx_btn_zhuankuai",desc:"\u6d88\u9664\u7816\u5757\u6211\u5728\u884c\uff01"}],[n.SubPackageKey.paintWall,{key:n.SubPackageKey.paintWall,name:"\u5237\u5899",path:"xyx_btn_shuaqiang",desc:"\u7cbe\u51c6\u5207\u5272\uff0c\u89e3\u5f00\u8c1c\u9898\uff01"}],[n.SubPackageKey.circleMuzzle,{key:n.SubPackageKey.circleMuzzle,name:"\u89e3\u5f00\u5706\u73af",path:"xyx_btn_jiekaiyuanhuan",desc:"\u597d\u591a\u5708~"}],[n.SubPackageKey.fishGoldBurst,{key:n.SubPackageKey.fishGoldBurst,name:"\u54b8\u9c7c\u7206\u91d1\u5e01",path:"xyx_btn_xianyubaojinbi",desc:"\u6536\u96c6\u91d1\u5e01"}],[n.SubPackageKey.fishFly,{key:n.SubPackageKey.fishFly,name:"\u9003\u79bb\u9ca8\u9c7c",path:"xyx_btn_jiejiuxiaoyu",desc:"\u9003\u79bb\u8ffd\u6355\u7684\u9ca8\u9c7c\uff01"}],[n.SubPackageKey.fishEscape,{key:n.SubPackageKey.fishEscape,name:"\u5c0f\u9c7c\u5927\u9003\u4ea1",path:"xyx_btn_xiaoyudataowang",desc:"\u5e2e\u52a9\u5c0f\u9c7c\u9003\u79bb\u8ffd\u6355\uff01"}],[n.SubPackageKey.stickPuzzle,{key:n.SubPackageKey.stickPuzzle,name:"\u6e05\u9664\u6c34\u7ba1",path:"xyx_btn_qingchushuiguan",desc:"\u7545\u901a\u6c34\u6d41\uff01"}],[n.SubPackageKey.drawHomePath,{key:n.SubPackageKey.drawHomePath,name:"\u5582\u9971\u5927\u9c7c",path:"xyx_btn_yulingzhizheng",desc:"\u997f\uff01"}],[n.SubPackageKey.bridgeCraft,{key:n.SubPackageKey.bridgeCraft,name:"\u5efa\u6865\u5927\u5e08",path:"xyx_btn_jianqiaodashi",desc:"\u8bbe\u8ba1\u6865\u6881\uff0c\u901a\u884c\u65e0\u963b\uff01"}],[n.SubPackageKey.mazeLine,{key:n.SubPackageKey.mazeLine,name:"\u62ff\u5230\u9152\u575b",path:"xyx_btn_nadaojiutan",desc:"\u60f3\u559d\u70b9\u4ec0\u4e48~"}],[n.SubPackageKey.slicePig,{key:n.SubPackageKey.slicePig,name:"\u5207\u54b8\u9c7c",path:"xyx_btn_qiexianyu",desc:"\u5de7\u5999\u5207\u5272\u54b8\u9c7c\uff01"}],[n.SubPackageKey.sheepGuardian,{key:n.SubPackageKey.sheepGuardian,name:"\u4fdd\u62a4\u5c0f\u9c7c",path:"xyx_btn_baohuxiaoyu",desc:"\u5e2e\u6211\u907f\u5f00\u5371\u9669\uff01"}],[n.SubPackageKey.islandGame,{key:n.SubPackageKey.islandGame,name:"\u5207\u65b9\u5757",path:"xyx_btn_fenfangkuai",desc:"\u7cbe\u51c6\u5207\u5272\uff0c\u89e3\u5f00\u8c1c\u9898\uff01"}],[n.SubPackageKey.drawLine,{key:n.SubPackageKey.drawLine,name:"\u5f15\u6c34\u753b\u7ebf",path:"xyx_btn_huaxianyinshui",desc:"\u5f15\u6c34\u89e3\u8c1c\uff01"}],[n.SubPackageKey.screwMiniGame,{key:n.SubPackageKey.screwMiniGame,name:"\u62e7\u87ba\u4e1d",path:"xyx_btn_ningluosi",desc:"\u62e7\u7d27\u87ba\u4e1d\uff0c\u5b8c\u6210\u4efb\u52a1\uff01"}],[n.SubPackageKey.jigsawGame,{key:n.SubPackageKey.jigsawGame,name:"\u62fc\u56fe",path:"xyx_btn_huanyuanpintu",desc:"\u8fd8\u539f\u5b8c\u6574\u56fe\u7247\uff01"}],[n.SubPackageKey.rescueHeroGame,{key:n.SubPackageKey.rescueHeroGame,name:"\u5207\u5272",path:"xyx_btn_qiege",desc:"\u7cbe\u51c6\u5207\u5272\uff0c\u89e3\u5f00\u8c1c\u9898\uff01"}],[n.SubPackageKey.parkour,{key:n.SubPackageKey.parkour,name:"\u54b8\u9c7c\u8dd1\u9177",path:"xyx_btn_xianyupaoku",desc:"\u514b\u670d\u969c\u788d\uff0c\u8dd1\u51fa\u9ad8\u5206\uff01"}],[n.SubPackageKey.ballFall,{key:n.SubPackageKey.ballFall,name:"\u5f00\u95f8\u653e\u5e01",path:"xyx_btn_kaizhafangbi",desc:"\u5feb\u901f\u5f00\u95f8\uff0c\u653e\u5e01\u8d62\u5927\u5956\uff01"}],[n.SubPackageKey.railing,{key:n.SubPackageKey.railing,name:"\u8c61\u68cb\u5bfb\u5b9d",path:"xyx_btn_xiangqixunbao",desc:"\u68cb\u76d8\u4e0a\u5bfb\u627e\u5b9d\u85cf"}],[n.SubPackageKey.fishGame,{key:n.SubPackageKey.fishGame,name:"\u9c7c\u7075\u4e4b\u4e89",path:"xyx_btn_yulingzhizheng",desc:"\u5c55\u5f00\u6fc0\u70c8\u7684\u6218\u6597\uff01"}],[n.SubPackageKey.bladeFly,{key:n.SubPackageKey.bladeFly,name:"\u62ef\u6551\u5b54\u660e",path:"xyx_btn_feidao",desc:"\u62ef\u6551\u88ab\u56f0\u7684\u8bf8\u845b\u5b54\u660e\uff01"}],[n.SubPackageKey.findCraft,{key:n.SubPackageKey.findCraft,name:"\u54b8\u9c7c\u6253\u5de5",path:"xyx_btn_xianyudagong",desc:"\u5e2e\u52a9\u54b8\u9c7c\u627e\u5230\u5de5\u4f5c"}],[n.SubPackageKey.guessPlace,{key:n.SubPackageKey.guessPlace,name:"\u731c\u5730\u70b9",path:"xyx_btn_xianyudagong",desc:"\u731c\u731c\u6211\u5728\u54ea~"}],[n.SubPackageKey.findDifference,{key:n.SubPackageKey.findDifference,name:"\u627e\u4e0d\u540c",path:"xyx_btn_zhanbutong",desc:"\u5bfb\u627e\u4e0d\u540c\u4e4b\u5904\uff01"}],[n.SubPackageKey.circleFish,{key:n.SubPackageKey.circleFish,name:"\u54b8\u9c7c\u6253\u635e\u961f",path:"xyx_btn_xianyudalaodui",desc:"\u7ec4\u5efa\u6253\u635e\u961f\uff0c\u6253\u635e\u5b9d\u85cf\uff01"}]]),e._miniGameList=[n.SubPackageKey.match3,n.SubPackageKey.carCross,n.SubPackageKey.building,n.SubPackageKey.watermelonMerge,n.SubPackageKey.skiRush,n.SubPackageKey.digitMatch,n.SubPackageKey.hanoiTower,n.SubPackageKey.loadCarRun,n.SubPackageKey.card2048,n.SubPackageKey.unblock,n.SubPackageKey.circleFish,n.SubPackageKey.numberMuzzle,n.SubPackageKey.plates,n.SubPackageKey.oilRush,n.SubPackageKey.basketball,n.SubPackageKey.huntEvolution,n.SubPackageKey.fishGrow,n.SubPackageKey.brickGame,n.SubPackageKey.paintWall,n.SubPackageKey.circleMuzzle,n.SubPackageKey.fishGoldBurst,n.SubPackageKey.fishFly,n.SubPackageKey.fishEscape,n.SubPackageKey.stickPuzzle,n.SubPackageKey.drawHomePath,n.SubPackageKey.bridgeCraft,n.SubPackageKey.mazeLine,n.SubPackageKey.slicePig,n.SubPackageKey.sheepGuardian,n.SubPackageKey.islandGame,n.SubPackageKey.drawLine,n.SubPackageKey.screwMiniGame,n.SubPackageKey.jigsawGame,n.SubPackageKey.rescueHeroGame,n.SubPackageKey.parkour,n.SubPackageKey.ballFall,n.SubPackageKey.railing,n.SubPackageKey.fishGame,n.SubPackageKey.bladeFly,n.SubPackageKey.findCraft,n.SubPackageKey.guessPlace,n.SubPackageKey.findDifference],e._newMiniGameList=[n.SubPackageKey.match3,n.SubPackageKey.carCross,n.SubPackageKey.building,n.SubPackageKey.watermelonMerge,n.SubPackageKey.skiRush,n.SubPackageKey.digitMatch,n.SubPackageKey.hanoiTower,n.SubPackageKey.loadCarRun,n.SubPackageKey.card2048,n.SubPackageKey.numberMuzzle,n.SubPackageKey.oilRush,n.SubPackageKey.fishGrow,n.SubPackageKey.basketball,n.SubPackageKey.unblock],e._hotMiniGameList=[n.SubPackageKey.match3,n.SubPackageKey.watermelonMerge,n.SubPackageKey.huntEvolution,n.SubPackageKey.digitMatch,n.SubPackageKey.card2048,n.SubPackageKey.hanoiTower,n.SubPackageKey.basketball,n.SubPackageKey.fishGrow,n.SubPackageKey.skiRush,n.SubPackageKey.paintWall,n.SubPackageKey.unblock,n.SubPackageKey.brickGame,n.SubPackageKey.oilRush,n.SubPackageKey.findCraft,n.SubPackageKey.numberMuzzle,n.SubPackageKey.fishGoldBurst],e._showStudioGamesTab=[0],e}return __extends(e,t),e.prototype.getMiniGameList=function(t){void 0===t&&(t=0);for(var e=[],i=0,o=[this._newMiniGameList,this._hotMiniGameList,this._miniGameList][t]||[];i<o.length;i++){var n=o[i];this._miniGames.has(n)&&e.push(this._miniGames.get(n))}return e},e.prototype.needShowStudioGame=function(){return o.default.instance.miniGameAdapter.needStudioGames()},Object.defineProperty(e,"instance",{get:function(){return this.getInst()},enumerable:!1,configurable:!0}),e}(t("./utils/SingleClass").SingleClass);i.MiniGameDataManager=a,cc._RF.pop()},{"./SubPackageManager":"SubPackageManager","./types-miniGame":"types-miniGame","./utils/SingleClass":"SingleClass"}],MiniGameDefer:[function(t,e,i){"use strict";cc._RF.push(e,"59d2cHMKIZOJq/IaOAhjcK4","MiniGameDefer"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameDefer=void 0;i.MiniGameDefer=function(){var t=this;this.resolved=!1,this.promise=new Promise(function(e,i){t.resolve=e,t.reject=i})},cc._RF.pop()},{}],MiniGameLauncher:[function(t,e,i){"use strict";cc._RF.push(e,"564761q7I9JbI3cOQAI02xm","MiniGameLauncher"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameLauncher=void 0;var o=__importStar(t("./SubPackageManager")),n=t("./utils/SubResourceUtils"),a=cc._decorator,s=a.ccclass,r=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var i;return __extends(e,t),i=e,Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){i._instance=this;var t=this.node._mainGameData;o.default.instance.onLoad(t),this._gotoMain()},e.prototype.onEnable=function(){},e.prototype.onDisable=function(){},e.prototype.start=function(){},e.prototype.onDestroy=function(){},e.prototype._gotoMain=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return o.default.instance.miniGameData.showLoading?(o.default.instance.showLoadingDialog(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._loadMain()];case 1:return t.sent()&&o.default.instance.emitHideLoaidngUI(),[2]}})})}),[3,3]):[3,1];case 1:return[4,this._loadMain()];case 2:e.sent()&&o.default.instance.emitHideLoaidngUI(),e.label=3;case 3:return[2]}})})},e.prototype._loadMain=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(a){switch(a.label){case 0:return[4,n.SubResourceUtils.getInst().loadAsset("miniGameScripts","scene/MiniGameCenterWindow",cc.Prefab)];case 1:return(t=a.sent())?(e=cc.instantiate(t),i=o.default.instance.getLayer(o.MiniGameLayer.Main),cc.isValid(i)&&o.default.instance.inUse?(null==i||i.addChild(e),[2,!0]):[2,!1]):(o.default.instance.exitGameCenter(),[2,!1])}})})},e._instance=null,i=__decorate([s],e)}(cc.Component));i.MiniGameLauncher=r,cc._RF.pop()},{"./SubPackageManager":"SubPackageManager","./utils/SubResourceUtils":"SubResourceUtils"}],MiniGameLoading:[function(t,e,i){"use strict";cc._RF.push(e,"c7576+GrixNX5m5sgnAVu4H","MiniGameLoading"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameLoading=void 0;var o,n=cc._decorator,a=n.ccclass,s=n.property;(function(t){t[t.none=0]="none",t[t.show=1]="show",t[t.close=2]="close",t[t.finish=3]="finish"})(o||(o={}));var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spine=null,e._state=o.none,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.onEnable=function(){},e.prototype.onDisable=function(){},e.prototype.start=function(){},e.prototype.onDestroy=function(){},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(){return[2,new Promise(function(e){var i=t.spine;i?(i.setToSetupPose(),i.setAnimation(0,"show2",!1),i.setCompleteListener(function(){i.setAnimation(0,"idle2",!0),i.setCompleteListener(void 0),e(!0)})):e(!1)})]})})},e.prototype.close=function(){var t=this,e=this.spine;e&&(e.setAnimation(0,"hide2",!1),e.setCompleteListener(function(){t.node.destroy()}))},__decorate([s(sp.Skeleton)],e.prototype,"spine",void 0),__decorate([a],e)}(cc.Component);i.MiniGameLoading=r,cc._RF.pop()},{}],MiniGameLvComp:[function(t,e,i){"use strict";cc._RF.push(e,"76e2c0lHdhBgYKLKC9isfS+","MiniGameLvComp"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("./SubPackageManager")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.levelPrefab=[],e.btnBack=null,e.isUseMap=!1,e.mapPrefab=null,e._curLvNode=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.btnBack.on(cc.Node.EventType.TOUCH_END,this._exitGame,this),this.isUseMap?this._createMap():this._createLevel(),this.btnBack.zIndex=100;var t=n.default.instance.miniGameAdapter.eventMgr;t.on(o.MiniGameEvent.EventLevelComplete,this._onLevelComplete,this),t.on(o.MiniGameEvent.EventGameWin,this._gameWin,this),t.on(o.MiniGameEvent.EventGameFail,this._gameFail,this)},e.prototype._exitGame=function(){n.default.instance.getModel().gameExit()},e.prototype._onLevelComplete=function(){if(this.isUseMap)this._nextMap();else{if(0==this.levelPrefab.length)return void this._gameWin();this._nextLevel()}},e.prototype._createLevel=function(){this._curLvNode=cc.instantiate(this.levelPrefab.shift()),this._curLvNode.zIndex=99,this.node.addChild(this._curLvNode)},e.prototype._createMap=function(){this._curLvNode=cc.instantiate(this.mapPrefab),this._curLvNode.zIndex=99,this.node.addChild(this._curLvNode)},e.prototype._nextMap=function(){this._curLvNode.destroy(),n.default.instance.getModel().mapIndex++,this._createMap()},e.prototype._nextLevel=function(){this._curLvNode.destroy(),this._createLevel()},e.prototype._gameWin=function(){n.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype._gameFail=function(){n.default.instance.gotoResultWithLoading(!1,this.node.parent)},e.prototype.onDisable=function(){this.btnBack.off(cc.Node.EventType.TOUCH_END,this._exitGame,this);var t=n.default.instance.miniGameAdapter.eventMgr;t.off(o.MiniGameEvent.EventGameWin,this._gameWin,this),t.off(o.MiniGameEvent.EventGameFail,this._gameFail,this),t.off(o.MiniGameEvent.EventLevelComplete,this._onLevelComplete,this)},__decorate([r(cc.Prefab)],e.prototype,"levelPrefab",void 0),__decorate([r(cc.Node)],e.prototype,"btnBack",void 0),__decorate([r],e.prototype,"isUseMap",void 0),__decorate([r(cc.Prefab)],e.prototype,"mapPrefab",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../../game/scripts/mini-adapter/types-miniPre":void 0,"./SubPackageManager":"SubPackageManager"}],MiniGameResultWindow:[function(t,e,i){"use strict";cc._RF.push(e,"0406bqjvGRIsY1YQvhYXgwj","MiniGameResultWindow"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./SubPackageManager")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.winBg=null,e.loseBg=null,e.winTitle=null,e.loseTitle=null,e.resultAni=null,e.okBtn=null,e.winSound=null,e.failSound=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.okBtn.on(cc.Node.EventType.TOUCH_END,this.exitGame,this)},e.prototype.onEnable=function(){this._onClose=void 0},e.prototype.setWinOrLoseToPlay=function(t,e){this.winBg.active=t,this.loseBg.active=!t,this.winTitle.active=t,this.loseTitle.active=!t,this.resultAni.play("showResult"),this._onClose=e;var i=t?this.winSound:this.failSound;cc.audioEngine.play(i,!1,.45)},e.prototype.onDisable=function(){this._onClose&&this._onClose()},e.prototype.exitGame=function(){var t=o.default.instance.getModel();t?t.gameExit():(o.default.instance.backToGameCenter(),cc.audioEngine.uncache(this.winSound),cc.audioEngine.uncache(this.failSound))},__decorate([s(cc.Node)],e.prototype,"winBg",void 0),__decorate([s(cc.Node)],e.prototype,"loseBg",void 0),__decorate([s(cc.Node)],e.prototype,"winTitle",void 0),__decorate([s(cc.Node)],e.prototype,"loseTitle",void 0),__decorate([s(cc.Animation)],e.prototype,"resultAni",void 0),__decorate([s(cc.Node)],e.prototype,"okBtn",void 0),__decorate([s(cc.AudioClip)],e.prototype,"winSound",void 0),__decorate([s(cc.AudioClip)],e.prototype,"failSound",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./SubPackageManager":"SubPackageManager"}],MiniGameScreenItem:[function(t,e,i){"use strict";cc._RF.push(e,"bd7b9tkkF9Lq6+8d1rYhoNE","MiniGameScreenItem"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("./SubPackageManager")),a=t("./base/MiniGameUIManager"),s=t("./utils/SubResourceUtils"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.desc=null,e.bg=null,e.listInfo=null,e}return __extends(e,t),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onClickCell,this)},e.prototype.start=function(){},e.prototype.refreshItem=function(t){var e=this;this.listInfo=t,this.bg.node.opacity=0;var i=this.listInfo.key;s.SubResourceUtils.getInst().loadAsset(s.SubResourceUtils.getInst().bundleRoot,"texture/main/item/"+t.path,cc.SpriteFrame).then(function(t){cc.isValid(e)&&i==e.listInfo.key&&(t&&(e.bg.spriteFrame=t),e.bg.node.opacity=255)}),this.label.string=t.name,this.desc.string=t.desc},e.prototype.onClickCell=function(){a.MiniGameUIManager.instance.sendEventToGame(o.MiniGameEvent.MiniGameTGA,o.MiniGameTAGEvent.ClickMiniGameItem,{key:this.listInfo.key}),n.default.instance.miniGameAdapter.eventMgr.emit(o.MiniGameEvent.ClickItemList,this.listInfo)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_END)},__decorate([l(cc.Label)],e.prototype,"label",void 0),__decorate([l(cc.Label)],e.prototype,"desc",void 0),__decorate([l(cc.Sprite)],e.prototype,"bg",void 0),__decorate([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../../../game/scripts/mini-adapter/types-miniPre":void 0,"./SubPackageManager":"SubPackageManager","./base/MiniGameUIManager":"MiniGameUIManager","./utils/SubResourceUtils":"SubResourceUtils"}],MiniGameScreen:[function(t,e,i){"use strict";cc._RF.push(e,"61b98ZHY5tFXaHlfndCVRH9","MiniGameScreen"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameScreen=void 0;var o=t("../../../game/scripts/mini-adapter/types-miniPre"),n=t("./MiniGameDataManager"),a=__importDefault(t("./MiniGameScreenItem")),s=__importStar(t("./SubPackageManager")),r=t("./types-miniGame"),c=t("./utils/TableView"),l=cc._decorator,h=l.ccclass,u=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.root=null,e.loading=null,e.listRoot=null,e.item=null,e.tableView=null,e.btnStudioGame=null,e.toggleContainer=null,e.widgets=[],e._miniGameList=[],e._autoEnter=!1,e._tabIdx=-1,e}var i;return __extends(e,t),i=e,Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),e.prototype.onClickClose=function(){s.default.instance.exitGameCenter()},e.prototype.onClickStudioGames=function(){s.default.instance.exitGameCenter(!0)},e.prototype.onClickToggle=function(t,e){var i=parseInt(e)||0;this.initTableview(i,!1)},e.prototype._onSelectedGame=function(t){this._enterGame(t.key)},e.prototype._showLoading=function(t){this.loading.active=t},e.prototype._enterGame=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._showLoading(!0),e=s.default.getInst().getLayer(s.MiniGameLayer.SubGame),[4,s.default.instance.showGame(t,e)];case 1:return i.sent(),this._showLoading(!1),this.node.active=!1,[2]}})})},e.prototype.backToShow=function(){this._showLoading(!1),this.node.active=!0},e.prototype.onLoad=function(){if(i._instance=this,this._showLoading(!1),this._autoEnter=s.default.instance.enterParams.miniGameEnter==o.MiniGameEnterType.AutoEnter,this._autoEnter){this.listRoot.active=!1;var t=s.default.instance.enterParams.miniGame[0]||r.SubPackageKey.ballFall;this._enterGame(t)}s.default.instance.adaptMaxHeight(this.root)},e.prototype.onEnable=function(){s.default.instance.miniGameAdapter.eventMgr.on(o.MiniGameEvent.ClickItemList,this._onSelectedGame,this)},e.prototype.start=function(){for(var t=0,e=this.widgets;t<e.length;t++)e[t].updateAlignment();this.listRoot.removeAllChildren(),this.listRoot.active=!0;var i=this._tabIdx<0?0:this._tabIdx;this.initTableview(i,!0)},e.prototype.initTableview=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=!1),t!=this._tabIdx){this._tabIdx=t,this.refreshToggle();var i=n.MiniGameDataManager.instance.getMiniGameList(t);this._miniGameList=i;var o=n.MiniGameDataManager.instance.needShowStudioGame(t),a=s.default.instance.miniGameData;o=o&&1===a.from,this.btnStudioGame.active=o,this.tableView.reloadData(e)}},e.prototype.refreshToggle=function(){var t=this._tabIdx;t=Math.max(t,0);for(var e=this.toggleContainer.children,i=0;i<e.length;i++){var o=e[i],n=o.getChildByName("title"),a=o.getChildByName("checkmark");t==i?(a.active=!0,n.color=cc.color(70,21,38)):(a.active=!1,n.color=cc.color(241,193,69))}},e.prototype.onDisable=function(){s.default.instance.miniGameAdapter.eventMgr.off(o.MiniGameEvent.ClickItemList,this._onSelectedGame,this)},e.prototype.onDestroy=function(){i._instance=null},e.prototype.tableCellAtIndex=function(t,e){var i=e.getChildByName("item");i||(i=cc.instantiate(this.item),e.addChild(i),i.name="item",i.setPosition(0,0),i.active=!0),i.getComponent(a.default).refreshItem(this._miniGameList[t],t)},e.prototype.tableCellSize=function(){return cc.size(670,174)},e.prototype.tableCellCount=function(){return this._miniGameList.length},e._instance=null,__decorate([u(cc.Node)],e.prototype,"root",void 0),__decorate([u(cc.Node)],e.prototype,"loading",void 0),__decorate([u(cc.Node)],e.prototype,"listRoot",void 0),__decorate([u(cc.Node)],e.prototype,"item",void 0),__decorate([u(c.TableView)],e.prototype,"tableView",void 0),__decorate([u(cc.Node)],e.prototype,"btnStudioGame",void 0),__decorate([u(cc.Node)],e.prototype,"toggleContainer",void 0),__decorate([u([cc.Widget])],e.prototype,"widgets",void 0),i=__decorate([h],e)}(cc.Component);i.MiniGameScreen=d,cc._RF.pop()},{"../../../game/scripts/mini-adapter/types-miniPre":void 0,"./MiniGameDataManager":"MiniGameDataManager","./MiniGameScreenItem":"MiniGameScreenItem","./SubPackageManager":"SubPackageManager","./types-miniGame":"types-miniGame","./utils/TableView":"TableView"}],MiniGameTipsManager:[function(t,e,i){"use strict";cc._RF.push(e,"5d94fjLptBBC6R8hvshRCw9","MiniGameTipsManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameTip=i.MiniGameTipsManager=void 0;var o=__importStar(t("../SubPackageManager")),n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tipsLayer="TipsLayer",e._tips=new Set,e}return __extends(e,t),e.showTip=function(t,i){e.getInst().createTip(t,i)},e.prototype.createTip=function(t,e){var i=this,n=o.default.instance.getLayer(o.MiniGameLayer.Tips);if(n){var s=n.getChildByName(this.tipsLayer);s||(s=new cc.Node(this.tipsLayer),n.addChild(s),s.setPosition(0,0));var r=new a(t,e);this._tips.add(r),e=r.node,s.addChild(e),cc.tween(e).by(1,{y:50}).by(.5,{y:50,opacity:-255}).call(function(){i._tips.delete(r),r.dispose()}).start()}},e.prototype.closeAll=function(){this._tips.forEach(function(t){t.dispose()}),this._tips.clear()},e}(t("../utils/SingleClass").SingleClass);i.MiniGameTipsManager=n;var a=function(){function t(t,e){if(this._node=null,e)this._node=cc.instantiate(e);else{this._node=new cc.Node("tips");var i=this._node.addComponent(cc.Label),o=cc.color();cc.Color.fromHEX(o,"#F2C146"),this._node.color=o,i.fontSize=44;var n=this._node.addComponent(cc.LabelOutline);n.width=3,cc.Color.fromHEX(o,"#975911"),n.color=o}var a=this._node.getComponent(cc.Label);a&&(a.string=t),this._node.setPosition(0,0),this._node.opacity=255}return Object.defineProperty(t.prototype,"node",{get:function(){return this._node},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this._node&&this._node.isValid&&this._node.destroy()},t}();i.MiniGameTip=a,cc._RF.pop()},{"../SubPackageManager":"SubPackageManager","../utils/SingleClass":"SingleClass"}],MiniGameUIBase:[function(t,e,i){"use strict";cc._RF.push(e,"64a36ZLUv1HO6Uy251F0uX8","MiniGameUIBase"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameUIBase=void 0;var o=function(){function t(){this.ui=null,this.components=[]}return t.prototype.init=function(){return __awaiter(this,void 0,Promise,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:t=0,e=this.components,i.label=1;case 1:return t<e.length?[4,e[t].init()]:[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2,!0]}})})},t.prototype.onLoad=function(){for(var t=0,e=this.components;t<e.length;t++)e[t].onLoad()},t.prototype.onDestroy=function(){for(var t=0,e=this.components;t<e.length;t++)e[t].onDestroy()},t.prototype.destroy=function(){this.ui&&(this.ui.dispose(),this.ui=null),this.onDestroy()},t.packageName="",t.compName="",t.features=[],t}();i.MiniGameUIBase=o,cc._RF.pop()},{}],MiniGameUIManager:[function(t,e,i){"use strict";cc._RF.push(e,"93625YsrMZPZqniH6Jf9BBU","MiniGameUIManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameUIManager=i.miniUI=i.addSubPackageUI=void 0;var o=__importDefault(t("../SubPackageManager")),n=t("../utils/SingleClass"),a=t("../utils/SubResourceUtils"),s=new Map;i.addSubPackageUI=function(t){return function(e){s.set(t,e)}},i.miniUI=function(t){return function(e){e.packageName=t.packageName,e.compName=t.compName,t.features&&(e.features=e.features.concat(t.features))}};var r=function(t){function e(){var e=t.call(this)||this;return e._uiArray=new Set,e._createPromise=null,e._asyncOperation=null,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this.getInst()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"miniGameRoot",{get:function(){return o.default.instance.miniGameAdapter.miniGameRoot||cc.find("Canvas/miniGameRoot")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fguiRoot",{get:function(){var t;return o.default.instance.miniGameAdapter.fguiRoot||(null===(t=cc.find("Canvas/GRoot"))||void 0===t?void 0:t.$gobj)},enumerable:!1,configurable:!0}),e.prototype.purge=function(){var t=e;t._instance&&(this.closeAllView(),t._instance=null)},e.prototype.exitGame=function(){this.purge()},e.prototype.gameRun=function(t,e){return __awaiter(this,void 0,Promise,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return e=e||this.fguiRoot,(i=s.get(t))?[4,this.addView(i,e)]:[2,!1];case 1:return[2,o.sent()]}})})},e.prototype.addView=function(t,e){return __awaiter(this,void 0,Promise,function(){var i,o,n,s,r,c,l,h;return __generator(this,function(u){switch(u.label){case 0:return e=e||this.fguiRoot,[4,a.SubResourceUtils.getInst().loadFGUI(t.packageName)];case 1:return u.sent()?[4,this._createInstance(!1,t.packageName,t.compName)]:[2,!1];case 2:i=u.sent(),this._createPromise=null,o=[],n=new Set,s=t;do{if(o=s.features)for(r=0,c=o;r<c.length;r++)l=c[r],n.add(l);s=Object.getPrototypeOf(s)}while(o);return(h=new t).ui=i,n.forEach(function(t){var e=new t;e.uiBase=h,h.components.push(e)}),[4,h.init()];case 3:return u.sent()?(e.addChild(i),i.setSize(e.width,e.height),i.center(),h.onLoad(),this._uiArray.add(h),[2,!0]):[2,!1]}})})},e.prototype._createInstance=function(t,e,i){var n=this;return this._createPromise?this._createPromise:(this._createPromise=new Promise(function(a){var s;if(t){var r=fgui.UIPackage.createObject(e,i).asCom;a(r)}else{var c=o.default.instance.miniGameAdapter.FguiAsyncClass(),l=n._asyncOperation=null!==(s=n._asyncOperation)&&void 0!==s?s:new c;l.callback=function(t){n._asyncOperation=null,a(t)},l.createObject(e,i)}}),this._createPromise)},e.prototype.closeView=function(t){this._uiArray.has(t)&&(t.destroy(),this._uiArray.delete(t))},e.prototype.closeAllView=function(){this._uiArray.forEach(function(t){t.destroy()}),this._uiArray.clear()},e.prototype.releaseUIBundle=function(t){var e=s.get(t);if(e){var i=e.packageName;a.SubResourceUtils.getInst().releaseBundle(i)}},e.prototype.releaseUIBundleCommon=function(){var t=e.uiBundleCommonName;a.SubResourceUtils.getInst().releaseBundle(t)},e.prototype.goToResult=function(){this.miniGameRoot.zIndex=1,o.default.instance.gotoResultWithLoading(!0,this.miniGameRoot)},e.prototype.sendEventToGame=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var a=o.default.instance.miniGameAdapter;(e=a.eventMgr).emit.apply(e,__spreadArrays([t],i))},e.uiBundleCommonName="mini_common",e}(n.SingleClass);i.MiniGameUIManager=r,cc._RF.pop()},{"../SubPackageManager":"SubPackageManager","../utils/SingleClass":"SingleClass","../utils/SubResourceUtils":"SubResourceUtils"}],P2ConvexUtil:[function(t,e,i){"use strict";cc._RF.push(e,"d7195sER89NIKLiIheaUYkE","P2ConvexUtil"),Object.defineProperty(i,"__esModule",{value:!0}),t("./p2.js");var o=function(){function t(){this.PTM_RATIO=15}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.createPolygonShape=function(t,e){void 0===e&&(e=cc.v2());var i=[];t.length>0&&t[0].equals(t[t.length-1])&&(t.length-=1);for(var o=this.convexPartition(t),n=0;n<o.length;n++){for(var a=o[n],s=[],r=0,c=a.length;r<c;r++){var l=a[r],h=l.x/this.PTM_RATIO,u=l.y/this.PTM_RATIO;s.push([h,u])}var d=new p2.Convex({vertices:s});i.push(d)}return i},t.prototype.convexPartition=function(t){this.ForceCounterClockWise(t);for(var e,i,o,n,a,s,r=[],c=cc.v2(),l=cc.v2(),h=0,u=0,d=0;d<t.length;++d)if(this.Reflex(d,t)){i=o=1e8;for(var p=0;p<t.length;++p)this.Left(this.At(d-1,t),this.At(d,t),this.At(p,t))&&this.RightOn(this.At(d-1,t),this.At(d,t),this.At(p-1,t))&&(n=this.LineIntersect(this.At(d-1,t),this.At(d,t),this.At(p,t),this.At(p-1,t)),this.Right(this.At(d+1,t),this.At(d,t),n)&&(e=this.SquareDist(this.At(d,t),n))<i&&(i=e,c=n,h=p)),this.Left(this.At(d+1,t),this.At(d,t),this.At(p+1,t))&&this.RightOn(this.At(d+1,t),this.At(d,t),this.At(p,t))&&(n=this.LineIntersect(this.At(d+1,t),this.At(d,t),this.At(p,t),this.At(p+1,t)),this.Left(this.At(d-1,t),this.At(d,t),n)&&(e=this.SquareDist(this.At(d,t),n))<o&&(o=e,u=p,l=n));if(h==(u+1)%t.length){var m=c.add(l).div(2);(a=this.Copy(d,u,t)).push(m),(s=this.Copy(h,d,t)).push(m)}else{for(var f=0,g=h;u<h;)u+=t.length;for(p=h;p<=u;++p)if(this.CanSee(d,p,t)){var _=1/(this.SquareDist(this.At(d,t),this.At(p,t))+1);this.Reflex(p,t)?this.RightOn(this.At(p-1,t),this.At(p,t),this.At(d,t))&&this.LeftOn(this.At(p+1,t),this.At(p,t),this.At(d,t))?_+=3:_+=2:_+=1,_>f&&(g=p,f=_)}a=this.Copy(d,g,t),s=this.Copy(g,d,t)}return(r=r.concat(this.convexPartition(a))).concat(this.convexPartition(s))}r.push(t);for(var y=r.length-1;y>=0;y--)0==r[y].length&&r.splice(y,0);return r},t.prototype.Reflex=function(t,e){return this.Right(t,e)},t.prototype.ForceCounterClockWise=function(t){this.IsCounterClockWise(t)||t.reverse()},t.prototype.IsCounterClockWise=function(t){return t.length<3||this.GetSignedArea(t)>0},t.prototype.GetSignedArea=function(t){var e,i=0;for(e=0;e<t.length;e++){var o=(e+1)%t.length;i+=t[e].x*t[o].y,i-=t[e].y*t[o].x}return i/2},t.prototype.Right=function(t,e,i){void 0===i&&(i=void 0);var o=t,n=e,a=i;if(void 0===i){var s=t,r=e;o=this.At(s-1,r),n=this.At(s,r),a=this.At(s+1,r)}return this.Area(o,n,a)<0},t.prototype.At=function(t,e){var i=e.length;return e[t<0?i- -t%i:t%i]},t.prototype.Area=function(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)},t.prototype.Left=function(t,e,i){return this.Area(t,e,i)>0},t.prototype.LeftOn=function(t,e,i){return this.Area(t,e,i)>=0},t.prototype.RightOn=function(t,e,i){return this.Area(t,e,i)<=0},t.prototype.LineIntersect=function(t,e,i,o){var n=cc.v2(),a=e.y-t.y,s=t.x-e.x,r=a*t.x+s*t.y,c=o.y-i.y,l=i.x-o.x,h=c*i.x+l*i.y,u=a*l-c*s;return this.FloatEquals(u,0)||(n.x=(l*r-s*h)/u,n.y=(a*h-c*r)/u),n},t.prototype.FloatEquals=function(t,e){return Math.abs(t-e)<=1e-6},t.prototype.SquareDist=function(t,e){var i=e.x-t.x,o=e.y-t.y;return i*i+o*o},t.prototype.Copy=function(t,e,i){for(var o=[];e<t;)e+=i.length;for(;t<=e;++t)o.push(this.At(t,i));return o},t.prototype.CanSee=function(t,e,i){if(this.Reflex(t,i)){if(this.LeftOn(this.At(t,i),this.At(t-1,i),this.At(e,i))&&this.RightOn(this.At(t,i),this.At(t+1,i),this.At(e,i)))return!1}else if(this.RightOn(this.At(t,i),this.At(t+1,i),this.At(e,i))||this.LeftOn(this.At(t,i),this.At(t-1,i),this.At(e,i)))return!1;if(this.Reflex(e,i)){if(this.LeftOn(this.At(e,i),this.At(e-1,i),this.At(t,i))&&this.RightOn(this.At(e,i),this.At(e+1,i),this.At(t,i)))return!1}else if(this.RightOn(this.At(e,i),this.At(e+1,i),this.At(t,i))||this.LeftOn(this.At(e,i),this.At(e-1,i),this.At(t,i)))return!1;for(var o=0;o<i.length;++o)if((o+1)%i.length!=t&&o!=t&&(o+1)%i.length!=e&&o!=e){var n=cc.v2();if(this.LineIntersect2(this.At(t,i),this.At(e,i),this.At(o,i),this.At(o+1,i),n))return!1}return!0},t.prototype.LineIntersect2=function(t,e,i,o,n){if(t==i||t==o||e==i||e==o)return!1;var a=t.x,s=t.y,r=e.x,c=e.y,l=i.x,h=i.y,u=o.x,d=o.y;if(Math.max(a,r)<Math.min(l,u)||Math.max(l,u)<Math.min(a,r))return!1;if(Math.max(s,c)<Math.min(h,d)||Math.max(h,d)<Math.min(s,c))return!1;var p=(u-l)*(s-h)-(d-h)*(a-l),m=(r-a)*(s-h)-(c-s)*(a-l),f=(d-h)*(r-a)-(u-l)*(c-s);return!(Math.abs(f)<1e-6)&&(m/=f,0<(p/=f)&&p<1&&0<m&&m<1&&(n.x=a+p*(r-a),n.y=s+p*(c-s),!0))},t._instance=null,t}();i.default=o,cc._RF.pop()},{"./p2.js":"p2"}],PaintWallMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"173bcEbxlBAX7r2MB6ELFpq","PaintWallMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=cc._decorator,s=a.ccclass,r=a.property;(function(t){t[t.None=0]="None",t[t.Yellow=1]="Yellow",t[t.Blue=2]="Blue"})(o||(o={}));var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.yellowChessFrame=null,e.blueChessFrame=null,e.yellowPainterFrame=null,e.bluePainterFrame=null,e.gridSize=new cc.Size(50,50),e.trueIconFrame=null,e.maxLevel=8,e.targetChessNodes=[],e.chessNodes=[],e.data1=[],e.data2=[],e.levelRandomData=[],e.levelRandomDataLength=10,e.levelData1=e.data1,e.levelData2=e.data2,e.mapData=[],e.rows=8,e.cols=8,e.level=0,e.checkAnsNum=0,e.chessBoardSize=250,e}return __extends(e,t),e.prototype.onClickExit=function(){n.default.instance.getModel().gameExit()},e.prototype.onDisable=function(){this._clear(this.chessNodes),this._clear(this.targetChessNodes)},e.prototype.start=function(){this.levelData1=this.data1,this.levelData2=this.data2,this._startLevel(++this.level)},e.prototype._clear=function(t){for(;t.length;)for(var e=t.shift();e.length;){var i=e.shift();i&&(i.hasEventListener("touchstart")&&i.off("touchstart"),i.destroy())}},e.prototype._randomNumber=function(){return Math.floor(1111111*Math.random())},e.prototype._createRandomLevel=function(){var t=[],e=[];this.levelRandomData=[];for(var i=0;i<2*this.levelRandomDataLength;i++)t.push(i>=this.levelRandomDataLength?2:1);for(i=0;i<this.levelRandomDataLength;i++){for(var o=[],n=0;n<this.levelRandomDataLength;n++)o.push(1);e.push(o)}for(i=0;i<100;i++){var a=this._randomNumber()%this.levelRandomDataLength;if(i%2==0)for(var s=0;s<this.levelRandomDataLength;s++)e[a][s]=t[a];else for(var r=0;r<this.levelRandomDataLength;r++)e[r][a]=t[a+this.levelRandomDataLength]}for(i=0;i<this.levelRandomDataLength;i++){var c=0;for(n=0;n<this.levelRandomDataLength;n++)c=10*c+e[i][n];c=10*c+t[i],this.levelRandomData.push(c)}var l=0;for(i=0;i<this.levelRandomDataLength;i++)l=10*l+t[this.levelRandomDataLength+i];this.levelRandomData.push(l)},e.prototype._startLevel=function(t){if(t==this.maxLevel)return this.node.pauseSystemEvents(!0),void n.default.instance.gotoResultWithLoading(!0,this.node.parent);this._clear(this.chessNodes),this._clear(this.targetChessNodes),this.checkAnsNum=0,console.log("clear check"),1==t?this.mapData=this.levelData1:2==t?this.mapData=this.levelData2:t<8&&(this.levelRandomDataLength=t,this._createRandomLevel(),this.mapData=this.levelRandomData),this.cols=this.rows=this.mapData.length-1,1!=this.mapData.length&&(this.gridSize.width=this.chessBoardSize/this.mapData.length),this.gridSize.height=this.gridSize.width,this._createTargetBoard(),this.gridSize.height*=2,this.gridSize.width=this.gridSize.height,this._createChessBoard()},e.prototype._reverseInt=function(t){var e=t.toString().split("");return e.reverse(),parseInt(e.join(""))},e.prototype._checkAns=function(){var t=this;if(this.checkAnsNum--,console.log(this.checkAnsNum),0==this.checkAnsNum){for(var e=0;e<this.rows;e++)for(var i=0;i<this.cols;i++)if(this.targetChessNodes[e][i].colorId!=this.chessNodes[e][i].colorId)return void console.log("wrong");var o=new cc.Vec2(25,-150),n=this._createGridNodeWithSprite();n.parent=this.node,n.setPosition(o);var a=n.sprite;this.trueIconFrame&&(a.spriteFrame=this.trueIconFrame),a.sizeMode=cc.Sprite.SizeMode.CUSTOM,n.setContentSize(this.cols*this.gridSize.width,this.cols*this.gridSize.width*.7),cc.tween(n).to(.1,{scale:1.5}).to(.1,{scale:.8}).to(.1,{scale:1.2}).to(.1,{scale:.9}).to(.6,{scale:1}).call(function(){t._startLevel(++t.level),n.destroy()}).start()}},e.prototype._createGridNodeWithSprite=function(t){void 0===t&&(t=null);var e=new cc.Node;return e.i=0,e.j=0,e.colorId=o.None,null==t&&(e.sprite=e.addComponent(cc.Sprite)),e},e.prototype._createChessNode=function(){var t=this._createGridNodeWithSprite();return t.sprite.sizeMode=cc.Sprite.SizeMode.CUSTOM,t.parent=this.node,t},e.prototype._createTargetBoard=function(){for(var t=this.rows,e=t,i=new cc.Vec2(-e*this.gridSize.width/2,-t*this.gridSize.height/2-300),o=0;o<=t;o++)if(o!=t){var n=[],a=this.mapData[o];a=this._reverseInt(a);for(var s=0;s<=e&&s!=e;s++){var r=this._createChessNode();this._updateColor(r,a%10),r.setContentSize(this.gridSize.width,this.gridSize.height);var c=i.x+s*this.gridSize.width+this.gridSize.width/2,l=-i.y-o*this.gridSize.height-this.gridSize.height/2;r.setPosition(c,l),n.push(r),a/=10}this.targetChessNodes.push(n)}},e.prototype._createChessBoard=function(){for(var t=this,e=this.rows,i=this.cols,o=new cc.Vec2(-i*this.gridSize.width/2,-e*this.gridSize.height/2+150),n=function(n){var s=[],r=a.mapData[n];r=a._reverseInt(r);for(var c=function(c){if(n==e&&c==i)return"continue";var l=a._createChessNode();l.i=n==e?-1:n,l.j=c==i?-1:c,a._updateColor(l,1),l.setContentSize(a.gridSize.width,a.gridSize.height);var h=o.x+c*a.gridSize.width+a.gridSize.width/2,u=-o.y-n*a.gridSize.height-a.gridSize.height/2;l.setPosition(h,u),s.push(l),n!=e&&c!=i||(a._updateColor(l,r%10),l.on("touchstart",function(o){var a=o.currentTarget,s=cc.tween().target(a);if(s=s.then(cc.tween().target(a).call(function(){return a.pauseSystemEvents(!0)})),t.checkAnsNum++,console.log(t.checkAnsNum),n==e)for(var r=function(e){var i=t.chessNodes[e][c];i.color=cc.color(i.color.r/2,i.color.g/2,i.color.b/2),s=s.then(cc.tween().target(a).to(.1,{position:i.position}).call(function(){return t._updateColor(i,a.colorId)}))},l=e-1;l>=0;l--)r(l);if(c==i){var d=function(e){var i=t.chessNodes[n][e];i.color=cc.color(i.color.r/2,i.color.g/2,i.color.b/2),s=s.then(cc.tween().target(a).to(.1,{position:i.position}).call(function(){return t._updateColor(i,a.colorId)}))};for(l=i-1;l>=0;l--)d(l)}(s=s.then(cc.tween().target(a).to(.1,{position:new cc.Vec3(h,u,0)}).call(function(){a.resumeSystemEvents(!0)}))).delay(.2).call(function(){t._checkAns()}).start()})),r/=10},l=0;l<=e;l++)c(l);a.chessNodes.push(s)},a=this,s=0;s<=e;s++)n(s)},e.prototype._updateColor=function(t,e){e=Math.floor(e),t.colorId=e,e==o.Yellow&&(t.color=cc.Color.WHITE,-1!=t.i&&-1!=t.j||!this.yellowPainterFrame?this.yellowChessFrame&&(t.color=cc.Color.YELLOW,t.sprite.spriteFrame=this.yellowChessFrame):t.sprite.spriteFrame=this.yellowPainterFrame),e==o.Blue&&(t.color=cc.Color.WHITE,-1!=t.i&&-1!=t.j||!this.bluePainterFrame?this.blueChessFrame&&(t.color=cc.Color.CYAN,t.sprite.spriteFrame=this.blueChessFrame):t.sprite.spriteFrame=this.bluePainterFrame)},__decorate([r(cc.SpriteFrame)],e.prototype,"yellowChessFrame",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"blueChessFrame",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"yellowPainterFrame",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"bluePainterFrame",void 0),__decorate([r(cc.Size)],e.prototype,"gridSize",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"trueIconFrame",void 0),__decorate([r()],e.prototype,"maxLevel",void 0),__decorate([r([cc.Integer])],e.prototype,"data1",void 0),__decorate([r([cc.Integer])],e.prototype,"data2",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],PaintWallModel:[function(t,e,i){"use strict";cc._RF.push(e,"d88e74Des1M273dE5W57zGR","PaintWallModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/paintWall/paintWallMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.paintWall)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],ParkourBattleWindow:[function(t,e,i){"use strict";cc._RF.push(e,"e7046FLM1hP85CvjpAHKS+U","ParkourBattleWindow"),Object.defineProperty(i,"__esModule",{value:!0}),i.ParkourBattleWindow=void 0;var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("./ParkourModel"),a=t("./ParkourNodeExtra"),s=t("./ParkourSelectIndex"),r=t("../../miniGamePackage/utils/SubSwitchAni"),c=t("./ParkourOpenBox"),l=cc._decorator,h=l.ccclass,u=l.property,d=function(t){function e(){var e=t.call(this)||this;return e.sksks=[],e.muli1=1/2.4,e.leftInitNodeX=-525,e.leftInitNodeY=-500,e.leftInit2NodeX=-430,e.muli2=.8,e.maxCount=12,e.leftList=[],e.rightList=[],e.flagLeftList={},e.flagRightList={},e.actorList={},e.toYSpeedList=[],e.toXSpeedList=[],e.toScaleSpeedList=[],e.initX=0,e.initY=0,e.initScale=0,e.flagPool=[],e.actorListPool=[],e._curTime=0,e._curDistance=0,e.roleNum=1,e.whileRoleNum=1,e.dtRoleNum=0,e.aniTimeScale=1,e.readyTimeScale=!1,e.slowTimeScale=.1,e.isFinish=!1,e.state=n.ParkourState.Wait,e.attackMuli=1,e.mSPoint=new cc.Vec2(-1,-1),e.isMove=!1,e._mulitMoveSpeed=.7,e._mulitTitleMoveSpeed=.5,e._maxDtTime=50,e._randomHeroList=[],e.m_btnReturn=null,e.m_btnTime=null,e.m_stopBtn=null,e.m_roleNode=null,e.m_ship=null,e.m_world=null,e.m_flagItem=null,e.roleNodePrefab=null,e.m_rotateNode=null,e.m_titleImg=null,e.m_topAniNode=null,e.timeCountNode=null,e.box=null,e.hand=null,e._lastUpdateTime=0,e._pause=!1,i.gameInstance=e,e}var i;return __extends(e,t),i=e,e.prototype.start=function(){var t=this;this.m_btnReturn.on(cc.Node.EventType.TOUCH_END,function(){return t._model.gameExit()},this),this.m_stopBtn.on(cc.Node.EventType.TOUCH_END,this.stopRotate,this)},e.prototype.initRole=function(t,e){void 0===e&&(e=1);for(var i=this.m_ship.getChildByName("ship0"),o=function(e){var o=n.m_ship.children[e];if(o.getComponent(r.SubSwitchAni).aniList=i.getComponent(r.SubSwitchAni).aniList,void 0!==t){var a=o.getChildByName("topNode");a.active=!0,0==t||5==t?o.getComponent(r.SubSwitchAni).switchAni(t,"animation"):o.getComponent(r.SubSwitchAni).switchAni(t,"run");var s=a.getComponentInChildren(sp.Skeleton);s.setAnimation(0,"animation",!1),s.setCompleteListener(function(){a.active=!1})}},n=this,a=0;a<this.m_ship.childrenCount;a++)o(a);e>=1&&(this.attackMuli=e),this.m_roleNode.getComponent(s.ParkourSelectIndex).selectIndex(1),this.setWaveState(!0)},e.prototype.setWaveState=function(t){void 0===t&&(t=!0);for(var e=0;e<this.m_ship.childrenCount;e++)this.m_ship.children[e].getChildByName("wave").active=t},e.prototype.changTimeScale=function(){this.aniTimeScale=1==this.aniTimeScale?this.slowTimeScale:1},e.prototype.onEnable=function(){var t=this;i.gameInstance=this,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),cc.game.on(cc.game.EVENT_SHOW,this.wxOnShow,this),cc.game.on(cc.game.EVENT_HIDE,this.wxOnHide,this),this._model=o.default.instance.getModel(),this._lastUpdateTime,(new Date).getTime(),this._curTime=this._model.speedTime,this._curDistance=0,this._randomHeroList=this._model.changeHeroConf.concat(),this.initNode(),this.initFlag(),this.initActor(),this.m_roleNode.active=!1,this._pause=!0;var e=this._model.heroConf[this.randomHero(!0)];(new c.ParkourOpenBox).openBox(this.box,e).then(function(){t.box.active=!1,t.hand.active=!1,t.m_roleNode.active=!0,t._pause=!1,t.initRole(e.linkIndex),t.refreshRole(),t.setWaveState(!1),t.isFinish=!0,t.startGame()})},e.prototype.startGame=function(){var t=this;this.timeCountNode.active=!0;var e=this.timeCountNode;e.active=!0;var i=e.getComponentInChildren(sp.Skeleton);i.setAnimation(0,"animation",!1),i.setCompleteListener(function(){e.active=!1,t.isFinish=!1;var i=(new Date).getTime();t._lastUpdateTime=i,t.setWaveState(!0)}),this.m_topAniNode.active=!1,this.m_rotateNode.active=!1},e.prototype.onDisable=function(){i.gameInstance=null,this.clearMusic(),this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),cc.game.off(cc.game.EVENT_SHOW,this.wxOnShow,this),cc.game.off(cc.game.EVENT_HIDE,this.wxOnHide,this),this.clear()},e.prototype.clearMusic=function(){cc.audioEngine.uncacheAll()},e.prototype.update=function(t){if(!this._pause){var e=1e3*t;e>this._maxDtTime&&(e=this._maxDtTime);var i=e*this.aniTimeScale;if(this.state==n.ParkourState.FightingBoss)return this.refreshBossNum(i/Math.sqrt(this.aniTimeScale)),void this.refreshBossActor();this.isFinish||this._curTime>this._model.maxTime||this.leftList.length<=0||(this._curTime>=this._model.speedTime?(this.state=n.ParkourState.Running,this.resetLastNode(),this.resetActor(),this.resetFlag(),this.initFlag(),this.initActor(),this.refreshRole()):this.readyTimeScale&&this._curTime+this._model.fightingTims>=this._model.speedTime&&(this.state=n.ParkourState.Fighting,this.aniTimeScale=this.slowTimeScale,this.setWhileRoleWithActorCount(!0)),this.refreshNode(i),this.refreshFlag(),this.refreshRoleNum(i/Math.sqrt(this.aniTimeScale)),this.refreshActor(),this._curTime+=i)}},e.prototype.initNode=function(){for(var t=0;t<this.maxCount;t++)this.leftList.push(this.m_world.getChildByName("leftNode"+t)),this.rightList.push(this.m_world.getChildByName("rightNode"+t));var e=0,i=0;for(t=0;t<this.maxCount;t++){var o=Math.pow(this.muli2,t),n=(this.leftInit2NodeX-this.leftInitNodeX)*(1-o)/(1-this.muli2),a=this.leftInitNodeX+n,s=n/this.muli1,r=this.leftInitNodeY+s,c=this.leftList[t];c.x=a,c.y=r,c.scaleX=o,c.scaleY=o;var l=this.rightList[t];l.x=-a,l.y=r,l.scaleX=-o,l.scaleY=o,t>0&&this.toYSpeedList.push((i-r)/this._model.speedTime),t>0&&this.toXSpeedList.push((a-e)/this._model.speedTime),t>0&&this.toScaleSpeedList.push((o/this.muli2-o)/this._model.speedTime),e=a,i=r}this.initX=this.leftList[this.leftList.length-1].x,this.initY=this.leftList[this.leftList.length-1].y,this.initScale=this.leftList[this.leftList.length-1].scaleX},e.prototype.initFlag=function(){for(var t=0;t<this.maxCount;t++){var e=this._curDistance+t,i=this._model.flagConfig[e];if(i){if(i.left&&!this.flagLeftList[e]){var o=i.left.type,n=i.left.type+i.left.count;"up"===o?n="\u5347\u9636":"change"===o&&(n="\u53d8\u5f02"),(c=null==(r=this.getPoolNode(this.m_flagItem,this.flagPool))?void 0:r.getComponent(a.ParkourNodeExtra)).setExtra("conf",i.left),c.setExtra("FollowNode",this.leftList[t]),this.m_world.addChild(r,this.leftList[t].zIndex),r.getComponent(s.ParkourSelectIndex).selectIndex(i.left.controll),r.getChildByName("kNumber").getComponent(cc.Label).string=n,r.active=!0,this.flagLeftList[e]=r}var r,c;if(i.right&&!this.flagRightList[e])o=i.right.type,n=i.right.type+i.right.count,"up"===o?n="\u5347\u9636":"change"===o&&(n="\u53d8\u5f02"),(c=null==(r=this.getPoolNode(this.m_flagItem,this.flagPool))?void 0:r.getComponent(a.ParkourNodeExtra)).setExtra("conf",i.right),c.setExtra("FollowNode",this.rightList[t]),this.m_world.addChild(r,this.leftList[t].zIndex),r.getComponent(s.ParkourSelectIndex).selectIndex(i.right.controll),r.getChildByName("kNumber").getComponent(cc.Label).string=n,r.active=!0,this.flagRightList[e]=r}}this.refreshFlag()},e.prototype.initActor=function(){for(var t=0;t<this.maxCount;t++){var e=this._curDistance+t,i=this._model.flagConfig[e];if(i&&(i.middle&&this.actorList[e]&&0==t&&(this.readyTimeScale=!0),i.middle&&!this.actorList[e])){var o=this.getPoolNode(this.roleNodePrefab,this.actorListPool),n=o.getChildByName("m_ship"),c=o.getChildByName("m_tips"),l=Math.min(i.middle.count,n.childrenCount),h=null==o?void 0:o.getComponent(a.ParkourNodeExtra),u=!1;i.middle.type.indexOf("boss")>-1&&(l=1,u=!0),h.setExtra("conf",i.middle),h.setExtra("FollowNode",this.leftList[t]),h.setExtra("isBoss",u),o.position.x=0,c.y=681+(i.middle.scale||0)/1*100,this.m_world.addChild(o,this.leftList[t].getSiblingIndex());for(var d=0;d<n.childrenCount;d++){n.children[d].active=d<l;var p=n.children[d];p.getComponent(r.SubSwitchAni).switchAni(parseInt(u?i.middle.type.split("_")[1]:i.middle.type),"run"),p.scaleX=u&&i.middle.scale>0?i.middle.scale:1,p.scaleY=u&&i.middle.scale>0?i.middle.scale:1,p.getChildByName("wave").active=!u}c.getChildByName("roleNum").getComponent(cc.Label).string=i.middle.count+"",c.getChildByName("bossBloodNode").getChildByName("bossBlood").getComponent(cc.Label).string="100%",c.getChildByName("bossBloodNode").getChildByName("bloodPro").width=295,c.active=!0,o.scaleX=-1,this.actorList[e]=o,o.getComponent(s.ParkourSelectIndex).selectIndex(u?2:0)}}this.refreshActor()},e.prototype.getPoolNode=function(t,e){return e.length<=0?cc.instantiate(t):e.pop()},e.prototype.resetLastNode=function(){var t=this.leftList[0];this.leftList.push(t),this.leftList.splice(0,1),t.x=this.initX,t.y=this.initY,t.scaleX=this.initScale,t.scaleY=this.initScale,t.active=!0,t.opacity=0,t=this.rightList[0],this.rightList.push(t),this.rightList.splice(0,1),t.x=-this.initX,t.y=this.initY,t.scaleX=-this.initScale,t.scaleY=this.initScale,t.active=!0,t.opacity=0,this._curTime=0},e.prototype.resetFlag=function(){var t=this.flagLeftList[this._curDistance];if(t){var e=t.getComponent(a.ParkourNodeExtra);this.checkRoleCount(!0,e.getExtra("conf")),t.active=!1,t.removeFromParent(),e.setExtra("FollowNode",null),this.flagPool.push(t),delete this.flagLeftList[this._curDistance]}(t=this.flagRightList[this._curDistance])&&(e=t.getComponent(a.ParkourNodeExtra),this.checkRoleCount(!1,e.getExtra("conf")),t.active=!1,t.removeFromParent(),e.setExtra("FollowNode",null),this.flagPool.push(t),delete this.flagRightList[this._curDistance]),this._curDistance+=1},e.prototype.resetActor=function(){var t=this.actorList[this._curDistance];if(t){var e=t.getComponent(a.ParkourNodeExtra);this.checkRoleWithActorCount(e.getExtra("conf")),t.active=!1,t.removeFromParent(),e.setExtra("FollowNode",null),this.actorListPool.push(t),delete this.actorList[this._curDistance],this.aniTimeScale=1,this.readyTimeScale=!1,t.getChildByName("topAni").active=!1}},e.prototype.refreshNode=function(t){for(var e=0;e<this.toXSpeedList.length;e++){var i=this.leftList[e],o=this.rightList[e],n=this.toXSpeedList[e],a=this.toYSpeedList[e],s=this.toScaleSpeedList[e];i.x-=n*t,o.x+=n*t,i.y+=a*t,o.y+=a*t,i.scaleX+=s*t,i.scaleY+=s*t,o.scaleX-=s*t,o.scaleY+=s*t,i.opacity=1530*i.scaleY,o.opacity=1530*o.scaleY}},e.prototype.refreshFlag=function(){var t=null,e=null,i=null;for(var o in this.flagLeftList)e=(t=this.flagLeftList[o]).getComponent(a.ParkourNodeExtra).getExtra("FollowNode"),t.y=e.y,i=.8*(0-e.x)/t.width,t.scaleX=i,t.scaleY=i,t.x=-t.width*i/2,t.opacity=e.opacity,t.active=!0;for(var o in this.flagRightList)i=.8*((e=(t=this.flagRightList[o]).getComponent(a.ParkourNodeExtra).getExtra("FollowNode")).x-0)/t.width,t.y=e.y,t.scaleX=i,t.scaleY=i,t.x=t.width*i/2,t.opacity=e.opacity,t.active=!0},e.prototype.refreshActor=function(){var t,e=null,i=null;for(var o in this.actorList){var s=(t=this.actorList[o]).getComponent(a.ParkourNodeExtra);if(e=s.getExtra("FollowNode"),t.x=0,t.y=e.y,i=e.scaleY,t.scaleX=i,t.scaleY=i,t.opacity=e.opacity,t.active=!0,this.state==n.ParkourState.Fighting&&o==this._curDistance.toString()){for(var r=s.getExtra("conf"),c=Math.max(r.count+Math.ceil(this.dtRoleNum*this.attackMuli),0),l=t.getChildByName("m_ship"),h=Math.min(c,l.childrenCount),u=0;u<l.childrenCount;u++)l.children[u].active=u<h;t.getChildByName("m_tips").getChildByName("roleNum").getComponent(cc.Label).string=c+""}}},e.prototype.refreshBossActor=function(){var t;for(var e in this.actorList)if(this.actorList[e].getComponent(a.ParkourNodeExtra).getExtra("isBoss")){t=this.actorList[e];break}if(this.state==n.ParkourState.FightingBoss){var i=t.getComponent(a.ParkourNodeExtra).getExtra("conf"),o=Math.max(i.count+Math.ceil(this.dtRoleNum*this.attackMuli),0),s=t.getChildByName("m_tips");s.getChildByName("roleNum").getComponent(cc.Label).string=o+"",s.getChildByName("bossBloodNode").getChildByName("bossBlood").getComponent(cc.Label).string=o+"%",s.getChildByName("bossBloodNode").getChildByName("bloodPro").width=o/i.count*295}},e.prototype.refreshRole=function(t){void 0===t&&(t=!1);for(var e=this.roleNum+(this.whileRoleNum>=this.roleNum?Math.floor(this.dtRoleNum):Math.ceil(this.dtRoleNum)),i=this.m_roleNode.getChildByName("m_ship"),o=Math.min(this.whileRoleNum>=this.roleNum?this.whileRoleNum:e,i.childrenCount),n=this.m_roleNode.getChildByName("m_tips"),a=function(e){var n=i.children[e];if(n.active=e<o,t&&e<o){var a=n.getChildByName("topNode");a.active=!0;var s=a.getComponentInChildren(sp.Skeleton);s.setAnimation(0,"animation",!1),s.setCompleteListener(function(){a.active=!1})}},s=0;s<i.childrenCount;s++)a(s);if(n.getChildByName("roleNum").getComponent(cc.Label).string=e+"",n.active=e>0,t){this.m_roleNode.setScale(1),this.m_roleNode.stopAllActions();var r=cc.scaleTo(.1,1.1),c=cc.scaleTo(.1,1),l=cc.sequence(r,c);this.m_roleNode.runAction(l)}e<=0&&(this.isFinish=!0,this.toResult(!1))},e.prototype.refreshRoleNum=function(t){if(this.whileRoleNum!=this.roleNum){var e=this.whileRoleNum>=this.roleNum;if(e&&this.roleNum+this.dtRoleNum>=this.whileRoleNum||!e&&this.roleNum+this.dtRoleNum<=this.whileRoleNum)this.settlementFightingWin();else{var i=e?Math.floor(this.dtRoleNum):Math.ceil(this.dtRoleNum);this.dtRoleNum+=(this.whileRoleNum-this.roleNum)*t/(3*this._model.fightingTims),(e?Math.floor(this.dtRoleNum):Math.ceil(this.dtRoleNum))!=i&&this.refreshRole()}}},e.prototype.refreshBossNum=function(t){if(this.whileRoleNum!=this.roleNum){var e=this.whileRoleNum>=this.roleNum;if(e&&this.roleNum+this.dtRoleNum>=this.whileRoleNum||!e&&this.roleNum+this.dtRoleNum<=this.whileRoleNum)this.toResult(!0);else{var i=e?Math.floor(this.dtRoleNum):Math.ceil(this.dtRoleNum);this.dtRoleNum+=(this.whileRoleNum-this.roleNum)*t/(5*this._model.fightingTims),(e?Math.floor(this.dtRoleNum):Math.ceil(this.dtRoleNum))!=i&&this.refreshRole()}}},e.prototype.settlementFightingWin=function(){this.roleNum=this.whileRoleNum,this.dtRoleNum=0,this.aniTimeScale=1,this.readyTimeScale=!1;var t=this.actorList[this._curDistance];if(t){for(var e=t.getChildByName("m_ship"),i=t.getChildByName("m_tips"),o=0;o<e.childrenCount;o++)e.children[o].active=!1;i.getChildByName("roleNum").getComponent(cc.Label).string="0",i.active=!1,i.getChildByName("bossBloodNode").getChildByName("bossBlood").getComponent(cc.Label).string="0%",i.getChildByName("bossBloodNode").getChildByName("bloodPro").width=0}this.refreshRole(),this.state=n.ParkourState.Running},e.prototype.randomHero=function(t){if(void 0===t&&(t=!1),t){var e=this._model.initHeroConf,i=e[n=Math.floor(Math.random()*e.length)],o=this._randomHeroList.indexOf(i);return o>=0&&this._randomHeroList.splice(o,1),i}var n,a=this._randomHeroList;return i=a[n=Math.floor(Math.random()*a.length)],a.splice(n,1),i},e.prototype.checkRoleCount=function(t,e){if(t&&this.m_roleNode.x<0||!t&&this.m_roleNode.x>=0){var i=!1;switch(e.type){case"begin":this.isFinish=!1;break;case"end":this.isFinish=!0,this.beginRotate();break;case"up":this.initRole(e.count,1.5);break;case"change":if(0===this._randomHeroList.length)this.initRole(e.count,1.5);else{var o=this.randomHero();this.initRole(o,1.5)}break;case"+":this.whileRoleNum+=e.count,i=!0;break;case"-":this.whileRoleNum=Math.max(this.whileRoleNum-e.count,1);break;case"x":this.whileRoleNum*=e.count,i=!0;break;case"\xf7":this.whileRoleNum=Math.max(Math.ceil(this.whileRoleNum/e.count),1)}this.refreshRole(i)}},e.prototype.checkRoleWithActorCount=function(){this.roleNum=this.whileRoleNum,this.dtRoleNum=0,this.refreshRole()},e.prototype.setWhileRoleWithActorCount=function(t){if(void 0===t&&(t=!1),this.whileRoleNum==this.roleNum){var e=this.actorList[this._curDistance];if(e){var i=e.getComponent(a.ParkourNodeExtra).getExtra("conf");if(this.whileRoleNum=Math.max(this.whileRoleNum-Math.ceil(i.count/this.attackMuli),0),t){var o=e.getChildByName("topAni");o.active=!0,o.getComponentInChildren(sp.Skeleton).setAnimation(0,"animation",!0)}}}},e.prototype.beginRotate=function(){this.m_rotateNode.active=!0;var t=0,e=0;for(var i in this._model.rotateConf)(this._model.rotateConf[i].min<t||0==t)&&(t=this._model.rotateConf[i].min),(this._model.rotateConf[i].max>e||0==e)&&(e=this._model.rotateConf[i].max);this.m_rotateNode.getChildByName("m_top").getChildByName("m_control").rotation=t,this.rotateTween(t,e)},e.prototype.rotateTween=function(t,e){var i=this,o=cc.rotateTo(.75,e),n=cc.rotateTo(.75,t),a=cc.sequence(o,n,cc.callFunc(function(){i.rotateTween(t,e)}));this.m_rotateNode.getChildByName("m_top").getChildByName("m_control").runAction(a)},e.prototype.stopRotate=function(){var t=this,e=this.m_rotateNode.getChildByName("m_top"),i=this.m_rotateNode.getChildByName("m_top").getChildByName("m_control");i.stopAllActions();var o=i.angle,n="5";for(var a in this._model.rotateConf)if(this._model.rotateConf[a].min<=o&&this._model.rotateConf[a].max>o){n=a;break}e.stopAllActions();var s=e.getChildByName("rotate_"+n);if(s){var r=cc.scaleTo(.1,1.1),c=cc.scaleTo(.1,1),l=cc.sequence(r,c,cc.callFunc(function(){t.gotoFightBoss(n)}));s.runAction(l)}else this.gotoFightBoss(n)},e.prototype.gotoFightBoss=function(t){var e=this;if("\u795e\u5668"==t){this.m_topAniNode.active=!0;var i=this.m_topAniNode.getComponentInChildren(sp.Skeleton);i.setAnimation(0,"animation",!1),i.setCompleteListener(function(){e.initRole(2,2),e.refreshRole(!1),e.moveToFightPos()})}else this.whileRoleNum+=parseInt(t),this.checkRoleWithActorCount(void 0),this.refreshRole(!0),this.moveToFightPos();this.m_rotateNode.active=!1},e.prototype.moveToFightPos=function(){var t,e=this;for(var i in this.actorList)if(this.actorList[i].getComponent(a.ParkourNodeExtra).getExtra("isBoss")){t=this.actorList[i],this._curDistance=parseInt(i);break}this.aniTimeScale=this.slowTimeScale,this.m_roleNode.stopAllActions();var o=cc.scaleTo(.5,1.05),s=cc.moveTo(.5,cc.v2(0,-420)),r=cc.spawn(o,s),c=cc.moveTo(5*this._model.fightingTims/this.aniTimeScale/1e3,cc.v2(0,-320)),l=cc.sequence(r,cc.callFunc(function(){e.m_roleNode.runAction(c),e.state=n.ParkourState.FightingBoss,e.setWhileRoleWithActorCount();var i=t.getChildByName("topAni");i.active=!0,i.getComponentInChildren(sp.Skeleton).setAnimation(0,"animation",!0)}));this.m_roleNode.runAction(l)},e.prototype.clear=function(){this.toYSpeedList=[],this.toXSpeedList=[],this.toScaleSpeedList=[],this.leftList=[],this.rightList=[],this.actorList={},this.flagLeftList={},this.flagRightList={},this.m_world.x=0,this.m_titleImg.x=0,this.roleNum=1,this.whileRoleNum=1,this.dtRoleNum=0,this.isFinish=!1,this.state=n.ParkourState.Wait,this.aniTimeScale=1,this.readyTimeScale=!1,this.m_rotateNode.stopAllActions(),this.m_rotateNode.active=!1,this.timeCountNode.active=!1,this._pause=!1,this.attackMuli=1},e.prototype.onTouchBegin=function(t){this.isMove=!0,this.mSPoint.set(cc.v2(t.getLocationX(),t.getLocationY()))},e.prototype.onTouchMove=function(t){if(this.isMove&&!this.isFinish&&!this._pause){var e=(this.mSPoint.x-t.getLocationX())*this._mulitMoveSpeed,i=this.m_roleNode.x-e;this.m_titleImg.x,Math.pow(this.muli2,2*this.maxCount),i>150||i<-150||(this.m_roleNode.x=i,this.mSPoint.set(cc.v2(t.getLocationX(),t.getLocationY())))}},e.prototype.onTouchEnd=function(){this.mSPoint.set(cc.v2(-1,-1)),this.isMove=!1},e.prototype.toResult=function(t){for(var e in t?console.error("\u80dc\u5229\u4e86"):(console.error("\u5931\u8d25\u4e86"),this.m_topAniNode.active=!1,o.default.instance.gotoResultWithLoading(!1,this.node.parent)),this.clearMusic(),this.actorList){var i=this.actorList[e];i.stopAllActions(),i.getChildByName("m_ship").active=!1,i.getChildByName("m_tips").active=!1,t&&i.getComponent(a.ParkourNodeExtra).getExtra("isBoss")&&(i.getChildByName("topAni").active=!1,o.default.instance.gotoResultWithLoading(!0,this.node.parent))}this.m_roleNode.stopAllActions(),this.state=n.ParkourState.Finish},e.prototype.wxOnHide=function(){this._pause=!0},e.prototype.wxOnShow=function(){this._pause=!1},e.gameInstance=null,__decorate([u(sp.SkeletonData)],e.prototype,"sksks",void 0),__decorate([u(cc.Node)],e.prototype,"m_btnReturn",void 0),__decorate([u(cc.Node)],e.prototype,"m_btnTime",void 0),__decorate([u(cc.Node)],e.prototype,"m_stopBtn",void 0),__decorate([u(cc.Node)],e.prototype,"m_roleNode",void 0),__decorate([u(cc.Node)],e.prototype,"m_ship",void 0),__decorate([u(cc.Node)],e.prototype,"m_world",void 0),__decorate([u(cc.Prefab)],e.prototype,"m_flagItem",void 0),__decorate([u(cc.Prefab)],e.prototype,"roleNodePrefab",void 0),__decorate([u(cc.Node)],e.prototype,"m_rotateNode",void 0),__decorate([u(cc.Node)],e.prototype,"m_titleImg",void 0),__decorate([u(cc.Node)],e.prototype,"m_topAniNode",void 0),__decorate([u(cc.Node)],e.prototype,"timeCountNode",void 0),__decorate([u(cc.Node)],e.prototype,"box",void 0),__decorate([u(cc.Node)],e.prototype,"hand",void 0),i=__decorate([h],e)}(cc.Component);i.ParkourBattleWindow=d,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/utils/SubSwitchAni":"SubSwitchAni","./ParkourModel":"ParkourModel","./ParkourNodeExtra":"ParkourNodeExtra","./ParkourOpenBox":"ParkourOpenBox","./ParkourSelectIndex":"ParkourSelectIndex"}],ParkourModel:[function(t,e,i){"use strict";cc._RF.push(e,"9c088ghZrlIEp8QwjvAK5kf","ParkourModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.ParkourModel=i.ParkourState=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame");(function(t){t[t.Wait=0]="Wait",t[t.Running=1]="Running",t[t.Fighting=2]="Fighting",t[t.FightingBoss=3]="FightingBoss",t[t.Finish=4]="Finish"})(i.ParkourState||(i.ParkourState={}));var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speedTime=500,e.fightingTims=200,e.maxTime=25e3,e.flagConfig={1:{left:{type:"begin",count:0,controll:2},right:{type:"begin",count:0,controll:5}},5:{left:{type:"x",count:2,controll:0},right:{type:"+",count:10,controll:1}},10:{left:{type:"-",count:5,controll:0},right:{type:"+",count:5,controll:1}},15:{left:{type:"\xf7",count:2,controll:1},right:{type:"+",count:5,controll:0}},20:{middle:{type:"6",count:5,controll:0}},25:{left:{type:"+",count:20,controll:1},right:{type:"change",count:7,controll:3}},30:{left:{type:"-",count:15,controll:0},right:{type:"x",count:2,controll:1}},35:{middle:{type:"8",count:20,controll:0}},40:{left:{type:"+",count:20,controll:0},right:{type:"x",count:10,controll:1}},45:{left:{type:"+",count:20,controll:1},right:{type:"change",count:4,controll:3}},50:{left:{type:"\xf7",count:2,controll:1},right:{type:"+",count:5,controll:0}},55:{left:{type:"change",count:5,controll:3},right:{type:"-",count:10,controll:1}},60:{left:{type:"end",count:0,controll:4},right:{type:"end",count:0,controll:5}},62:{middle:{type:"boss_3",count:100,controll:0,scale:2}}},e.rotateConf={5:{min:5,max:30},20:{min:-8,max:5},"\u795e\u5668":{min:-19,max:-8},10:{min:-30,max:-19}},e.initHeroConf=[0,0,1,2,4,4,4,4,4,4,4,4,4,5,6,7,8,9],e.changeHeroConf=[0,1,4,5,6,7,8,9],e.heroConf=[{name:"\u9c7c\u738b",linkIndex:0},{name:"\u960e\u7f57\u5929\u5b50",linkIndex:1},{name:"\u960e\u7f57\u5929\u5b50",linkIndex:2},{name:"\u766b\u766b\u86d9",linkIndex:3},{name:"\u53d8\u5f02\u5415\u5e03",linkIndex:4},{name:"\u9b54\u541b\u960e\u7f57",linkIndex:5},{name:"\u6bd2\u2219\u534e\u4f57",linkIndex:6},{name:"\u6551\u751f\u5458\u2219\u534e\u4f57",linkIndex:7},{name:"\u9b54\u2219\u534e\u4f57",linkIndex:8},{name:"\u5218\u5907",linkIndex:9}],e}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/parkour/parkour",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.parkour)],e)}(n.default);i.ParkourModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],ParkourNodeExtra:[function(t,e,i){"use strict";cc._RF.push(e,"83a86CGs65Gr4ciR+s4k+PQ","ParkourNodeExtra"),Object.defineProperty(i,"__esModule",{value:!0}),i.ParkourNodeExtra=void 0;var o=cc._decorator,n=o.ccclass,a=(o.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.extraObj={},e}return __extends(e,t),e.prototype.setExtra=function(t,e){this.extraObj[t]=e},e.prototype.getExtra=function(t){return this.extraObj[t]||null},__decorate([n],e)}(cc.Component));i.ParkourNodeExtra=a,cc._RF.pop()},{}],ParkourOpenBoxWindow:[function(t,e,i){"use strict";cc._RF.push(e,"36a8a/5SBdAUpLNcXj3Nnr2","ParkourOpenBoxWindow"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/utils/SubSwitchAni"),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.okBtn=null,e.hero=null,e.heroName=null,e.showAni=null,e.skills=[],e._callback=null,e}return __extends(e,t),e.prototype.showHero=function(t,e){this._callback=e,this.hero.getComponent(o.SubSwitchAni).switchAni(t.linkIndex,"idle"),0==t.linkIndex?this.skills[0].active=!0:this.skills[1].active=!0,this.heroName.string=t.name},e.prototype.onClick=function(){this.node.destroy(),this._callback&&this._callback()},e.prototype.onEnable=function(){this.okBtn.on(cc.Node.EventType.TOUCH_END,this.onClick,this),this.showAni.play("newHero")},e.prototype.onDisable=function(){this.okBtn.off(cc.Node.EventType.TOUCH_END,this.onClick,this)},e.prototype.onDestroy=function(){this._callback=null},__decorate([s(cc.Node)],e.prototype,"okBtn",void 0),__decorate([s(cc.Node)],e.prototype,"hero",void 0),__decorate([s(cc.Label)],e.prototype,"heroName",void 0),__decorate([s(cc.Animation)],e.prototype,"showAni",void 0),__decorate([s(cc.Node)],e.prototype,"skills",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"../../miniGamePackage/utils/SubSwitchAni":"SubSwitchAni"}],ParkourOpenBox:[function(t,e,i){"use strict";cc._RF.push(e,"cfedeqwGwFP+KI1R9VT46X5","ParkourOpenBox"),Object.defineProperty(i,"__esModule",{value:!0}),i.ParkourOpenBox=void 0;var o=t("../../miniGamePackage/utils/MiniGameDefer"),n=t("../../miniGamePackage/utils/SubResourceUtils"),a=__importDefault(t("./ParkourOpenBoxWindow")),s=function(){function t(){this._boxNode=null,this._heroConf=null,this._window=null,this._defer=null}return t.prototype._onOpenBox=function(){var t=this;console.log("_onOpenBox");var e=this._boxNode;e.off(cc.Node.EventType.TOUCH_END,this._onOpenBox,this);var i=e.getComponent(sp.Skeleton);i.setCompleteListener(function(){return __awaiter(t,void 0,void 0,function(){var t,o,s=this;return __generator(this,function(r){switch(r.label){case 0:return"show"!==i.animation?[2]:(i.setCompleteListener(null),i.animation="idle",e.active=!1,[4,n.SubResourceUtils.getInst().loadAsset(n.SubResourceUtils.getInst().bundleRoot,"prefab/openBox/openBox",cc.Prefab)]);case 1:return t=r.sent(),(o=cc.instantiate(t)).name="openBox",e.parent.addChild(o),(this._window=o.getComponent(a.default)).showHero(this._heroConf,function(){s._defer.resolve()}),[2]}})})}),i.animation="show"},t.prototype.openBox=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return this._boxNode=t,this._heroConf=e,t.on(cc.Node.EventType.TOUCH_END,this._onOpenBox,this),this._defer=new o.MiniGameDefer,[2,this._defer.promise]})})},t}();i.ParkourOpenBox=s,cc._RF.pop()},{"../../miniGamePackage/utils/MiniGameDefer":"MiniGameDefer","../../miniGamePackage/utils/SubResourceUtils":"SubResourceUtils","./ParkourOpenBoxWindow":"ParkourOpenBoxWindow"}],ParkourSelectIndex:[function(t,e,i){"use strict";cc._RF.push(e,"a1fcftnLE1J4qbE01NqV7Gp","ParkourSelectIndex"),Object.defineProperty(i,"__esModule",{value:!0}),i.ParkourSelectIndex=void 0;var o=cc._decorator,n=o.ccclass,a=o.property,s=function(){function t(){this.show=[],this.hide=[]}return __decorate([a({type:[cc.Node],tooltip:"\u663e\u793a\u7684\u8282\u70b9"})],t.prototype,"show",void 0),__decorate([a({type:[cc.Node],tooltip:"\u9690\u85cf\u7684\u8282\u70b9"})],t.prototype,"hide",void 0),__decorate([n("HideShowType")],t)}(),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showHideList=[],e}return __extends(e,t),e.prototype.selectIndex=function(t){if(this.showHideList.length>t){var e=this.showHideList[t];if(e.show)for(var i=0;i<e.show.length;i++)e.show[i].active=!0;if(e.hide)for(i=0;i<e.hide.length;i++)e.hide[i].active=!1}},__decorate([a({type:[s]})],e.prototype,"showHideList",void 0),__decorate([n],e)}(cc.Component);i.ParkourSelectIndex=r,cc._RF.pop()},{}],Patrol:[function(t,e,i){"use strict";cc._RF.push(e,"a2adbenxNZH8b7FoeYujouy","Patrol"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGameState_Patrol=void 0;var o=__importDefault(t("../../../miniGamePackage/utils/MathExt")),n=t("./StateBase"),a=function(t){function e(e){var i=t.call(this,e)||this;return i.destination=cc.Vec2.ZERO,i.lastPos=cc.Vec3.ZERO,i}return __extends(e,t),e.prototype.onEnterState=function(t){(null==t?void 0:t.destination)&&(this.destination=t.destination),this.lastPos=this.owner.node.position},e.prototype.onUpdateState=function(t){this.owner.moveTo(this.destination,t),this.testEscape()||this.testCatch()||o.default.V3(this.destination).sub(this.lastPos).dot(o.default.V3(this.destination).sub(this.owner.node.position))<0&&this.owner.onSwitch(n.FishGameState.idle)},e}(n.FishGameStateBase);i.FishGameState_Patrol=a,cc._RF.pop()},{"../../../miniGamePackage/utils/MathExt":"MathExt","./StateBase":"StateBase"}],PlatformUtils:[function(t,e,i){"use strict";cc._RF.push(e,"90dd1WAJvFF2KeYwcZg6YEY","PlatformUtils"),Object.defineProperty(i,"__esModule",{value:!0}),i.subPlatformEnv=i.isCocosGame=void 0,p("platformVersion","v1.0.3"),p("platformTagTime","2022-06-27 11:21"),i.isCocosGame=window&&window.cc&&window.cc.sys&&"string"==typeof window.cc.sys.OS_IOS,i.subPlatformEnv={get isDebug(){return!i.isCocosGame&&!!window.DEBUG},get isWX(){return i.isCocosGame?cc.sys.platform===cc.sys.WECHAT_GAME:egret.Capabilities.runtimeType===egret.RuntimeType.WXGAME},get isTT(){return!!i.isCocosGame&&cc.sys.platform===cc.sys.BYTEDANCE_GAME},get isQQ(){return window&&window.qq},get isNativeAPP(){return!i.isCocosGame&&egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE},get isNativeIOSAPP(){return i.isCocosGame?(p("cc.sys.platform",cc.sys.platform),cc.sys.os===cc.sys.OS_IOS&&!1):(p("egret.Capabilities.runtimeType",egret.Capabilities.runtimeType),p("egret.Capabilities.os",egret.Capabilities.os),egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE&&"iOS"===egret.Capabilities.os)},get isNativeAndroidAPP(){return i.isCocosGame?cc.sys.os===cc.sys.OS_ANDROID&&!1:egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE&&"Android"===egret.Capabilities.os},get isH5(){return i.isCocosGame?cc.sys.platform===cc.sys.DESKTOP_BROWSER||cc.sys.platform===cc.sys.MOBILE_BROWSER:egret.Capabilities.runtimeType===egret.RuntimeType.WEB},get isMixMicroEnd(){if(window&&window.navigator&&window.navigator.userAgent){var t=window.navigator.userAgent;return t.indexOf("mix_micro_end_ios")>-1||t.indexOf("mix_micro_end_android")>-1}return!1},get isMixMicroEndAndroid(){return!!(window&&window.navigator&&window.navigator.userAgent)&&window.navigator.userAgent.indexOf("mix_micro_end_android")>-1},get isNonMixMicroEnd(){if(window&&window.navigator&&window.navigator.userAgent){var t=window.navigator.userAgent;return t.indexOf("HortorApp")>-1||t.indexOf("gcApp")>-1||t.indexOf("HortorApk")>-1||t.indexOf("gcApk")>-1}return!1}};var o=i.subPlatformEnv.isDebug,n=i.subPlatformEnv.isWX,a=i.subPlatformEnv.isTT,s=i.subPlatformEnv.isNativeAPP,r=i.subPlatformEnv.isNativeIOSAPP,c=i.subPlatformEnv.isNativeAndroidAPP,l=i.subPlatformEnv.isH5,h=i.subPlatformEnv.isMixMicroEnd,u=i.subPlatformEnv.isMixMicroEndAndroid,d=i.subPlatformEnv.isNonMixMicroEnd;function p(t,e){var i=!1;(s||h)&&(i=!0),console.warn("[platform]: "+t+" ",i?JSON.stringify(e):e)}p("isDebug",o),p("isWX",n),p("isTT",a),p("isNativeAPP",s),p("isNativeIOSAPP",r),p("isNativeAndroidAPP",c),p("isH5",l),p("isMixMicroEnd",h),p("isMixMicroEndAndroid",u),p("isNonMixMicroEnd",d),o&&void 0===window.HSDK&&(window.HSDK={},["ENV","LogType","EventType","NoticeType","SMSCodeType","QQScene","WXScene","QQMicroAppType","WXMicroAppType","MicroProgramType","BindPlatformType","AddicationType","SwitchStatus"].forEach(function(t){window.HSDK[t]={}})),cc._RF.pop()},{}],PlayerFish:[function(t,e,i){"use strict";cc._RF.push(e,"5183dvQX9tI2r/25QXl/EI3","PlayerFish"),Object.defineProperty(i,"__esModule",{value:!0}),i.PlayerFish=void 0;var o=__importDefault(t("./BaseFish")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fishFrames=[],e.fishSprite=null,e}return __extends(e,t),e.prototype.initFish=function(t){this.setFishType(t)},e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.fishSprite.spriteFrame=this.fishFrames[this.fishType]},e.prototype.setFishType=function(e){t.prototype.setFishType.call(this,e),this.fishSprite.spriteFrame=this.fishFrames[this.fishType]},__decorate([s([cc.SpriteFrame])],e.prototype,"fishFrames",void 0),__decorate([s(cc.Sprite)],e.prototype,"fishSprite",void 0),__decorate([a],e)}(o.default);i.PlayerFish=r,cc._RF.pop()},{"./BaseFish":"BaseFish"}],PolygonUtil:[function(t,e,i){"use strict";cc._RF.push(e,"78534Ndxx9Nvo6Mvk/bjYTZ","PolygonUtil"),Object.defineProperty(i,"__esModule",{value:!0}),i.PolygonUtil=void 0;var o=function(){function t(){}return t.splitPolygonByLine=function(t,e,i,o){void 0===o&&(o=!1);for(var n=[],a=i.length-1;a>=0;a--){var s=i[a],r=0==a?i[i.length-1]:i[a-1],c=this.lineCrossPoint(s,r,t,e),l=c[0],h=c[1];-1!=l&&(i.splice(a,-1,h),n.push(a+1))}return n},t.lineCrossPoint=function(t,e,i,o){var n,a,s,r,c,l,h=t,u=e,d=i,p=o,m=new cc.Vec2(0,0);return s=this.dblcmp(n=this.ab_cross_ac(h,u,d),0),r=this.dblcmp(a=this.ab_cross_ac(h,u,p),0),c=this.dblcmp(this.ab_cross_ac(d,p,h),0),l=this.dblcmp(this.ab_cross_ac(d,p,u),0),-2==(s^r)&&-2==(c^l)?(m.x=(d.x*a-p.x*n)/(a-n),m.y=(d.y*a-p.y*n)/(a-n),[0,m]):0==s&&this.point_on_line(d,h,u)<=0?[1,m=d]:0==r&&this.point_on_line(p,h,u)<=0?[1,m=p]:0==c&&this.point_on_line(h,d,p)<=0?[1,m=h]:0==l&&this.point_on_line(u,d,p)<=0?[1,m=u]:[-1,null]},t.isLineSegmentCross=function(t,e,i,o){return((i.x-t.x)*(i.y-o.y)-(i.y-t.y)*(i.x-o.x))*((i.x-e.x)*(i.y-o.y)-(i.y-e.y)*(i.x-o.x))<0||((t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x))*((t.x-o.x)*(t.y-e.y)-(t.y-o.y)*(t.x-e.x))<0},t.point_on_line=function(t,e,i){return this.dblcmp(this.dot(e.x-t.x,e.y-t.y,i.x-t.x,i.y-t.y),0)},t.rayPointToLine=function(t,e,i){Math.min(e.x,i.x);var o=Math.max(e.x,i.x),n=Math.min(e.y,i.y),a=Math.max(e.y,i.y);if(t.y<n||t.y>a||t.x>o)return-1;var s=e.x+(i.x-e.x)/(i.y-e.y)*(t.y-e.y);return s>t.x?0:s==t.x?1:-1},t.relationPointToPolygon=function(t,e){for(var i=0,o=0;o<e.length;++o){if(e[o].equals(t))return 2;var n=e[o],a=e[0];o<e.length-1&&(a=e[o+1]);var s=this.rayPointToLine(t,n,a);if(1==s)return 1;0==s&&i++}return i%2==0?-1:0},t.lineCutPolygon=function(t,e,i){for(var o=[],n=[],a=[],s=0;s<i.length;++s){n.push(i[s]);var r=i[s],c=i[0];s<i.length-1&&(c=i[s+1]);var l=this.lineCrossPoint(t,e,r,c);0==l[0]?(a.push(n.length),n.push(l[1])):l[0]>0&&(l[1].equals(r)?a.push(n.length-1):(a.push(n.length),s===i.length-1&&n.push(l[1])))}if(a.length>1){var h=n[a[0]],u=n[a[1]],d=n[a[a.length-1]],p=this.relationPointToPolygon(new cc.Vec2((h.x+u.x)/2,(h.y+u.y)/2),i),m=p>=0;a.length>2&&h.sub(u).mag()>h.sub(d).mag()&&(u=d,m=(p=this.relationPointToPolygon(new cc.Vec2((h.x+u.x)/2,(h.y+u.y)/2),i))<0);var f=m,g=0,_=a[g],y=[],v=[],b=0;for(y.push(n[_]),m&&v.push(n[_]),g++,b++,_++;b<n.length;){_==n.length&&(_=0);var P=n[_];g>=0&&_==a[g]?(++g>=a.length&&(g=0),m?(v.push(P),o.push(v),v=[]):(v=[]).push(P),y.push(P),m=!m):m?v.push(P):y.push(P),_++,b++}if(m)if(!f&&v.length>1)v.push(n[a[0]]),o.push(v);else for(s=0;s<v.length;++s)y.push(v[s]);o.push(y)}return o},t.ab_cross_ac=function(t,e,i){return this.cross(e.x-t.x,e.y-t.y,i.x-t.x,i.y-t.y)},t.dot=function(t,e,i,o){return t*i+e*o},t.cross=function(t,e,i,o){return t*o-i*e},t.dblcmp=function(t,e){return Math.abs(t-e)<=1e-6?0:t>e?1:-1},t}();i.PolygonUtil=o,cc._RF.pop()},{}],Pool:[function(t,e,i){"use strict";cc._RF.push(e,"a5039iLgV9O5LxF879aeXpl","Pool"),Object.defineProperty(i,"__esModule",{value:!0}),i.Pool=void 0;var o=function(){function t(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.init=null,this.dele=null,this.pool=[],this.objs=[],this.ctor=t,this.init=e,this.dele=i}return Object.defineProperty(t.prototype,"poolLen",{get:function(){return this.pool.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objsLen",{get:function(){return this.objs.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"peek",{get:function(){return 0==this.objsLen?null:this.objs[this.objsLen-1]},enumerable:!1,configurable:!0}),t.prototype.newObj=function(){var t=this.pool.pop();return t||(t=this.ctor()),this.init&&this.init(t),this.objs.push(t),t},t.prototype.delObj=function(t){this.dele&&this.dele(t);var e=this.objs.findIndex(function(e){return e==t});e>=0&&this.objs.splice(e,1),this.pool.push(t)},t.prototype.clrObj=function(){var t=this;this.dele&&this.objs.forEach(function(e){t.dele&&t.dele(e),t.pool.push(e)}),this.objs.length=0},t}();i.Pool=o,cc._RF.pop()},{}],Queue:[function(t,e,i){"use strict";cc._RF.push(e,"3d18cQ97FxCAaj/wjMs3iy6","Queue"),Object.defineProperty(i,"__esModule",{value:!0}),i.Queue=void 0;var o=function(){function t(){this.queue=[],this.f=0,this.r=0,this.isEmpty=!0}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.f>this.r?this.r+this.capacity-this.f:this.f<this.r?this.r-this.f:this.isEmpty?0:this.capacity},enumerable:!1,configurable:!0}),t.prototype.enq=function(t){var e;if(0==this.capacity)for(var i=0;i<5;i++)this.queue.push(null);else if(!this.isEmpty&&this.length+1>this.capacity)if(this.r>this.f)for(i=0;i<5;i++)this.queue.push(null);else{var o=this.queue.splice(this.f-this.capacity);for(i=0;i<5;i++)this.queue.push(null);this.f+=5,(e=this.queue).push.apply(e,o)}this.queue[this.r]=t,this.r=(this.r+1)%this.capacity,this.isEmpty=!1},t.prototype.deq=function(){if(0==this.capacity||this.isEmpty)return null;var t=this.queue[this.f];return this.queue[this.f]=null,this.f=(this.f+1)%this.capacity,this.f==this.r&&(this.isEmpty=!0),t},t}();i.Queue=o,cc._RF.pop()},{}],RailingCurve:[function(t,e,i){"use strict";cc._RF.push(e,"79a1dpxeI1MVJV70qFEWnX+","RailingCurve"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e,i,o,n){this.center=t,this.startRad=e,this.endRad=i,this.radius=o,this.rightHalf=n}return Object.defineProperty(t.prototype,"len",{get:function(){return this.radius*(this.endRad-this.startRad)},enumerable:!1,configurable:!0}),t.prototype.trans=function(t,e,i){var o=this.center.sub(t),n=cc.v2(Math.cos(e)*o.x-Math.sin(e)*o.y,Math.sin(e)*o.x+Math.cos(e)*o.y);this.center=n.add(cc.v2(0,cc.Vec2.distance(t,i))),this.startRad+=(this.rightHalf?1:-1)*e,this.endRad+=(this.rightHalf?1:-1)*e},t.prototype.val=function(t){t=Math.max(0,Math.min(t,1));var e=(this.endRad-this.startRad)*t+this.startRad;return this.rightHalf||(e=Math.PI-e),this.center.add(cc.v2(Math.cos(e),Math.sin(e)).multiplyScalar(this.radius))},t}(),n=function(){function t(t,e){this.arcList=[];var i=Math.abs(e);if(this.arcList.length=0,this.length=t,0!=i){var n,a,s,r,c,l,h=e>0,u=h?1:-1,d=Math.floor(i),p=(i-d)*Math.PI,m=t/(d*Math.PI+2*p),f=cc.v2(u*Math.sin(p),Math.cos(p)).multiplyScalar(m).add(cc.v2(0,m)),g=Math.pow(-1,d+1)*u,_=cc.v2(g*Math.sin(p),-Math.cos(p)).multiplyScalar(m).add(cc.v2(0,(2*d+3)*m)),y=f.add(_).mul(.5),v=(n=y,a=f,s=cc.v2(0,m),r=cc.Vec2.distance(n,a),c=cc.Vec2.distance(a,s),l=cc.Vec2.distance(n,s),-Math.acos((r*r+l*l-c*c)/(2*r*l))*u),b=h;this.arcList.push(new o(cc.v2(0,m),Math.PI/2-p,Math.PI/2,m,b)),b=!b;for(var P=1;P<=d;P++)this.arcList.push(new o(cc.v2(0,(2*P+1)*m),-Math.PI/2,Math.PI/2,m,b)),b=!b;this.arcList.push(new o(cc.v2(0,(2*d+3)*m),-Math.PI/2,p-Math.PI/2,m,b)),b=!b,this.arcList.forEach(function(t){return t.trans(y,d%2==0&&0!=p?v:0,f)})}}return Object.defineProperty(t.prototype,"curveLen",{get:function(){return this.length},enumerable:!1,configurable:!0}),t.prototype.val=function(t){if(0==this.arcList.length)return cc.v2(0,this.length*t);t=Math.max(0,Math.min(t,1));for(var e=0,i=0;i<this.arcList.length;i++){if(t*this.length<e+this.arcList[i].len)return this.arcList[i].val((t*this.length-e)/this.arcList[i].len);e+=this.arcList[i].len}return this.arcList[this.arcList.length-1].val(1)},t}();i.default=n,cc._RF.pop()},{}],RailingEnd:[function(t,e,i){"use strict";cc._RF.push(e,"b28e4HgUMxAMrVdtILE0wVu","RailingEnd"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=(o.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.startPos=cc.Vec2.ZERO,e.localEndPos=cc.Vec2.ZERO,e}return __extends(e,t),Object.defineProperty(e.prototype,"endPosition",{get:function(){return this.startPos.add(this.localEndPos)},enumerable:!1,configurable:!0}),e.prototype.init=function(t){this.startPos=t,this.node.position=cc.v3(t.x,t.y,0)},__decorate([n],e)}(cc.Component));i.default=a,cc._RF.pop()},{}],RailingGameWindow:[function(t,e,i){"use strict";cc._RF.push(e,"94adeYtNUJCAa4xBHnf8FOr","RailingGameWindow"),Object.defineProperty(i,"__esModule",{value:!0}),i.SLIDE=i.InputState=void 0;var o,n=t("./RailingMapUnit"),a=t("./RailingModel"),s=__importDefault(t("./RailingRoom")),r=__importDefault(t("./RailingRailTrack")),c=__importStar(t("./RailingPlayer")),l=t("./config/config"),h=__importDefault(t("./RailingEnd")),u=__importDefault(t("../../miniGamePackage/SubPackageManager")),d=cc._decorator,p=d.ccclass,m=d.property;(function(t){t[t.None=-1]="None",t[t.SlideUp=0]="SlideUp",t[t.SlideRight=1]="SlideRight",t[t.SlideDown=2]="SlideDown",t[t.SlideLeft=3]="SlideLeft"})(o=i.InputState||(i.InputState={})),i.SLIDE="slideInput";var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stream=null,e.streamFolder=null,e.piranha=null,e.fishFolder=null,e.roomPrefab=null,e.trackPrefab=null,e.levelFolder=null,e.root=null,e.end=null,e.roomList=[],e.railList=[],e.curLevel=0,e._input=o.None,e.slideGap=300,e.slideTimer=0,e.isTouching=!1,e.lastTouchPos=cc.Vec2.ZERO,e.player=null,e.gameConfig=null,e.bg=null,e}var d;return __extends(e,t),d=e,Object.defineProperty(e,"Ins",{get:function(){return d._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curRoom",{get:function(){return this.roomList[this.curLevel]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curRail",{get:function(){return this.railList[this.curLevel]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"input",{get:function(){return this._input},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){d._instance=this},e.prototype.onDestroy=function(){d._instance=null},e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.touchDown,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.touchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.touchUp,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.touchDown,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.touchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.touchUp,this)},e.prototype.lateUpdate=function(){this._input=o.None},e.prototype.touchDown=function(t){this.slideTimer=Date.now()+this.slideGap,this.lastTouchPos=t.getLocation(),this.isTouching=!0},e.prototype.touchMove=function(t){if(this.isTouching){var e=t.getLocation().sub(this.lastTouchPos);(Date.now()>this.slideTimer||e.mag()>20)&&(0==e.x&&0==e.y?this._input=o.None:Math.abs(e.x)>Math.abs(e.y)?(this._input=e.x>0?o.SlideRight:o.SlideLeft,cc.game.emit(i.SLIDE,this._input)):(this._input=e.y>0?o.SlideUp:o.SlideDown,cc.game.emit(i.SLIDE,this._input)),this.isTouching=!1)}},e.prototype.touchUp=function(t){if(this.isTouching){var e=t.getLocation().sub(this.lastTouchPos);0==e.x&&0==e.y?this._input=o.None:Math.abs(e.x)>Math.abs(e.y)?(this._input=e.x>0?o.SlideRight:o.SlideLeft,cc.game.emit(i.SLIDE,this._input)):(this._input=e.y>0?o.SlideUp:o.SlideDown,cc.game.emit(i.SLIDE,this._input)),this.isTouching=!1}},e.prototype.moveMap=function(t){this.root.position=cc.v3(0,l.Railing.focusCenterY-t*l.Railing.globalScale,0),this.refreshBG(-t*l.Railing.globalScale)},e.prototype.loadGameData=function(){var t=this.gameConfig.json,e=cc.v2(0,-300);this.roomList.length=0,this.railList.length=0;for(var i=e.y,o=0;o<l.Railing.streamCnt;o++){var n=cc.instantiate(this.stream);n.parent=this.streamFolder,n.position=cc.v3(100*Math.random()-100,i,0),i+=l.Railing.streamHeightStep}var a=function(i){var o=t[i],n=cc.v2(o.startCrd[0],o.startCrd[1]),a=cc.v2(o.endCrd[0],o.endCrd[1]),h=cc.instantiate(c.roomPrefab),u=h.getComponent(s.default);h.parent=c.levelFolder,h.setSiblingIndex(0),u.init(o.roomMap,n,a,e,cc.v2(o.roomSize[0],o.roomSize[1]),o.roomUnitScale),c.roomList.push(u),e=u.crd2Pos(a).add(cc.v2(0,100));var d=cc.instantiate(c.trackPrefab),p=d.getComponent(r.default);d.parent=c.levelFolder,d.setSiblingIndex(0),c.railList.push(p),e=p.init(o.railLen,e,o.railStep,o.arcMode).add(cc.v2(0,180));for(var m=p.curve.arcList,f=function(t){if(o.fishList[t][0]>=m.length)return"continue";var e=m[o.fishList[t][0]].center.add(cc.v2(o.fishList[t][1]*Math.random(),o.fishList[t][2]*Math.random())).add(p.startPoint).add(cc.v2(0,2*m[o.fishList[t][0]].radius)),i=cc.instantiate(c.piranha);i.parent=c.fishFolder,i.position=cc.v3(e.x,e.y,0),e.x<0&&(i.scaleX=-i.scaleX);var n=i.getComponent(sp.Skeleton);n.setAnimation(0,"animation",!1),n.setCompleteListener(function(){setTimeout(function(){if(m[o.fishList[t][0]].center&&cc.v2(o.fishList[t][1]*Math.random(),o.fishList[t][2]*Math.random())&&p.startPoint&&cc.v2(0,2*m[o.fishList[t][0]].radius)){var e=m[o.fishList[t][0]].center.add(cc.v2(o.fishList[t][1]*Math.random(),o.fishList[t][2]*Math.random())).add(p.startPoint).add(cc.v2(0,2*m[o.fishList[t][0]].radius));i.position=cc.v3(e.x,e.y,0),n.setAnimation(0,"animation",!1)}},l.Railing.fishAnimInterval+1e3*(2*Math.random()-1))})},g=0;g<o.fishList.length;g++)f(g)},c=this;for(o=0;o<t.length;o++)a(o);this.end.node.parent=this.levelFolder,this.end.node.setSiblingIndex(0),this.end.init(e)},e.prototype.start=function(){console.log("game"),this.loadGameData(),this.curLevel=0;var t=l.Railing.globalScale,e=cc.v3(0,l.Railing.focusCenterY,0),i=this.root.position.sub(e).multiplyScalar(t);this.root.position=e.add(i),this.root.scale=l.Railing.globalScale;var o=this.curRoom.crd2Pos(this.curRoom.startPoint_d);this.player.moveToPos(cc.v2(o.x,o.y)),this.player.curState=c.PlayerState.Idle},e.prototype.playerRoomRoutine=function(t,e){var i=function(t){return t&&t.curState!=n.UnitState.Block&&t.curState!=n.UnitState.Undefine};if(this.curRoom.endPoint_d.equals(e)&&t==a.Direction.Up)return{moveSuccess:!1,enterRail:!0};var o=this.curRoom.crd2Info(e);if(!i(o))return{moveSuccess:!1};var s=e.add(a.dirMap.get(t).clone());if(!i(o=this.curRoom.crd2Info(s)))return{moveSuccess:!1};for(var r=s;i(o);)r=s,s=s.add(a.dirMap.get(t).clone()),o=this.curRoom.crd2Info(s);return{moveSuccess:!0,destination:this.curRoom.crd2Pos(r)}},e.prototype.onPlayerRoomMove=function(t,e){var i=this.curRoom.getArriveUnitCrd(a.dirMap.get(t).clone(),e),o=this.curRoom.crd2Info(i);if(!o)return{railCntChange:0};var s=o.curState==n.UnitState.Full?1:0;return o.curState==n.UnitState.Full&&o.setState(n.UnitState.Empty),{railCntChange:s,enterRail:i.equals(this.curRoom.endPoint_d)}},e.prototype.onPlayerRoomOccupy=function(t){var e=d.Ins.curRoom.crd2Info(d.Ins.curRoom.pos2Crd(t));if(!e)return{railCntChange:0};var i=e.curState==n.UnitState.Full?1:0;return e.curState==n.UnitState.Full&&e.setState(n.UnitState.Empty),{railCntChange:i}},e.prototype.playerRailRoutine=function(t,e,i){if(t==a.RailDir.Front){var o=this.curRail.getCurMaxProcess(e);return i>=o?{moveSuccess:!1}:{moveSuccess:!0,destination:o}}return t==a.RailDir.Back?{moveSuccess:!0,destination:0}:{moveSuccess:!1}},e.prototype.onPlayerRailMove=function(t,e){var i=this.curRail.isCostCrd(e)?-1:0;return this.curRail.updateProcess(e),e>=1?(this.curLevel++,this.curLevel>=this.roomList.length?(this.win(),{railCntChange:i,end:!0}):{railCntChange:i,finishRail:!0}):e<=0?{railCntChange:i,exitRail:!0}:{railCntChange:i}},e.prototype.win=function(){var t=this;this.player.winGameMove(this.end.endPosition,function(){u.default.instance.gotoResultWithLoading(!0,t.node.parent)})},e.prototype.exit=function(){u.default.instance.getModel().gameExit()},e.prototype.refreshBG=function(t){var e=this.node.getContentSize(),i=cc.v2(e.width/l.Railing.bgUnitSize_src.x,e.height/l.Railing.bgUnitSize_src.y),o=cc.v2(0,t/this.node.height),n=this.bg.getMaterial(0);n.setProperty("tiling",i),n.setProperty("offset",o)},e._instance=null,__decorate([m(cc.Prefab)],e.prototype,"stream",void 0),__decorate([m(cc.Node)],e.prototype,"streamFolder",void 0),__decorate([m(cc.Prefab)],e.prototype,"piranha",void 0),__decorate([m(cc.Node)],e.prototype,"fishFolder",void 0),__decorate([m(cc.Prefab)],e.prototype,"roomPrefab",void 0),__decorate([m(cc.Prefab)],e.prototype,"trackPrefab",void 0),__decorate([m(cc.Node)],e.prototype,"levelFolder",void 0),__decorate([m(cc.Node)],e.prototype,"root",void 0),__decorate([m(h.default)],e.prototype,"end",void 0),__decorate([m(c.default)],e.prototype,"player",void 0),__decorate([m(cc.JsonAsset)],e.prototype,"gameConfig",void 0),__decorate([m(cc.Sprite)],e.prototype,"bg",void 0),d=__decorate([p],e)}(cc.Component);i.default=f,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./RailingEnd":"RailingEnd","./RailingMapUnit":"RailingMapUnit","./RailingModel":"RailingModel","./RailingPlayer":"RailingPlayer","./RailingRailTrack":"RailingRailTrack","./RailingRoom":"RailingRoom","./config/config":"config"}],RailingMapUnit:[function(t,e,i){"use strict";cc._RF.push(e,"12560QYCYBNn5kfIyyXCFjs","RailingMapUnit"),Object.defineProperty(i,"__esModule",{value:!0}),i.UnitState=void 0;var o,n=t("./config/config"),a=cc._decorator,s=a.ccclass,r=a.property;(function(t){t[t.Block=0]="Block",t[t.Full=1]="Full",t[t.Empty=2]="Empty",t[t.Undefine=-1]="Undefine"})(o=i.UnitState||(i.UnitState={}));var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.crd=cc.Vec2.ZERO,e.unitSpriteRenderer=null,e.grassSpriteRenderer=null,e.railSpriteRenderer=null,e.grassSprites=[],e._curState=o.Undefine,e}return __extends(e,t),Object.defineProperty(e.prototype,"curState",{get:function(){return this._curState},enumerable:!1,configurable:!0}),e.prototype.init=function(t){this.crd=t.clone()},e.prototype.setState=function(t){this._curState=t,this.refresh()},e.prototype.refresh=function(){this.railSpriteRenderer.enabled=this.curState==o.Full,this.unitSpriteRenderer.enabled=this.curState!=o.Block,this.grassSpriteRenderer.node.active=!1,this.curState==o.Block&&Math.random()<n.Railing.grassProbability&&0!=this.crd.y&&Math.random()<n.Railing.grassProbability&&0!=this.crd.y&&(this.unitSpriteRenderer,this.grassSpriteRenderer.spriteFrame=this.grassSprites[Math.floor(Math.random()*this.grassSprites.length)],this.grassSpriteRenderer.node.active=!0)},__decorate([r],e.prototype,"crd",void 0),__decorate([r(cc.Sprite)],e.prototype,"unitSpriteRenderer",void 0),__decorate([r(cc.Sprite)],e.prototype,"grassSpriteRenderer",void 0),__decorate([r(cc.Sprite)],e.prototype,"railSpriteRenderer",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"grassSprites",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"./config/config":"config"}],RailingModel:[function(t,e,i){"use strict";cc._RF.push(e,"fc7a6C4Tc5KrIVi/348UDcH","RailingModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.RailingModel=i.dirMap=i.RailDir=i.Direction=void 0;var o,n=t("../../miniGamePackage/SubPackageManager"),a=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),s=t("../../miniGamePackage/types-miniGame");(function(t){t[t.Up=0]="Up",t[t.Right=1]="Right",t[t.Down=2]="Down",t[t.Left=3]="Left"})(o=i.Direction||(i.Direction={})),function(t){t[t.Front=0]="Front",t[t.Back=1]="Back"}(i.RailDir||(i.RailDir={})),i.dirMap=new Map([[o.Up,cc.Vec2.UP],[o.Right,cc.Vec2.RIGHT],[o.Down,cc.Vec2.UP.negate()],[o.Left,cc.Vec2.RIGHT.negate()]]);var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/railing/railing",[2,!0]})})},__decorate([n.addSubPackage(s.SubPackageKey.railing)],e)}(a.default);i.RailingModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],RailingMoveCoroutine:[function(t,e,i){"use strict";cc._RF.push(e,"fe62bUWQFVHE4R3eEIQDcj2","RailingMoveCoroutine"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=(o.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.callback=null,e.speed=0,e.dst=cc.Vec3.ZERO,e.src=cc.Vec3.ZERO,e.dir=cc.Vec3.ZERO,e.target=null,e}return __extends(e,t),e.prototype.init=function(t,e,i,o){return this.callback=i.bind(o),this.src=o.node.position,this.dst=cc.v3(t.x,t.y,0),this.dir=this.dst.sub(this.src).normalize(),this.speed=e,this.target=o,this},e.prototype.update=function(t){console.log("Coroutine");var e=this.dir.clone().multiplyScalar(this.speed*t),i=this.target.node.position.add(e),o=this.dst.sub(i);this.dir.dot(o)<=0?this.exitCor():this.target.moveToPos(cc.v2(i.x,i.y))},e.prototype.exitCor=function(){this.callback&&this.callback(),this.target.moveToPos(cc.v2(this.dst.x,this.dst.y)),this.destroy()},__decorate([n],e)}(cc.Component));i.default=a,cc._RF.pop()},{}],RailingPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"91accf3UB5OdqIo3S42PTN0","RailingPlayer"),Object.defineProperty(i,"__esModule",{value:!0}),i.PlayerState=void 0;var o,n=t("./config/config"),a=__importStar(t("./RailingGameWindow")),s=t("./RailingMapUnit"),r=t("./RailingModel"),c=__importDefault(t("./RailingMoveCoroutine")),l=cc._decorator,h=l.ccclass,u=l.property;(function(t){t[t.Idle=0]="Idle",t[t.RoomMoving=1]="RoomMoving",t[t.RailMoving=2]="RailMoving",t[t.Await=3]="Await"})(o=i.PlayerState||(i.PlayerState={}));var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._curState=o.Idle,e.isInRail=!1,e.actCD=300,e.actTimer=0,e.railCnt=0,e.railPos=0,e.railDir=r.RailDir.Front,e.railDst=0,e.curDir=r.Direction.Up,e.roomDst=cc.Vec2.ZERO,e.isInAnim=!1,e.anim=null,e.railFolder=null,e.railBottomPrefab=null,e.bodyOffset=-27.83,e.posOffset=0,e.railBottoms=[],e.railBottomsPool=[],e}return __extends(e,t),Object.defineProperty(e.prototype,"curState",{get:function(){return this._curState},set:function(t){this._curState=t,this.isInRail||this.occupyRoomPosRet(),t==o.Idle?this.anim.setAnimation(0,"idle",!0):this.anim.setAnimation(0,"run",!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curPos",{get:function(){return cc.v2(this.node.position.x,this.node.position.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"railSpeed",{get:function(){return a.default.Ins.curRail.calcRailCrdSpeed(n.Railing.playerSpeed)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomPos",{get:function(){return a.default.Ins.curRoom.pos2Crd(this.curPos)},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){cc.game.on(a.SLIDE,this.inputProcess,this)},e.prototype.onDisable=function(){cc.game.off(a.SLIDE,this.inputProcess,this)},e.prototype.requestRoomRoutine=function(t){var e=a.default.Ins.playerRoomRoutine(t,this.roomPos);console.log(e),e.moveSuccess?(e.destination&&(this.roomDst=e.destination),this.curState=o.RoomMoving):e.enterRail?0==this.railCnt&&a.default.Ins.curRail.isCostCrd(0)?this.curState=o.Idle:this.enterRail():this.curState=o.Idle},e.prototype.requestRailRoutine=function(t){var e=a.default.Ins.playerRailRoutine(t,this.railCnt,this.railPos);this.railDir=t,e.moveSuccess?(null!=e.destination&&(this.railDst=e.destination),this.curState=o.RailMoving):this.curState=o.Idle},e.prototype.moveToPos=function(t){this.node.position=cc.v3(t.x,t.y,0),a.default.Ins.moveMap(t.y)},e.prototype.roomMove=function(t){var e,i=r.dirMap.get(this.curDir).clone().multiplyScalar(n.Railing.playerSpeed*t),c=this.curPos.add(i),l=this.curPos.sub(this.roomDst),h=c.sub(this.roomDst);if(l.dot(h)<=0?(this.moveToPos(this.roomDst),e=a.default.Ins.onPlayerRoomMove(this.curDir,this.roomDst),this.curState=o.Idle):(this.moveToPos(c),e=a.default.Ins.onPlayerRoomMove(this.curDir,c)),e.railCntChange>0&&this.getRail(),e.end)this.curState=o.Await;else{var u=a.default.Ins.curRoom.getArriveUnitCrd(this.curDir,this.curPos).add(r.dirMap.get(this.curDir)),d=a.default.Ins.curRoom.crd2Info(u),p=a.default.Ins.curRoom.crd2Pos(u);if(d&&d.curState==s.UnitState.Full){var m=p.sub(this.curPos),f=this.roomDst.sub(this.curPos);if(cc.Vec2.dot(m,f)<0)return;cc.Vec2.distance(this.curPos,p)<=n.Railing.playerSpeed*n.Railing.bounceTime&&!this.isInAnim&&this.bounceAnim(!0)}}},e.prototype.occupyRoomPosRet=function(){console.log("occupy"),a.default.Ins.onPlayerRoomOccupy(this.curPos).railCntChange>0&&this.getRail()},e.prototype.railMove=function(t){var e,i=(this.railDir==r.RailDir.Front?1:-1)*this.railSpeed*t,s=this.railPos+i;(s-this.railDst)*(this.railPos-this.railDst)<=0?(this.railPos=this.railDst,this.moveToPos(a.default.Ins.curRail.crd2pos(this.railDst).add(cc.v2(0,n.Railing.playerPadStep+this.bodyOffset))),e=a.default.Ins.onPlayerRailMove(this.railDir,this.railDst),this.curState=o.Idle):(this.railPos=s,this.moveToPos(a.default.Ins.curRail.crd2pos(s).add(cc.v2(0,n.Railing.playerPadStep+this.bodyOffset))),e=a.default.Ins.onPlayerRailMove(this.railDir,s)),e.railCntChange<0&&this.loseRail(),e.end?this.curState=o.Await:e.exitRail?this.exitRail():e.finishRail&&this.finishRail()},e.prototype.getRail=function(){this.isInAnim=!1,this.railCnt++,this.refreshView(),console.log("\u83b7\u5f97\u8f68\u9053")},e.prototype.loseRail=function(){this.isInAnim=!1,this.railCnt--,this.refreshView(),console.log("\u5931\u53bb\u8f68\u9053")},e.prototype.bounceAnim=function(t){var e=this;if(void 0===t&&(t=!1),console.log(this.isInAnim),!this.isInAnim){this.isInAnim=!0;for(var i=0;i<this.railBottoms.length;i++)cc.tween(this.railBottoms[i]).by(n.Railing.bounceTime/2,{position:cc.v3(0,n.Railing.bounceHeight+n.Railing.playerPadStep,0)},{easing:"backOut"}).by(n.Railing.bounceTime/2,{position:cc.v3(0,-n.Railing.bounceHeight,0)},{easing:"backIn"}).start();cc.tween(this.anim.node).by(n.Railing.bounceTime/2,{position:cc.v3(0,n.Railing.bounceHeight+n.Railing.playerPadStep,0)},{easing:"backOut"}).by(n.Railing.bounceTime/2,{position:cc.v3(0,-n.Railing.bounceHeight,0)},{easing:"backIn"}).call(function(){e.isInAnim=!1}).start()}},e.prototype.enterRail=function(){var t=this;this.posOffset=n.Railing.stonePathOffset+n.Railing.playerPadStep,this.isInRail=!0,this.curState=o.Await,this.node.addComponent(c.default).init(a.default.Ins.curRail.crd2pos(0),n.Railing.playerSpeed,function(){t.requestRailRoutine(r.RailDir.Front),t.refreshView()},this),console.log("enterRail")},e.prototype.exitRail=function(){var t=this;this.posOffset=0,this.isInRail=!1,this.node.addComponent(c.default).init(a.default.Ins.curRoom.crd2Pos(a.default.Ins.curRoom.endPoint_d),n.Railing.playerSpeed,function(){t.curState=o.Idle,t.refreshView()},this),console.log("exitRail")},e.prototype.finishRail=function(){var t=this;this.posOffset=0,this.isInRail=!1,this.railPos=0,this.node.addComponent(c.default).init(a.default.Ins.curRoom.crd2Pos(a.default.Ins.curRoom.startPoint_d),n.Railing.playerSpeed,function(){t.curState=o.Idle,t.refreshView()},this),this.roomDst=a.default.Ins.curRoom.startPoint_d,console.log("finishRail")},e.prototype.inputProcess=function(t){this.curState!=o.Await&&(this.curState!=o.Idle||Date.now()<this.actTimer||(this.actTimer=Date.now()+this.actCD,t!=a.InputState.None&&(this.isInRail?(t==a.InputState.SlideUp?this.railDir=r.RailDir.Front:t==a.InputState.SlideDown&&(this.railDir=r.RailDir.Back),this.requestRailRoutine(this.railDir)):(this.curDir=t,this.requestRoomRoutine(this.curDir)))))},e.prototype.winGameMove=function(t,e){var i=this;this._curState=o.Await,this.node.addComponent(c.default).init(t,n.Railing.playerSpeed,function(){i.anim.setAnimation(0,"idle",!0),e()},this)},e.prototype.update=function(t){this.curState==o.RoomMoving?this.roomMove(t):this.curState==o.RailMoving&&this.railMove(t)},e.prototype.getRailBottom=function(){var t;return 0==this.railBottomsPool.length?((t=cc.instantiate(this.railBottomPrefab)).parent=this.railFolder,this.railBottoms.push(t),t):((t=this.railBottomsPool.pop()).active=!0,this.railBottoms.push(t),t)},e.prototype.loseRailBottom=function(t){t.active=!1,this.railBottomsPool.push(t);var e=this.railBottoms.findIndex(function(e){return e==t});e>=0&&this.railBottoms.splice(e,1)},e.prototype.refreshView=function(){for(var t=this.railBottoms.length,e=0;e<this.railCnt;e++){var i=e<t?this.railBottoms[e]:this.getRailBottom();i.stopAllActions(),i.position=cc.v3(0,this.posOffset+this.bodyOffset+n.Railing.playerPadStep*e)}for(e=this.railCnt;e<t;e++)this.railBottoms[e].stopAllActions(),this.loseRailBottom(this.railBottoms[e]);this.anim.node.stopAllActions(),this.anim.node.position=cc.v3(0,this.posOffset+this.bodyOffset+this.railCnt*n.Railing.playerPadStep,0)},__decorate([u(sp.Skeleton)],e.prototype,"anim",void 0),__decorate([u(cc.Node)],e.prototype,"railFolder",void 0),__decorate([u(cc.Prefab)],e.prototype,"railBottomPrefab",void 0),__decorate([h],e)}(cc.Component);i.default=d,cc._RF.pop()},{"./RailingGameWindow":"RailingGameWindow","./RailingMapUnit":"RailingMapUnit","./RailingModel":"RailingModel","./RailingMoveCoroutine":"RailingMoveCoroutine","./config/config":"config"}],RailingRailTrack:[function(t,e,i){"use strict";cc._RF.push(e,"bc85dDEk5dHw4C1SHighil7","RailingRailTrack"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./RailingCurve")),n=__importDefault(t("./RailingRail")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.railPrefab=null,e.railLen_d=10,e.finished_d=0,e.curve=null,e.railStep=0,e.startPoint=cc.Vec2.ZERO,e.railList=[],e}return __extends(e,t),Object.defineProperty(e.prototype,"stepLen_d",{get:function(){return this.railLen_d-1},enumerable:!1,configurable:!0}),e.prototype.calcRailCrdSpeed=function(t){return t/this.curveLen},Object.defineProperty(e.prototype,"curveLen",{get:function(){return this.railStep*this.stepLen_d},enumerable:!1,configurable:!0}),e.prototype.crd2pos=function(t){return this.startPoint.add(this.curve.val(t))},e.prototype.unitifyCrd=function(t,e){return void 0===e&&(e=!0),e?Math.ceil(t*this.curveLen/this.railStep)/this.stepLen_d:Math.floor(t*this.curveLen/this.railStep)/this.stepLen_d},e.prototype.crd2unitPos=function(t){var e=this.unitifyCrd(t);return this.crd2pos(e)},e.prototype.isCostCrd=function(t){var e=this.unitifyCrd(t,!1);return this.finished_d/this.railLen_d<=e},e.prototype.updateProcess=function(t){var e=this.unitifyCrd(t,!1)*this.stepLen_d+1;this.finished_d=Math.max(this.finished_d,e),this.refresh()},e.prototype.getCurMaxProcess=function(t){var e=t+this.finished_d;return e<this.railLen_d?(e-1)/this.stepLen_d:1},e.prototype.init=function(t,e,i,a){this.railStep=i,this.railLen_d=t,this.startPoint=cc.v2(0,e.y),this.curve=new o.default(this.curveLen,a);for(var s=this.crd2pos(1),r=-1,c=0;c<this.railLen_d;c++){var l=cc.instantiate(this.railPrefab).getComponent(n.default),h=c<this.railLen_d-2;r=0==c?l.init(0,r,h):c==this.railLen_d-1?l.init(2,r,h):l.init(1,r,h),l.node.parent=this.node,l.node.setSiblingIndex(0);var u=this.crd2pos(c/this.stepLen_d);l.node.position=cc.v3(u.x,u.y,0),this.railList.push(l)}return s},e.prototype.refresh=function(){for(var t=0;t<this.railLen_d&&t<this.finished_d;t++)this.railList[t].setActive(!0)},__decorate([r(cc.Prefab)],e.prototype,"railPrefab",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"./RailingCurve":"RailingCurve","./RailingRail":"RailingRail"}],RailingRail:[function(t,e,i){"use strict";cc._RF.push(e,"1dfb0yDIzdMWLHM1cznKTXM","RailingRail"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./config/config"),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spriteRenderer=null,e.railUnitSprite=null,e.wave=null,e.stones=[],e._active=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!1,configurable:!0}),e.prototype.setActive=function(t){this._active=t,this.refresh()},e.prototype.refresh=function(){this.railUnitSprite.enabled=this.active},e.prototype.init=function(t,e,i){void 0===i&&(i=!0),this.wave.active=i;var n=0;if(0==t)n=0;else if(1==t)do{n=Math.floor(Math.random()*(this.stones.length-2)+1)}while(n==e);else 2==t&&(n=this.stones.length-1);this.spriteRenderer.spriteFrame=this.stones[n];var a=o.Railing.offsets[n];return this.spriteRenderer.node.position=cc.v3(a.x,a.y,0),this.setActive(!1),n},__decorate([s(cc.Sprite)],e.prototype,"spriteRenderer",void 0),__decorate([s(cc.Sprite)],e.prototype,"railUnitSprite",void 0),__decorate([s(cc.Node)],e.prototype,"wave",void 0),__decorate([s(cc.SpriteFrame)],e.prototype,"stones",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./config/config":"config"}],RailingRoom:[function(t,e,i){"use strict";cc._RF.push(e,"8f42fi6EmVLe54lJUBbLH9c","RailingRoom"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./RailingModel"),n=__importDefault(t("./RailingMapUnit")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.map=[],e.mapWidth_d=0,e.mapHeight_d=0,e.startPoint_d=cc.Vec2.ZERO,e.endPoint_d=cc.Vec2.ZERO,e.roomSize=cc.Vec2.ZERO,e.mapUnitPrefab=null,e.unitFolder=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"mapUnitSize",{get:function(){return cc.v2(this.roomSize.x/this.mapWidth_d,this.roomSize.y/this.mapHeight_d)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rootPos",{get:function(){return cc.v2(this.node.position.x,this.node.position.y)},set:function(t){this.node.position=cc.v3(t.x,t.y,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapOffset",{get:function(){return cc.v2(this.roomSize.x/2-this.mapUnitSize.x/2,0)},enumerable:!1,configurable:!0}),e.prototype.init=function(t,e,i,o,n,a){this.startPoint_d=e,this.endPoint_d=i,this.roomSize=n,this.rootPos=cc.v2(0,o.y),this.map.length=0,this.mapHeight_d=t.length,this.mapWidth_d=t[0].length;for(var s=0;s<this.mapWidth_d;s++){for(var r=[],c=0;c<this.mapHeight_d;c++){var l=t[this.mapHeight_d-c-1][s],h=this.crd2Pos_local(cc.v2(s,c)),u=this.generateMapUnit(l,h,cc.v2(s,c),a);r.push(u)}this.map.push(r)}},e.prototype.validCrd=function(t){return!(t.y>=this.mapHeight_d||t.y<0||t.x>=this.mapWidth_d||t.x<0)},e.prototype.generateMapUnit=function(t,e,i,o){var a=cc.instantiate(this.mapUnitPrefab).getComponent(n.default);return a.init(i),a.node.parent=this.unitFolder,a.node.setSiblingIndex(0),a.node.scale=o,a.setState(t),a.node.position=cc.v3(e.x,e.y,0),a},e.prototype.crd2Info=function(t){return this.validCrd(t)?this.map[t.x][t.y]:null},e.prototype.pos2Crd=function(t){var e=t.sub(this.rootPos).add(this.mapOffset),i=Math.round(e.x/this.mapUnitSize.x),o=Math.round(e.y/this.mapUnitSize.y);return cc.v2(i,o)},e.prototype.crd2Pos=function(t){return this.crd2Pos_local(t).add(this.rootPos)},e.prototype.crd2Pos_local=function(t){return cc.v2(t.x*this.mapUnitSize.x,t.y*this.mapUnitSize.y).sub(this.mapOffset)},e.prototype.getArriveUnitCrd=function(t,e){var i=this.pos2Crd(e),n=this.crd2Pos(i),a=e.sub(n),s=t instanceof cc.Vec2?t:o.dirMap.get(t);return a.dot(s)>=0?i:i.sub(s)},e.prototype.isInEndPos=function(t){var e=this.pos2Crd(t);return!this.validCrd(e)||this.endPoint_d.equals(e)},e.prototype.start=function(){console.log("room")},__decorate([r(cc.Prefab)],e.prototype,"mapUnitPrefab",void 0),__decorate([r(cc.Node)],e.prototype,"unitFolder",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"./RailingMapUnit":"RailingMapUnit","./RailingModel":"RailingModel"}],RescueHeroItem:[function(t,e,i){"use strict";cc._RF.push(e,"27b98g+eU1DVqFcfN/4Rs7Z","RescueHeroItem"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hero=null,e.speedX=600,e.speedY=300,e._isFall=!1,e._isDie=!1,e._tween=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"isFall",{get:function(){return this._isFall},set:function(t){this._isFall=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDie",{get:function(){return this._isDie},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.hero.setAnimation(0,"run",!0)},e.prototype.playAnim=function(){var t=this,e=this.speedX,i=Math.abs((this.node.y- -300)/this.speedY),o=Math.abs((this.node.x-500)/e);this._tween=cc.tween(this.node).to(i,{y:-300}).to(o,{x:500}).call(function(){t.isDie||(t.node.active=!1)}).start()},e.prototype.stopAnim=function(){this._tween&&this._tween.stop()},e.prototype.playDefeatAnim=function(){var t=this;this._isDie=!0,this.speedX;var e=Math.abs((this.node.y- -300)/this.speedY),i=this._tween;this._tween=cc.tween(this.node).parallel(cc.tween().delay(.5).call(function(){i&&i.stop(),i=null,t.hero.setAnimation(0,"die",!1)}).delay(1).call(function(){n.default.instance.miniGameAdapter.eventMgr.emit(o.MiniGameEvent.EventGameFail)}),cc.tween(this.node).to(e,{y:-300})).start()},e.prototype.playAttackAnim=function(){var t=this;this.hero.setAnimation(0,"attack",!1),this.hero.setCompleteListener(function(){t.hero.setAnimation(0,"idle",!0)})},e.prototype.onDisable=function(){this._tween&&this._tween.stop()},__decorate([r(sp.Skeleton)],e.prototype,"hero",void 0),__decorate([r],e.prototype,"speedX",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../../../game/scripts/mini-adapter/types-miniPre":void 0,"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],RescueHeroLogic:[function(t,e,i){"use strict";cc._RF.push(e,"ed35eHJnZBJXa4YQEa9mTJs","RescueHeroLogic"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=t("../../miniGamePackage/texturePlus/PolygonUtil"),s=__importDefault(t("../../miniGamePackage/texturePlus/TexturePlus")),r=__importDefault(t("./RescueHeroItem")),c=cc._decorator,l=c.ccclass,h=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.graphics=null,e.texture=null,e.hero1Texture=null,e.hero2Texture=null,e.textures=[],e.hero1Textures=[],e.hero2Textures=[],e.heros=[],e.scissors=null,e._startPoint=null,e._endPoint=null,e._tween=null,e._movePoints=[],e._isGameOver=!1,e._isCut=!1,e._isHero1Fall=!1,e._isHero2Fall=!1,e}return __extends(e,t),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this);for(var t=0;t<this.heros.length;t++)this.heros[t].node.zIndex=100+t},e.prototype._onTouchStart=function(t){var e=t.getLocation();this._startPoint=this.node.convertToNodeSpaceAR(e),this._movePoints.push(this._startPoint),this.graphics.moveTo(this._startPoint.x,this._startPoint.y)},e.prototype._onTouchMove=function(t){var e=t.getLocation(),i=this.node.convertToNodeSpaceAR(e);this.graphics.lineTo(i.x,i.y),this.graphics.stroke();var o=this._movePoints[this._movePoints.length-1];if(o.sub(i).mag()<10&&o.sub(i).mag()>5)this._movePoints.push(i);else if(o.sub(i).mag()>=10)for(var n=o.sub(i).mag(),a=Math.ceil(n/10),s=1;s<=a;s++){var r=Math.min(10*s/n,1),c=cc.misc.lerp(o.y,i.y,r),l=cc.misc.lerp(o.x,i.x,r);this._movePoints.push(cc.v2(l,c))}},e.prototype._onTouchEnd=function(t){var e=t.getLocation();this._endPoint=this.node.convertToNodeSpaceAR(e),this._isCut=!0,this._cutRope(),this._unRegisterEvent()},e.prototype._cutRope=function(){if(0!=this._movePoints.length){var t=this.scissors.node.getPosition();this.scissors.node.setPosition(this._movePoints.shift());var e=this.scissors.node.getPosition();this.scissors.node.angle=180*-cc.v2(e.sub(t)).signAngle(cc.v2(0,1))/Math.PI;for(var i=0;i<2;i++)if(this.textures[i].node.getBoundingBox().contains(e)){var o=t.sub(e).normalize(),n=e.add(o.mul(40)),a=e.add(o.mul(-40));this.useLineCutPolygon(n,a)}}},e.prototype.update=function(){if(!this._isGameOver){for(var t=!0,e=0;e<this.heros.length;e++)if(this.heros[e].node.active){t=!1;break}var i=this.heros[1].node.getPosition();this.heros[0].node.getBoundingBox().contains(i)&&!this.heros[0].isDie&&!this.heros[1].isDie&&this.heros[0].node.active&&this.heros[1].node.active&&(this._isGameOver=!0,this.heros[1].stopAnim(),this.heros[0].playDefeatAnim(),this.heros[1].playAttackAnim());var a=n.default.instance.miniGameAdapter.eventMgr;if(t&&(this._isGameOver=!0,a.emit(o.MiniGameEvent.EventGameWin)),this._isCut)if(this._movePoints.length>0)for(e=0;e<5;e++)this._cutRope();else{for(this._isCut=!1,this.graphics.clear(),e=0;e<this.heros.length;e++)if(!this.heros[e].isFall){this._isGameOver=!0,a.emit(o.MiniGameEvent.EventGameFail);break}this.scissors.node.active=!1}}},e.prototype.splitTexture=function(t,e,i,o){for(var n=e[0],a=Number.MIN_SAFE_INTEGER,r=0;r<e.length;r++)for(var c=0;c<e[r].length;c++)e[r][c]=e[r][c],e[r][c].y>a&&(a=e[r][c].y,n=e[r]);var l=e.indexOf(n);for(e.splice(l,1),t.polygon=n,r=1;r<e.length;r++){var h=cc.instantiate(t.node),u=h.getComponent(s.default);h.parent=this.node,h.zIndex=1,h.setPosition(t.node.position),u.texture=i,u.polygon=e[r],o.push(u)}},e.prototype.useLineCutPolygon=function(t,e){for(var i=this.node.convertToWorldSpaceAR(t),o=this.node.convertToWorldSpaceAR(e),n=1;n>=0;n--){var a=this.textures[n],s=this.heros[n],r=this._getPolygon(a,i,o);r.length<=0||(!s.isFall&&r.length>1&&(s.isFall=!0,s.playAnim()),this.splitTexture(a,r,this.texture,this.textures))}this._playAnim()},e.prototype._playAnim=function(){for(var t=this.textures.length-1;t>1;t--){var e=this.textures[t];this.textures.splice(t,1);var i=Math.abs((e.node.y- -300)/600);cc.tween(e.node).parallel(cc.tween(e.node).to(.2,{opacity:0}),cc.tween(e.node).to(i,{y:-300})).start()}},e.prototype._getPolygon=function(t,e,i){var o=e.clone(),n=i.clone();return o=t.node.convertToNodeSpaceAR(e),n=t.node.convertToNodeSpaceAR(i),a.PolygonUtil.lineCutPolygon(o,n,t.polygon)},e.prototype._unRegisterEvent=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this)},e.prototype.onDisable=function(){this._unRegisterEvent()},__decorate([h(cc.Graphics)],e.prototype,"graphics",void 0),__decorate([h(cc.Texture2D)],e.prototype,"texture",void 0),__decorate([h(cc.Texture2D)],e.prototype,"hero1Texture",void 0),__decorate([h(cc.Texture2D)],e.prototype,"hero2Texture",void 0),__decorate([h([s.default])],e.prototype,"textures",void 0),__decorate([h([s.default])],e.prototype,"hero1Textures",void 0),__decorate([h([s.default])],e.prototype,"hero2Textures",void 0),__decorate([h([r.default])],e.prototype,"heros",void 0),__decorate([h(sp.Skeleton)],e.prototype,"scissors",void 0),__decorate([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../../../../game/scripts/mini-adapter/types-miniPre":void 0,"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/texturePlus/PolygonUtil":"PolygonUtil","../../miniGamePackage/texturePlus/TexturePlus":"TexturePlus","./RescueHeroItem":"RescueHeroItem"}],RescueHeroModel:[function(t,e,i){"use strict";cc._RF.push(e,"7e527C5Tl9G/qNpeoYqImyd","RescueHeroModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.RescueHeroModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/rescueHeroGame/rescueHeroGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.rescueHeroGame)],e)}(n.default);i.RescueHeroModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],ScrewBoard:[function(t,e,i){"use strict";cc._RF.push(e,"d0fcf0Y2sxK75Mkafi1O/A5","ScrewBoard"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/p2/P2ConvexUtil")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boardType=0,e.boardPrefabs=[],e.points=[],e.screwType=1,e.isAwake=!0,e.factor=15,e.body=null,e}return __extends(e,t),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this)},e.prototype._onTouchStart=function(){},e.prototype.createBoard=function(t,e){var i=null;switch(e){case 1:i=this._createScrew1(t);break;case 3:i=this._createScrew3(t);break;case 4:i=this._createScrew4(t);break;default:i=this._createScrew1(t)}t.addBody(i),this.body=i,this.body.collisionResponse=this.isAwake},e.prototype._createScrew1=function(){for(var t=[],e=0;e<this.points.length;e++){var i=this.points[e];t[e]=[],t[e].push(i.x/this.factor),t[e].push(i.y/this.factor)}var a=new o.P2.Body({angle:-this.node.angle/180*Math.PI,mass:1,position:[this.node.x/this.factor,this.node.y/this.factor]}),s=n.default.getInstance().createPolygonShape(this.points);for(e=0;e<s.length;e++){var r=s[e];a.addShape(r)}return a.allowSleep=!1,a.damping=0,a.displays=[this.node],a},e.prototype._createScrew3=function(){var t=this.node.parent.getPosition(),e=new o.P2.Circle({radius:30/this.factor}),i=new o.P2.Body({mass:0,position:[t.x/this.factor,t.y/this.factor]});return i.damping=0,i.displays=[this.node],i.addShape(e),i},e.prototype._createScrew4=function(){var t=this.node.parent.getPosition(),e=new o.P2.Circle({radius:25/this.factor}),i=new o.P2.Body({mass:0,position:[t.x/this.factor,t.y/this.factor]});return e.sensor=!0,i.allowSleep=!1,i.damping=0,i.displays=[this.node],i.addShape(e),i},__decorate([r],e.prototype,"boardType",void 0),__decorate([r([cc.Prefab])],e.prototype,"boardPrefabs",void 0),__decorate([r([cc.Vec2])],e.prototype,"points",void 0),__decorate([r],e.prototype,"screwType",void 0),__decorate([r],e.prototype,"isAwake",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/p2/P2ConvexUtil":"P2ConvexUtil"}],ScrewGame2:[function(t,e,i){"use strict";cc._RF.push(e,"e3e76kQBLBK/IHd730hYi7o","ScrewGame2"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importStar(t("../../miniGamePackage/SubPackageManager")),n=__importDefault(t("./ScrewBoard")),a=__importDefault(t("./ScrewItem")),s=t("./ScrewModel"),r=__importDefault(t("./ScrewSensorHoleComp")),c=__importDefault(t("./ScrewSpikeComp")),l=cc._decorator,h=l.ccclass,u=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.holes=[],e.spikes=[],e.boards=[],e.screwBoards=[],e.boardPrefabs=[],e.spikePrefab=null,e._isGameOver=!1,e._isGameStart=!1,e._world=null,e.mapStr="",e.spikeStr="",e}return __extends(e,t),Object.defineProperty(e.prototype,"world",{get:function(){return this._world},set:function(t){this._world=t},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){this._isGameStart=!1,this._init()},e.prototype.initGame=function(){this.world=new o.P2.World,this.world.sleepMode=o.P2.World.BODY_SLEEPING,this.world.setGlobalRelaxation(5),this.world.gravity=[0,-50],this.world.defaultContactMaterial.friction=.01;for(var t=0;t<this.screwBoards.length;t++){var e=this.screwBoards[t];e.createBoard(this.world,e.screwType)}this.world.on("beginContact",this.onBeginContact,this),this.world.on("endContact",this.onEndContact,this),this._registerTouchEvent(),this._initScrewPos()},e.prototype.onBeginContact=function(t){t.bodyA,t.bodyB;for(var e=0;e<this.holes.length;e++)this.holes[e].onBeginContact(t)},e.prototype.onEndContact=function(t){t.bodyA,t.bodyB;for(var e=0;e<this.holes.length;e++)this.holes[e].onEndContact(t)},e.prototype._initScrewPos=function(){for(var t=0;t<this.spikes.length;t++){var e=this.spikes[t];this._updateScrewPos(e)}},e.prototype._init=function(){this.world=new o.P2.World,this.world.sleepMode=o.P2.World.BODY_SLEEPING,this.world.setGlobalRelaxation(5),this.world.gravity=[0,-50],this.world.defaultContactMaterial.friction=.01;for(var t=JSON.parse(this.mapStr),e=JSON.parse(this.spikeStr),i=0;i<t.length;i++)if(0!==(d=t[i]).boardType){var n=(u=cc.instantiate(this.boardPrefabs[d.boardType])).getComponent(a.default),l=n.screwBoard;if(n.node.setPosition(d.pos),l.node.angle=d.angle,l.isAwake=d.isAwake,l.boardType=d.boardType,l.screwType=d.screwType,l.createBoard(this.world,d.screwType),d.screwType===s.ScrewType.POLYGON&&(this.boards.push(l.node),this.screwBoards.push(l),u.zIndex=20*(i+10)),l.screwType===s.ScrewType.HOLE){var h=l.getComponent(r.default);h.sensorBoard.createBoard(this.world,s.ScrewType.CIRCLE_SENSOR),this.holes.push(h)}this.node.addChild(u)}for(i=0;i<e.length;i++){var u,d=e[i],p=(u=cc.instantiate(this.spikePrefab)).getComponent(c.default);p.node.setPosition(d),this.spikes.push(p),this.node.addChild(u),u.zIndex=20*(i+40)}this.world.on("beginContact",this.onBeginContact,this),this.world.on("endContact",this.onEndContact,this),this._registerTouchEvent(),this._initScrewPos(),this._isGameStart=!0},e.prototype._genMap=function(){for(var t=[],e=0;e<this.screwBoards.length;e++){var i=this.screwBoards[e],o={};o.screwType=i.screwType,o.pos=i.node.getPosition(),o.angle=i.node.angle,o.isAwake=i.isAwake,o.boardType=i.boardType,t.push(o)}var n=[];for(e=0;e<this.spikes.length;e++)i=this.spikes[e],n.push(i.node.getPosition());console.log(JSON.stringify(t)),console.log(JSON.stringify(n))},e.prototype._updateScrewPos=function(t){for(var e=t.node.getPosition(),i=0;i<this.holes.length;i++){var o=this.holes[i];if(!o.isUsed){var n=o.node.parent,a=n.getPosition();this._isCollide(e,a,n.width/2,n.height/2)&&(t.hole=o)}}t.updatePos()},e.prototype.update=function(){if(this._isGameStart&&!this._isGameOver&&this.world){this.world.step(1/60),cc.winSize.height;for(var t=this.world.bodies.length,e=0;e<t;e++){var i=this.world.bodies[e];if(i.displays&&!(i.displays.length<=0)){var a=i.displays[0];a&&(a.x=15*i.position[0],a.y=15*i.position[1],a.angle=180*(i.angle+i.shapes[0].angle)/Math.PI)}}var s=!0;for(e=0;e<this.boards.length;e++){var r=this.boards[e];if(r.y>-1500)s=!1;else if(r.y<-1500){var c=r.getComponent(n.default).body;c.sleep(),c.collisionResponse=!1,this.boards.splice(e,1),e--}}s&&(this._isGameOver=!0,o.default.instance.gotoResultWithLoading(!0,this.node.parent))}},e.prototype.start=function(){},e.prototype._registerTouchEvent=function(){for(var t=0;t<this.spikes.length;t++){var e=this.spikes[t];e.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),e.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),e.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this)}},e.prototype._unRegisterTouchEvent=function(){for(var t=0;t<this.spikes.length;t++){var e=this.spikes[t];e.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),e.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),e.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this)}},e.prototype._onTouchStart=function(t){var e=t.getCurrentTarget(),i=t.getLocation();e.parent.convertToNodeSpaceAR(i),e.getComponent(c.default).playMoveAnim()},e.prototype._onTouchMove=function(t){var e=t.getLocation(),i=t.getCurrentTarget(),o=(i.getComponent(c.default),i.parent.convertToNodeSpaceAR(e));i.setPosition(o)},e.prototype._onTouchEnd=function(t){var e=t.getLocation(),i=t.getCurrentTarget(),o=i.getComponent(c.default);i.parent.convertToNodeSpaceAR(e),this._updateScrewPos(o),o.playStopAnim()},e.prototype._isCollide=function(t,e,i,o){var n=cc.v2(e.x+i,e.y-o),a=cc.v2(e.x-i,e.y-o),s=cc.v2(e.x-i,e.y+o),r=cc.v2(e.x+i,e.y+o),c=this._isInTriangle(t,n,a,s),l=this._isInTriangle(t,n,r,s);return c||l},e.prototype._isInTriangle=function(t,e,i,o){var n=i.sub(e),a=o.sub(e),s=o.sub(i),r=t.sub(e),c=t.sub(i);return n.cross(a)>=0!=n.cross(r)<0&&n.cross(a)>=0!=a.cross(r)>=0&&s.cross(n)>0!=s.cross(c)>=0},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},e.prototype.onDisable=function(){this._isGameOver=!0,this.world.clear(),this.world.off("beginContact",this.onBeginContact),this.world.off("endContact",this.onEndContact),this.world=null,this._unRegisterTouchEvent()},__decorate([u([r.default])],e.prototype,"holes",void 0),__decorate([u([c.default])],e.prototype,"spikes",void 0),__decorate([u([cc.Node])],e.prototype,"boards",void 0),__decorate([u([n.default])],e.prototype,"screwBoards",void 0),__decorate([u([cc.Prefab])],e.prototype,"boardPrefabs",void 0),__decorate([u(cc.Prefab)],e.prototype,"spikePrefab",void 0),__decorate([u],e.prototype,"mapStr",void 0),__decorate([u],e.prototype,"spikeStr",void 0),__decorate([h],e)}(cc.Component);i.default=d,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./ScrewBoard":"ScrewBoard","./ScrewItem":"ScrewItem","./ScrewModel":"ScrewModel","./ScrewSensorHoleComp":"ScrewSensorHoleComp","./ScrewSpikeComp":"ScrewSpikeComp"}],ScrewItem:[function(t,e,i){"use strict";cc._RF.push(e,"81527VVRDlDMZdbjR5ZAnLX","ScrewItem"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./ScrewBoard")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.screwBoard=null,e}return __extends(e,t),__decorate([s(o.default)],e.prototype,"screwBoard",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./ScrewBoard":"ScrewBoard"}],ScrewModel:[function(t,e,i){"use strict";cc._RF.push(e,"54808DFHyZNz71Xwd33oMbN","ScrewModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.ScrewModel=i.ScrewType=i.ScrewColliderType=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame");(function(t){t[t.SCREW_SPIKE=Math.pow(2,0)]="SCREW_SPIKE",t[t.SCREW_HOLE=Math.pow(2,1)]="SCREW_HOLE",t[t.SCREW_OTHER=Math.pow(2,2)]="SCREW_OTHER"})(i.ScrewColliderType||(i.ScrewColliderType={})),function(t){t[t.POLYGON=1]="POLYGON",t[t.HOLE=3]="HOLE",t[t.CIRCLE_SENSOR=4]="CIRCLE_SENSOR"}(i.ScrewType||(i.ScrewType={}));var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/screwMiniGame/screwMiniGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.screwMiniGame)],e)}(n.default);i.ScrewModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],ScrewSensorHoleComp:[function(t,e,i){"use strict";cc._RF.push(e,"24bf4xE5NlMGpOR1uTFoFJM","ScrewSensorHoleComp"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./ScrewBoard")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.board=null,e.sensorBoard=null,e._curPos=cc.v2(),e._colliderList=[],e._isUsed=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"_body",{get:function(){return this.board.body},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_sensorBody",{get:function(){return this.sensorBoard.body},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curPos",{get:function(){return this._curPos},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUsed",{get:function(){return this._isUsed||this._colliderList.length>0},set:function(t){this._isUsed=t,this.updateColliderBodyActive()},enumerable:!1,configurable:!0}),e.prototype.onBeginContact=function(t){var e=t.bodyA,i=t.bodyB,o=t.shapeA,n=t.shapeB;e===this._sensorBody?-1===this._colliderList.indexOf(n)&&this._colliderList.push(n):i===this._sensorBody&&-1===this._colliderList.indexOf(o)&&this._colliderList.push(o)},e.prototype.onEndContact=function(t){var e=t.bodyA,i=t.bodyB,o=t.shapeA,n=t.shapeB;if(e===this._sensorBody)(a=this._colliderList.indexOf(n))>-1&&this._colliderList.splice(a,1);else if(i===this._sensorBody){var a;(a=this._colliderList.indexOf(o))>-1&&this._colliderList.splice(a,1)}},e.prototype.onLoad=function(){this._curPos=this._curPos,this.updateColliderBodyActive()},e.prototype.updateColliderBodyActive=function(){this.board.body&&(0==this._colliderList.length&&this.isUsed?(this.board.body.collisionResponse=!0,this.board.body.wakeUp()):(this.board.body.collisionResponse=!1,this.board.body.sleep()))},__decorate([s(o.default)],e.prototype,"board",void 0),__decorate([s(o.default)],e.prototype,"sensorBoard",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./ScrewBoard":"ScrewBoard"}],ScrewSpikeComp:[function(t,e,i){"use strict";cc._RF.push(e,"1c6a4MXpi9PkqIr4mOfAhwn","ScrewSpikeComp"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skeleton=null,e._anim={idle1:"idle1",idle2:"idle2",in:"in",out:"out"},e._curAnim="",e._hole=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"hole",{get:function(){return this._hole},set:function(t){this._hole&&(this._hole.isUsed=!1),t.isUsed=!0,this._hole=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_curPos",{get:function(){return this.hole?this.hole.node.parent.getPosition():cc.v2()},enumerable:!1,configurable:!0}),e.prototype.playMoveAnim=function(){this._curAnim!==this._anim.out&&(this.skeleton.loop=!1,this.skeleton.animation=this._anim.out)},e.prototype.playStopAnim=function(){this._curAnim!==this._anim.in&&(this.skeleton.loop=!1,this.skeleton.animation=this._anim.in)},e.prototype.updatePos=function(){this.node.setPosition(this._curPos)},e.prototype.onLoad=function(){this.skeleton.loop=!1,this.skeleton.animation=this._anim.idle1},__decorate([a(sp.Skeleton)],e.prototype,"skeleton",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],Self:[function(t,e,i){"use strict";cc._RF.push(e,"8749dzVAX9AgqBhdvbc8Q8v","Self"),Object.defineProperty(i,"__esModule",{value:!0}),i.BladeFlySelf=void 0;var o=t("../../../miniGamePackage/utils/Line"),n=function(t){function e(e,i){var n=this,a=[o.Line.Vec2Line(cc.v2(1,0),cc.v2(e.x-i.x/2,e.y+i.y/2),i.x),o.Line.Vec2Line(cc.v2(0,-1),cc.v2(e.x+i.x/2,e.y+i.y/2),i.y),o.Line.Vec2Line(cc.v2(-1,0),cc.v2(e.x+i.x/2,e.y-i.y/2),i.x),o.Line.Vec2Line(cc.v2(0,1),cc.v2(e.x-i.x/2,e.y-i.y/2),i.y)];return(n=t.call(this,a)||this).center=e,n.size=i,n}return __extends(e,t),e.prototype.collisionRet=function(t){var e={},i=t.point.add(t.dir.mul(this.ACCURACY)),n=o.Line.Vec2Line(t.dir,i,t.dist),a=Number.MAX_VALUE;return this.edge.forEach(function(t){var o=t.intersect(n);if(o){var s=cc.Vec2.distance(o,i);s<a&&(e.selfDie=!0,e.point=o,a=s)}}),e},e}(t("./ColliderObjBase").BladeFlyColliderObjBase);i.BladeFlySelf=n,cc._RF.pop()},{"../../../miniGamePackage/utils/Line":"Line","./ColliderObjBase":"ColliderObjBase"}],SingleClass:[function(t,e,i){"use strict";cc._RF.push(e,"fbf14qqhvtHsK+DrxtRK7UB","SingleClass"),Object.defineProperty(i,"__esModule",{value:!0}),i.SingleClass=void 0;var o=function(){function t(){}return t.getInst=function(){return this._instance||(this._instance=new this),this._instance},t}();i.SingleClass=o,cc._RF.pop()},{}],StateBase:[function(t,e,i){"use strict";cc._RF.push(e,"b9cfbLJh/RHXbbGu8wZzgiA","StateBase"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGameStateBase=i.FishGameState=void 0;var o,n=t("../config_FishGame");(function(t){t[t.idle=0]="idle",t[t.patrol=1]="patrol",t[t.escape=2]="escape",t[t.catch=3]="catch"})(o=i.FishGameState||(i.FishGameState={}));var a=function(){function t(t){this.nextEscapeTime=0,this.isGetEscapeTarget=!1,this.owner=t}return t.prototype.onEnterState=function(){},t.prototype.onUpdateState=function(){},t.prototype.onExitState=function(){},t.prototype.testEscape=function(){for(var t=this.owner.getAreaInfo(this.owner.center,this.owner.real_visiualRadius).targets,e=0;e<t.length;e++)if(!t[e].isDie&&t[e].score>this.owner.score)return this.isGetEscapeTarget?Date.now()>this.nextEscapeTime&&(this.owner.onSwitch(o.escape),!0):(this.isGetEscapeTarget=!0,this.nextEscapeTime=Date.now()+Math.random()*(n.FishGame.escapeDelayTimeRange.y-n.FishGame.escapeDelayTimeRange.x)+n.FishGame.escapeDelayTimeRange.x,!1);return this.isGetEscapeTarget=!1,!1},t.prototype.testCatch=function(){for(var t=this.owner.getAreaInfo(this.owner.center,this.owner.real_catchRadius).targets,e=0;e<t.length;e++)if(!t[e].isDie&&t[e].score<this.owner.score)return this.owner.onSwitch(o.catch,{target:t[e]}),!0;return!1},t}();i.FishGameStateBase=a,cc._RF.pop()},{"../config_FishGame":"config_FishGame"}],SubGlobalEntity:[function(t,e,i){"use strict";cc._RF.push(e,"b6c8aX6gSxJ6p6+DDsz9g4D","SubGlobalEntity"),Object.defineProperty(i,"__esModule",{value:!0}),i.SubGlobalEntity=void 0;var o=cc._decorator,n=o.ccclass,a=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var i;return __extends(e,t),i=e,e._getInstance=function(t){if(!t._instance||t._instance.constructor!==t)if(t===i){var e=new cc.Node("Sub Global Entity");e.parent=cc.director.getScene(),e.addComponent(t),cc.game.addPersistRootNode(e)}else t._getInstance(i).node.addComponent(t);return t._instance},e.prototype.onLoad=function(){var t=this,e=this.constructor;e._instance&&e._instance.constructor===e?(console.warn("The singleton has been created."),Promise.resolve().then(function(){t.node.isValid&&t.node.destroy()})):(e._instance=this,cc.game.isPersistRootNode(this.node)||cc.game.addPersistRootNode(this.node))},e.prototype.onDestroy=function(){var t=this.constructor;t._instance===this&&(t._instance=null)},e._instance=null,i=__decorate([n],e)}(cc.Component));i.SubGlobalEntity=a,cc._RF.pop()},{}],SubPackageManager:[function(t,e,i){"use strict";cc._RF.push(e,"b80e8Jf7fRPkIPYPzdtv/me","SubPackageManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.MiniGameLayer=i.addSubPackage=i.SubPackageKeyToModel=i.p5Noise=i.P2=void 0;var o=t("./utils/SingleClass"),n=t("./utils/PlatformUtils"),a=t("./utils/SubResourceUtils"),s=__importDefault(t("./MiniGameResultWindow")),r=t("./types-miniGame"),c=t("../../../game/scripts/mini-adapter/types-miniPre"),l=t("./base/MiniGameUIManager"),h=t("./utils/MiniGameDefer"),u=t("./MiniGameScreen");t("./p2/p2.js");var d,p=t("./base/MiniGameTipsManager"),m=t("./MiniGameLoading");i.P2=p2,i.p5Noise=t("./noise/noise.js"),i.SubPackageKeyToModel={},i.addSubPackage=function(t){return function(e){i.SubPackageKeyToModel[t]=e}},function(t){t.Main="main",t.SubGame="subGame",t.Loading="loading",t.Tips="tips"}(d=i.MiniGameLayer||(i.MiniGameLayer={}));var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.useMiniGame=!1,e.model=void 0,e.enterParams={miniGame:[],miniGameEnter:c.MiniGameEnterType.AutoEnter},e._currentKey=r.SubPackageKey.default,e._closeCallback=void 0,e.inUse=!1,e._startTime=0,e._adapter=null,e.maxHeight=1506,e.miniGameData=null,e.layers=new Map,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this.getInst()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"miniGameAdapter",{get:function(){return this._adapter},set:function(t){this._adapter=t},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(t){this.inUse=!0,this.miniGameData=t,this.miniGameAdapter=t.adapter,this.resolveQueryParams();var e=this.miniGameAdapter.miniGameRoot,i=e.getContentSize();for(var o in d){var n=d[o],a=new cc.Node(n);a.setContentSize(i),e.addChild(a),this.layers.set(n,a)}},e.prototype.getLayer=function(t){return this.layers.get(t)},e.prototype.showGame=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.currentKey==t?(console.warn("\u5f53\u524d\u5b50\u5305\u5df2\u7ecf\u663e\u793a"),[2]):(console.warn("start miniGame",t),this.currentKey=t,this._startTime=0,[4,this.start(e)]);case 1:return i.sent(),[2]}})})},e.prototype.start=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(o){switch(o.label){case 0:return e=this.miniGameAdapter.fguiRoot,[4,l.MiniGameUIManager.instance.gameRun(this.currentKey,e)];case 1:return o.sent()?(e.visible=!0,this._startTime=this.miniGameAdapter.lastServerTime,[2]):this.initModel()?((i=this.model).prepare(),[4,i.gameRun(void 0,t)]):[3,3];case 2:return o.sent()?(this.emitHideLoaidngUI(),this._startTime=this.miniGameAdapter.lastServerTime,[3,4]):(console.error("\u6e38\u620f\u542f\u52a8\u5f02\u5e38: "+this.currentKey),this.exitGameCenter(),[2]);case 3:return console.error("\u52a0\u8f7d\u5b50\u5305\u5f02\u5e38"),this.exitGameCenter(),[2];case 4:return[2]}})})},e.prototype.loadSubpackage=function(t){return __awaiter(this,void 0,Promise,function(){var e,i;return __generator(this,function(){return e=new h.MiniGameDefer,i=r.SubPackageKey[t],n.isCocosGame?cc.assetManager.loadBundle(i,null,function(t,i){i?e.resolve(!0):e.reject(!1)}):wx.loadSubpackage({name:function(){return i},success:function(){e.resolve(!0)},fail:function(){e.reject(!1)},complete:function(){}}),[2,e.promise]})})},e.prototype.initModel=function(){if(null==this.currentKey||this.currentKey<0)return console.warn("\u9700\u8981\u6253\u5f00\u7684\u5b50\u5305\u5f02\u5e38"),!1;if(!i.SubPackageKeyToModel[this.currentKey])return console.warn("SubPackageKeyToModel\u7f3a\u5c11\u5bf9\u5e94\u7684model\u914d\u7f6e"),!1;var t=i.SubPackageKeyToModel[this.currentKey];return this.model=new t,!0},e.prototype.backToGameCenter=function(){console.warn("back to game center!",this.currentKey),this._closeCallback&&(this._closeCallback(),this._closeCallback=void 0);var t=this.miniGameAdapter.lastServerTime-this._startTime;this._startTime>0&&t>0&&t<864e5&&(l.MiniGameUIManager.instance.sendEventToGame(c.MiniGameEvent.MiniGameTGA,c.MiniGameTAGEvent.PlayMiniGameTime,{key:this.currentKey,time:t}),this._startTime=0),this.currentKey,this.currentKey=r.SubPackageKey.default,this.model=void 0;var e=u.MiniGameScreen.instance;p.MiniGameTipsManager.getInst().closeAll(),l.MiniGameUIManager.instance.closeAllView();for(var i=0,o=this.getLayer(d.SubGame).children||[];i<o.length;i++){var n=o[i];n!=(null==e?void 0:e.node)&&n.destroy()}null==e||e.backToShow()},e.prototype.exitGameCenter=function(t){void 0===t&&(t=!1),console.warn("exit game center!"),this._closeCallback&&(this._closeCallback(),this._closeCallback=void 0),this.emitCloseMiniGame(t),this.inUse=!1,this._startTime=0,this.layers.clear(),setTimeout(function(){a.SubResourceUtils.getInst().releaseBundle(c.BundleNameMini.miniGameRes),a.SubResourceUtils.getInst().releaseBundle(c.BundleNameMini.miniGameScripts),console.warn("release game center bundle")},100)},e.prototype.resolveQueryParams=function(){var t=globalThis.query;if(t&&"object"==typeof t){if(t.miniGameEnter&&(this.enterParams.miniGameEnter=t.miniGameEnter),t.miniGameExtra&&(this.enterParams.miniGameExtra=t.miniGameExtra),t.miniGame){var e=t.miniGame.split("|");this.enterParams.miniGame=e.map(function(t){return parseInt(t)})}}else if(t&&"string"==typeof t)for(var i=globalThis.query.split("&"),o=0;o<i.length;o++){var n=i[o].split("="),a=n[0],s=n[1];switch(a){case"miniGameEnter":this.enterParams.miniGameEnter=s;break;case"miniGameExtra":this.enterParams.miniGameExtra=s;break;case"miniGame":e=s.split("|"),this.enterParams.miniGame=e.map(function(t){return parseInt(t)})}}},e.prototype.gotoResultWithLoading=function(t,e,i,o){return __awaiter(this,void 0,void 0,function(){var n,r,h;return __generator(this,function(u){switch(u.label){case 0:return l.MiniGameUIManager.instance.sendEventToGame(c.MiniGameEvent.MiniGameTGA,c.MiniGameTAGEvent.ResultMiniGame,{key:this.currentKey,isWin:t}),[4,a.SubResourceUtils.getInst().loadAsset(a.SubResourceUtils.getInst().bundleRoot,"prefab/result/miniGameResult",cc.Prefab)];case 1:return n=u.sent(),this._closeCallback=o,n?((r=cc.instantiate(n)).name="miniGameResult",h=e||this.getLayer(d.SubGame),cc.isValid(h)&&this.inUse?(null==h||h.addChild(r),i&&i(),r.getComponent(s.default).setWinOrLoseToPlay(t),[2]):[2]):(this.getModel()?this.getModel().gameExit():this.exitGameCenter(),[2])}})})},e.prototype.showLoadingDialog=function(t){return __awaiter(this,void 0,void 0,function(){var i,o,n,s;return __generator(this,function(r){switch(r.label){case 0:return[4,a.SubResourceUtils.getInst().loadAsset(a.SubResourceUtils.getInst().bundleRoot,"prefab/common/loadingDialog",cc.Prefab)];case 1:return(i=r.sent())?(o=cc.instantiate(i),n=e.instance.getLayer(d.Loading),cc.isValid(n)&&this.inUse?(null==n||n.addChild(o),o.zIndex=2,[4,(s=o.getComponent(m.MiniGameLoading)).show()]):[2]):(null==t||t(),[2]);case 2:return r.sent(),[4,null==t?void 0:t()];case 3:return r.sent(),s.close(),[2]}})})},e.prototype.showLoadingUI=function(t){globalThis.wx&&wx.showLoading&&wx.showLoading(t)},e.prototype.hideLoadingUI=function(){globalThis.wx&&wx.hideLoading&&wx.hideLoading()},e.prototype.emitCloseMiniGame=function(t){void 0===t&&(t=!1),this.miniGameAdapter.eventMgr.emit(c.MiniGameEvent.CloseMiniGame,t)},e.prototype.emitHideLoaidngUI=function(){this.miniGameAdapter.eventMgr.emit(c.MiniGameEvent.HideLoadingUI)},e.prototype.getModel=function(){return this.model},Object.defineProperty(e.prototype,"currentKey",{get:function(){return this._currentKey},set:function(t){this._currentKey=t},enumerable:!1,configurable:!0}),e.prototype.showTip=function(t,e){p.MiniGameTipsManager.showTip(t,e)},e.prototype.adaptMaxHeight=function(t){var e,i=t.getComponent(cc.Widget);if(i){var o=(null===(e=this.miniGameAdapter.miniGameRoot)||void 0===e?void 0:e.height)||0,n=this.maxHeight;if(o>n){var a=(o-n)/2;i.top=a,i.bottom=a}}},e}(o.SingleClass);i.default=f,cc._RF.pop()},{"../../../game/scripts/mini-adapter/types-miniPre":void 0,"./MiniGameLoading":"MiniGameLoading","./MiniGameResultWindow":"MiniGameResultWindow","./MiniGameScreen":"MiniGameScreen","./base/MiniGameTipsManager":"MiniGameTipsManager","./base/MiniGameUIManager":"MiniGameUIManager","./noise/noise.js":"noise","./p2/p2.js":"p2","./types-miniGame":"types-miniGame","./utils/MiniGameDefer":"MiniGameDefer","./utils/PlatformUtils":"PlatformUtils","./utils/SingleClass":"SingleClass","./utils/SubResourceUtils":"SubResourceUtils"}],SubPackageModelBase:[function(t,e,i){"use strict";cc._RF.push(e,"259bdM7rMlHGZEFZxnRyLnG","SubPackageModelBase"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./utils/SubResourceUtils"),n=__importDefault(t("./SubPackageManager")),a=t("./types-miniGame"),s=t("./utils/MiniGameDefer"),r=function(){function t(){this.enterWindow="",this.enterParams=null,this._mapIndex=0}return Object.defineProperty(t.prototype,"mapIndex",{get:function(){return this._mapIndex},set:function(t){this._mapIndex=t},enumerable:!1,configurable:!0}),t.prototype.prepare=function(t){return __awaiter(this,void 0,Promise,function(){return __generator(this,function(){return t&&(this.enterParams=t),[2,!0]})})},t.prototype.gameRun=function(t,e){return __awaiter(this,void 0,Promise,function(){var i,r,c,l;return __generator(this,function(h){switch(h.label){case 0:return i=new s.MiniGameDefer,t&&(this.enterWindow=t),this.enterWindow?[4,o.SubResourceUtils.getInst().loadAsset(o.SubResourceUtils.getInst().bundleRoot,this.enterWindow,cc.Prefab)]:(i.reject(!1),[2,i.promise]);case 1:return(r=h.sent())&&(c=cc.instantiate(r))?(c.name=a.SubPackageKey[n.default.instance.currentKey],null==(l=e||cc.find("Canvas/miniGameRoot"))||l.addChild(c),i.resolve(!0),[2,i.promise]):(i.reject(!1),[2,i.promise])}})})},t.prototype.unregisteView=function(){},t.prototype.gameExit=function(){this.unregisteView(),this.enterParams=null,n.default.instance.backToGameCenter()},t}();i.default=r,cc._RF.pop()},{"./SubPackageManager":"SubPackageManager","./types-miniGame":"types-miniGame","./utils/MiniGameDefer":"MiniGameDefer","./utils/SubResourceUtils":"SubResourceUtils"}],SubResourceUtils:[function(t,e,i){"use strict";cc._RF.push(e,"49b9554GetNwqtkAGoGV6Wh","SubResourceUtils"),Object.defineProperty(i,"__esModule",{value:!0}),i.SubResourceUtils=void 0;var o=t("../../../../game/scripts/mini-adapter/types-miniPre"),n=__importDefault(t("../SubPackageManager")),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._bundlePromises=cc.js.createMap(),e._fguiPromises=cc.js.createMap(),e.bundleRoot=o.BundleNameMini.miniGameRes,e}return __extends(e,t),e.prototype.loadAsset=function(t,e,i,o){return __awaiter(this,void 0,Promise,function(){var n,a;return __generator(this,function(s){switch(s.label){case 0:return[4,this.loadBundle(t)];case 1:return(n=s.sent())?(a=n.get(e,i))?(null==o||o(a),[2,a]):[2,new Promise(function(t,a){n.load(e,i,function(n,s){s?(null==o||o(s),t(s)):e?(a(n),console.error(n)):console.error("URI\u4e0d\u5b58\u5728",e,i)})})]:[2,null]}})})},e.prototype.loadBundle=function(t){return __awaiter(this,void 0,Promise,function(){var e,i;return __generator(this,function(){return e=this._bundlePromises,(i=cc.assetManager.getBundle(t))?[2,i]:(e[t]||(e[t]=new Promise(function(i,o){var a=n.default.instance.miniGameAdapter.bundleVersions,s=a?a[t]:null;cc.assetManager.loadBundle(t,s?{version:s}:null,function(n,a){delete e[t],a?i(a):(o(n),console.error(n))})})),[2,e[t]])})})},e.prototype.releaseBundle=function(t){var e;if("string"==typeof t){var i=cc.assetManager.getBundle(t);i&&i.releaseAll()}else null===(e=null==t?void 0:t.releaseAll)||void 0===e||e.call(t)},e.prototype.loadFGUI=function(t,e){return __awaiter(this,void 0,Promise,function(){var i,o,n,a,s,r=this;return __generator(this,function(c){switch(c.label){case 0:return i=this.bundleRoot,[4,this.loadBundle(i)];case 1:return(o=c.sent())?(n=fgui.UIPackage.getByName(t),a="fairygui/"+t+"/"+t,n?[2,n]:((s=this._fguiPromises)[t]||(s[t]=new Promise(function(i){fgui.UIPackage.loadPackage(o,a,e,function(e,n){return __awaiter(r,void 0,void 0,function(){var r,c,l,h,u,d,p=this;return __generator(this,function(m){switch(m.label){case 0:if(delete s[t],e||!n)return[3,3];for(o.get(a).addRef(),r=n._items,c=0,l=r.length;c<l;c++)(h=r[c]).file&&(u=o.get(h.file))&&u.addRef();return d=n.dependencies,[4,Promise.all(d.map(function(t){return p.loadFGUI(t.name)}))];case 1:m.sent(),m.label=2;case 2:return i(n),[3,4];case 3:console.error("minigame loadFGUI:"+e),i(null),m.label=4;case 4:return[2]}})})})})),[2,s[t]])):[2,null]}})})},e}(t("./SingleClass").SingleClass);i.SubResourceUtils=a,cc._RF.pop()},{"../../../../game/scripts/mini-adapter/types-miniPre":void 0,"../SubPackageManager":"SubPackageManager","./SingleClass":"SingleClass"}],SubSwitchAni:[function(t,e,i){"use strict";cc._RF.push(e,"612d6TeR5FFxpx9mOcHtDGH","SubSwitchAni"),Object.defineProperty(i,"__esModule",{value:!0}),i.SubSwitchAni=void 0;var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.target=null,e.aniList=[],e}return __extends(e,t),e.prototype.switchAni=function(t,e){var i=this.target?this.target.getComponent(sp.Skeleton):this.getComponentInChildren(sp.Skeleton);if(i&&this.aniList.length>t){var o=this.aniList[t];i.skeletonData!=o&&(i.skeletonData=o),2==t&&i.setSkin("mask"),i.setAnimation(0,e,!0)}},__decorate([a(cc.Node)],e.prototype,"target",void 0),__decorate([a({type:[sp.SkeletonData]})],e.prototype,"aniList",void 0),__decorate([n],e)}(cc.Component);i.SubSwitchAni=s,cc._RF.pop()},{}],SysDefine:[function(t,e,i){"use strict";cc._RF.push(e,"83dc0bvPb1K14oEjXmjjLXy","SysDefine"),Object.defineProperty(i,"__esModule",{value:!0}),i.SysDefine=i.UIState=i.ModalOpacity=i.FormType=void 0,function(t){t[t.Screen=0]="Screen",t[t.FixedUI=1]="FixedUI",t[t.PopUp=2]="PopUp",t[t.TopTips=3]="TopTips"}(i.FormType||(i.FormType={})),function(t){t[t.None=0]="None",t[t.OpacityZero=1]="OpacityZero",t[t.OpacityLow=2]="OpacityLow",t[t.OpacityHalf=3]="OpacityHalf",t[t.OpacityHigh=4]="OpacityHigh",t[t.OpacityFull=5]="OpacityFull"}(i.ModalOpacity||(i.ModalOpacity={})),function(t){t[t.None=0]="None",t[t.Loading=1]="Loading",t[t.Showing=2]="Showing",t[t.Hiding=3]="Hiding"}(i.UIState||(i.UIState={}));var o=function(){function t(){}return t.SYS_PATH_CANVAS="Canvas",t.SYS_PATH_UIFORMS_CONFIG_INFO="UIFormsConfigInfo",t.SYS_PATH_CONFIG_INFO="SysConfigInfo",t.SYS_UIROOT_NAME="Canvas/Scene/UIROOT",t.SYS_UIMODAL_NAME="Canvas/Scene/UIROOT/UIModalManager",t.SYS_UIAdapter_NAME="Canvas/Scene/UIROOT/UIAdapterManager",t.SYS_SCREEN_NODE="Screen",t.SYS_FIXEDUI_NODE="FixedUI",t.SYS_POPUP_NODE="PopUp",t.SYS_TOPTIPS_NODE="TopTips",t.SYS_STANDARD_Prefix="_",t.SYS_STANDARD_Separator="$",t.SYS_STANDARD_End="#",t.UI_PATH_ROOT="UIForms/",t.SeparatorMap={_Node:"cc.Node",_Label:"cc.Label",_Button:"cc.Button",_Sprite:"cc.Sprite",_RichText:"cc.RichText",_Mask:"cc.Mask",_MotionStreak:"cc.MotionStreak",_TiledMap:"cc.TiledMap",_TiledTile:"cc.TiledTile",_Spine:"sp.Skeleton",_Graphics:"cc.Graphics",_Animation:"cc.Animation",_WebView:"cc.WebView",_EditBox:"cc.EditBox",_ScrollView:"cc.ScrollView",_VideoPlayer:"cc.VideoPlayer",_ProgressBar:"cc.ProgressBar",_PageView:"cc.PageView",_Slider:"cc.Slider",_Toggle:"cc.Toggle",_ButtonPlus:"ButtonPlus"},t}();i.SysDefine=o,cc._RF.pop()},{}],TableView:[function(t,e,i){"use strict";cc._RF.push(e,"096cfhqRh1NWK59CpgwVKhK","TableView"),Object.defineProperty(i,"__esModule",{value:!0}),i.TableView=i.TableViewCellNode=i.VerticalFillOrder=void 0;var o,n=cc._decorator,a=n.ccclass,s=n.property,r=n.requireComponent,c=n.menu,l=-1;(function(t){t[t.TOP_DOWN=0]="TOP_DOWN",t[t.BOTTOM_UP=1]="BOTTOM_UP"})(o=i.VerticalFillOrder||(i.VerticalFillOrder={}));var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._idx=l,e.getIdx=function(){return e._idx},e.setIdx=function(t){return e._idx=t},e.reset=function(){return e._idx=l},e}return __extends(e,t),__decorate([a],e)}(cc.Node);i.TableViewCellNode=h;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scrollView=null,e.maskNode=null,e.vordering=o.TOP_DOWN,e.starInterval=0,e.midInterval=0,e.endInterval=0,e.handlerCellCount=new cc.Component.EventHandler,e.handlerCellSize=new cc.Component.EventHandler,e.handlerCellUpdate=new cc.Component.EventHandler,e.tableCellCount=null,e.tableCellSize=null,e.tableCellUpdate=null,e._indices=[],e._cellsPositions=[],e._cellsUsed=[],e._cellsFreed=[],e._isUsedCellsDirty=!1,e._isInit=!1,e}return __extends(e,t),e.prototype.getScrollView=function(){return this.scrollView},e.prototype.onInit=function(){if(!this._isInit){this._isInit=!0,this.scrollView=this.node.getComponent(cc.ScrollView);var t=function(t){var e=t._componentName,i=t.handler,o=t.target.getComponent(e);return o[i].bind(o)};this.tableCellCount=t(this.handlerCellCount),this.tableCellSize=t(this.handlerCellSize),this.tableCellUpdate=t(this.handlerCellUpdate)}},e.prototype.onLoad=function(){this.onInit()},e.prototype.onEnable=function(){this.node.on("scrolling",this._scrollViewDidScroll,this)},e.prototype.onDisable=function(){this.node.off("scrolling",this._scrollViewDidScroll,this)},e.prototype.setVerticalFillOrder=function(t){this.vordering=t},e.prototype.setInterval=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.midInterval=t,this.starInterval=e,this.endInterval=i},e.prototype.reloadData=function(t){if(void 0===t&&(t=!1),this.onInit(),this.scrollView.horizontal!==this.scrollView.vertical){for(var e in this._cellsUsed)this._cellsFreed.push(this._cellsUsed[e]),this._cellsUsed[e].reset(),this._cellsUsed[e].active=!1;this._indices=[],this._cellsUsed=[],this._updateCellPositions(),this._updateContentSize(t),this.tableCellCount()>0&&this._scrollViewDidScroll()}else cc.error("TableView only vertical or horizontal scrolling is supported")},e.prototype.cellAtIndex=function(t){if(this._indices[t])for(var e in this._cellsUsed)if(this._cellsUsed[e].getIdx()===t)return this._cellsUsed[e];return null},e.prototype.updateCellAtIndex=function(t){if(!(t<=l)){var e=this.tableCellCount();if(!(0===e||t>e-1)){var i=this.cellAtIndex(t);i&&this._moveCellOutOfSight(i),i=this._createCellAtIndex(t),this._setIndexForCell(t,i),this._addCellIfNecessary(i)}}},e.prototype.scrollToIndex=function(t,e){void 0===e&&(e=.01);var i=this._cellsPositions[t];i&&(this.scrollView.horizontal?this.scrollView.scrollToOffset(cc.v2(i-this.midInterval,0),Math.max(e,.01)):this.vordering===o.TOP_DOWN?this.scrollView.scrollToOffset(cc.v2(0,i-this.midInterval),Math.max(e,.01)):(this.tableCellSize(t),this.scrollView.scrollToOffset(cc.v2(0,this.scrollView.getMaxScrollOffset().y-i+this.midInterval),Math.max(e,.01))))},e.prototype._updateCellPositions=function(){var t=this.tableCellCount();if(this._cellsPositions=[],t>0){for(var e=this.starInterval,i=0;i<t;++i){this._cellsPositions[i]=e;var o=this.tableCellSize(i);this.scrollView.horizontal?e+=o.width:e+=o.height,i<t-1&&0!=this.midInterval&&(e+=this.midInterval)}e+=this.endInterval,this._cellsPositions[t]=e}},e.prototype._updateContentSize=function(t){var e=this.maskNode.getContentSize(),i=this.tableCellCount();if(i>0){var n=this._cellsPositions[i];this.scrollView.horizontal&&n>this.maskNode.width?e=cc.size(n,this.maskNode.height):this.scrollView.vertical&&n>this.maskNode.height&&(e=cc.size(this.maskNode.width,n))}e.width==this.scrollView.content.width&&e.height==this.scrollView.content.height||this.scrollView.content.setContentSize(e),t?this.scrollView.scrollToOffset(this.scrollView.getScrollOffset(),.01):this.scrollView.horizontal?this.scrollView.scrollToLeft(.01):this.vordering===o.TOP_DOWN?this.scrollView.scrollToTop(.01):this.scrollView.scrollToBottom(.01)},e.prototype._positionFromIndex=function(t){var e=this.scrollView.horizontal?cc.v2(this._cellsPositions[t],0):cc.v2(0,this._cellsPositions[t]),i=this.tableCellSize(t);return this.scrollView.vertical?this.vordering===o.BOTTOM_UP?e.y=e.y+i.height/2:e.y=this.scrollView.content.height-e.y-i.height/2:e.x=e.x+i.width/2,this.scrollView.vertical?(e.x=this.scrollView.content.width*(.5-this.scrollView.content.anchorX),e.y=e.y-this.scrollView.content.height*this.scrollView.content.anchorY):(e.x=e.x-this.scrollView.content.width*this.scrollView.content.anchorX,e.y=this.scrollView.content.height*(.5-this.scrollView.content.anchorY)),e},e.prototype._indexFromOffset=function(t){var e=this.tableCellCount()-1,i=this.__indexFromOffset(t);return i!=l&&(i=Math.max(0,i))>e&&(i=l),i},e.prototype.__indexFromOffset=function(t){for(var e=0,i=this.tableCellCount()-1,o=this.scrollView.horizontal?t.x:t.y;i>=e;){var n=Math.floor(e+(i-e)/2),a=this._cellsPositions[n],s=this._cellsPositions[n+1];if(o>=a&&o<=s)return n;o<a?i=n-1:e=n+1}return e<=0?0:l},e.prototype._moveCellOutOfSight=function(t){this._cellsFreed.push(t);var e=this._cellsUsed.indexOf(t);-1!=e&&this._cellsUsed.splice(e,1),this._isUsedCellsDirty=!0,this._indices[t.getIdx()]=null,t.reset(),t.active=!1},e.prototype._setIndexForCell=function(t,e){e.setAnchorPoint(.5,.5),e.setPosition(this._positionFromIndex(t)),e.setIdx(t)},e.prototype._addCellIfNecessary=function(t){t.parent||(t.parent=this.scrollView.content),this._cellsUsed.push(t),this._isUsedCellsDirty=!0,this._indices[t.getIdx()]=!0,t.active=!0},e.prototype._scrollViewDidScroll=function(){var t=this.tableCellCount();if(0!==t){this._isUsedCellsDirty&&(this._isUsedCellsDirty=!1,this._cellsUsed.sort(function(t,e){return t.getIdx()-e.getIdx()}));var e,i=0,n=0,a=Math.max(t-1,0),s=this.scrollView.getScrollOffset();if(s.x*=-1,this.vordering===o.BOTTOM_UP&&(s.y=this.scrollView.content.height-s.y-this.maskNode.height),(i=this._indexFromOffset(s.clone()))===l&&(i=t-1),s.x+=this.maskNode.width,s.y+=this.maskNode.height,(n=this._indexFromOffset(s.clone()))===l&&(n=t-1),this._cellsUsed.length>0)for(var r=(e=this._cellsUsed[0]).getIdx();r<i&&(this._moveCellOutOfSight(e),this._cellsUsed.length>0);)r=(e=this._cellsUsed[0]).getIdx();if(this._cellsUsed.length>0)for(r=(e=this._cellsUsed[this._cellsUsed.length-1]).getIdx();r<=a&&r>n&&(this._moveCellOutOfSight(e),this._cellsUsed.length>0);)r=(e=this._cellsUsed[this._cellsUsed.length-1]).getIdx();for(var c=i;c<=n;++c)this._indices[c]||this.updateCellAtIndex(c)}},e.prototype._dequeueCell=function(){var t=null;return this._cellsFreed.length>0&&(t=this._cellsFreed.shift()||null),t},e.prototype._createCellAtIndex=function(t){var e=this._dequeueCell();return e||(e=new h),e.setContentSize(this.tableCellSize(t)),this.tableCellUpdate(t,e),e},__decorate([s({type:cc.Node,tooltip:"\u88c1\u526a\u8282\u70b9"})],e.prototype,"maskNode",void 0),__decorate([s({type:cc.Enum(o),tooltip:"\u5355\u5143\u683c\u5782\u76f4\u586b\u5145\u987a\u5e8f"})],e.prototype,"vordering",void 0),__decorate([s({type:cc.Integer,tooltip:"\u7b2c\u4e00\u4e2a\u5355\u5143\u683c\u548c\u8fb9\u6846\u7684\u95f4\u9694"})],e.prototype,"starInterval",void 0),__decorate([s({type:cc.Integer,tooltip:"\u5355\u5143\u683c\u4e4b\u95f4\u7684\u95f4\u9694"})],e.prototype,"midInterval",void 0),__decorate([s({type:cc.Integer,tooltip:"\u6700\u540e\u4e00\u4e2a\u5355\u5143\u683c\u548c\u8fb9\u6846\u7684\u95f4\u9694"})],e.prototype,"endInterval",void 0),__decorate([s({type:cc.Component.EventHandler,tooltip:"\u5355\u5143\u683c\u7684\u6570\u91cf\n\u51fd\u6570\u5f62\u53c2 () => number"})],e.prototype,"handlerCellCount",void 0),__decorate([s({type:cc.Component.EventHandler,tooltip:"\u5355\u5143\u683c\u7684\u5927\u5c0f\n\u51fd\u6570\u5f62\u53c2 (idx: number) => cc.Size"})],e.prototype,"handlerCellSize",void 0),__decorate([s({type:cc.Component.EventHandler,tooltip:"\u66f4\u65b0\u5355\u5143\u683c\n\u51fd\u6570\u5f62\u53c2 (idx: number, cell: TableViewCellNode) => void"})],e.prototype,"handlerCellUpdate",void 0),__decorate([a,c("Extend/TableView"),r(cc.ScrollView)],e)}(cc.Component);i.TableView=u,cc._RF.pop()},{}],TestGame:[function(t,e,i){"use strict";cc._RF.push(e,"0ee6cHc5XhL2qgXQGcD2Fba","TestGame"),Object.defineProperty(i,"__esModule",{value:!0}),i.TestGame=void 0;var o=t("../../miniGamePackage/base/MiniGameUIBase"),n=t("../../miniGamePackage/base/MiniGameUIManager"),a=t("../../miniGamePackage/types-miniGame"),s=t("./TestMiniFeature1"),r=t("./TestMiniFeature2"),c=t("./TestMiniView"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.ui.getChild("close").asButton.onClick(this.onClickClose,this),this.ui.getChild("jump").asButton.onClick(this.onClickJump,this)},e.prototype.onClickClose=function(){n.MiniGameUIManager.instance.goToResult()},e.prototype.onClickJump=function(){n.MiniGameUIManager.instance.addView(c.TestMiniView)},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},__decorate([n.addSubPackageUI(a.SubPackageKey.testGame),n.miniUI({packageName:"mini_testGame",compName:"TestGame",features:[s.TestMiniFeature1,r.TestMiniFeature2]})],e)}(o.MiniGameUIBase);i.TestGame=l,cc._RF.pop()},{"../../miniGamePackage/base/MiniGameUIBase":"MiniGameUIBase","../../miniGamePackage/base/MiniGameUIManager":"MiniGameUIManager","../../miniGamePackage/types-miniGame":"types-miniGame","./TestMiniFeature1":"TestMiniFeature1","./TestMiniFeature2":"TestMiniFeature2","./TestMiniView":"TestMiniView"}],TestMiniFeature1:[function(t,e,i){"use strict";cc._RF.push(e,"f39c1XSBpNMa4PtYmDJAxCe","TestMiniFeature1"),Object.defineProperty(i,"__esModule",{value:!0}),i.TestMiniFeature1=void 0;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){return __awaiter(this,void 0,Promise,function(){return __generator(this,function(){return t.prototype.init.call(this),cc.log("TestMiniFeature1 init"),[2,!0]})})},e.prototype.onLoad=function(){t.prototype.onLoad.call(this),cc.log("TestMiniFeature1 onLoad")},e.prototype.onDestroy=function(){cc.log("TestMiniFeature1 onDestroy")},e}(t("../../miniGamePackage/base/MIniGameUIFeature").MiniGameUIFeature);i.TestMiniFeature1=o,cc._RF.pop()},{"../../miniGamePackage/base/MIniGameUIFeature":"MIniGameUIFeature"}],TestMiniFeature2:[function(t,e,i){"use strict";cc._RF.push(e,"bdaa6E2vIRBYpyf7XnmPOBV","TestMiniFeature2"),Object.defineProperty(i,"__esModule",{value:!0}),i.TestMiniFeature2=void 0;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),cc.log("TestMiniFeature2")},e}(t("../../miniGamePackage/base/MIniGameUIFeature").MiniGameUIFeature);i.TestMiniFeature2=o,cc._RF.pop()},{"../../miniGamePackage/base/MIniGameUIFeature":"MIniGameUIFeature"}],TestMiniView:[function(t,e,i){"use strict";cc._RF.push(e,"0e415XD2VBGvIxk+59NncJG","TestMiniView"),Object.defineProperty(i,"__esModule",{value:!0}),i.TestMiniView=void 0;var o=t("../../miniGamePackage/base/MiniGameUIBase"),n=t("../../miniGamePackage/base/MiniGameUIManager"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.ui.getChild("close").asButton.onClick(this.onClickClose,this)},e.prototype.onClickClose=function(){n.MiniGameUIManager.instance.closeView(this)},e.prototype.onClickJump=function(){},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},__decorate([n.miniUI({packageName:"mini_testGame",compName:"TestMiniView"})],e)}(o.MiniGameUIBase);i.TestMiniView=a,cc._RF.pop()},{"../../miniGamePackage/base/MiniGameUIBase":"MiniGameUIBase","../../miniGamePackage/base/MiniGameUIManager":"MiniGameUIManager"}],TextureAssembler:[function(t,e,i){"use strict";cc._RF.push(e,"dacfboxk41I2L6nmSbz/m0V","TextureAssembler"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./CommonUtils"),n=cc.gfx,a=new n.VertexFormat([{name:n.ATTR_POSITION,type:n.ATTR_TYPE_FLOAT32,num:2},{name:n.ATTR_UV0,type:n.ATTR_TYPE_FLOAT32,num:2},{name:n.ATTR_COLOR,type:n.ATTR_TYPE_UINT8,num:4,normalize:!0}]),s=function(t){function e(){var e=t.call(this)||this;return e.verticesCount=4,e.indicesCount=6,e.floatsPerVert=5,e.uvOffset=2,e.colorOffset=4,e.indicesArr=[],e._renderData=null,e._renderData=new cc.RenderData,e._renderData.init(e),e.initData(),e}return __extends(e,t),Object.defineProperty(e.prototype,"verticesFloats",{get:function(){return this.verticesCount*this.floatsPerVert},enumerable:!1,configurable:!0}),e.prototype.getVfmt=function(){return a},e.prototype.getBuffer=function(){return cc.renderer._handle.getBuffer("mesh",this.getVfmt())},e.prototype.initData=function(){this._renderData.createQuadData(0,this.verticesFloats,this.indicesCount)},e.prototype.resetData=function(t){var e=t.polygon;!e||e.length<3||(this.verticesCount=e.length,this.indicesCount=this.verticesCount+2*(this.verticesCount-3),this._renderData.clear(),this.initData())},e.prototype.initQuadIndices=function(t,e){for(var i=0;i<e.length;i++)t[i]=e[i]},e.prototype.updateColor=function(t,e){var i=this._renderData.uintVDatas[0];if(i){e=null!=e?e:t.node.color._val;for(var o=this.floatsPerVert,n=this.colorOffset,a=t.polygon,s=0;s<a.length;s++)i[n+s*o]=e}},e.prototype.updateUVs=function(t){var e=this.uvOffset,i=this.floatsPerVert,n=this._renderData.vDatas[0],a=[];t.texture&&(a=o.CommonUtils.computeUv(t.polygon,t.texture.width,t.texture.height));for(var s=t.polygon,r=0;r<s.length;r++){var c=i*r+e;n[c]=a[r].x,n[c+1]=a[r].y}},e.prototype.updateWorldVertsWebGL=function(t){var e=this._renderData.vDatas[0],i=t.node._worldMatrix.m,o=i[0],n=i[1],a=i[4],s=i[5],r=i[12],c=i[13],l=1===o&&0===n&&0===a&&1===s,h=this.floatsPerVert;if(l)for(var u=t.polygon,d=0;d<u.length;d++)e[d*h]=u[d].x+r,e[d*h+1]=u[d].y+c;else for(u=t.polygon,d=0;d<u.length;d++)e[d*h]=o*u[d].x+a*u[d].y+r,e[d*h+1]=n*u[d].x+s*u[d].y+c},e.prototype.updateWorldVertsNative=function(t){for(var e=this._renderData.vDatas[0],i=this.floatsPerVert,o=t.polygon,n=0;n<o.length;n++)e[n*i]=o[n].x,e[n*i+1]=o[n].y},e.prototype.updateWorldVerts=function(t){this.updateWorldVertsWebGL(t)},e.prototype.updateVerts=function(t){var e=o.CommonUtils.splitPolygon(t.polygon);this.initQuadIndices(this._renderData.iDatas[0],e),this.updateWorldVerts(t)},e.prototype.updateRenderData=function(t){t._vertsDirty&&(this.resetData(t),this.updateUVs(t),this.updateVerts(t),this.updateColor(t,null),t._vertsDirty=!1)},e.prototype.fillBuffers=function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);var i=this._renderData,o=i.vDatas[0],n=i.iDatas[0],a=this.getBuffer(),s=a.request(this.verticesCount,this.indicesCount),r=s.byteOffset>>2,c=a._vData;o.length+r>c.length?c.set(o.subarray(0,c.length-r),r):c.set(o,r);for(var l=a._iData,h=s.indiceOffset,u=s.vertexOffset,d=0,p=n.length;d<p;d++)l[h++]=u+n[d]},e.prototype.packToDynamicAtlas=function(t,e){if(!e._original&&cc.dynamicAtlasManager&&e._texture.packable){var i=cc.dynamicAtlasManager.insertSpriteFrame(e);i&&e._setDynamicAtlasFrame(i)}var o=t._materials[0];o&&o.getProperty("texture")!==e._texture&&(t._vertsDirty=!0,t._updateMaterial())},e}(cc.Assembler);i.default=s,cc._RF.pop()},{"./CommonUtils":"CommonUtils"}],TextureMathUtil:[function(t,e,i){"use strict";cc._RF.push(e,"a0dd0mrbZ9OKplt998MRMPK","TextureMathUtil"),Object.defineProperty(i,"__esModule",{value:!0}),i.TextureMathUtils=void 0;var o=function(){function t(){}return t.clamp=function(t,e,i){if(t>e){var o=t;t=e,e=o}return i<t?t:i>e?e:i},t.getAngle=function(t){return 180*t/Math.PI},t.getRadian=function(t){return t/180*Math.PI},t.getRadian2=function(t,e,i,o){var n=i-t,a=o-e;return Math.atan2(a,n)},t.getDistance=function(t,e,i,o){var n=i-t,a=o-e,s=n*n+a*a;return Math.sqrt(s)},t.toFixedStr=function(t,e){return t.toFixed(e).replace(/\.?0*$/,"")},t.toPercentStr=function(t,e){return this.toFixedStr(100*t,e)+"%"},t.toFixedWan=function(e){var i=1e4*Math.floor(e/1e4);return e>1e5?t.toFixedStr(i/1e5*10,1)+"\u4e07":e.toString()},t.getFinalValueBasedOnParams=function(t,e,i){if(e.length<5)return 0;var o=e[4]*(e[0]*Math.pow(t,e[3])+e[1]*t+e[2]);return i&&(o=Math.ceil(o)),o},t.limit=function(t,e){t=Math.min(t,e);var i=(e=Math.max(t,e))-t;return t+Math.random()*i},t.limitInteger=function(e,i){return Math.round(t.limit(e,i))},t.randomArray=function(t){return t[Math.floor(Math.random()*t.length)]},t}();i.TextureMathUtils=o,cc._RF.pop()},{}],TexturePlus:[function(t,e,i){"use strict";cc._RF.push(e,"a6f7aGY1UFMkbgMzwCw/Nuu","TexturePlus"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=__importDefault(t("./TextureAssembler")),a=t("./CommonUtils");cc.renderer.renderEngine,function(t){t[t.Cut=0]="Cut"}(o||(o={}));var s=new cc.Vec2,r=new cc.Mat4,c=cc._decorator,l=c.ccclass,h=(c.inspector,c.executeInEditMode),u=(c.mixins,c.property),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._texture=null,e._type=0,e.editing=!1,e._polygon=[],e._assembler=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t;var e=-t.width/2,i=-t.height/2,o=t.height/2,n=t.width/2;this.polygon=[cc.v2(e,i),cc.v2(n,i),cc.v2(n,o),cc.v2(e,o)],this._updateMaterial()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this.setVertsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polygon",{get:function(){return this._polygon},set:function(t){this._polygon=t,this._updateVerts()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.node._hitTest=this._hitTest.bind(this)},e.prototype.start=function(){},e.prototype._updateVerts=function(){this.setVertsDirty()},e.prototype._updateMaterial=function(){var t=this._texture,e=this.getMaterial(0);e&&(void 0!==e.getDefine("USE_TEXTURE")&&e.define("USE_TEXTURE",!0),e.setProperty("texture",t)),this.setVertsDirty()},e.prototype._validateRender=function(){},e.prototype._resetAssembler=function(){(this._assembler=new n.default).init(this),this._updateColor(),this.setVertsDirty()},e.prototype._hitTest=function(t){var e=this.node,i=s;return e._updateWorldMatrix(),!!cc.Mat4.invert(r,e._worldMatrix)&&(cc.Vec2.transformMat4(i,t,r),a.CommonUtils.isInPolygon(i,this.polygon))},e.Type=o,__decorate([u(cc.Texture2D)],e.prototype,"_texture",void 0),__decorate([u(cc.Texture2D)],e.prototype,"texture",null),__decorate([u({type:cc.Enum(o),serializable:!0})],e.prototype,"type",null),__decorate([u(cc.Boolean)],e.prototype,"editing",void 0),__decorate([u({type:[cc.Vec2],serializable:!0})],e.prototype,"_polygon",void 0),__decorate([u({type:[cc.Vec2],serializable:!0})],e.prototype,"polygon",null),__decorate([l,h],e)}(cc.RenderComponent);i.default=d,cc._RF.pop()},{"./CommonUtils":"CommonUtils","./TextureAssembler":"TextureAssembler"}],UnblockGameWindow:[function(t,e,i){"use strict";cc._RF.push(e,"4e80e6kF8RAFJH+Om5Fq34Y","UnblockGameWindow"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("../../miniGamePackage/utils/MathExt")),s=t("./config_Unblock"),r=t("./UnblockModel"),c=__importDefault(t("./UnblockUnit")),l=__importDefault(t("./UnblockUnitActor")),h=cc._decorator,u=h.ccclass,d=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boxFolder=null,e.cuboidPrefab=null,e.timeLabel=null,e.timeUpSprite=null,e.timeDownSprite=null,e.time=s.Unblock.time,e.clickCountLabel=null,e.map=[],e.gameOver=!1,e.level=2,e.maxLevel=10,e.blockCount=10,e._movedBlockCount=0,e._clickCount=10,e.touchMovedDis=0,e.rotationSpeed=360,e.rotationAxis=cc.v3(1,1,0).normalize(),e.shareNode=null,e.isShared=!1,e}var i;return __extends(e,t),i=e,Object.defineProperty(e.prototype,"movedBlockCount",{get:function(){return this._movedBlockCount},set:function(t){this._movedBlockCount=t,this._movedBlockCount==this.blockCount&&(this.gameOver=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clickCount",{get:function(){return this._clickCount},set:function(t){this._clickCount=t,this.clickCountLabel&&(this.clickCountLabel.string=this._clickCount.toString())},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){r.UB_S.Ins.mgr=this},e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.down,this),this.node.on(cc.Node.EventType.TOUCH_END,this.up,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.move,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.up,this),cc.game.setFrameRate(60),i.instance=this},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.down,this),this.node.off(cc.Node.EventType.TOUCH_END,this.up,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.move,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.up,this),cc.game.setFrameRate(30),i.instance=null},e.prototype.down=function(){this.gameOver||(this.touchMovedDis=0)},e.prototype.up=function(t){var e=this;if(this.touchMovedDis<10&&!this.gameOver){var i=cc.Camera.main.getRay(t.touch.getLocation()),o=cc.geomUtils.intersect.raycast(cc.director.getScene(),i),n=o.findIndex(function(t){var e,i,o;return(null===(e=t.node)||void 0===e?void 0:e.getComponent(l.default))||(null===(i=t.node)||void 0===i?void 0:i.parent)!=cc.director.getScene()&&(null===(o=t.node)||void 0===o?void 0:o.parent.getComponent(l.default))}),a=n>=0?o[n].node.getComponent(l.default)||o[n].node.parent.getComponent(l.default):null;if(a&&0==a.isMoveOut){var c=this.testUnitsMoveDist(a.units,a.dir);if(c>0){this.moveUnits(a.units,a.dir,c);var h=r.dirMap.get(a.dir),u=h.mul(Math.abs(h.dot(s.Unblock.unitSize))*c).add(a.node.position);console.log(a.node.position+" = "+h+"*"+c+" => "+u),a.moveActor(u)}else-1==c?(console.log("move out"),this.removeUnits(a.units,a),a.removeOut(),this.blockCount--,cc.log(this.blockCount)):a.blockedActor(a.dir);this.clickCount--,0==this.blockCount?(this.gameOver=!0,setTimeout(function(){return e.win()},500)):0==this.clickCount&&setTimeout(function(){return e.lose()},500)}}},e.prototype.move=function(t){var e=t.getDelta();if(this.touchMovedDis+=e.mag(),!this.gameOver){var i=cc.v3(-e.y,e.x,0).normalize(),o=new cc.Quat;cc.Quat.fromAxisAngle(o,i,cc.misc.degreesToRadians(e.mag()/2));var n=new cc.Quat;this.boxFolder.getRotation(n),o=cc.Quat.multiply(o,o,n),this.boxFolder.setRotation(o)}},e.prototype.start=function(){console.log("gameWindow"),this.win()},e.prototype.scaleUp=function(){this.boxFolder.scale=a.default.StepTo(this.boxFolder.scale,3,.2)},e.prototype.scaleDown=function(){this.boxFolder.scale=a.default.StepTo(this.boxFolder.scale,.5,.2)},e.prototype.testUnitsMoveDist=function(t,e){var i=this,o=r.dirMap.get(e),n=Number.MAX_SAFE_INTEGER,a=!0;return t.forEach(function(e){var s=e.crd.add(o);if(t.findIndex(function(t){return t.crd.equals(s)})<0){for(;i.validCrd(s)&&!i.crd2Info(s);)s.addSelf(o);i.validCrd(s)&&(a=!1,n=Math.min(Math.abs(s.sub(e.crd).mag()),n))}}),a?-1:n-1},e.prototype.moveUnits=function(t,e,i){var o=this;t.forEach(function(t){o.setInfo(t.crd,null);var n=t.crd.add(r.dirMap.get(e).mul(i));t.crd=n,o.setInfo(n,t)})},e.prototype.removeUnits=function(t){var e=this;t.forEach(function(t){e.setInfo(t.crd,null)})},e.prototype.nextUnits=function(t,e){var i=this,o=r.dirMap.get(e),n=[];return t.forEach(function(e){var a=e.crd.add(o),s=i.crd2Info(a);s&&t.findIndex(function(t){return t==s})<0&&n.push(s)}),n},e.prototype.update=function(t){if(this.gameOver){this.boxFolder.scale=5/this.level,t/=2,this.rotationAxis=this.rotationAxis.add(cc.v3(this.rotationAxis.y,-this.rotationAxis.x,0).mul(t)),this.rotationAxis=this.rotationAxis.normalize();var e=-this.rotationSpeed*t,i=new cc.Quat;cc.Quat.fromAxisAngle(i,this.rotationAxis,cc.misc.degreesToRadians(e));var o=new cc.Quat;this.boxFolder.getRotation(o),i=cc.Quat.multiply(i,i,o),this.boxFolder.setRotation(i)}else this.time-=t,this.time<=0&&(this.gameOver=!0,this.lose());this.timeLabel.string=""+Math.ceil(this.time),this.timeUpSprite.fillRange=this.time/s.Unblock.time,this.timeDownSprite.fillRange=1-this.time/s.Unblock.time},e.prototype.lose=function(){o.default.instance.gotoResultWithLoading(!1,this.node.parent)},e.prototype.win=function(){if(this.level>this.maxLevel)o.default.instance.gotoResultWithLoading(!0,this.node.parent);else{3==this.level&&(this.level=10),s.Unblock.gridSize=cc.v3(this.level,this.level,this.level),s.Unblock.maxPos=s.Unblock.gridSize.div(2).multiply(s.Unblock.unitSize);var t=this.level*this.level*this.level;this.gameOver=!0,s.Unblock.time=.6*t,s.Unblock.time>200&&(s.Unblock.time-=240),this.time=s.Unblock.time,this.clickCount=Math.floor(1*t),this.blockCount=0,this._movedBlockCount=0,this.resetMap()}this.level++},e.prototype.initMap=function(){this.map=[];for(var t=0;t<s.Unblock.gridSize.x;t++){this.map.push([]);for(var e=0;e<s.Unblock.gridSize.y;e++){this.map[t].push([]);for(var i=0;i<s.Unblock.gridSize.z;i++){var o=new c.default(cc.v3(t,e,i));this.map[t][e].push(o)}}}this.constructMap()},e.prototype.validCrd=function(t){return!(t.x<0||t.x>=s.Unblock.gridSize.x||t.y<0||t.y>=s.Unblock.gridSize.y||t.z<0||t.z>=s.Unblock.gridSize.z)},e.prototype.crd2Info=function(t){return this.validCrd(t)?this.map[t.x][t.y][t.z]:null},e.prototype.setInfo=function(t,e){this.validCrd(t)&&(this.map[t.x][t.y][t.z]=e)},e.prototype.resetMap=function(){this.boxFolder.removeAllChildren(!0),this.initMap()},e.prototype.constructMap=function(){for(var t,e=this,i=function(t){for(var e=0;e<t.length/2;e++){var i=Math.floor(Math.random()*t.length),o=Math.floor(Math.random()*t.length),n=t[i];t[i]=t[o],t[o]=n}},o=[cc.v3(0,1,0),cc.v3(1,0,0),cc.v3(0,-1,0),cc.v3(-1,0,0),cc.v3(0,0,1),cc.v3(0,0,-1)],n=[r.Dir.Up,r.Dir.Right,r.Dir.Down,r.Dir.Left,r.Dir.Front,r.Dir.Back],a=(t=[[]],o.forEach(function(e){return t.push([e])}),t),c=[],h=0;h<s.Unblock.gridSize.x;h++){c.push([]);for(var u=0;u<s.Unblock.gridSize.y;u++){c[h].push([]);for(var d=0;d<s.Unblock.gridSize.z;d++)c[h][u].push(!1)}}for(var p=function(t){return c[t.x][t.y][t.z]},m=function(t){c[t.x][t.y][t.z]=!0},f=function(t){c[t.x][t.y][t.z]=!1},g=function(t,e){return e.findIndex(function(e){return e.equals(t)})>=0},_=function(t){var i=[];i.push(t.startCrd),t.link.forEach(function(e){return i.push(e.add(t.startCrd))});for(var o=r.dirMap.get(t.dir),n=o.clone(),a=0;;){if(a++>1e4){console.error("error!(safeDir)");break}for(var s=!0,c=!0,l=0;l<i.length;l++){var h=i[l].add(n);if(g(h,i))c=!1;else if(e.crd2Info(h)&&(c=!1,p(h))){s=!1;break}}if(!s)return!1;if(c)return!0;n.addSelf(o)}return!1},y=function(t,i){e.blockCount++;var o=cc.instantiate(e.cuboidPrefab).getComponent(l.default);o.node.parent=e.boxFolder;var n=[],a=[],s=cc.v3(0,0,0);n.push(e.crd2Info(t.startCrd)),a.push(t.startCrd),t.link.forEach(function(i){var o=t.startCrd.add(i),r=e.crd2Info(o);r&&(n.push(r),a.push(o)),s.x=Math.max(s.x,Math.abs(i.x)),s.y=Math.max(s.y,Math.abs(i.y)),s.z=Math.max(s.z,Math.abs(i.z))}),o.init(t.dir,s.add(cc.v3(1,1,1)),n),n.forEach(function(t){return t.fill(o,a)}),o.launch(.4*e.blockCount/Math.pow(e.level-1,1.5)),i&&o.getComponent(cc.MeshRenderer).getMaterial(0).setProperty("diffuseColor",i)},v=0,b=0,P=function(t,o,c,l){void 0===c&&(c=[]);var h=b++,u="\u3010grp"+h+"\u3011",d="",m="";if(l&&(l.pd?(d=" from\u3010dfs"+l.pd+"\u3011",m="\nreturn to \u3010dfs"+l.pd+"\u3011"):l.pg&&(d=" by\u3010grp"+l.pg+"\u3011",m="\nback to \u3010grp"+l.pg+"\u3011")),s.Unblock.debugLogActive&&console.log(u+"enter grpDfs:"+o+" :["+t+"]"+d),t>=o.length)return s.Unblock.debugLogActive&&console.log(u+"last grp  <success>"+m),{res:[],visit:[]};var _=o[t];if(g(_,c))return s.Unblock.debugLogActive&&console.warn(u+"grp overlap  <continue>"),P(t+1,o,c,{pg:h});if(p(_))return s.Unblock.debugLogActive&&console.error(u+"grp visited  <fail>"+m),{res:null,visit:[]};var y=__spreadArrays(c),v=a.filter(function(t){return!t.some(function(t){return!e.validCrd(t.add(_))||p(t.add(_))})}),M=n.filter(function(t){return!e.validCrd(r.dirMap.get(t).add(_))||!p(r.dirMap.get(t).add(_))});i(v),i(M);for(var w=0;w<v.length;w++)for(var k=function(e){var i={startCrd:_,link:v[w],dir:M[e]},n=S(i,h);if(n.res){s.Unblock.debugLogActive&&console.warn(u+"dfs success and enter grp <continue>"),i.link.forEach(function(t){return y.push(i.startCrd.add(t))});var a=P(t+1,o,y,{pg:h});if(a.res){var r=__spreadArrays(n.res);r.push(i),r.push.apply(r,a.res);var l=__spreadArrays(n.visit);return l.push.apply(l,a.visit),s.Unblock.debugLogActive&&console.warn(u+"return grp  <success>"+m),{value:{res:r,visit:l}}}s.Unblock.debugLogActive&&console.error(u+"grp fail:"+t+"  <fail>"+m),n.visit.forEach(function(t){return f(t)}),y=__spreadArrays(c)}},C=0;C<M.length;C++){var x=k(C);if("object"==typeof x)return x.value}return s.Unblock.debugLogActive&&console.error(u+"all fail"+m),{res:null,visit:[]}},S=function(t,i){var o=v++,n="\u3010dfs"+o+"\u3011",a=i?"\nreturn to\u3010grp"+i+"\u3011":"";if(s.Unblock.debugLogActive&&console.log(n+"enter dfs:"+t.startCrd+" ==> "+t.dir),s.Unblock.debugLogActive&&console.log(t),p(t.startCrd))return s.Unblock.debugLogActive&&console.error(n+"dfs visited  <fail>"+a),{res:null,visit:[]};if(t.link.some(function(i){return!e.validCrd(t.startCrd.add(i))||p(t.startCrd.add(i))}))return s.Unblock.debugLogActive&&console.error(n+"overlap  <fail>"+a),{res:null,visit:[]};if(!_(t))return s.Unblock.debugLogActive&&console.error(n+"unsafe  <fail>"+a),{res:null,visit:[]};var c=[t.startCrd];t.link.forEach(function(e){return c.push(e.add(t.startCrd))}),c.forEach(function(t){return m(t)});var l=r.dirMap.get(t.dir),h=[],u=[];u.push(t.startCrd),t.link.forEach(function(e){return u.push(e.add(t.startCrd))});for(var d=0;d<u.length;d++){var y=u[d].clone();do{y.addSelf(l)}while(e.validCrd(y)&&g(y.sub(t.startCrd),t.link));if(!e.validCrd(y))return{res:[],visit:c};g(y,h)||g(y,c)||h.push(y)}var b=P(0,h,[],{pd:o});return b.res?(s.Unblock.debugLogActive&&console.warn(n+"<success>"+a),c.push.apply(c,b.visit),{res:b.res,visit:c}):(b.visit.forEach(function(t){return f(t)}),s.Unblock.debugLogActive&&console.error(n+"grp fail  <fail>"+a),c.forEach(function(t){return f(t)}),{res:null,visit:c})},M=[],w=cc.v3(Math.floor(s.Unblock.gridSize.x/2),Math.floor(s.Unblock.gridSize.y/2),Math.floor(s.Unblock.gridSize.z/2)),k=Math.max(s.Unblock.gridSize.x,s.Unblock.gridSize.y,s.Unblock.gridSize.z),C=w.clone(),x=[],B=1;B<=k;B++){for(h=0;h<B&&!(h>=s.Unblock.gridSize.x);h++){for(C.x+=(1-2*(1&h))*h,u=0;u<B&&!(u>=s.Unblock.gridSize.y);u++){for(C.y+=(1-2*(1&u))*u,d=0;d<B&&!(d>=s.Unblock.gridSize.z);d++)if(C.z+=(1-2*(1&d))*d,!p(C)){var T=C.clone(),F=P(0,[T]);m(T),F.res?M.push.apply(M,F.res):(Math.floor(6*Math.random()),this.setInfo(T,null),x.push(T))}C.z=w.z}C.y=w.y}C.x=w.x}i(M),M.sort(function(t,e){var i=t.startCrd.sub(s.Unblock.gridSize.mul(.5)).mag()+1*Math.random(),o=e.startCrd.sub(s.Unblock.gridSize.mul(.5)).mag()+1*Math.random();return i<o?-1:i>o?1:0}),M.forEach(function(t){y(t)})},e.prototype.share=function(){var t=this;this.isShared?o.default.instance.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.shareNode&&!this.isShared&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareNode,{miniGame:n.SubPackageKey.unblock}).then(function(e){e?(o.default.instance.showTip("\u5206\u4eab\u6210\u529f"),t.isShared=!0,t.time+=360,s.Unblock.time+=360):o.default.instance.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.exit=function(){o.default.getInst().getModel().gameExit()},e.instance=null,__decorate([d(cc.Node)],e.prototype,"boxFolder",void 0),__decorate([d(cc.Prefab)],e.prototype,"cuboidPrefab",void 0),__decorate([d(cc.Label)],e.prototype,"timeLabel",void 0),__decorate([d(cc.Sprite)],e.prototype,"timeUpSprite",void 0),__decorate([d(cc.Sprite)],e.prototype,"timeDownSprite",void 0),__decorate([d],e.prototype,"time",void 0),__decorate([d(cc.Label)],e.prototype,"clickCountLabel",void 0),__decorate([d(cc.Node)],e.prototype,"shareNode",void 0),i=__decorate([u],e)}(cc.Component);i.default=p,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","../../miniGamePackage/utils/MathExt":"MathExt","./UnblockModel":"UnblockModel","./UnblockUnit":"UnblockUnit","./UnblockUnitActor":"UnblockUnitActor","./config_Unblock":"config_Unblock"}],UnblockModel:[function(t,e,i){"use strict";cc._RF.push(e,"0d7324MPIFJjqGN1OyJwWud","UnblockModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.UnblockModel=i.UB_S=i.dirMap=i.Dir=void 0;var o,n=t("../../miniGamePackage/SubPackageManager"),a=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),s=t("../../miniGamePackage/types-miniGame"),r=t("../../miniGamePackage/utils/SingleClass");(function(t){t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Down=4]="Down",t[t.Left=8]="Left",t[t.Front=16]="Front",t[t.Back=32]="Back"})(o=i.Dir||(i.Dir={})),i.dirMap=new Map([[o.Up,cc.v3(0,1,0)],[o.Right,cc.v3(1,0,0)],[o.Down,cc.v3(0,-1,0)],[o.Left,cc.v3(-1,0,0)],[o.Front,cc.v3(0,0,1)],[o.Back,cc.v3(0,0,-1)]]);var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return this.getInst()},enumerable:!1,configurable:!0}),e}(r.SingleClass);i.UB_S=c;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/unblock/unblock",[2,!0]})})},__decorate([n.addSubPackage(s.SubPackageKey.unblock)],e)}(a.default);i.UnblockModel=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame","../../miniGamePackage/utils/SingleClass":"SingleClass"}],UnblockUnitActor:[function(t,e,i){"use strict";cc._RF.push(e,"31695DNY7tByoKsB47tYu+i","UnblockUnitActor"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/utils/MathExt")),n=t("./config_Unblock"),a=__importDefault(t("./UnblockGameWindow")),s=t("./UnblockModel"),r=cc._decorator,c=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.meshRenderer=null,e.sizeInt=cc.v3(1,1,1),e.isRemoving=!1,e.originPos=cc.Vec3.ZERO,e.dir=s.Dir.Back,e.units=[],e.planes=[],e.posOffset=[],e.eulerMap=new Map([[s.Dir.Up,cc.v3(0,0,90)],[s.Dir.Right,cc.v3(0,0,0)],[s.Dir.Down,cc.v3(0,0,270)],[s.Dir.Left,cc.v3(0,180,0)],[s.Dir.Front,cc.v3(0,270,0)],[s.Dir.Back,cc.v3(0,90,0)]]),e.isMoveOut=!1,e.disappearTime=0,e.lastTime=0,e}return __extends(e,t),e.prototype.init=function(t,e,i){this.sizeInt=e,this.dir=t,this.units=i;var o=cc.v3(0,0,0);i.forEach(function(t){return o.addSelf(t.pos)}),o.divSelf(i.length),this.node.position=o,this.originPos=o;var a=this.eulerMap.get(t),s=new cc.Quat;cc.Quat.fromEuler(s,a.x,a.y,a.z),cc.Vec3.transformQuat(e,e,s),this.node.scaleX=Math.abs(e.x*n.Unblock.unitSize.x),this.node.scaleY=Math.abs(e.y*n.Unblock.unitSize.y),this.node.scaleZ=Math.abs(e.z*n.Unblock.unitSize.z),this.node.eulerAngles=a},e.prototype.moveActor=function(t){var e=this;this.node.position=this.originPos,this.originPos=t;var i=cc.Vec3.distance(t,this.node.position)/n.Unblock.moveSpeed;console.log(cc.Vec3.distance(t,this.node.position)),cc.tween(this.node).to(i,{position:t}).call(function(){e.findNextActor(e.dir).forEach(function(t){return t.blockedActor(e.dir)})}).start()},e.prototype.findNextActor=function(t){var e=this,i=s.UB_S.Ins.mgr.nextUnits(this.units,t),o=[];return i.forEach(function(t){var i=t.actor;i&&i!=e&&o.findIndex(function(t){return t==i})<0&&o.push(i)}),o},e.prototype.blockedActor=function(t){this.node.position=this.originPos;var e=this.node.position,i=this.node.position.add(s.dirMap.get(t).mul(n.Unblock.bounceForce)),o=this.findNextActor(t);cc.tween(this.node).to(n.Unblock.bounceTime,{position:i},{easing:"sineOut"}).to(n.Unblock.bounceTime,{position:e},{easing:"sineIn"}).start(),cc.tween(this).delay(n.Unblock.bounceTime/5).call(function(){o.forEach(function(e){return e.blockedActor(t)})}).start()},e.prototype.removeOut=function(){var t=this;this.isMoveOut=!0,this.node.position=this.originPos;var e=s.dirMap.get(this.dir),i=cc.v3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),o=(n.Unblock.gridSize.div(2).dot(i.add(e))-this.units[0].crd.dot(e)+3)*n.Unblock.unitSize.dot(i),a=o/n.Unblock.moveSpeed;this.disappearTime=Date.now()+1e3*a,this.lastTime=Date.now(),cc.tween(this.node).to(a,{position:this.node.position.add(e.mul(o))},{easing:"sineOut"}).to(.15,{scaleX:1.3*this.node.scaleX,scaleY:1.3*this.node.scaleY,scaleZ:1.3*this.node.scaleZ},{easing:"sineOut"}).to(.15,{scaleX:0,scaleY:0,scaleZ:0},{easing:"sineIn"}).call(function(){return t.destoryActor()}).start()},e.prototype.launch=function(t){var e=this.node.position,i=s.dirMap.get(this.dir),o=cc.v3(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z)),r=(n.Unblock.gridSize.div(2).dot(o.add(i))-this.units[0].crd.dot(i)+3)*n.Unblock.unitSize.dot(o);this.node.position=this.node.position.add(i.mul(4*r)),this.node.opacity=0,cc.tween(this.node).delay(t).to(.1,{opacity:255}).to(.5,{position:e},{easing:cc.easing.quadInOut}).call(function(){a.default.instance&&a.default.instance.movedBlockCount++}).start()},e.prototype.destoryActor=function(){this.planes.forEach(function(t){return t.destroy}),this.node.destroy()},e.prototype.update=function(){if(this.isMoveOut){var t=o.default.Clamp(0,1,1-(Date.now()-this.lastTime)/(this.disappearTime-this.lastTime));this.meshRenderer.getMaterial(0).setProperty("diffuseColor",cc.color(255,255,255,255*t))}},e.prototype.onDisable=function(){cc.Tween.stopAllByTarget(this.node),cc.Tween.stopAllByTarget(this)},__decorate([l(cc.MeshRenderer)],e.prototype,"meshRenderer",void 0),__decorate([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../../miniGamePackage/utils/MathExt":"MathExt","./UnblockGameWindow":"UnblockGameWindow","./UnblockModel":"UnblockModel","./config_Unblock":"config_Unblock"}],UnblockUnit:[function(t,e,i){"use strict";cc._RF.push(e,"69fde4RztNCgZCX9gxxqlOR","UnblockUnit"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./config_Unblock"),n=function(){function t(t){this.crd=cc.Vec3.ZERO,this.linkCrd=[],this.actor=null,this.crd=t}return Object.defineProperty(t.prototype,"pos",{get:function(){return o.Unblock.maxPos.mul(-1).add(o.Unblock.unitSize.div(2)).add(o.Unblock.unitSize.clone().multiply(this.crd))},enumerable:!1,configurable:!0}),t.prototype.fill=function(t,e){var i=this;e.forEach(function(t){t.equals(i.crd)||i.linkCrd.push(t)}),this.actor=t},t}();i.default=n,cc._RF.pop()},{"./config_Unblock":"config_Unblock"}],Wall:[function(t,e,i){"use strict";cc._RF.push(e,"0daeeBANnBIVoBPLbYbw6R+","Wall"),Object.defineProperty(i,"__esModule",{value:!0}),i.BladeFlyWall=void 0;var o=t("../../../miniGamePackage/utils/Line"),n=t("../config_BladeFly"),a=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.collisionRet=function(t){t.point.addSelf(t.dir.mul(this.ACCURACY));for(var e={},i=o.Line.Vec2Line(t.dir,t.point,t.dist),a=Number.MAX_VALUE,s=function(i,o){var n=cc.Vec2.distance(i,t.point);n<a&&(a=n,e.point=i,e.reflect=o)},r=0;r<this.edge.length;r++){var c=this.edge[r];if(0!=c.dir.cross(t.dir)){var l=c.closetPointWithPoint(t.point);if(cc.Vec2.distance(t.point,l)<n.BladeFly.bladeRadius){var h=c.getOrthocenter(t.point),u=t.point.sub(h);if(t.dir.dot(u)>0)continue;s(t.point,c.reflect(t.dir))}else{u=t.point.sub(c.randomPointInLine());var d=c.nor;if(d.dot(u)>0&&d.mulSelf(-1),d.dot(t.dir)<0)continue;var p=o.Line.Vec2Line(t.dir,t.point.add(d.mul(n.BladeFly.bladeRadius)),t.dist),m=c.intersect(p);if(m){var f=c.nor;f.dot(t.dir)>0&&f.mulSelf(-1),s(P=m.add(f.mul(n.BladeFly.bladeRadius)),c.reflect(t.dir))}else{var g=c.closetPointWithLine(p),_=i.closetPointWithPoint(g),y=cc.Vec2.distance(_,g);if(y>n.BladeFly.bladeRadius)continue;var v=Math.sqrt(n.BladeFly.bladeRadius*n.BladeFly.bladeRadius-y*y),b=g.sub(_).add(t.dir.mul(v)),P=g.sub(b),S=b.mul(-1).normalize();s(P,t.dir.add(S.mul(-2*t.dir.dot(S))))}}}}return e},e}(t("./ColliderObjBase").BladeFlyColliderObjBase);i.BladeFlyWall=a,cc._RF.pop()},{"../../../miniGamePackage/utils/Line":"Line","../config_BladeFly":"config_BladeFly","./ColliderObjBase":"ColliderObjBase"}],basketballBubbleCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"ba18dU3ZzFGT44F1ZZXXyH7","basketballBubbleCtrl"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.minY=0,e.maxY=0,e.minX=0,e.maxX=0,e.minSpawnInterval=1,e.maxSpawnInterval=5,e.bubbleSpriteFrame=null,e}return __extends(e,t),e.prototype.update=function(){},e.prototype.spawnBubbleByNum=function(t,e,i){var o=this;this.minX=e.x-i,this.maxX=e.x+i;for(var n=.5/t,a=cc.tween(this.node),s=0;s<t;s++)a=a.delay(n).call(function(){return o.spawnBubble()});a=a.start()},e.prototype.spawnBubble=function(){var t=new cc.Node("Bubble"),e=t.addComponent(cc.Sprite);this.bubbleSpriteFrame&&(e.spriteFrame=this.bubbleSpriteFrame);var i=this.randomFloat(this.minX,this.maxX),o=this.randomFloat(.5,1.5);this.node.addChild(t),t.setPosition(i,this.minY),t.setScale(o);var n=(this.minX+this.maxX)/2,a=i-n,s=this.randomFloat(2,3),r=new cc.Vec3(n+a+a,this.maxY),c=1.5*o,l=cc.tween(t);l=l.to(s,{position:r,scale:c},{easing:"cubicOut"}).call(function(){t.destroy()}).start()},e.prototype.randomFloat=function(t,e){return t+Math.random()*(e-t)},__decorate([a({type:cc.Float})],e.prototype,"minY",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxY",void 0),__decorate([a({type:cc.Float})],e.prototype,"minSpawnInterval",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxSpawnInterval",void 0),__decorate([a({type:cc.SpriteFrame})],e.prototype,"bubbleSpriteFrame",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],basketballMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"a7ba6fZZRdKranROSu/Kkgd","basketballMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=__importStar(t("../../miniGamePackage/SubPackageManager")),a=t("../../miniGamePackage/types-miniGame"),s=__importDefault(t("./basketballBubbleCtrl")),r=__importDefault(t("./LCDNumber")),c=cc._decorator,l=c.ccclass,h=c.property;(function(t){t[t.Combo=0]="Combo",t[t.HollowBall=1]="HollowBall",t[t.BankShot=2]="BankShot",t[t.FastBreak=3]="FastBreak",t[t.BuzzerBeater=4]="BuzzerBeater",t[t.TotalScore=5]="TotalScore"})(o||(o={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.basketball=null,e.basketballSprite=null,e.basketballFrames=[],e.scoreSkillBoards=[],e.soundClip=[],e.ground=null,e.leftHood=null,e.rightHood=null,e.backboard=null,e.holdBack=null,e.scoreBoard=null,e.scorePosition1=null,e.scorePosition2=null,e.restartBt=null,e.countDownProgressBar=null,e.shadow=null,e.flashLight=null,e.smoke=null,e.dyingLight=null,e.bubbleCtrl=null,e._scoreSkills=[],e._score=0,e._checkpoints=[],e._currentCheckpointIndex=0,e._offsetY=0,e._world=null,e._ballBody=null,e._groundBody=null,e._backboardBody=null,e._hoopBodyLift=null,e._hoopBodyRight=null,e._shakeAmount=0,e._contactCount=0,e._boardDir=1,e._isDying=!1,e._isGameOver=!1,e._comboCountDown=0,e._comboMultiplier=0,e._comboCD=3,e._isGroundContacting=!1,e._contactTimes=0,e._blackSmokeTime=0,e._blackSmokeCD=.3,e.shareShotNode=null,e.isShared=!1,e}var i;return __extends(e,t),i=e,Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t,this.scoreBoard&&this.scoreBoard.drawLCDNumber(this.score)},enumerable:!1,configurable:!0}),e.prototype.start=function(){var t=this;if(this.basketball&&this.ground&&this.leftHood&&this.rightHood&&this.backboard&&(this._world=new n.P2.World,this._world.gravity=[0,-2200],this._world)){var e=new n.P2.Material(1);this._groundBody=new n.P2.Body({mass:0,position:[this.ground.x,this.ground.y]});var i=new n.P2.Box({width:this.ground.width,height:this.ground.height});i.material=e,this._groundBody.addShape(i),this._world.addBody(this._groundBody),this._backboardBody=new n.P2.Body({mass:0,position:[this.backboard.x,this.backboard.y]});var o=new n.P2.Box({width:this.backboard.width,height:this.backboard.height});o.material=e,this._backboardBody.addShape(o),this._world.addBody(this._backboardBody),this._hoopBodyLift=new n.P2.Body({mass:0,position:[this.leftHood.x,this.leftHood.y]});var a=new n.P2.Circle({radius:this.leftHood.width/2});a.material=e,this._hoopBodyLift.addShape(a),this._world.addBody(this._hoopBodyLift),this._hoopBodyRight=new n.P2.Body({mass:0,position:[this.rightHood.x,this.rightHood.y]});var s=new n.P2.Circle({radius:this.leftHood.width/2});if(s.material=e,this._hoopBodyRight.addShape(s),this._world.addBody(this._hoopBodyRight),this._ballBody=new n.P2.Body({mass:1,position:[this.basketball.x,this.basketball.y]}),this._ballBody){var r=new n.P2.Circle({radius:this.basketball.width/2});r.material=e,this._ballBody.addShape(r),this._world.addBody(this._ballBody);var c=new n.P2.ContactMaterial(e,e);c.restitution=.6,c.friction=.9,this._world.addContactMaterial(c),this._world.on("beginContact",function(e){e.bodyA!==t._ballBody&&e.bodyB!==t._ballBody||(console.log("\u7bee\u7403\u53d1\u751f\u4e86\u78b0\u649e"),t._contactCount++,t._contactTimes=.3,e.bodyA!=t._backboardBody&&e.bodyB!=t._backboardBody||(t._contactCount+=1e4,t._pengSound()),e.bodyA!=t._groundBody&&e.bodyB!=t._groundBody||(t._isGroundContacting=!0,t._pengSound(),t._isDying&&t._lose()))}),this._world.on("endContact",function(e){e.bodyA!==t._ballBody&&e.bodyB!==t._ballBody||e.bodyA!=t._groundBody&&e.bodyB!=t._groundBody||(console.log("\u7bee\u7403\u79bb\u5f00\u5730\u9762"),t._isGroundContacting=!1)}),this._showSkillScore(),this._nextLevel()}}},e.prototype._lose=function(){var t=this;this._isDying=!1,this._isGameOver=!0,this.scoreBoard&&this.scorePosition1&&this.scorePosition2&&cc.tween(this.scoreBoard.node.parent).to(1,{position:this.scorePosition2.position,scale:1.5,zIndex:10}).call(function(){t.restartBt&&(t.restartBt.active=!0)}).start()},e.prototype._goalSound=function(){n.default.instance.miniGameAdapter.vibrateLong(.4),this.soundClip.length>0&&cc.audioEngine.play(this.soundClip[0],!1,1)},e.prototype._pengSound=function(){n.default.instance.miniGameAdapter.vibrateShort(4);var t=Math.floor(3*Math.random())+1;this.soundClip.length>t&&cc.audioEngine.play(this.soundClip[t],!1,1)},e.prototype.restart=function(){var t=this;this.scoreBoard&&this.scorePosition1&&this.scorePosition2&&cc.tween(this.scoreBoard.node.parent).call(function(){t.restartBt&&(t.restartBt.active=!1)}).to(1,{position:this.scorePosition1.position,scale:1,zIndex:cc.macro.MIN_ZINDEX}).call(function(){t.score=0,t._comboMultiplier=0,t._isGameOver=!1,t.isShared=!1,t._nextLevel()}).start()},e.prototype.share=function(){var t=this;this.isShared?n.default.instance.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.shareShotNode&&!this.isShared&&n.default.instance.miniGameAdapter.shareScreenShotSP(this.shareShotNode,{miniGame:a.SubPackageKey.basketball}).then(function(e){e?(n.default.instance.showTip("\u5206\u4eab\u6210\u529f"),t.isShared=!0,t.reLife()):n.default.instance.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.reLife=function(){var t=this;this.scoreBoard&&this.scorePosition1&&this.scorePosition2&&cc.tween(this.scoreBoard.node.parent).call(function(){t.restartBt&&(t.restartBt.active=!1)}).to(1,{position:this.scorePosition1.position,scale:1,zIndex:cc.macro.MIN_ZINDEX}).call(function(){t._comboMultiplier=0,t._isGameOver=!1,t._nextLevel(),t.countDownProgressBar&&(t.countDownProgressBar.progress=1,cc.Tween.stopAllByTarget(t.countDownProgressBar),cc.tween(t.countDownProgressBar).to(10,{progress:0}).call(function(){t._isDying=!0}).start())}).start()},e.prototype._nextLevel=function(){var t=this,e=this,i=e._groundBody,o=e._backboardBody,n=e._hoopBodyLift,a=e._hoopBodyRight,s=e._ballBody;if(i&&o&&n&&a&&s&&this.ground&&this.backboard&&this.leftHood&&this.rightHood&&this.basketball&&this.holdBack){this._boardDir*=-1;var r=600*Math.random()-300;this._offsetY=r-this._offsetY,this._setNodePosition(this.ground,i,cc.v2(Math.abs(this.ground.x)*this._boardDir,this.ground.y)),this._setNodePosition(this.backboard,o,cc.v2(Math.abs(this.backboard.x)*this._boardDir,this.backboard.y+this._offsetY)),this.backboard.scaleX=-1*this._boardDir,this.holdBack.scaleX=-1*this._boardDir,this.holdBack.setPosition(cc.v2(Math.abs(this.holdBack.x)*this._boardDir,this.holdBack.y+this._offsetY)),this._setNodePosition(this.leftHood,n,cc.v2(Math.abs(this.leftHood.x)*this._boardDir,this.leftHood.y+this._offsetY)),this._setNodePosition(this.rightHood,a,cc.v2(Math.abs(this.rightHood.x)*this._boardDir,this.rightHood.y+this._offsetY));var c=(this.leftHood.x+this.rightHood.x)/2,l=this.leftHood.y,h=this.basketball.width/2;this._checkpoints=[cc.v2(c,l+h),cc.v2(c,l),cc.v2(c,l-h)],this._offsetY=r,this._isDying=!1,this._comboMultiplier++,this._comboCountDown=this._comboCD;var u=2e3/Math.min(this.score+200,1e3);this.countDownProgressBar&&(this.countDownProgressBar.progress=1,cc.Tween.stopAllByTarget(this.countDownProgressBar),cc.tween(this.countDownProgressBar).to(u,{progress:0}).call(function(){t._isDying=!0}).start())}},e.prototype._setNodePosition=function(t,e,i){t.setPosition(i),e.position=[i.x,i.y]},e.prototype.update=function(t){if(t>=.02&&(t=.02),this._world&&this.basketball&&this._ballBody){if(this._isDying&&(t/=2),this._contactTimes-=t,this._world.step(t),this.dyingLight&&(this._isDying?(this.dyingLight.setPosition(this.basketball.position),this.dyingLight.opacity=255):this.dyingLight.opacity=0),this._blackSmokeTime-=t,this._blackSmokeTime<0&&(this._blackSmokeTime=this._blackSmokeCD,this._comboMultiplier>5&&this.smoke)){var e=cc.instantiate(this.smoke);e.parent=this.basketball.parent,e.setPosition(this.basketball.position),e.angle=360*Math.random(),cc.tween(e).by(1,{y:30,scale:-.8}).call(function(){e.removeFromParent()}).start()}if(this._comboCountDown-=t,this.basketballSprite&&this.basketballFrames.length>=6){var i;i=this._contactCount%1e3>2?2:this._comboMultiplier>10?5:this._comboMultiplier>5?this._contactTimes>0?4:3:this._contactTimes>0?1:0,this.basketballSprite.spriteFrame=this.basketballFrames[i]}if(this._isDying&&this._isGroundContacting&&this._lose(),this._shakeAmount>=3){var n=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1,a=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1;this.node.setPosition(n,a)}if(this._shakeAmount=Math.max(0,this._shakeAmount-Math.pow(this._shakeAmount+10,1.3)*t),this.basketball.x=this._ballBody.position[0],this.basketball.y=this._ballBody.position[1],this.basketball.angle=180*this._ballBody.angle/Math.PI,this.basketball.x>this.node.width/2&&(this.basketball.x-=this.node.width,this._setNodePosition(this.basketball,this._ballBody,this.basketball.getPosition())),this.basketball.x<-this.node.width/2&&(this.basketball.x+=this.node.width,this._setNodePosition(this.basketball,this._ballBody,this.basketball.getPosition())),this.shadow){this.shadow.x=this.basketball.x;var s=this.basketball.y-this.shadow.y,r=Math.max(0,(600-s)/600);this.shadow.scale=r}var c=this.basketball.getPosition(),l=this.basketball.width/2;if(c.sub(this._checkpoints[this._currentCheckpointIndex]).mag()<l){if(this._currentCheckpointIndex++,this._currentCheckpointIndex===this._checkpoints.length){console.log("\u7bee\u7403\u4ece\u4e0a\u5411\u4e0b\u8fdb\u5165\u7bee\u7b50\uff01"),this._goalSound(),this._currentCheckpointIndex=0;var h=this._comboMultiplier;this._scoreSkills=[],this._comboMultiplier>1&&this._scoreSkills.push({type:o.Combo,num:this._comboMultiplier}),0!=this._contactCount&&10001!=this._contactCount||(0==this._contactCount&&(this._scoreSkills.push({type:o.HollowBall,num:this._comboMultiplier}),h+=3),10001==this._contactCount&&(h+=2,this._scoreSkills.push({type:o.BankShot,num:this._comboMultiplier})));var u=-this._ballBody.velocity[1];if(u>1e3){var d=Math.floor((u-1e3)/200)+1;this._scoreSkills.push({type:o.FastBreak,num:d}),h+=d}this._isDying&&(this._scoreSkills.push({type:o.BuzzerBeater,num:0}),h+=5),this._scoreSkills.push({type:o.TotalScore,num:h}),this.bubbleCtrl&&this.bubbleCtrl.spawnBubbleByNum(h,this.basketball.getPosition(),50),this._showSkillScore(),this.score+=h,this._shakeAmount=6+3*h,this._nextLevel()}}else this._currentCheckpointIndex>0&&c.sub(this._checkpoints[this._currentCheckpointIndex-1]).mag()>2*l&&(this._currentCheckpointIndex=0)}},e.prototype._showSkillScore=function(){var t=-300,e=40;1==this._boardDir&&(t=170),e*=-1*this._boardDir;for(var i=0;i<this.scoreSkillBoards.length;i++)this.scoreSkillBoards[i].parent.active=!1;var n=function(i){var n=a._scoreSkills[i].type,s=a._scoreSkills[i].num,r=a.scoreSkillBoards[n],c=r.parent;if(c.active=!0,n==o.Combo){var l=c.getChildByName("sp");l.active=s>5,r.getComponent(cc.Label).string=s.toString(),a.flashLight&&(s>10?(l.scale=(s+100)/100,cc.tween(a.flashLight).to(.1,{opacity:96}).to(.2,{opacity:0}).start()):(l.scale=1,a.flashLight.opacity=0))}else n!=o.FastBreak&&n!=o.TotalScore||(r.getComponent(cc.Label).string=s.toString());cc.Tween.stopAllByTarget(c),c.opacity=0,c.setPosition(t+i*e,390+-50*i),cc.tween(c).delay(.15*i).call(function(){c.opacity=255}).to(.1,{scale:1.3}).to(.1,{scale:1}).delay(1).to(a._comboCD-1.2-.15*i,{opacity:0}).start()},a=this;for(i=0;i<this._scoreSkills.length;i++)n(i)},e.prototype._touchStart=function(t){if(this.basketball&&this._ballBody&&!this._isDying&&!this._isGameOver){var e=this.node.convertToNodeSpaceAR(t.getLocation());this.basketball.getPosition().sub(e).normalize(),this._contactCount=0,this._ballBody.velocity[1]=Math.max(1e3,this._ballBody.velocity[1]),this._ballBody.velocity[0]=300*this._boardDir,this._comboCountDown<=0&&(this._comboMultiplier=1)}},e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStart,this),cc.game.setFrameRate(60),i.instance=this,n.default.instance.miniGameAdapter.changeMainGameMusic(.4)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._touchStart,this),cc.game.setFrameRate(30),i.instance=null;for(var t=0;t<this.soundClip.length;t++)cc.audioEngine.uncache(this.soundClip[t]);n.default.instance.miniGameAdapter.changeMainGameMusic(1)},e.prototype.onClickExit=function(){n.default.instance.getModel().gameExit()},e.instance=null,__decorate([h(cc.Node)],e.prototype,"basketball",void 0),__decorate([h(cc.Sprite)],e.prototype,"basketballSprite",void 0),__decorate([h([cc.SpriteFrame])],e.prototype,"basketballFrames",void 0),__decorate([h([cc.Node])],e.prototype,"scoreSkillBoards",void 0),__decorate([h([cc.AudioClip])],e.prototype,"soundClip",void 0),__decorate([h(cc.Node)],e.prototype,"ground",void 0),__decorate([h(cc.Node)],e.prototype,"leftHood",void 0),__decorate([h(cc.Node)],e.prototype,"rightHood",void 0),__decorate([h(cc.Node)],e.prototype,"backboard",void 0),__decorate([h(cc.Node)],e.prototype,"holdBack",void 0),__decorate([h(r.default)],e.prototype,"scoreBoard",void 0),__decorate([h(cc.Node)],e.prototype,"scorePosition1",void 0),__decorate([h(cc.Node)],e.prototype,"scorePosition2",void 0),__decorate([h(cc.Node)],e.prototype,"restartBt",void 0),__decorate([h(cc.ProgressBar)],e.prototype,"countDownProgressBar",void 0),__decorate([h(cc.Node)],e.prototype,"shadow",void 0),__decorate([h(cc.Node)],e.prototype,"flashLight",void 0),__decorate([h(cc.Prefab)],e.prototype,"smoke",void 0),__decorate([h(cc.Node)],e.prototype,"dyingLight",void 0),__decorate([h(s.default)],e.prototype,"bubbleCtrl",void 0),__decorate([h(cc.Node)],e.prototype,"shareShotNode",void 0),i=__decorate([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","./LCDNumber":"LCDNumber","./basketballBubbleCtrl":"basketballBubbleCtrl"}],basketballModel:[function(t,e,i){"use strict";cc._RF.push(e,"6afd2+RLIlDWKZi9dd/qeua","basketballModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/basketball/basketballMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.basketball)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],buildingMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"932c1oVTyZOw6WDCYAJ1I/7","buildingMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importStar(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wallNode=[],e.buildingPres=[],e.spawnBuildingPoint=null,e.sceneNode=null,e.scoreLabel=null,e.maxScoreLabel=null,e.soundClip=[],e.shareShotNode=null,e.dropHandNode=null,e.dropAimNode=null,e.dustNodePre=null,e.world=null,e.floorMaterial=null,e.buildingMaterial=null,e.spawnedBody=null,e.goodBuildings=[],e._shakeAmount=0,e.score=0,e.maxScore=0,e.overHeightTime=0,e.isGameOver=!1,e.isShared=!1,e.buildMaxHeight=0,e.dropHandAngle={value:0},e.dropHandConstraintToBuilding=null,e.isCanSpawnConstraint=!0,e.dropMoveSpeed=500,e}return __extends(e,t),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_END,this._touchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEnd,this),o.default.instance.miniGameAdapter.changeMainGameMusic(.4),cc.game.setFrameRate(60),cc.tween(this.dropHandAngle).set({value:-30}).to(3,{value:30},{easing:cc.easing.sineInOut}).to(3,{value:-30},{easing:cc.easing.sineInOut}).union().repeatForever().start()},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_END,this._touchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._touchEnd,this),cc.game.setFrameRate(30),o.default.instance.miniGameAdapter.changeMainGameMusic(1);for(var t=0;t<this.soundClip.length;t++)cc.audioEngine.uncache(this.soundClip[t]);cc.Tween.stopAllByTarget(this.dropHandAngle)},e.prototype.start=function(){this._gameInit(),this.init(),this.spawnDropBuilding()},e.prototype._gameInit=function(){var t=cc.sys.localStorage.getItem("miniGameBuilding");if(t){var e=JSON.parse(t);e&&(this.maxScore=e.maxScore)}},e.prototype._gameSave=function(){var t={maxScore:0};t.maxScore=this.maxScore,cc.sys.localStorage.setItem("miniGameBuilding",JSON.stringify(t))},e.prototype.clear=function(){for(var t=0,e=this.goodBuildings;t<e.length;t++)e[t].node.destroy();this.goodBuildings=[]},e.prototype.reStart=function(){var t=this;this.clear(),this.init(),this.score=0,this.isShared=!1,cc.tween(this).call(function(){t.dropMoveSpeed=1e4}).delay(1).call(function(){t.dropMoveSpeed=500,t.spawnDropBuilding()}).start()},e.prototype.reLife=function(){var t=this;this.clear();var e=this.score;this.score=0,this.isCanSpawnConstraint=!1,this.init();for(var i=function(i){var n=i;cc.tween(o).delay(1+.3*n).call(function(){var i=t.spawnBuilding(0);i&&(i.body.position=[0,t.buildMaxHeight+91],i.node.setPosition(0,t.buildMaxHeight+91),t.isCanSpawnConstraint=!0,t.score++),n==e-1&&cc.tween(t).delay(1).call(function(){t.spawnDropBuilding()}).start()}).start()},o=this,n=0;n<e;n++)i(n)},e.prototype.init=function(){var t=this;if(this.isGameOver=!1,this.shareShotNode&&(this.shareShotNode.active=!1),this.dropAimNode&&this.dropHandNode){this.world=new o.P2.World,this.world.gravity=[0,-3e3],this.floorMaterial=new o.P2.Material(1),this.buildingMaterial=new o.P2.Material(3);var e=new o.P2.ContactMaterial(this.floorMaterial,this.buildingMaterial);e.friction=100,e.restitution=.1,this.world.addContactMaterial(e),(e=new o.P2.ContactMaterial(this.buildingMaterial,this.buildingMaterial)).friction=100,e.restitution=.1,this.world.addContactMaterial(e);for(var i=0,n=this.wallNode;i<n.length;i++){var a=n[i],s=new o.P2.Body({mass:0,position:[a.x,a.y]}),r=new o.P2.Box({width:a.width,height:a.height});r.material=this.floorMaterial,s.addShape(r),this.world.addBody(s)}this.dropHandNode.zIndex=2,this.world.on("beginContact",function(e){var i=e.bodyA,o=e.bodyB;if(t.isCanSpawnConstraint&&(i==t.goodBuildings[t.goodBuildings.length-1].body||o==t.goodBuildings[t.goodBuildings.length-1].body)){if(cc.audioEngine.play(t.soundClip[0],!1,1),t.isCanSpawnConstraint=!1,t.dustNodePre){var n=cc.instantiate(t.dustNodePre);n.parent=t.goodBuildings[t.goodBuildings.length-1].node,n.setPosition(0,0);var a=n.getComponent(cc.Animation);a&&a.play(),cc.tween(n).delay(.3).call(function(){n.destroy()}).start()}cc.tween(t).delay(1).call(function(){var e,n=i.position[1]-o.position[1];if((n=Math.abs(91-Math.abs(n)))<10&&Math.abs(i.angle)<Math.PI/20&&Math.abs(o.angle)<Math.PI/20){cc.log("addConstraint");var a=new p2.LockConstraint(i,o);null===(e=t.world)||void 0===e||e.addConstraint(a),t.score+=1}else t.lose()}).start()}})}},e.prototype.spawnDropBuilding=function(){if(this.spawnBuildingPoint&&this.dropHandNode&&this.world){var t=this.spawnBuilding();if(t){var e=cc.v2(this.dropHandNode.position.x,this.dropHandNode.position.y-205);t.node.setPosition(e),t.body.position=[e.x,e.y],this.spawnedBody=t.body}}},e.prototype.checkBuildings=function(){for(var t=this.wallNode[0].y,e=0;e<this.goodBuildings.length;e++){if(e>0&&this.goodBuildings[e].node.y<=this.goodBuildings[e-1].node.y)return void this.lose();this.score>e&&(t=Math.max(t,this.goodBuildings[e].node.y))}this.buildMaxHeight=t},e.prototype.spawnBuilding=function(t){var e;if(void 0===t&&(t=11),this.spawnBuildingPoint&&this.sceneNode&&this.buildingMaterial){var i=Math.floor(Math.random()*this.buildingPres.length),n=cc.instantiate(this.buildingPres[i]);n.width-=(n.width-n.height)*Math.min(1,this.goodBuildings.length/50),n.parent=this.sceneNode;var a=new o.P2.Body({mass:t}),s=new o.P2.Box({width:n.width,height:90});s.material=this.buildingMaterial,a.addShape(s),null===(e=this.world)||void 0===e||e.addBody(a);var r={body:a,node:n};return this.goodBuildings.push(r),r}},e.prototype.update=function(t){if(!this.isGameOver&&(t>.02&&(t=.02),this.world)){if(this._shakeAmount>=3){var e=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1,i=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1;this.node.setPosition(cc.v2(e,i))}if(this._shakeAmount=Math.max(0,this._shakeAmount-Math.pow(this._shakeAmount+7,1.3)*t),this.world.step(t),this.checkBuildings(),this.sceneNode){var o=this.dropMoveSpeed*t,n=-this.buildMaxHeight-400,a=this.sceneNode.y;this.sceneNode.y>n+o?this.sceneNode.y-=o:this.sceneNode.y<n-o?this.sceneNode.y+=o:this.sceneNode.y=n,this.dropAimNode&&(this.dropAimNode.y-=this.sceneNode.y-a)}if(this.scoreLabel&&this.maxScoreLabel&&(this.scoreLabel.string=this.score+"",this.maxScoreLabel.string=this.maxScore+"",this.score>this.maxScore&&(this.maxScore=this.score,this._gameSave())),this.spawnedBody&&(this.spawnedBody.velocity=[0,0]),this.dropAimNode&&this.dropHandNode){this.dropAimNode.angle=this.dropHandAngle.value;var s=this.dropAimNode.angle*Math.PI/180;this.dropHandNode.setPosition(this.dropAimNode.getPosition().add(cc.v2(Math.sin(s),-Math.cos(s)).mul(this.dropAimNode.height-5)));var r=cc.v2(this.dropHandNode.position.x,this.dropHandNode.position.y-205);this.spawnedBody&&(this.spawnedBody.position=[r.x,r.y])}for(var c=0,l=this.goodBuildings;c<l.length;c++){var h=l[c],u=h.body,d=h.node;d.setPosition(u.position[0],u.position[1]),d.angle=180*u.angle/Math.PI}}},e.prototype.lose=function(){cc.Tween.stopAllByTarget(this),this.isGameOver=!0,this.spawnedBody=null,this.shareShotNode&&(this.shareShotNode.active=!0,this.shareShotNode.getChildByName("label").getComponent(cc.Label).string=this.score+"")},e.prototype.share=function(){var t=this;this.isShared?o.default.instance.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.shareShotNode&&!this.isShared&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareShotNode,{miniGame:n.SubPackageKey.building}).then(function(e){e?(o.default.instance.showTip("\u5206\u4eab\u6210\u529f"),t.isShared=!0,t.reLife()):o.default.instance.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype._touchEnd=function(){var t,e=this;this.spawnedBody&&(this.dropHandConstraintToBuilding&&(null===(t=this.world)||void 0===t||t.removeConstraint(this.dropHandConstraintToBuilding)),this.spawnedBody.wakeUp(),this.spawnedBody.gravityScale=1,this.spawnedBody=null,this.isCanSpawnConstraint=!0,cc.tween(this).delay(1).call(function(){e.spawnDropBuilding()}).start())},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([r(cc.Node)],e.prototype,"wallNode",void 0),__decorate([r(cc.Node)],e.prototype,"buildingPres",void 0),__decorate([r(cc.Node)],e.prototype,"spawnBuildingPoint",void 0),__decorate([r(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([r(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([r(cc.Label)],e.prototype,"maxScoreLabel",void 0),__decorate([r([cc.AudioClip])],e.prototype,"soundClip",void 0),__decorate([r(cc.Node)],e.prototype,"shareShotNode",void 0),__decorate([r(cc.Node)],e.prototype,"dropHandNode",void 0),__decorate([r(cc.Node)],e.prototype,"dropAimNode",void 0),__decorate([r(cc.Node)],e.prototype,"dustNodePre",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame"}],buildingModel:[function(t,e,i){"use strict";cc._RF.push(e,"61de4Lg06lB3IXzmVTLV7D2","buildingModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/building/buildingMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.building)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],carCrossCar:[function(t,e,i){"use strict";cc._RF.push(e,"0b21avh34RGMZlFR0597isf","carCrossCar"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.dieSprite=null,e.frames=[],e.dieFrames=[],e}return __extends(e,t),e.prototype.start=function(){var t=Math.floor(Math.random()*this.frames.length);this.sprite&&this.frames.length&&(this.sprite.spriteFrame=this.frames[t]),this.dieSprite&&this.dieFrames.length&&(this.dieSprite.spriteFrame=this.dieFrames[t])},e.prototype.die=function(){var t=this;this.sprite&&(this.sprite.node.active=!1),this.dieSprite&&(this.dieSprite.node.active=!0),cc.tween(this.node).to(1,{opacity:0},{easing:cc.easing.smooth}).call(function(){t.node.destroy()}).start()},__decorate([a(cc.Sprite)],e.prototype,"sprite",void 0),__decorate([a(cc.Sprite)],e.prototype,"dieSprite",void 0),__decorate([a(cc.SpriteFrame)],e.prototype,"frames",void 0),__decorate([a(cc.SpriteFrame)],e.prototype,"dieFrames",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],carCrossMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"b0d74lvNLBLSIVgUt34AL8r","carCrossMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("./carCrossCar")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.soundClip=[],e.dangerPre=null,e.scene=null,e.carPre=null,e.pipePre=null,e.scoreLabel=null,e.lifeLabel=null,e.levelLabel=null,e.maxLevelLabel=null,e.maxLevel=0,e.nowLevel=0,e.initPipeNum=2,e.upPipeY=500,e.downPipeY=-500,e.pipeNum=0,e.score=0,e.maxScore=20,e.life=0,e.maxLife=3,e.carCnt=0,e.carSpeed=1500,e.cars=[],e.pipes=[],e._shakeAmount=0,e.dangerSet=new Set,e.shareNode=null,e.isShared=!1,e}var i;return __extends(e,t),i=e,e.prototype.onEnable=function(){i.instance=this,this.node.on(cc.Node.EventType.TOUCH_START,this.onNodeClicked,this),cc.game.setFrameRate(60)},e.prototype.onDisable=function(){i.instance=null,this.node.off(cc.Node.EventType.TOUCH_START,this.onNodeClicked,this),cc.game.setFrameRate(30)},e.prototype.start=function(){this._gameInit(),this.nextLevel()},e.prototype._gameInit=function(){var t=cc.sys.localStorage.getItem("miniGameCarCross");if(t){var e=JSON.parse(t);e&&(this.maxLevel=e.maxScore)}this.maxLevelLabel&&(this.maxLevelLabel.string=this.maxLevel.toString())},e.prototype._gameSave=function(){var t={maxScore:0};t.maxScore=Math.max(this.maxLevel,this.nowLevel),cc.sys.localStorage.setItem("miniGameCarCross",JSON.stringify(t))},e.prototype.onNodeClicked=function(){if(!(this.carCnt<0||0==this.cars.length)){o.default.instance.miniGameAdapter.vibrateShort(3),cc.audioEngine.play(this.soundClip[0],!1,1);var t=this.cars[this.carCnt--];cc.tween(t).by(10,{y:10*this.carSpeed}).start(),this._shakeAmount=Math.max(this._shakeAmount,10);for(var e=0;e<=this.carCnt;e++){var i=this.downPipeY-100*(this.carCnt-e+1)-this.cars[e].y;cc.tween(this.cars[e]).by(i/this.carSpeed,{y:i}).start()}}},e.prototype.nextLevel=function(){var t=this;if(this._gameSave(),this.shareNode&&(this.shareNode.active=!1),this.scene&&this.pipePre){this.scene.destroyAllChildren(),this.dangerSet.clear(),this.cars=[],this.pipes=[],this.score=0,this.isShared=!1,this.life=this.maxLife,this.pipeNum=this.nowLevel+this.initPipeNum,this.initCars();for(var e=30*this.pipeNum+110,i=(this.upPipeY-this.downPipeY)/(this.pipeNum+1),o=c(100,200,this.pipeNum),n=c(150,350,this.pipeNum),a=function(a){var r=s.downPipeY+i*(a+1),c=cc.instantiate(s.pipePre);c.parent=s.scene,c.y=r;var l=c.getChildByName("left"),h=c.getChildByName("right");s.pipes.push(c);var u=c.getChildByName("shadow"),d=u.getChildByName("left"),p=u.getChildByName("right"),m=o[a],f=n[a];cc.log(m,f);var g=2*Math.random()*e/150;cc.tween(s).delay(g).call(function(){cc.tween(l).by(e/m,{x:-e},{easing:cc.easing.smooth}).by(e/f,{x:e},{easing:cc.easing.quadIn}).call(function(){t._shakeAmount=Math.max(t._shakeAmount,15)}).union().repeatForever().start(),cc.tween(h).by(e/m,{x:e},{easing:cc.easing.smooth}).by(e/f,{x:-e},{easing:cc.easing.quadIn}).union().repeatForever().start(),cc.tween(d).by(e/m,{x:-e},{easing:cc.easing.smooth}).by(e/f,{x:e},{easing:cc.easing.quadIn}).call(function(){t._shakeAmount=Math.max(t._shakeAmount,15)}).union().repeatForever().start(),cc.tween(p).by(e/m,{x:e},{easing:cc.easing.smooth}).by(e/f,{x:-e},{easing:cc.easing.quadIn}).union().repeatForever().start()}).start()},s=this,r=0;r<this.pipeNum;r++)a(r);this.nowLevel++}function c(t,e,i){for(var o=[],n=t;n<=e;n++)o.push(n);var a=Math.floor((e-t+1)/i),s=[];for(n=0;n<i&&0!=o.length;n++){var r=Math.floor(Math.random()*o.length),c=Math.floor(a/2),l=r-c,h=r+c;l<0&&(h-=l,l=0),h>=o.length&&(l-=h-o.length+1,h=o.length-1),s.push(o[r]),o.splice(l,h-l+1)}return s}},e.prototype.initCars=function(){if(this.carPre&&this.scene){var t=this.maxScore-this.score+this.maxLife-1;this.carCnt=t-1;for(var e=0;e<t;e++){var i=cc.instantiate(this.carPre);this.cars.push(i),i.parent=this.scene,i.setPosition(0,this.downPipeY-100*(t-e))}}},e.prototype.reStart=function(){this.nowLevel--,this.nextLevel()},e.prototype.update=function(t){var e=this;if(this._shakeAmount>=3){var i=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1,n=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1;this.scene&&this.scene.parent.setPosition(i,n)}this._shakeAmount=Math.max(0,this._shakeAmount-Math.pow(this._shakeAmount+7,1.3)*t);var s=this.cars.filter(function(t){return t.y>1e3});this.cars=this.cars.filter(function(t){return t.y<=1e3}),s.forEach(function(t){t.destroy(),e.score++,cc.log("score++")});for(var r=this.pipes.length-1;r>=0;r--){for(var c=this.pipes[r].getChildByName("left").getChildByName("collider").getBoundingBoxToWorld(),l=this.cars.length-1;l>=0;l--){var h=this.cars[l].getBoundingBoxToWorld();c.intersects(h)&&(cc.Tween.stopAllByTarget(this.cars[l]),(p=this.cars[l].getComponent(a.default))&&p.die(),this.cars.splice(l,1),cc.log("\u78b0\u649e"),o.default.instance.miniGameAdapter.vibrateLong(.1),cc.audioEngine.play(this.soundClip[1],!1,1),this.life--,this._shakeAmount+=20)}for(c=this.pipes[r].getChildByName("left").getChildByName("danger").getBoundingBoxToWorld(),l=this.cars.length-1;l>=0;l--)h=this.cars[l].getBoundingBoxToWorld(),c.intersects(h)&&(this.showDanger(this.cars[l].getPosition(),this.cars[l],this.pipes[r]),cc.log("\u5371\u9669"))}if(this.life<=0){this.life=0;for(var u=0,d=this.cars;u<d.length;u++){var p;(p=d[u]).destroy()}this.cars=[],this.shareNode&&(this.shareNode.active=!0)}if(this.score>=this.maxScore&&this.nextLevel(),this.scoreLabel&&(this.scoreLabel.string=this.score+"/"+this.maxScore),this.lifeLabel){this.lifeLabel.string="life:"+this.life+"/"+this.maxLife;var m=this.lifeLabel.node.children[0];for(r=0;r<this.life;r++)m.children[r].active=!0;for(r=this.life;r<this.maxLife;r++)m.children[r].active=!1}this.levelLabel&&(this.levelLabel.string=""+this.nowLevel)},e.prototype.showDanger=function(t,e,i){var o=this,n=e.uuid+"_"+i.uuid;this.dangerSet.has(n)||(this.dangerSet.add(n),cc.tween(this).delay(.1).call(function(){if(o.dangerPre&&o.scene&&255==e.opacity){var i=cc.instantiate(o.dangerPre);i.parent=o.scene,i.setPosition(t),i.opacity=0,cc.tween(i).to(.1,{opacity:255}).by(.2,{y:40}).by(.1,{y:20,opacity:-255}).call(function(){i.destroy()}).start()}}).start())},e.prototype.share=function(){var t=this;this.isShared?o.default.instance.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.shareNode&&!this.isShared&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareNode,{miniGame:n.SubPackageKey.carCross}).then(function(e){e?(o.default.instance.showTip("\u5206\u4eab\u6210\u529f"),t.isShared=!0,t.shareNode&&(t.shareNode.active=!1),t.life=t.maxLife,t.initCars()):o.default.instance.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},e.instance=null,__decorate([c([cc.AudioClip])],e.prototype,"soundClip",void 0),__decorate([c(cc.Node)],e.prototype,"dangerPre",void 0),__decorate([c(cc.Node)],e.prototype,"scene",void 0),__decorate([c(cc.Node)],e.prototype,"carPre",void 0),__decorate([c(cc.Node)],e.prototype,"pipePre",void 0),__decorate([c(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([c(cc.Label)],e.prototype,"lifeLabel",void 0),__decorate([c(cc.Label)],e.prototype,"levelLabel",void 0),__decorate([c(cc.Label)],e.prototype,"maxLevelLabel",void 0),__decorate([c(cc.Node)],e.prototype,"shareNode",void 0),i=__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","./carCrossCar":"carCrossCar"}],carCrossModel:[function(t,e,i){"use strict";cc._RF.push(e,"567487Oca9FJpLZ6PxRTzR2","carCrossModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.CarCrossModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),s=cc._decorator,r=(s.ccclass,s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/carCross/carCrossMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.carCross)],e)}(a.default));i.CarCrossModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],card2048Card:[function(t,e,i){"use strict";cc._RF.push(e,"b5aa2PcnYZNoZ7DUKN3Ez1r","card2048Card"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.numLabel=null,e.cards0=[],e.cards1=[],e.cards=[],e._num=1,e}return __extends(e,t),Object.defineProperty(e.prototype,"num",{get:function(){return this._num},set:function(t){this.setNum(t),this.fade()},enumerable:!1,configurable:!0}),e.prototype.fade=function(){cc.tween(this.cards[1].node).to(.1,{opacity:255},{easing:cc.easing.smooth}).to(.4,{opacity:0},{easing:cc.easing.smooth}).start()},e.prototype.up=function(){cc.tween(this.node).to(.1,{scale:1.2},{easing:cc.easing.cubicOut}).start()},e.prototype.down=function(t){void 0===t&&(t=null),cc.tween(this.node).to(.1,{scale:1},{easing:cc.easing.cubicIn}).call(function(){t&&t.dropCardSound()}).start()},e.prototype.setNum=function(t){this._num=t,this.numLabel&&(this.numLabel.string=t.toString());for(var e=0;t>1;)t/=2,e++;e>10&&(e=0),this.cards[0].spriteFrame=this.cards0[e],this.cards[1].spriteFrame=this.cards1[e],this.cards[1].node.opacity=0},e.prototype.setAnyNum=function(){this._num=0,this.cards[0].spriteFrame=this.cards0[0],this.cards[1].spriteFrame=this.cards1[0],cc.tween(this.cards[1].node).to(1,{opacity:200}).to(1,{opacity:0}).union().repeatForever().start(),this.numLabel&&(this.numLabel.string="???")},__decorate([a(cc.Label)],e.prototype,"numLabel",void 0),__decorate([a([cc.SpriteFrame])],e.prototype,"cards0",void 0),__decorate([a([cc.SpriteFrame])],e.prototype,"cards1",void 0),__decorate([a([cc.Sprite])],e.prototype,"cards",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],card2048MainGame:[function(t,e,i){"use strict";cc._RF.push(e,"67bbdVEv+hIvbf+Ta5fd3B0","card2048MainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("./card2048Card")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardPre=null,e.sceneNode=null,e.dropCardPre=null,e.scoreLabel=null,e.addScorePre=null,e._cards=[],e._cardCols=4,e._score=0,e._initX=-225,e._initY=220,e._intervalX=150,e._intervalY=-50,e.soundClip=[],e._spawnCardIntervalX=70,e._spawnCardNum=3,e._spawnCardPos=cc.v2(-100,-460),e._spawnAnyCardPos=cc.v2(100,-460),e._dropCards=[],e._notEndCol=-1,e._isCheckingCardNum=!1,e._cardAddCombo=1,e._spawnedCards=[],e._spawnedAnyCards=[],e._movingCard=null,e._lastCardId=cc.v2(-1,-1),e._shakeAmount=0,e._spawnMaxValue=3,e._maxValue=2048,e._maxCardsNumInCol=9,e.gameData={cards:[],anyCardNum:0,spawnCards:[],lastCardId:cc.v2(),score:0,spawnMaxValue:3,isShare:!1},e.shareNode=null,e.isShared=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),o.default.instance.miniGameAdapter.changeMainGameMusic(.4),cc.game.setFrameRate(60)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),o.default.instance.miniGameAdapter.changeMainGameMusic(1);for(var t=0;t<this.soundClip.length;t++)cc.audioEngine.uncache(this.soundClip[t]);cc.game.setFrameRate(30)},e.prototype.start=function(){this.init(),this.gameInit()},e.prototype.init=function(){for(var t=0;t<this._cardCols;t++)this._cards.push([]);this._initDropCards(),this._spawnCard(this._spawnCardNum),this._notEndCol=-1,this._isCheckingCardNum=!1},e.prototype.gameInit=function(){var t=cc.sys.localStorage.getItem("miniGameCard2048");if(t){var e=JSON.parse(t);if(e)for(var i=e.cards,o=0;o<i.length;o++)for(var n=i[o],a=function(t){var e=s._getCard();if(!e)return{value:void 0};var i=s._getDropPosition(o);e.node.setPosition(cc.v2(i.x,-1200)),e.node.zIndex=2e3,s._cards[o].push(e);var a=s._cards[o].length;cc.tween(e.node).delay(.1*t).to(1,{y:i.y},{easing:cc.easing.smooth}).call(function(){e.node.zIndex=a+100}).start(),e.setNum(n[t])},s=this,r=0;r<n.length;r++){var c=a(r);if("object"==typeof c)return c.value}var l=e.spawnCards;for(o=0;o<3;o++){if(o>=l.length)return;this._spawnedCards[o].setNum(l[o])}for(this._lastCardId=e.lastCardId,o=0;o<e.anyCardNum;o++)this._spawnAnyCard();this._score=e.score,this._spawnMaxValue=e.spawnMaxValue,e.isShare&&(this.isShared=e.isShare)}},e.prototype.gameSave=function(){this.gameData.cards=this._cards.map(function(t){return t.map(function(t){return t.num})}),this.gameData.anyCardNum=this._spawnedAnyCards.length,this.gameData.lastCardId=this._lastCardId,this.gameData.spawnCards=this._spawnedCards.map(function(t){return t.num}),this.gameData.score=this._score,this.gameData.spawnMaxValue=this._spawnMaxValue,this.gameData.isShare=this.isShared,cc.sys.localStorage.setItem("miniGameCard2048",JSON.stringify(this.gameData))},e.prototype.gameRestart=function(){this.sceneNode&&this.sceneNode.destroyAllChildren(),this._spawnMaxValue=3,this._cards=[],this._spawnedAnyCards=[],this._spawnedCards=[],this._lastCardId=cc.v2(-1,-1),this._score=0,this.isShared=!1,this.init(),this.gameSave()},e.prototype.share=function(){var t=this;this.isShared?o.default.instance.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.shareNode&&!this.isShared&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareNode,{miniGame:n.SubPackageKey.card2048}).then(function(e){if(e){o.default.instance.showTip("\u5206\u4eab\u6210\u529f"),t.isShared=!0,t.shareNode&&(t.shareNode.active=!1);for(var i=0;i<5;i++)t._spawnAnyCard();t.gameSave()}else o.default.instance.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.update=function(t){if(this.scoreLabel&&(this.scoreLabel.string=Math.floor(this._score).toString()),this._shakeAmount>=3){var e=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1,i=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1;this.node.setPosition(e,i)}this._shakeAmount=Math.max(0,this._shakeAmount-Math.pow(this._shakeAmount+7,1.3)*t)},e.prototype._initDropCards=function(){if(this.dropCardPre&&this.sceneNode)for(var t=0;t<this._cardCols;t++){var e=cc.instantiate(this.dropCardPre);e.parent=this.sceneNode,e.setPosition(this._getDropPosition(t)),this._dropCards.push(e)}},e.prototype._getCard=function(){if(!this.cardPre||!this.sceneNode)return null;var t=cc.instantiate(this.cardPre);return t.parent=this.sceneNode,t.getComponent(a.default)},e.prototype._spawnCard=function(t){for(var e=0;e<t;e++){var i=this._getCard();if(i){var o=this._getSpawnPosByID(e);i.node.setPosition(cc.v2(-500,o.y)),cc.tween(i.node).delay(.1*(t-e)+.3*t-.3).to(.3,{x:o.x},{easing:cc.easing.smooth}).start();var n=1<<Math.floor(Math.random()*this._spawnMaxValue)+1;i.setNum(n),i.node.zIndex=1e3+e,this._spawnedCards.length<=e?this._spawnedCards.push(i):this._spawnedCards[e]=i}}},e.prototype._spawnAnyCard=function(){var t=this._getCard();if(t){this._spawnedAnyCards.push(t);var e=this._spawnedAnyCards.length-1,i=this._getSpawnAnyCardPosByID(e);t.node.setPosition(i.x+1e3,i.y),cc.tween(t.node).to(.3,{x:i.x,y:i.y}).start(),t.setAnyNum(),t.node.zIndex=1e3-e}},e.prototype._getSpawnPosByID=function(t){return this._spawnCardPos.add(cc.v2(-this._spawnCardIntervalX*(this._spawnCardNum-t-1),0))},e.prototype._getSpawnAnyCardPosByID=function(t){return this._spawnAnyCardPos.add(cc.v2(50*t,0))},e.prototype._getCardAtPos=function(t){return this._spawnedCards[this._spawnedCards.length-1]&&this._spawnedCards[this._spawnedCards.length-1].node.getBoundingBox().contains(t)?this._spawnedCards[this._spawnedCards.length-1]:this._spawnedAnyCards.length>0&&this._spawnedAnyCards[0]&&this._spawnedAnyCards[0].node.getBoundingBox().contains(t)?this._spawnedAnyCards[0]:null},e.prototype._addScore=function(t,e){if(e=e.add(cc.v2(0,-120)),this.goalSound(),this._score+=t*this._cardAddCombo,this.addScorePre){var i=cc.instantiate(this.addScorePre);if(!i)return;var o=i.getComponent(cc.Label);o&&(o.string="+ "+t+" x "+this._cardAddCombo),this.sceneNode&&(i.parent=this.sceneNode),i.zIndex=2e3,i.setPosition(e),i.scale=1.3,i.opacity=0,cc.tween(i).to(.1,{opacity:255},{easing:cc.easing.cubicIn}).to(.2,{scale:1},{easing:cc.easing.cubicIn}).by(1,{y:20,opacity:-255},{easing:cc.easing.cubicIn}).call(function(){i.destroy()}).start()}},e.prototype._checkNumAdd=function(){var t=this;this._isCheckingCardNum=!0;var e=-1,i=function(i){if(!(t._cards.length<=i)){var o=t._cards[i].length;if(o>1&&(t._cards[i][o-1].num==t._cards[i][o-2].num||0==t._cards[i][o-1].num)){e=i;var n=t._cards[i][o-2].node.getPosition();cc.tween(t._cards[i][o-1].node).to(.3,{x:n.x,y:n.y},{easing:cc.easing.cubicIn}).call(function(){t._shakeAmount+=15;var e=t._cards[i][o-2].num*=2;t._addScore(e,n),e>128&&(e=128),e/=4;for(var a=0;e>=1;)e/=2,a++;t._spawnMaxValue=Math.max(a,t._spawnMaxValue);var s=t._cards[i].pop();s&&s.node.destroy()}).call(function(){t._checkNumAdd()}).start()}else if(o>0&&t._cards[i][o-1].num>=t._maxValue)if(e=i,o>1){var a=t._cards[i][o-2].node.getPosition();cc.tween(t._cards[i][o-1].node).to(.3,{x:a.x,y:a.y},{easing:cc.easing.cubicIn}).call(function(){t._addScore(t._maxValue,a),t._shakeAmount+=15,t._cards[i][o-2].num=t._maxValue;var e=t._cards[i].pop();e&&e.node.destroy(),t._checkNumAdd()}).start()}else cc.tween(t._cards[i][o-1].node).to(.3,{opacity:0},{easing:cc.easing.cubicIn}).call(function(){t._spawnAnyCard(),t._shakeAmount+=15,t._addScore(t._maxValue,t._cards[i][o-1].node.getPosition().add(cc.v2(0,-t._intervalY)));var e=t._cards[i].pop();e&&e.node.destroy(),t._checkNumAdd()}).start()}};if(this._notEndCol>=0&&(this._cardAddCombo+=1,i(this._notEndCol)),!(e>=0)){this._cardAddCombo=1,this._notEndCol=-1;for(var o=0;o<this._cardCols;o++)if(i(o),e>=0)return void(this._notEndCol=e);this.gameSave(),this._isCheckingCardNum=!1}},e.prototype.goalSound=function(){o.default.instance.miniGameAdapter.vibrateLong(.1),this.soundClip.length>0&&cc.audioEngine.play(this.soundClip[0],!1,1)},e.prototype.dropCardSound=function(){o.default.instance.miniGameAdapter.vibrateShort(4),this.soundClip.length>1&&cc.audioEngine.play(this.soundClip[1],!1,1)},e.prototype.cardBack=function(){var t=this._lastCardId;if(!(t.x<0||t.y>=this._cards[t.x].length)){var e=this._cards[t.x].pop();if(e){this._spawnedCards.push(e);var i=this._getSpawnPosByID(this._spawnedCards.length-1);e.node.zIndex=1e3+this._spawnedCards.length,cc.Tween.stopAllByTarget(e.node),cc.tween(e.node).to(.3,{x:i.x,y:i.y}).start()}}},e.prototype.onTouchStart=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation()),i=this._getCardAtPos(e);i&&(this._movingCard=i,this._movingCard.up())},e.prototype.onTouchMove=function(t){if(this._movingCard){var e=t.getDelta();this._movingCard.node.x+=e.x,this._movingCard.node.y+=e.y}},e.prototype.onTouchEnd=function(){if(this._movingCard){var t=this._getDropColumn(this._movingCard),e=this._getSpawnPosByID(this._spawnedCards.length-1);if(0==this._movingCard.num&&(e=this._getSpawnAnyCardPosByID(0)),t>=0)if(this._movingCard.down(this),e=this._getDropPosition(t),this._cards[t].push(this._movingCard),this._movingCard.node.zIndex=this._cards[t].length+100,this._lastCardId=cc.v2(t,this._cards[t].length-1),0==this._movingCard.num){for(var i=1;i<this._spawnedAnyCards.length;i++)this._spawnedAnyCards[i].node.zIndex=1e3-i+1,cc.tween(this._spawnedAnyCards[i].node).to(.3,{x:this._getSpawnAnyCardPosByID(i-1).x}).start(),this._spawnedAnyCards[i-1]=this._spawnedAnyCards[i];this._spawnedAnyCards.pop()}else if(this._spawnedCards.length==this._spawnCardNum){for(i=this._spawnCardNum-2;i>=0;i--)this._spawnedCards[i].node.zIndex=1e3+i+1,cc.tween(this._spawnedCards[i].node).to(.3,{x:this._getSpawnPosByID(i+1).x}).start(),this._spawnedCards[i+1]=this._spawnedCards[i];this._spawnCard(1)}else this._spawnedCards.pop();else this._movingCard.down();cc.tween(this._movingCard.node).to(.3,{x:e.x,y:e.y},{easing:cc.easing.cubicOut}).start(),this._isCheckingCardNum||this._checkNumAdd()}this._movingCard=null},e.prototype._getDropColumn=function(t){for(var e=0;e<this._cards.length;e++)if(e!=this._notEndCol){if(0==t.num){if(0==this._cards[e].length)continue}else if(this._cards[e].length==this._maxCardsNumInCol&&this._cards[e][this._maxCardsNumInCol-1].num!=t.num)continue;var i=this._getDropPosition(e);if(t.node.getBoundingBox().contains(i))return e}return-1},e.prototype._getDropPosition=function(t){var e=this._initY+this._intervalY*this._cards[t].length,i=this._initX+this._intervalX*t;return cc.v2(i,e)},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([c(cc.Prefab)],e.prototype,"cardPre",void 0),__decorate([c(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([c(cc.Prefab)],e.prototype,"dropCardPre",void 0),__decorate([c(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([c(cc.Prefab)],e.prototype,"addScorePre",void 0),__decorate([c([cc.AudioClip])],e.prototype,"soundClip",void 0),__decorate([c(cc.Node)],e.prototype,"shareNode",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","./card2048Card":"card2048Card"}],card2048Model:[function(t,e,i){"use strict";cc._RF.push(e,"f855cPHiWhC+ryDzkrC20S3","card2048Model"),Object.defineProperty(i,"__esModule",{value:!0}),i.Card2048Model=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),s=cc._decorator,r=(s.ccclass,s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/card2048/card2048MainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.card2048)],e)}(a.default));i.Card2048Model=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],circleFishBubble:[function(t,e,i){"use strict";cc._RF.push(e,"79d0fviJ3dGH7ZIFCfYppNJ","circleFishBubble"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.minY=0,e.maxY=0,e.minX=0,e.maxX=0,e.minSpawnInterval=1,e.maxSpawnInterval=5,e.bubbleSpriteFrame=null,e._spawnBubbleTimer=0,e}return __extends(e,t),e.prototype.update=function(t){this._spawnBubbleTimer-=t,this._spawnBubbleTimer<=0&&(this._spawnBubbleTimer=this.randomFloat(this.minSpawnInterval,this.maxSpawnInterval),this.spawnBubble())},e.prototype.spawnBubble=function(){var t=new cc.Node("Bubble"),e=t.addComponent(cc.Sprite);this.bubbleSpriteFrame&&(e.spriteFrame=this.bubbleSpriteFrame);var i=this.randomFloat(this.minX,this.maxX),o=this.randomFloat(.5,1.5);this.node.addChild(t),t.setPosition(i,this.minY),t.setScale(o);var n=this.randomFloat(2,3),a=new cc.Vec3(i,this.maxY),s=1.5*o,r=cc.tween(t);r=r.to(n,{position:a,scale:s},{easing:"cubicOut"}).call(function(){t.destroy()}).start()},e.prototype.randomFloat=function(t,e){return t+Math.random()*(e-t)},__decorate([a({type:cc.Float})],e.prototype,"minY",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxY",void 0),__decorate([a({type:cc.Float})],e.prototype,"minX",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxX",void 0),__decorate([a({type:cc.Float})],e.prototype,"minSpawnInterval",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxSpawnInterval",void 0),__decorate([a({type:cc.SpriteFrame})],e.prototype,"bubbleSpriteFrame",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],circleFishMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"417af9j6IlFCLCt1Wp7TW3U","circleFishMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/SubPackageManager"),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sceneNode=null,e.leftNode=null,e.rightNode=null,e.fishPrefab=null,e.sharkPrefab=null,e.startEndNode=null,e._startEndBody=null,e._world=null,e._constraints=[],e._bodies=[],e._lastBody=null,e._canDraw=!1,e._graphics=null,e._interval=10,e._isGameOver=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),cc.game.setFrameRate(60)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),cc.game.setFrameRate(30)},e.prototype.start=function(){this._world=new n.P2.World({gravity:[0,0]}),this.sceneNode&&(this._graphics=this.sceneNode.addComponent(cc.Graphics));var t=Math.pow(2,1),e=Math.pow(2,0),i=~e|e;if(this.fishPrefab&&this.sharkPrefab&&this.sceneNode)for(var o=Math.floor(5*Math.random()+20),a=function(t){var o=s.fishPrefab;t&&Math.random()>.4&&(o=s.sharkPrefab);var a=cc.instantiate(o);a.parent=s.sceneNode;var r=(Math.random()-.5)*s.node.width*.7,c=(Math.random()-.5)*s.node.height*.5;a.setPosition(cc.v2(r,c));var l=a.width,h=a.height,u=new n.P2.Body({mass:1,position:[r,c]}),d=new n.P2.Box({width:l,height:h,collisionGroup:e,collisionMask:i});u.addShape(d),s._world.addBody(u),u.angle=2*Math.random()*Math.PI,s._bodies.push({body:u,node:a,isShark:o==s.sharkPrefab}),s._world.on("beginContact",function(t){if(t.bodyA==u&&t.bodyB.mass>1e5||t.bodyB==u&&t.bodyA.mass>1e5){var e=100*Math.random()+100,i=u.angle,o=[e*Math.sin(i),-e*Math.cos(i)],n=[10*Math.cos(i),10*Math.sin(i)];u.applyImpulse(o,n),u.applyImpulse([-o[0],-o[1]],[-n[0],-n[1]])}})},s=this,r=0;r<o;r++)a(r);if(this.startEndNode&&this.leftNode&&this.rightNode){var c=new n.P2.Body({mass:0,position:[this.startEndNode.x,this.startEndNode.y]}),l=new n.P2.Circle({radius:1,collisionGroup:e,collisionMask:i});c.addShape(l),this._world.addBody(c),this._lastBody=c,this._startEndBody=c,e=Math.pow(2,2),i=~e;var h=new n.P2.Body({mass:0,position:[this.leftNode.x,this.leftNode.y]}),u=new n.P2.Box({width:this.leftNode.width,height:this.leftNode.height,collisionGroup:e,collisionMask:i});h.addShape(u),this._world.addBody(h);var d=new n.P2.Body({mass:0,position:[this.rightNode.x,this.rightNode.y]}),p=new n.P2.Box({width:this.rightNode.width,height:this.rightNode.height,collisionGroup:e,collisionMask:i});d.addShape(p),this._world.addBody(d),i=~(e&&t),c=new n.P2.Body({mass:0,position:[-this.node.width/2,0]});var m=new n.P2.Box({width:100,height:1e4,collisionGroup:e,collisionMask:i});c.addShape(m),this._world.addBody(c),c=new n.P2.Body({mass:0,position:[this.node.width/2,0]}),m=new n.P2.Box({width:100,height:1e4,collisionGroup:e,collisionMask:i}),c.addShape(m),this._world.addBody(c),c=new n.P2.Body({mass:0,position:[0,-this.node.height/2]}),m=new n.P2.Box({width:1e4,height:100,collisionGroup:e,collisionMask:i}),c.addShape(m),this._world.addBody(c)}if(this.startEndNode){var f=this.startEndNode.getPosition().add(cc.v2(0,-200));for(r=0;r<5;r++)this._addRope(f)}},e.prototype.update=function(t){if(this._world&&this.startEndNode&&!this._isGameOver){this._world.step(t),this._startEndBody&&(null==this._lastBody?this._startEndBody.velocity[1]=1e3:this._startEndBody.velocity[1]=0);for(var e=!0,i=0,o=this._bodies;i<o.length;i++){var n=o[i],a=n.body,s=n.node,r=n.isShark;if(s.setPosition(cc.v2(a.position[0],a.position[1])),s.angle=180*a.angle/Math.PI,s.angle=(s.angle%360+360)%360,Math.abs(s.angle-180)<80?s.scaleY=-1:Math.abs(s.angle-180)>100&&(s.scaleY=1),r&&s.y>this.startEndNode.y+2e3)return void this._lose();!r&&s.y<this.startEndNode.y&&(e=!1);var c=100*Math.random()+100,l=a.angle,h=[c*Math.cos(l),c*Math.sin(l)];if(a.applyForce(h,[0,0]),Math.abs(a.velocity[0])+Math.abs(a.velocity[1])<1){var u=[c*Math.sin(l),-c*Math.cos(l)],d=[10*Math.cos(l),10*Math.sin(l)];a.applyImpulse(u,d),a.applyImpulse([-u[0],-u[1]],[-d[0],-d[1]])}}var p=!0;if(null==this._lastBody){for(var m=0,f=this._constraints;m<f.length;m++)f[m].bodyA.position[1]<this.startEndNode.y+2100&&(p=!1);p&&(e?this._win():this._lose())}this._drawConstraint()}},e.prototype._lose=function(){this._isGameOver=!0,o.default.instance.gotoResultWithLoading(!1,this.node.parent)},e.prototype._win=function(){this._isGameOver=!0,o.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype._drawConstraint=function(){if(this._graphics){this._graphics.clear();for(var t=0,e=this._constraints;t<e.length;t++){var i=(n=e[t]).bodyA.position;this._graphics.fillColor=cc.color(227,156,73),this._graphics.circle(i[0],i[1],4),this._graphics.fill()}for(var o=0;o<this._constraints.length;o++){i=(n=this._constraints[o]).bodyA.position;var n,a=n.bodyB.position;this._graphics.lineWidth=10,this._graphics.strokeColor=cc.color(203,132,47),this._graphics.moveTo(i[0],i[1]),this._graphics.lineTo(a[0],a[1]),this._graphics.stroke(),this._graphics.lineWidth=5,this._graphics.strokeColor=cc.color(227,156,73),this._graphics.moveTo(i[0],i[1]),this._graphics.lineTo(a[0],a[1]),this._graphics.stroke();var s=[a[0]-i[0],a[1]-i[1]],r=cc.v2(s[1],-s[0]).normalize().mul(10),c=[r.x,r.y],l=[i[0]-c[0]/2,i[1]-c[1]/2],h=[a[0]-c[0]/2,a[1]-c[1]/2],u=[i[0]+c[0]/2,i[1]+c[1]/2],d=[a[0]+c[0]/2,a[1]+c[1]/2],p=l,m=[(h[0]+d[0])/2,(h[1]+d[1])/2];o%2==1&&(m=[(u[0]+l[0])/2,(u[1]+l[1])/2],p=d),this._graphics.lineWidth=2,this._graphics.strokeColor=cc.color(174,109,25),this._graphics.moveTo(p[0],p[1]),this._graphics.lineTo(m[0],m[1]),this._graphics.stroke()}this._lastBody&&(i=this._lastBody.position,this._graphics.fillColor=cc.color(203,132,47),this._graphics.circle(i[0],i[1],20),this._graphics.fill(),this._graphics.fillColor=cc.color(227,156,73),this._graphics.circle(i[0],i[1],10),this._graphics.fill())}},e.prototype.onTouchStart=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation());this._lastBody&&n.P2.vec2.distance(this._lastBody.position,[e.x,e.y])<4*this._interval&&(this._canDraw=!0)},e.prototype.onTouchMove=function(t){if(this._canDraw&&null!==this._lastBody&&this._world&&null!=this._startEndBody)for(var e=this.node.convertToNodeSpaceAR(t.getLocation()),i=0;i<10;i++)this._addRope(e)},e.prototype._addRope=function(t){if(null!==this._lastBody&&this._world&&null!=this._startEndBody){if(this._constraints.length>20&&n.P2.vec2.distance(this._lastBody.position,this._startEndBody.position)<=2*this._interval){var e=new n.P2.LockConstraint(this._lastBody,this._startEndBody);return this._world.addConstraint(e),this._constraints.push(e),this._lastBody!=this._startEndBody&&(this._lastBody.mass=.1,this._lastBody.type=n.P2.Body.DYNAMIC,this._lastBody.updateMassProperties()),void(this._lastBody=null)}if(n.P2.vec2.distance(this._lastBody.position,[t.x,t.y])>=this._interval){var i=cc.v2(this._lastBody.position[0],this._lastBody.position[1]);t=i.add(t.sub(i).normalize().mul(this._interval));var o=new n.P2.Body({mass:0,position:[t.x,t.y]}),a=Math.pow(2,1),s=~a,r=new n.P2.Circle({radius:this._interval,collisionGroup:a,collisionMask:s});o.addShape(r),this._world.addBody(o),e=new n.P2.LockConstraint(this._lastBody,o,{maxForce:Number.MAX_SAFE_INTEGER}),this._world.addConstraint(e),this._constraints.push(e),this._lastBody!=this._startEndBody&&(this._lastBody.mass=.1,this._lastBody.type=n.P2.Body.DYNAMIC,this._lastBody.updateMassProperties()),this._lastBody=o}}},e.prototype.onTouchEnd=function(){this._canDraw=!1},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([r(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([r(cc.Node)],e.prototype,"leftNode",void 0),__decorate([r(cc.Node)],e.prototype,"rightNode",void 0),__decorate([r(cc.Prefab)],e.prototype,"fishPrefab",void 0),__decorate([r(cc.Prefab)],e.prototype,"sharkPrefab",void 0),__decorate([r(cc.Node)],e.prototype,"startEndNode",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],circleFishModel:[function(t,e,i){"use strict";cc._RF.push(e,"7118bm2+ixAkbR47vf3l585","circleFishModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/circleFish/circleFishMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.circleFish)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],circleMuzzleMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"a3257fbUx9AQpaiYjtnecxa","circleMuzzleMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(){this.position=cc.v2(0,0),this.neighbors=[],this.edges=[],this.inDegree=0,this.outDegree=0},c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._nodes=[],e._circles=[],e.circlePrefab=[],e.scene=null,e.countBar=null,e.countDownLabel=null,e._countDown=120,e._totalCountDown=120,e.radius=0,e._touchID=-1,e._initialTouchVector=cc.Vec2.ZERO,e._initialTouchAngle=0,e._shakeAngle=3,e._screenSize=cc.size(600,600),e._gridSize=4,e.isGameOver=!1,e}return __extends(e,t),e.prototype.start=function(){this._createGraphAndEdges()},e.prototype._createGraphAndEdges=function(){this._nodes=this._createHexagonalGrid(this._gridSize),this._createEdges(this._nodes),this._displayGraph(this._nodes),this._countDown=this._totalCountDown},e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._touchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._touchEnd,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._touchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._touchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._touchEnd,this)},e.prototype._touchStart=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation());this._shakeAngle=0;for(var i=0;i<this._circles.length;i++){var o=this._circles[i];e.sub(o.getPosition()).mag()<this.radius&&(this._touchID=i,this._initialTouchVector=e.sub(o.getPosition()),this._initialTouchAngle=o.angle)}cc.log(this._touchID)},e.prototype._touchMove=function(t){var e=this;if(-1!==this._touchID){var i=this._circles[this._touchID],o=this.node.convertToNodeSpaceAR(t.getLocation()).sub(i.getPosition()),n=180*this._initialTouchVector.signAngle(o)/Math.PI;n<0&&(n+=360),this._nodes[this._touchID].edges.length>0?0==this._shakeAngle&&(this._shakeAngle=3,cc.tween(i).by(.03,{angle:-this._shakeAngle}).by(.03,{angle:this._shakeAngle}).by(.03,{angle:this._shakeAngle}).by(.03,{angle:-this._shakeAngle}).call(function(){e._shakeAngle=0}).start()):i.angle=this._initialTouchAngle+n}},e.prototype._touchEnd=function(){this._touchID=-1,this._checkRemove()},e.prototype._checkRemove=function(){for(var t=!1,e=0,i=this._nodes;e<i.length;e++)(n=i[e]).inDegree=0,n.outDegree=0;for(var o=0;o<this._nodes.length;o++)for(var n,a=0,s=(n=this._nodes[o]).edges;a<s.length;a++){var r=s[a],c=this._nodes.indexOf(r);if(-1!=c){var l=(this._circles[c].angle+90)%360,h=180*Math.atan2(n.position.y-r.position.y,n.position.x-r.position.x)/Math.PI,u=Math.abs(h-l)%360;u>15&&u<345&&(r.inDegree++,n.outDegree++)}}var d=function(e){var i=p._circles[e],o=p._nodes[e];0==o.inDegree&&0==o.outDegree&&(t=!0,p._nodes.splice(e,1),p._circles.splice(e,1),cc.tween(i).by(1,{opacity:-255,y:100}).call(function(){i.removeFromParent()}).start())},p=this;for(o=0;o<this._nodes.length;o++)d(o);t&&this._checkRemove()},e.prototype.update=function(t){this.isGameOver||(this.countBar&&this.countDownLabel&&(this._countDown-=t,this.countBar.progress=this._countDown/this._totalCountDown,this.countDownLabel.string=Math.floor(this._countDown).toString(),this._countDown<=0&&(this.isGameOver=!0,o.default.instance.gotoResultWithLoading(!1,this.node.parent))),0==this._nodes.length&&(this.isGameOver=!0,o.default.instance.gotoResultWithLoading(!0,this.node.parent)))},e.prototype._displayGraph=function(t){if(0!=this.circlePrefab.length&&this.scene){this.scene.destroyAllChildren();var e=Math.min.apply(Math,t.map(function(t){return t.position.x})),i=Math.max.apply(Math,t.map(function(t){return t.position.x})),o=Math.min.apply(Math,t.map(function(t){return t.position.y})),n=Math.max.apply(Math,t.map(function(t){return t.position.y})),a=this._screenSize.width/(i-e),s=this._screenSize.height/(n-o),r=Math.min(a,s);this.radius=.9*r;var c=cc.v2(this._screenSize.width/2*r/a,this._screenSize.height/2+r);this._circles=[];for(var l=this.scene.addComponent(cc.Graphics),h=0,u=t;h<u.length;h++){var d=u[h],p=Math.floor(Math.random()*this.circlePrefab.length),m=cc.instantiate(this.circlePrefab[p]);this._circles.push(m),this.scene.addChild(m),d.edges.length>0&&(m.zIndex=2),m.setPosition(d.position.mul(r).sub(c)),m.scale=1.6*r/166;for(var f=1;f<=5;f++)(k=m.getChildByName(f.toString())).active=!1;var g=[!1,!1,!1,!1,!1,!1];l.lineWidth=10;for(var _=0,y=d.edges;_<y.length;_++){var v=y[_];l.moveTo(m.position.x,m.position.y);var b=m.getPosition().add(v.position.sub(d.position).mul(r/2));l.lineTo(b.x,b.y);var P=v.position.sub(d.position),S=180*cc.Vec2.UP.signAngle(P)/Math.PI;S=(S+720)%360,g[Math.round(S/60)]=!0}var M=g.indexOf(!1),w=60*M;for(m.angle=w,f=0;f<g.length;f++){var k;(k=m.getChildByName(((f-M+6)%6).toString()))||!g[f]?k&&(k.active=g[f]):cc.error((f-M+6)%6)}}}},e.prototype._createHexagonalGrid=function(t){for(var e=[],i=0;i<t;i++)for(var o=0;o<t;o++)(n=new r).position=new cc.Vec2(3*i/2,Math.sqrt(3)*(o+i%2/2)),e.push(n);for(i=0;i<t;i++)for(o=0;o<t;o++){var n=e[i*t+o];i>0&&(n.neighbors.push(e[(i-1)*t+o]),i%2==1&&o<t-1?n.neighbors.push(e[(i-1)*t+o+1]):i%2==0&&o>0&&n.neighbors.push(e[(i-1)*t+o-1])),o>0&&n.neighbors.push(e[i*t+o-1]),i<t-1&&(n.neighbors.push(e[(i+1)*t+o]),i%2==1&&o<t-1?n.neighbors.push(e[(i+1)*t+o+1]):i%2==0&&o>0&&n.neighbors.push(e[(i+1)*t+o-1])),o<t-1&&n.neighbors.push(e[i*t+o+1])}return e},e.prototype._createEdges=function(t){var e=new Set;t.sort(function(){return Math.random()-.5});for(var i=0,o=t;i<o.length;i++){var n=o[i];if(!e.has(n)){n.neighbors.sort(function(){return Math.random()-.5});for(var a=Math.min(n.neighbors.length,Math.floor(5*Math.random())+1),s=0;s<a;s++){var r=n.neighbors[s];n.edges.includes(r)||0!=r.edges.length||(n.edges.push(r),e.has(r)||e.add(r))}}}for(var c=function(t){t.inDegree=l._nodes.filter(function(e){return e.edges.includes(t)}).length,cc.log(t.edges.length,t.inDegree)},l=this,h=0,u=this._nodes;h<u.length;h++)c(n=u[h]);this._nodes=this._nodes.filter(function(t){return t.edges.length>0||t.inDegree>0})},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([s([cc.Prefab])],e.prototype,"circlePrefab",void 0),__decorate([s(cc.Node)],e.prototype,"scene",void 0),__decorate([s(cc.ProgressBar)],e.prototype,"countBar",void 0),__decorate([s(cc.Label)],e.prototype,"countDownLabel",void 0),__decorate([a],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],circleMuzzleModel:[function(t,e,i){"use strict";cc._RF.push(e,"5f80dKNwChNMap8wRacCd3A","circleMuzzleModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/circleMuzzle/circleMuzzleMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.circleMuzzle)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],config_BladeFly:[function(t,e,i){"use strict";cc._RF.push(e,"0df46Dw4ohDT4UhI9BcxxTa","config_BladeFly"),Object.defineProperty(i,"__esModule",{value:!0}),i.BladeFly=void 0,function(t){t.frameDebug=!1,t.flySpeed=800,t.flyRot=-1080,t.bladeRadius=30,t.enemyMoveSpeed=15,t.enemyWaitTime=2e4,t.promptLength=500}(i.BladeFly||(i.BladeFly={})),cc._RF.pop()},{}],config_FindCraft:[function(t,e,i){"use strict";cc._RF.push(e,"473a5VqKp5Eza8s0cDCLXcQ","config_FindCraft"),Object.defineProperty(i,"__esModule",{value:!0}),i.FindCraft=void 0,function(t){t.playerSpeed=200,t.rotSpeed=3,t.maxLoad=20,t.resArea=[cc.v2(-300,-300),cc.v2(300,300)],t.promptSizeOffset=cc.v2(80,80),t.topLabelShowTime=.7,t.itemHei=50,t.coinValue=5.4,t.resCfg=[{loadCost:2,value:10,generate:7,originNum:10,maxNum:100},{loadCost:2,value:7,generate:4,originNum:16,maxNum:100},{loadCost:3,value:17,generate:6,originNum:5,maxNum:100}],t.speedPriceCfg=[{price:100,value:50},{price:200,value:80},{price:300,value:110}],t.maxLoadPriceCfg=[{price:100,value:10},{price:200,value:20},{price:300,value:30}],t.targetMoney=600}(i.FindCraft||(i.FindCraft={})),cc._RF.pop()},{}],config_FishGame:[function(t,e,i){"use strict";cc._RF.push(e,"33bf7Z9HTNMXb2qrV9xV1Xm","config_FishGame"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishGame=void 0,function(t){t.activeDebug=!1,t.blockNum=cc.v2(20,20),t.mapSize=cc.v2(3e3,3e3),t.envWidth=3263,t.beanDensity=4,t.randomVolume=20,t.spawnCircle=400,t.bubbleNum=3,t.bubbleMaxRandTime=2e3,t.bubbleMinRandTime=1e3,t.magnetNum=5,t.magnetRange=300,t.magnetSpeed=300,t.magnetScaleRatio=.1,t.rotSpeed=3,t.idleTime=400,t.escapeRemainTime=1500,t.escapeVisualRange=300,t.catchVisualRange=300,t.escapeDelayTimeRange=cc.v2(500,1e3),t.enemyCfg=[[0,10],[1,20],[2,20],[3,50],[4,100],[5,100],[6,300],[7,500],[8,1e3]],t.monthPosList=[cc.v2(24,-5),cc.v2(38,-3),cc.v2(55,-3),cc.v2(100,-23),cc.v2(135,-89),cc.v2(281,-51),cc.v2(200,-139),cc.v2(362,-58),cc.v2(284,40)],t.playerMonthPos=cc.v2(767,-85),t.decayRate=.3,t.baseSpeed=150,t.scoreGradient=900,t.f=function(e){return 1-e/(e+1/t.decayRate)},t.baseSize=40,t.slowness=3,t.growRate=40,t.g=function(e){return Math.log10(e/t.slowness+1)*t.growRate+1},t.ratio=.15,t.viewScaleStep=2,t.textIncrement=8,t.labelOffset=0,t.fishScaleTime=500,t.originScore=1,t.scoreTheWin=200*t.beanDensity*t.beanDensity}(i.FishGame||(i.FishGame={})),cc._RF.pop()},{}],config_Unblock:[function(t,e,i){"use strict";cc._RF.push(e,"7ed55DyoW5I/bqrksYUs9VK","config_Unblock"),Object.defineProperty(i,"__esModule",{value:!0}),i.Unblock=void 0,function(t){t.debugLogActive=!1,t.rotSpeed=1,t.gridSize=cc.v3(10,10,10),t.unitSize=cc.v3(100,100,100),t.moveSpeed=800,t.time=1200,t.maxPos=t.gridSize.div(2).multiply(t.unitSize),t.bounceForce=25,t.bounceTime=.15}(i.Unblock||(i.Unblock={})),cc._RF.pop()},{}],config:[function(t,e,i){"use strict";cc._RF.push(e,"29db2BBYmNPaby0n85GF6x9","config"),Object.defineProperty(i,"__esModule",{value:!0}),i.Railing=void 0,function(t){t.globalScale=1,t.playerSpeed=500,t.focusCenterY=-300,t.trackSmooth=500,t.tileHeight=50,t.trackWidth=30,t.grassProbability=.2,t.playerPadStep=30,t.stonePathOffset=29,t.bgUnitSize_src=cc.v2(188,167),t.streamHeightStep=500,t.streamCnt=20,t.fishAnimInterval=5e3,t.bounceHeight=20,t.bounceTime=1,t.offsets=[cc.v2(-7,-1),cc.v2(-40,-8),cc.v2(-1,-14),cc.v2(36,-20),cc.v2(-22,-22)]}(i.Railing||(i.Railing={})),cc._RF.pop()},{}],diffLayerBG:[function(t,e,i){"use strict";cc._RF.push(e,"604e9LaQMtGiZvynHtOcnlF","diffLayerBG"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./oneLayer")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layers=[],e}return __extends(e,t),e.prototype.setPosition=function(t){for(var e=1,i=0;i<this.layers.length;i++)e/=2,this.layers[i].setPosition(cc.v2(t.x*e*e,t.y))},__decorate([s(o.default)],e.prototype,"layers",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./oneLayer":"oneLayer"}],digitMatchCube:[function(t,e,i){"use strict";cc._RF.push(e,"e3e39E/WgpG67jyb3coczIT","digitMatchCube"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textLabel=null,e.frames=[],e.goldFrame=null,e._num=0,e.position=cc.v2(),e}return __extends(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"num",{get:function(){return this._num},set:function(t){this._num=t;var e=this.node.getComponent(cc.Sprite);e&&(e.spriteFrame=this.frames[t%this.frames.length]),this.goldFrame&&(this.goldFrame.active=t>=10),this.textLabel&&(this.textLabel.string=t+"")},enumerable:!1,configurable:!0}),e.prototype.init=function(){this.num=Math.floor(5*Math.random()+1);var t=this.node.scale;this.node.scale=0,cc.tween(this.node).to(.2,{scale:t}).start(),this.textLabel},e.prototype.remove=function(t){var e=this;this.node.zIndex=15,cc.tween(this.node).to(.3,{scale:0,x:t.x,y:t.y},{easing:cc.easing.cubicOut}).call(function(){e.node.destroy()}).start()},e.prototype.moveTo=function(t){cc.tween(this.node).to(.3,{x:t.x,y:t.y}).start()},__decorate([a(cc.Label)],e.prototype,"textLabel",void 0),__decorate([a(cc.SpriteFrame)],e.prototype,"frames",void 0),__decorate([a(cc.Node)],e.prototype,"goldFrame",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],digitMatchMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"e2dccPdANdBn6TmYR1KlQOB","digitMatchMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("./digitMatchCube")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cubePre=null,e.sceneNode=null,e.lifeNode=null,e.scoreLabel=null,e.comboLabel=null,e.addScorePre=null,e.starPre=[],e.whiteCube=null,e.maxScoreLabel=null,e.shareNode=null,e.gameOverPanel=null,e.soundClip=[],e.boardSize=cc.v2(5,5),e.board=[],e.initPos=cc.v2(0,0),e.intervalXY=cc.v2(100,100),e.canClick=!1,e._isGameOver=!1,e._matchCombo=0,e._shakeAmount=0,e.isCanReLife=!0,e._life=5,e._maxScore=0,e._score=0,e.scoreShow={value:0},e}return __extends(e,t),Object.defineProperty(e.prototype,"isGameOver",{get:function(){return this._isGameOver},set:function(t){this.gameOverPanel&&(t||(this.gameOverPanel.active=!1)),this._isGameOver=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"matchCombo",{get:function(){return this._matchCombo},set:function(t){this._matchCombo=t,this.comboLabel&&this.matchCombo>=3&&(cc.Tween.stopAllByTarget(this.comboLabel.node),this.comboLabel.string=t+" combo!",cc.tween(this.comboLabel.node).set({scale:1,opacity:255}).to(.1,{scale:1.2},{easing:cc.easing.cubicOut}).to(.4,{scale:.9},{easing:cc.easing.cubicIn}).to(.1,{scale:1},{easing:cc.easing.smooth}).delay(1).to(.5,{scale:1.3,opacity:0},{easing:cc.easing.cubicIn}).start())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"life",{get:function(){return this._life},set:function(t){t>5&&(t=5),this.isGameOver=!(t>0),this._life=t,this.lifeNode&&cc.tween(this.lifeNode).to(.3,{width:134*t}).start()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxScore",{get:function(){return this._maxScore},set:function(t){this._maxScore=t,this.maxScoreLabel&&(this.maxScoreLabel.string=this.maxScore+"")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(t){var e=t-this._score;if(this._score=t,cc.tween(this.scoreShow).to(.5,{value:this._score}).start(),this.addScorePre){var i=cc.instantiate(this.addScorePre);i.getComponent(cc.Label).string="+"+e,i.parent=this.addScorePre.parent,i.setPosition(this.addScorePre.getPosition()),cc.tween(i).set({opacity:0}).by(.75,{y:30,opacity:255},{easing:cc.easing.cubicOut}).delay(.25).by(.5,{y:50,opacity:-255},{easing:cc.easing.cubicIn}).call(function(){i.destroy()}).start()}},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStart,this),o.default.instance.miniGameAdapter.changeMainGameMusic(.4),cc.game.setFrameRate(60)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._touchStart,this),o.default.instance.miniGameAdapter.changeMainGameMusic(1);for(var t=0;t<this.soundClip.length;t++)cc.audioEngine.uncache(this.soundClip[t]);cc.game.setFrameRate(30)},e.prototype._touchStart=function(t){if(this.canClick&&!this.isGameOver){var e=this.node.convertToNodeSpaceAR(t.getLocation());e=e.sub(this.initPos);var i=Math.round(e.x/this.intervalXY.x),o=Math.round(e.y/this.intervalXY.y);i>=0&&i<this.boardSize.x&&o>=0&&o<this.boardSize.y&&this.board[i][o]&&(this.shortShake(),this.board[i][o].num+=1,this.life-=1,this.checkMatch(cc.v2(i,o)))}},e.prototype.start=function(){var t=this;this.gameInit(),cc.tween(this).delay(1).call(function(){t.checkMatch()}).start()},e.prototype.gameInit=function(){this.init();var t=cc.sys.localStorage.getItem("miniGameDigitMatch");if(t){var e=JSON.parse(t);if(e){for(var i=e.cubes,o=0;o<i.length;o++)for(var n=0;n<i[o].length;n++)this.board[o][n].num=i[o][n];this.maxScore=e.maxScore,this._score=e.score,this.scoreShow.value=e.score,this.life=e.life,this.isCanReLife=e.isCanReLife}}},e.prototype.gameSave=function(){for(var t={cubes:[],score:0,maxScore:0,life:0,isCanReLife:!1},e=0;e<this.board.length;e++){t.cubes.push([]);for(var i=0;i<this.board[e].length;i++)t.cubes[e].push(this.board[e][i].num)}t.score=this._score,t.maxScore=this.maxScore,t.isCanReLife=this.isCanReLife,t.life=this.life,cc.sys.localStorage.setItem("miniGameDigitMatch",JSON.stringify(t))},e.prototype.getPos=function(t,e){return this.initPos.add(cc.v2(this.intervalXY.x*t,this.intervalXY.y*e))},e.prototype.reStart=function(){var t=this,e=Math.max(this.maxScore,this._score);cc.Tween.stopAllByTarget(this),cc.Tween.stopAllByTarget(this.scoreShow),this.sceneNode&&this.sceneNode.destroyAllChildren(),this.init(),this.maxScore=e,cc.tween(this).delay(1).call(function(){t.checkMatch()}).start(),this.gameSave()},e.prototype.init=function(){this.life=5,this.isCanReLife=!0,this.maxScore=0,this.board=[],this._score=0,this.matchCombo=0,this.scoreShow.value=0,this.canClick=!1,this.intervalXY=cc.v2(680/this.boardSize.x,680/this.boardSize.x),this.initPos=cc.v2(-(this.boardSize.x-1)/2*this.intervalXY.x,-(this.boardSize.y-1)/2*this.intervalXY.y);for(var t=0;t<this.boardSize.x;t++){this.board.push([]);for(var e=0;e<this.boardSize.y;e++)this.spawnCube(t)}},e.prototype.update=function(t){if(this.scoreLabel&&(this.scoreLabel.string=Math.floor(this.scoreShow.value)+""),this._shakeAmount>=3){var e=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1,i=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1;this.node.setPosition(e,i)}this._shakeAmount=Math.max(0,this._shakeAmount-Math.pow(this._shakeAmount+7,1.3)*t)},e.prototype.spawnCube=function(t){if(this.cubePre&&this.sceneNode){var e=cc.instantiate(this.cubePre),i=e.getComponent(a.default);e.parent=this.sceneNode;var o=this.board[t].length;e.setPosition(this.getPos(t,o)),e.scale=this.intervalXY.x/e.width,e.zIndex=10,i.init(),this.board[t].push(i)}},e.prototype.checkMatch=function(t){var e=this;void 0===t&&(t=cc.v2(-1,-1)),this.canClick=!0;var i=this.board.map(function(t){return t.map(function(){return!1})}),o=[[-1,0],[1,0],[0,-1],[0,1]],n=function(t,a,s,r){if(!(t<0||t>=e.board.length||a<0||a>=e.board[0].length||i[t][a]||e.board[t][a].num!==s)){i[t][a]=!0,r.push({x:t,y:a});for(var c=0,l=o;c<l.length;c++){var h=l[c];n(t+h[0],a+h[1],s,r)}}},a=function(){for(var t=e.board[0].length-1;t>=0;t--)for(var i=0;i<e.board.length;i++){var o=[];if(n(i,t,e.board[i][t].num,o),o.length>=3)return o}return[]}();if(a.length>=3){this.canClick=!1,a.sort(function(t,e){return e.y-t.y});var s=a.length*this.board[a[0].x][a[0].y].num;-1==t.x&&(t.x=a[0].x,t.y=a[0].y);for(var r=this.board[t.x][t.y],c=0,l=a;c<l.length;c++){var h=l[c];h.x==t.x&&h.y==t.y||(this.board[h.x][h.y].remove(r.node.getPosition()),this.board[h.x].splice(h.y,1))}cc.tween(this).delay(.25).call(function(){e.matchLight(r,2*a.length),e.score+=10*s,e.matchCombo++,e.life+=1}).delay(.5).call(function(){for(var t=0;t<e.board.length;t++)for(var i=0;i<e.board[t].length;i++)e.board[t][i].moveTo(e.getPos(t,i))}).delay(.3).call(function(){for(var t=0;t<e.board.length;t++)for(;e.board[t].length<e.boardSize.y;)e.spawnCube(t)}).delay(.3).call(function(){e.gameSave(),e.checkMatch()}).start()}else this.matchCombo=0,this.isGameOver&&this.lose()},e.prototype.matchLight=function(t,e){var i=this;if(void 0===e&&(e=5),this.whiteCube&&!(this.starPre.length<2)&&this.sceneNode){this.longShake(),this._shakeAmount+=3*e;for(var o=cc.tween(this),n=0;n<e;n++)o=o.delay(.125/e).call(function(){var e=cc.instantiate(i.starPre[Math.floor(2*Math.random())]);e.parent=i.sceneNode,e.zIndex=20,e.setPosition(t.node.getPosition());var o=2*Math.random()*Math.PI;cc.tween(e).by(.5,{y:600*Math.sin(o),x:600*Math.cos(o)}).by(.5,{y:600*Math.sin(o),x:600*Math.cos(o),opacity:-255}).call(function(){e.destroy()}).start()});o=o.start();var a=cc.instantiate(this.whiteCube);a.parent=this.sceneNode,a.scale=this.intervalXY.x/a.width,a.setPosition(t.node.getPosition()),a.opacity=0,a.zIndex=11,cc.tween(a).to(.1,{opacity:255},{easing:cc.easing.smooth}).call(function(){t.num++}).to(.4,{opacity:0},{easing:cc.easing.smooth}).call(function(){a.destroy()}).start(),cc.audioEngine.play(this.soundClip[1],!1,1)}},e.prototype.lose=function(){this.gameOverPanel&&(this.gameOverPanel.active=!0),this.gameOverPanelShow()},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},e.prototype.share=function(){var t=this;this.isCanReLife?this.shareNode&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareNode,{miniGame:n.SubPackageKey.digitMatch}).then(function(e){e?(t.flyText("\u5206\u4eab\u6210\u529f",cc.Color.GREEN),t.life=5,t.isCanReLife=!1):t.flyText("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a",cc.Color.RED)}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)}):this.flyText("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21",cc.Color.RED)},e.prototype.flyText=function(t){if(this.scoreLabel){var e=cc.instantiate(this.scoreLabel.node),i=e.getComponent(cc.Label);e.zIndex=cc.macro.MAX_ZINDEX,i.string=t,i.fontSize=44,e.parent=this.node,e.setPosition(0,0),e.opacity=255,cc.tween(e).by(1,{y:50}).by(.5,{y:50,opacity:-255}).start()}},e.prototype.shortShake=function(){o.default.instance.miniGameAdapter.vibrateShort(10)},e.prototype.longShake=function(){o.default.instance.miniGameAdapter.vibrateLong(.1)},e.prototype.gameOverPanelShow=function(){if(this.gameOverPanel){var t=this.gameOverPanel.getChildByName("maxScore").getComponent(cc.Label),e=this.gameOverPanel.getChildByName("score").getComponent(cc.Label);t.string=this._maxScore+"",e.string=this._score+""}},__decorate([c(cc.Node)],e.prototype,"cubePre",void 0),__decorate([c(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([c(cc.Node)],e.prototype,"lifeNode",void 0),__decorate([c(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([c(cc.Label)],e.prototype,"comboLabel",void 0),__decorate([c(cc.Node)],e.prototype,"addScorePre",void 0),__decorate([c(cc.Node)],e.prototype,"starPre",void 0),__decorate([c(cc.Node)],e.prototype,"whiteCube",void 0),__decorate([c(cc.Label)],e.prototype,"maxScoreLabel",void 0),__decorate([c(cc.Node)],e.prototype,"shareNode",void 0),__decorate([c(cc.Node)],e.prototype,"gameOverPanel",void 0),__decorate([c([cc.AudioClip])],e.prototype,"soundClip",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","./digitMatchCube":"digitMatchCube"}],digitMatchModel:[function(t,e,i){"use strict";cc._RF.push(e,"d3f0ajWS9dBm75X9koqSF0T","digitMatchModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/digitMatch/digitMatchMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.digitMatch)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],drawHomeBubbleController:[function(t,e,i){"use strict";cc._RF.push(e,"88234W6+I1JErUb8ATfeY0x","drawHomeBubbleController"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.minY=0,e.maxY=0,e.minX=0,e.maxX=0,e.minSpawnInterval=1,e.maxSpawnInterval=5,e.bubbleSpriteFrame=null,e._spawnBubbleTimer=0,e}return __extends(e,t),e.prototype.update=function(t){this._spawnBubbleTimer-=t,this._spawnBubbleTimer<=0&&(this._spawnBubbleTimer=this.randomFloat(this.minSpawnInterval,this.maxSpawnInterval),this.spawnBubble())},e.prototype.spawnBubble=function(){var t=new cc.Node("Bubble"),e=t.addComponent(cc.Sprite);this.bubbleSpriteFrame&&(e.spriteFrame=this.bubbleSpriteFrame);var i=this.randomFloat(this.minX,this.maxX),o=this.randomFloat(.5,1.5);this.node.addChild(t),t.setPosition(i,this.minY),t.setScale(o);var n=this.randomFloat(2,3),a=new cc.Vec3(i,this.maxY),s=1.5*o,r=cc.tween(t);r=r.to(n,{position:a,scale:s},{easing:"cubicOut"}).call(function(){t.destroy()}).start()},e.prototype.randomFloat=function(t,e){return t+Math.random()*(e-t)},__decorate([a({type:cc.Float})],e.prototype,"minY",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxY",void 0),__decorate([a({type:cc.Float})],e.prototype,"minX",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxX",void 0),__decorate([a({type:cc.Float})],e.prototype,"minSpawnInterval",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxSpawnInterval",void 0),__decorate([a({type:cc.SpriteFrame})],e.prototype,"bubbleSpriteFrame",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],drawHomePathBubbleController:[function(t,e,i){"use strict";cc._RF.push(e,"61a05mN0vRDsqzK7SL2N113","drawHomePathBubbleController"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.minY=0,e.maxY=0,e.minX=0,e.maxX=0,e.minSpawnInterval=1,e.maxSpawnInterval=5,e.bubbleSpriteFrame=null,e._spawnBubbleTimer=0,e}return __extends(e,t),e.prototype.update=function(t){this._spawnBubbleTimer-=t,this._spawnBubbleTimer<=0&&(this._spawnBubbleTimer=this.randomFloat(this.minSpawnInterval,this.maxSpawnInterval),this.spawnBubble())},e.prototype.spawnBubble=function(){var t=new cc.Node("Bubble"),e=t.addComponent(cc.Sprite);this.bubbleSpriteFrame&&(e.spriteFrame=this.bubbleSpriteFrame);var i=this.randomFloat(this.minX,this.maxX),o=this.randomFloat(.5,1.5);this.node.addChild(t),t.setPosition(i,this.minY),t.setScale(o);var n=this.randomFloat(2,3),a=new cc.Vec3(i,this.maxY),s=1.5*o,r=cc.tween(t);r=r.to(n,{position:a,scale:s},{easing:"cubicOut"}).call(function(){t.destroy()}).start()},e.prototype.randomFloat=function(t,e){return t+Math.random()*(e-t)},__decorate([a({type:cc.Float})],e.prototype,"minY",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxY",void 0),__decorate([a({type:cc.Float})],e.prototype,"minX",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxX",void 0),__decorate([a({type:cc.Float})],e.prototype,"minSpawnInterval",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxSpawnInterval",void 0),__decorate([a({type:cc.SpriteFrame})],e.prototype,"bubbleSpriteFrame",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],drawHomePathMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"010e8wKCrVDvLCqKXYkVilT","drawHomePathMainGame"),Object.defineProperty(i,"__esModule",{value:!0}),i.drawHomeColors=void 0;var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("./personData"),a=cc._decorator,s=a.ccclass,r=a.property;i.drawHomeColors=[new cc.Color(255,0,0),new cc.Color(0,255,0),new cc.Color(0,0,255),new cc.Color(255,255,0),new cc.Color(255,0,255),new cc.Color(0,255,255),new cc.Color(255,165,0),new cc.Color(128,0,128),new cc.Color(128,128,0),new cc.Color(0,128,128),new cc.Color(139,69,19)];var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.personPrefab=null,e.homePrefab=null,e.trueIconFrame=null,e.pathNode=null,e.pathHeadNode=null,e.spritesNode=null,e._personData=[],e._graphics=null,e._headGraphics=null,e._pathNodeMap=[],e._pathNodeMapOffset=1e3,e._persons=[],e._homes=[],e._touchThreshold=20,e._isGameFail=!1,e._currentPathIndex=-1,e._touchMoveEvent=null,e._lineWidth=20,e._movingNodeNum=0,e._nowLevel=1,e._personSize=60,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._touchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._touchEnd,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._touchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._touchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._touchEnd,this)},e.prototype.start=function(){this.pathNode&&(this._graphics=this.pathNode.addComponent(cc.Graphics)),this.pathHeadNode&&(this._headGraphics=this.pathHeadNode.addComponent(cc.Graphics)),this._startLevel()},e.prototype.update=function(){this._drawPathHead(),this._touchMoveEvent&&this._touchMove2(this._touchMoveEvent)},e.prototype._startLevel=function(){var t;null===(t=this._graphics)||void 0===t||t.clear(),this._initPersonAndHome(this._nowLevel+1),this._addSprites()},e.prototype._randomInt=function(t){return Math.floor(Math.random()*t)},e.prototype._randomVec2=function(){for(var t=cc.v2(0,0),e=cc.size(500,1e3);;){t=cc.v2(this._randomInt(e.width)-e.width/2,this._randomInt(e.height)-e.height/2);for(var i=0,o=0,n=this._persons;o<n.length;o++){var a=n[o];t.sub(a.position).mag()<=1.5*this._personSize&&(i=1)}for(var s=0,r=this._homes;s<r.length;s++){var c=r[s];t.sub(c.position).mag()<=1.5*this._personSize&&(i=1)}if(!i)break}return t},e.prototype._initPersonAndHome=function(t){if(this.personPrefab&&this.homePrefab){if(this._persons=[],this._homes=[],2==t)this._persons.push({position:cc.v2(200,400),prefab:this.personPrefab}),this._persons.push({position:cc.v2(-200,400),prefab:this.personPrefab}),this._homes.push({position:cc.v2(-200,-400),prefab:this.homePrefab}),this._homes.push({position:cc.v2(200,-400),prefab:this.homePrefab});else for(var e=0;e<t;e++){var i=this._randomVec2();this._persons.push({position:i,prefab:this.personPrefab});var o=this._randomVec2();this._homes.push({position:o,prefab:this.homePrefab})}for(this._pathNodeMap=new Array(1500),e=0;e<this._pathNodeMap.length;e++)this._pathNodeMap[e]=new Array(1500);for(var a=0,s=this._personData;a<s.length;a++)s[a].destroy();for(this._personData=[],e=0;e<this._persons.length;e++){var r=new n.DrawHomePathGamePersonData(e,this._persons[e].position);this._personData.push(r)}}},e.prototype._addSprites=function(){if(this.spritesNode){this.spritesNode.removeAllChildren();for(var t=this._persons,e=this._homes,o=0;o<t.length;o++){var n=t[o],a=cc.instantiate(n.prefab);this.spritesNode.addChild(a),a.setPosition(n.position),a.zIndex=0,a.color=i.drawHomeColors[o],this._personData[o].node=a}for(o=0;o<t.length;o++){var s=e[o],r=cc.instantiate(s.prefab);Math.random()>.5&&(r.scaleX=-1),this.spritesNode.addChild(r),r.setPosition(s.position),r.zIndex=2;var c=r.getChildByName("board"),l=c.getPosition().add(r.getPosition());r.removeChild(c),this.spritesNode.addChild(c),c.setPosition(l),c.zIndex=3,c.getChildByName("smallFish").color=i.drawHomeColors[o],this._personData[o].homeNode=r}}},e.prototype._touchStart=function(t){for(var e=this.node.convertToNodeSpaceAR(t.getLocation()),i=0;i<this._personData.length;i++){var o=this._personData[i],n=o.path;if(n.length>0&&0==o.isPathComplete){var a=n[n.length-1];if(e.sub(a).mag()<3*this._touchThreshold){this._currentPathIndex=i;break}}}},e.prototype._touchMove=function(t){-1!==this._currentPathIndex&&(this._touchMoveEvent=t)},e.prototype._touchMove2=function(t){if(-1!==this._currentPathIndex){var e=this.node.convertToNodeSpaceAR(t.getLocation()),i=this._personData[this._currentPathIndex],o=i.path;if(o.length>0){var n=o[o.length-1],a=e.sub(n).mag();if((e=n.add(e.sub(n).normalize().mul(Math.min(1.1*this._touchThreshold,a)))).x=Math.round(e.x),e.y=Math.round(e.y),(a=e.sub(n).mag())>this._touchThreshold){i.pathDis+=a;for(var s=Math.round(this._touchThreshold),r=-s;r<=s;r++)for(var c=-s;c<=s;c++){var l=Math.round(e.x+r+this._pathNodeMapOffset),h=Math.round(e.y+c+this._pathNodeMapOffset),u=this._pathNodeMap[l][h];this._isGameFail||null==u||u.pathID==this._currentPathIndex||this._isLineIntersectWithPath(e,o[o.length-1],this._personData[u.pathID].path,u.id)&&(this._isGameFail=!0,i.pathFailId=o.length,i.pathFailDis=i.pathDis,i.setFailPathSpeed(u.distance),this._personData[u.pathID].pathFailId=u.id,this._personData[u.pathID].pathFailDis=u.distance,this._personData[u.pathID].setFailPathSpeed(i.pathFailDis),console.log(u))}o.push(e),this._drawPath(this._currentPathIndex),this._pathNodeMap[e.x+this._pathNodeMapOffset][e.y+this._pathNodeMapOffset]||(this._pathNodeMap[e.x+this._pathNodeMapOffset][e.y+this._pathNodeMapOffset]={pathID:this._currentPathIndex,distance:i.pathDis,id:o.length-1})}}}},e.prototype._touchEnd=function(){if(!(this._currentPathIndex<0)){for(var t=this._personData[this._currentPathIndex].path,e=0;e<this._homes.length;e++){var i=this._homes[e].position;t[t.length-1].sub(i).mag()<4*this._touchThreshold&&(this._personData[this._currentPathIndex].isPathComplete=!0,e!=this._currentPathIndex?this._isGameFail=!0:this._personData[this._currentPathIndex].isRightHome=!0)}this._touchMoveEvent=null,this._currentPathIndex=-1,this._isAllPathsComplete()&&this._startMove()}},e.prototype._isLineIntersectWithPath=function(t,e,i,o){if(i.length<2)return!1;for(var n=Math.max(1,o-2);n<Math.min(i.length,o+2);n++){var a=i[n-1],s=i[n];if(this._isLineSegmentIntersect(t,e,a,s))return!0}return!1},e.prototype._drawPath=function(t){if(!(t<0||t>=this._personData.length)){var e=this._personData[t].path;if(!(e.length<2)){var o=this._graphics;o&&(o.lineCap=cc.Graphics.LineCap.ROUND,o.lineJoin=cc.Graphics.LineJoin.ROUND,o.lineWidth=this._lineWidth+6,o.strokeColor=cc.Color.WHITE,o.moveTo(e[e.length-2].x,e[e.length-2].y),o.lineTo(e[e.length-1].x,e[e.length-1].y),o.stroke(),e.length<3||(o.lineWidth=this._lineWidth,o.strokeColor=i.drawHomeColors[t],o.moveTo(e[e.length-3].x,e[e.length-3].y),o.lineTo(e[e.length-2].x,e[e.length-2].y),o.lineTo(e[e.length-1].x,e[e.length-1].y),o.stroke()))}}},e.prototype._drawPathHead=function(){if(this._headGraphics){this._headGraphics.clear();for(var t=0,e=this._personData;t<e.length;t++){var i=e[t],o=i.path;if(o.length>0){var n=o[o.length-1];if(i.isPathComplete)continue;this._headGraphics.circle(n.x,n.y,this._lineWidth/2+5),this._headGraphics.fillColor=cc.Color.WHITE,this._headGraphics.fill(),this._headGraphics.circle(n.x,n.y,this._lineWidth/3),this._headGraphics.fillColor=i.color,this._headGraphics.fill()}}}},e.prototype._isAllPathsComplete=function(){for(var t=0;t<this._personData.length;t++)if(!this._personData[t].isPathComplete)return!1;return!0},e.prototype._startMove=function(){this._movingNodeNum=0;for(var t=0,e=this._personData;t<e.length;t++)e[t].moveAlongPath(this),this._movingNodeNum+=1},e.prototype._moveComplete=function(){this._movingNodeNum-=1,console.log(this._movingNodeNum),0==this._movingNodeNum&&this._gameOver()},e.prototype._gameOver=function(){var t=this;if(this._isGameFail)o.default.instance.gotoResultWithLoading(!1,this.node.parent);else if(this._nowLevel++,this._nowLevel>=i.drawHomeColors.length)o.default.instance.gotoResultWithLoading(!0,this.node.parent);else{var e=new cc.Vec2(25,-100),n=new cc.Node;n.parent=this.node,n.setPosition(e);var a=n.addComponent(cc.Sprite);this.trueIconFrame&&(a.spriteFrame=this.trueIconFrame),a.sizeMode=cc.Sprite.SizeMode.CUSTOM,n.setContentSize(400,300),cc.tween(n).to(.15,{scale:1.5}).to(.15,{scale:.8}).to(.15,{scale:1.2}).to(.15,{scale:.9}).to(.6,{scale:1}).call(function(){t._startLevel(),n.destroy()}).start()}},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},e.prototype._isLineSegmentIntersect=function(t,e,i,o){var n=cc.v2(e.x-t.x,e.y-t.y),a=cc.v2(i.x-t.x,i.y-t.y),s=cc.v2(o.x-t.x,o.y-t.y),r=cc.v2(t.x-i.x,t.y-i.y),c=cc.v2(o.x-i.x,o.y-i.y),l=cc.v2(e.x-i.x,e.y-i.y),h=this.crossProduct2d(n,a),u=this.crossProduct2d(n,s),d=this.crossProduct2d(c,r),p=this.crossProduct2d(c,l);return h*u<0&&d*p<0},e.prototype.crossProduct2d=function(t,e){return t.x*e.y-t.y*e.x},__decorate([r(cc.Prefab)],e.prototype,"personPrefab",void 0),__decorate([r(cc.Prefab)],e.prototype,"homePrefab",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"trueIconFrame",void 0),__decorate([r(cc.Node)],e.prototype,"pathNode",void 0),__decorate([r(cc.Node)],e.prototype,"pathHeadNode",void 0),__decorate([r(cc.Node)],e.prototype,"spritesNode",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./personData":"personData"}],drawHomePathModel:[function(t,e,i){"use strict";cc._RF.push(e,"8ac7f6t9rNPvaSoprHoOffZ","drawHomePathModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/drawHomePath/drawHomePathMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.drawHomePath)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],findDifferenceLevel:[function(t,e,i){"use strict";cc._RF.push(e,"06ba0z35RVCFrInptac6kmk","findDifferenceLevel"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./findDifferenceMainGame")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.differences=null,e}return __extends(e,t),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onNodeClicked,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onNodeClicked,this)},e.prototype.onNodeClicked=function(t){var e;if(this.differences){var i=this.differences.convertToNodeSpaceAR(t.getLocation());cc.log(i);for(var n=0,a=this.differences.children;n<a.length;n++){var s=a[n];if(s.getBoundingBox().contains(i)){s.parent=this.node;break}}0==this.differences.children.length&&(null===(e=o.default.instance)||void 0===e||e.nextLevel())}},__decorate([s(cc.Node)],e.prototype,"differences",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./findDifferenceMainGame":"findDifferenceMainGame"}],findDifferenceMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"60dbbfjnHNNZ7QKsT4XKfrZ","findDifferenceMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scene=null,e.nowLevel=0,e.levels=[],e}var i;return __extends(e,t),i=e,e.prototype.onEnable=function(){i.instance=this,this.scene&&(this.levels=this.scene.children),this.nextLevel()},e.prototype.onDisable=function(){i.instance=null},e.prototype.nextLevel=function(){if(this.nowLevel!=this.levels.length){this.nowLevel>0&&(this.levels[this.nowLevel-1].active=!1);var t=this.levels[this.nowLevel];t&&(t.active=!0),this.nowLevel++}else o.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},e.instance=null,__decorate([s(cc.Node)],e.prototype,"scene",void 0),i=__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],findDifferenceModel:[function(t,e,i){"use strict";cc._RF.push(e,"54db7EyQntATpNp35yEYXDx","findDifferenceModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.FindDifferenceModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),s=cc._decorator,r=(s.ccclass,s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/findDifference/findDifferenceMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.findDifference)],e)}(a.default));i.FindDifferenceModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],fishEscapeBubble:[function(t,e,i){"use strict";cc._RF.push(e,"f6ca92jrJZDBr0kLhjMK3xP","fishEscapeBubble"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.minY=0,e.maxY=0,e.minX=0,e.maxX=0,e.minSpawnInterval=1,e.maxSpawnInterval=5,e.bubbleSpriteFrame=null,e._spawnBubbleTimer=0,e}return __extends(e,t),e.prototype.update=function(t){this._spawnBubbleTimer-=t,this._spawnBubbleTimer<=0&&(this._spawnBubbleTimer=this.randomFloat(this.minSpawnInterval,this.maxSpawnInterval),this.spawnBubble())},e.prototype.spawnBubble=function(){var t=new cc.Node("Bubble"),e=t.addComponent(cc.Sprite);this.bubbleSpriteFrame&&(e.spriteFrame=this.bubbleSpriteFrame);var i=this.randomFloat(this.minX,this.maxX),o=this.randomFloat(.5,1.5);this.node.addChild(t),t.setPosition(i,this.minY),t.setScale(o);var n=this.randomFloat(2,3),a=new cc.Vec3(i,this.maxY),s=1.5*o,r=cc.tween(t);r=r.to(n,{position:a,scale:s},{easing:"cubicOut"}).call(function(){t.destroy()}).start()},e.prototype.randomFloat=function(t,e){return t+Math.random()*(e-t)},__decorate([a({type:cc.Float})],e.prototype,"minY",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxY",void 0),__decorate([a({type:cc.Float})],e.prototype,"minX",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxX",void 0),__decorate([a({type:cc.Float})],e.prototype,"minSpawnInterval",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxSpawnInterval",void 0),__decorate([a({type:cc.SpriteFrame})],e.prototype,"bubbleSpriteFrame",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],fishEscapeMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"1e0e09HVCdEnZIUkjzWyodk","fishEscapeMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("./fishEscapeMath"),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fishNode=null,e.sceneNode=null,e.fishPre=null,e.sharkPre=null,e.homePre=null,e._home=null,e._fish=null,e._sharks=[],e._homeIndex=0,e._fishIndex=0,e._sharkIndexArray=[],e._sharkCount=1,e._gridSize=cc.v2(3,3),e._gridCount=0,e._level=1,e._mapGraph=new n.FishEscapePlanarGraph,e._nodes=[],e._scaleX=0,e._scaleY=0,e._isCanMove=!1,e}return __extends(e,t),e.prototype.start=function(){this._startLevel()},e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStart,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._touchStart,this)},e.prototype._startLevel=function(){var t=this,e=t.fishNode,i=t.sceneNode,o=t.homePre,n=t.sharkPre,a=t.fishPre;if(e&&i&&o&&n&&a){this._gridCount=3*this._level+6;var s=Math.max(3,Math.floor(Math.sqrt(this._gridCount/1.7))+1);this._gridSize=cc.v2(s,Math.floor(1.7*s)),this._sharkCount=Math.floor(this._level/2)+1,i.destroyAllChildren(),this._isCanMove=!0;var r=i.getContentSize();this._mapGraph.generatePlanarGraph(this._gridCount,this._gridSize),this._nodes=this._mapGraph.nodes,r.height=r.width*this._gridSize.y/this._gridSize.x;var c=r.width/this._gridSize.x,l=r.height/this._gridSize.y;this._scaleX=c,this._scaleY=l;var h=new cc.Node("Graphics").addComponent(cc.Graphics);i.addChild(h.node);var u=-r.width/2+c/2,d=-r.height/2+l/2+100;i.setPosition(cc.v2(u,d));for(var p=0,m=this._nodes;p<m.length;p++){var f=m[p],g=cc.v2(f.position.x*c,f.position.y*l),_=cc.instantiate(e);i.addChild(_),_.setPosition(g),_.setContentSize(c/2,c/2);for(var y=0,v=f.neighbors;y<v.length;y++){var b=v[y],P=cc.v2(this._nodes[b].position.x*c,this._nodes[b].position.y*l);h.lineWidth=c/10,h.strokeColor=cc.color(0,73,255),h.moveTo(g.x,g.y),h.lineTo(P.x,P.y),h.stroke(),h.lineWidth=c/20,h.strokeColor=cc.color(29,215,248),h.moveTo(g.x,g.y),h.lineTo(P.x,P.y),h.stroke()}}if(this._generatePositions()){var S=c/2/33;this._home=cc.instantiate(o),this._fish=cc.instantiate(a),this._sharks=[];for(var M=0;M<this._sharkCount;M++){var w=cc.instantiate(n);this._sharks.push(w),w.setParent(i),w.scale=S,w.setPosition(this._getPositionFromIndex(this._sharkIndexArray[M]))}this._home.setParent(i),this._fish.setParent(i),this._home.scale=S,this._fish.scale=S,this._home.setPosition(this._getPositionFromIndex(this._homeIndex)),this._fish.setPosition(this._getPositionFromIndex(this._fishIndex))}}},e.prototype._getPositionFromIndex=function(t){var e=this._nodes[t].position;return cc.v2(e.x*this._scaleX,e.y*this._scaleY)},e.prototype._generatePositions=function(){var t=this;this._sharkIndexArray=[];var e=this._nodes.length,i=Array.from({length:e},function(t,e){return e});this._homeIndex=this._getRandomIndex(i),i=i.filter(function(e){return e!==t._homeIndex});var o=this._homeIndex;if(void 0===o)return this._startLevel(),!1;for(var n=this._bfs(o,this._homeIndex),a=i.sort(function(t,e){return n[e]-n[t]}),s=function(){if(0==a.length)return r._startLevel(),{value:!1};var t=a.slice(0,Math.ceil(a.length/10)+1),e=r._getRandomIndex(t);r._sharkIndexArray.push(e);var i=r._nodes[e].neighbors;i.push(e),a=a.filter(function(t){return!i.includes(t)})},r=this,c=0;c<this._sharkCount;c++){var l=s();if("object"==typeof l)return l.value}var h=Math.min.apply(Math,this._sharkIndexArray.map(function(t){return n[t]})),u=a.filter(function(t){return n[t]===h-1});return 0==u.length?(this._startLevel(),!1):(this._fishIndex=this._getRandomIndex(u),!0)},e.prototype._bfs=function(t,e){var i=this._nodes.length,o=new Array(i).fill(-1),n=[t];for(o[e]=Number.MAX_SAFE_INTEGER,o[t]=0;n.length>0;)for(var a=n.shift(),s=0,r=this._nodes[a].neighbors;s<r.length;s++){var c=r[s];-1==o[c]&&(o[c]=o[a]+1,n.push(c))}return o},e.prototype._getRandomIndex=function(t){return t[Math.floor(Math.random()*t.length)]},e.prototype._touchStart=function(t){var e=this;if(this.sceneNode&&this._isCanMove)for(var i=this.sceneNode.convertToNodeSpaceAR(t.getLocation()),o=this._nodes[this._fishIndex].neighbors,n=function(t){var n=a._getPositionFromIndex(o[t]);if(i.sub(n).mag()<=a._scaleX/4){var s=a._getPositionFromIndex(a._fishIndex);return a._fishIndex=o[t],cc.tween(a._fish).call(function(){if(e._isCanMove=!1,e._fish){var t=n.sub(s);t.x>0&&(e._fish.scaleX=Math.abs(e._fish.scaleX)),t.x<0&&(e._fish.scaleX=-Math.abs(e._fish.scaleX))}}).to(.3,{position:cc.v2(n.x,n.y)}).call(function(){e._checkGameOver()||e._moveShark(0)}).start(),"break"}},a=this,s=0;s<o.length&&"break"!==n(s);s++);},e.prototype._moveShark=function(t){for(var e=this,i=Number.MAX_VALUE,o=-1,n=0;n<this._nodes[this._sharkIndexArray[t]].neighbors.length;n++){var a=this._nodes[this._sharkIndexArray[t]].neighbors[n];if(a!==this._homeIndex&&a!==this._sharkIndexArray[t]){var s=this._shortestPathBFS(a,this._fishIndex);(s<i||s==i&&Math.random()>.5||-1==o)&&(i=s,o=a)}}if(-1!=o){var r=this._getPositionFromIndex(this._sharkIndexArray[t]),c=this._getPositionFromIndex(o);this._sharkIndexArray[t]=o,cc.tween(this._sharks[t]).call(function(){if(e._isCanMove=!1,e._sharks){var i=c.sub(r);i.x>0&&(e._sharks[t].scaleX=Math.abs(e._sharks[t].scaleX)),i.x<0&&(e._sharks[t].scaleX=-Math.abs(e._sharks[t].scaleX))}}).to(.3,{x:c.x,y:c.y}).call(function(){e._checkGameOver()||(t==e._sharkCount-1?e._isCanMove=!0:e._moveShark(t+1))}).start()}},e.prototype._shortestPathBFS=function(t,e){var i=new Array(this._nodes.length).fill(!1),o=new Array(this._nodes.length).fill(Number.MAX_VALUE),n=[];for(i[this._homeIndex]=!0,i[t]=!0,o[t]=0,n.push(t);0!=n.length;){var a=n.shift();if(a===e)return 0;for(var s=0;s<this._nodes[a].neighbors.length;s++){var r=this._nodes[a].neighbors[s];if(!i[r]&&(i[r]=!0,o[r]=o[a]+1,n.push(r),r===e))return o[r]}}return Number.MAX_VALUE},e.prototype._checkGameOver=function(){for(var t=0;t<this._sharkCount;t++)if(this._fishIndex==this._sharkIndexArray[t])return o.default.instance.gotoResultWithLoading(!1,this.node.parent),!0;if(this._fishIndex==this._homeIndex)return this._level++,25==this._level?o.default.instance.gotoResultWithLoading(!0,this.node.parent):this._startLevel(),!0},e.prototype._reStart=function(){this._startLevel()},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([r(cc.Prefab)],e.prototype,"fishNode",void 0),__decorate([r(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([r(cc.Prefab)],e.prototype,"fishPre",void 0),__decorate([r(cc.Prefab)],e.prototype,"sharkPre",void 0),__decorate([r(cc.Prefab)],e.prototype,"homePre",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./fishEscapeMath":"fishEscapeMath"}],fishEscapeMath:[function(t,e,i){"use strict";cc._RF.push(e,"e7d59lMjatCu44fk5ZK/N/l","fishEscapeMath"),Object.defineProperty(i,"__esModule",{value:!0}),i.FishEscapePlanarGraph=i.FishEscapeNode=void 0;i.FishEscapeNode=function(){this.id=0,this.position=cc.v2(0,0),this.neighbors=[]};var o=function(){function t(){this.nodes=[],this.paths=[],this.nodes=[],this.paths=[]}return t.prototype.generatePlanarGraph=function(t,e){this.nodes=[],this.paths=[];for(var i=[],o=0;o<e.x;o++)for(var n=0;n<e.y;n++)i.push(cc.v2(o,n));for(o=0;o<t;o++){if(0===i.length){t=o;break}var a=Math.floor(Math.random()*i.length),s=i[a];i.splice(a,1),this.nodes.push({id:o,position:s,neighbors:[]})}var r=new Set;for(o=0;o<t;o++){var c=[];for(n=0;n<t;n++)if(o!=n){var l=this.nodes[o].position.sub(this.nodes[n].position).mag();c.push({dist:l,index:n})}c.sort(function(t,e){return t.dist-e.dist});for(var h=Math.floor(c.length/3),u=0;u<h;u++){var d=o<c[u].index?o+"-"+c[u].index:c[u].index+"-"+o;r.add(d)}}for(var p=Array.from(r).map(function(t){return t.split("-").map(Number)});p.length>0;){var m=Math.floor(Math.random()*p.length),f=p[m];p.splice(m,1),this.doesIntersect(this.nodes[f[0]],this.nodes[f[1]])||(this.nodes[f[0]].neighbors.push(f[1]),this.nodes[f[1]].neighbors.push(f[0]),this.paths.push(cc.v2(f[0],f[1])))}this.allNodesAndEdgesInCycle()?this.randomlyDeleteEdges():(this.nodes=[],this.paths=[],this.generatePlanarGraph(t,e))},t.prototype.doesIntersect=function(t,e){for(var i=0,o=this.paths;i<o.length;i++){var n=o[i],a=this.nodes[n.x],s=this.nodes[n.y];if(this.doLinesIntersect(t.position,e.position,a.position,s.position))return!0}for(var r=0,c=this.nodes;r<c.length;r++){var l=c[r];if(l&&l.id!==t.id&&l.id!==e.id&&this.isOnLine(t.position,e.position,l.position))return!0}return!1},t.prototype.doLinesIntersect=function(t,e,i,o){var n=e.sub(t),a=o.sub(i),s=n.cross(i.sub(t)),r=n.cross(o.sub(t)),c=a.cross(t.sub(i)),l=a.cross(e.sub(i));return s*r<0&&c*l<0},t.prototype.isOnLine=function(t,e,i){var o=i.sub(t).mag(),n=i.sub(e).mag(),a=e.sub(t).mag();return Math.abs(o+n-a)<1e-6},t.prototype.allNodesAndEdgesInCycle=function(){var t=new Array(this.nodes.length).fill(!1),e=new Array(this.nodes.length).fill(-1),i=new Array(this.nodes.length).fill(-1);this.tarjanDFS(0,-1,t,e,i,0);for(var o=1;o<this.nodes.length;o++)if(!t[o]||i[o]>=e[o])return!1;return!0},t.prototype.tarjanDFS=function(t,e,i,o,n,a){i[t]=!0,o[t]=a,n[t]=a,a++;for(var s=0,r=this.nodes[t].neighbors;s<r.length;s++){var c=r[s];c!==e&&(i[c]||this.tarjanDFS(c,t,i,o,n,a),n[t]=Math.min(n[t],n[c]))}},t.prototype.randomlyDeleteEdges=function(){for(var t=function(t){for(var i=e.nodes[t],o=0;o<i.neighbors.length;o++)if(!(Math.random()<.5)){var n=i.neighbors[o];i.neighbors.splice(o,1),e.nodes[n].neighbors=e.nodes[n].neighbors.filter(function(e){return e!==t}),e.allNodesAndEdgesInCycle()||(i.neighbors.splice(o,0,n),e.nodes[n].neighbors.push(t))}},e=this,i=0;i<this.nodes.length;i++)t(i)},t}();i.FishEscapePlanarGraph=o,cc._RF.pop()},{}],fishEscapeModel:[function(t,e,i){"use strict";cc._RF.push(e,"1f04egb25xEX7eR3qz3cvFg","fishEscapeModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/fishEscape/fishEscapeMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.fishEscape)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],fishFlyMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"2792cYjyTdKALeNj/gudGff","fishFlyMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/SubPackageManager"),a=__importDefault(t("./fishFlyRope")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.levelData=[],e._world=null,e._scene=null,e._fishNodes=[],e._ropes=[],e._stones=[],e._shakes=[],e._fishes=[],e.knife=null,e._knifeGraphics=null,e._graphics=null,e._fishBodies=[],e._startPoint=cc.v2(0,0),e._endPoint=cc.v2(0,0),e._constraints=[],e._isGameOver=!0,e._level=0,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),cc.game.setFrameRate(60)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),cc.game.setFrameRate(30)},e.prototype.start=function(){this.knife&&(this._knifeGraphics=this.knife.addComponent(cc.Graphics)),this._startLevel()},e.prototype._startLevel=function(){if(this._level!=this.levelData.length){for(var t=0;t<this.levelData.length;t++)this.levelData[t].node.active=!1;var e=this.levelData[this._level];for(e.node.active=!0,this._fishNodes=e.fishNodes,this._ropes=e.ropes,this._stones=e.stones,this._shakes=e.shakes,this._fishes=e.fishes,this._scene=e.scene,this._scene&&(this._graphics=this._scene.addComponent(cc.Graphics)),this._world=new n.P2.World,this._world.gravity=[0,0],this._fishBodies=[],this._constraints=[],t=0;t<this._fishNodes.length;t++){var i=this._fishNodes[t],a=1;this._stones.includes(t)&&(a=0);var s=new n.P2.Body({mass:a,position:[i.x,i.y],fixedRotation:!0});s.addShape(new n.P2.Box({width:i.getBoundingBox().width/2,height:i.getBoundingBox().height/2})),this._world.addBody(s),this._fishBodies.push(s)}for(t=0;t<this._ropes.length;t++){var r=this._ropes[t];if(r.x!=r.y)for(var c=this._fishBodies[r.x],l=this._fishBodies[r.y],h=n.P2.vec2.distance(c.position,l.position),u=Math.ceil(h/10),d=c,p=1;p<=u;p++){var m=void 0;p==u?m=l:((m=new n.P2.Body({mass:1,position:[c.position[0]+(l.position[0]-c.position[0])*(p/u),c.position[1]+(l.position[1]-c.position[1])*(p/u)],gravityScale:0})).addShape(new n.P2.Circle({radius:1})),this._world.addBody(m));var f=new n.P2.DistanceConstraint(d,m,{maxForce:Number.MAX_SAFE_INTEGER/2});this._world.addConstraint(f),this._constraints.push(f),d=m}}this._isGameOver=!1}else o.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype.update=function(t){if(this._world&&!this._isGameOver){this._world.step(t);for(var e=!0,i=0;i<this._fishBodies.length;i++){var o=this._fishBodies[i],n=this._fishNodes[i];n.x=o.position[0],n.y=o.position[1],this._shakes.includes(i)&&n.y>400&&(cc.log(n.y),this._lose()),this._fishes.includes(i)&&n.y<400&&(e=!1),this._stones.includes(i)||o.applyForce([0,2e3],[0,0])}if(e&&this._win(),this._graphics){this._graphics.clear();for(var a=0,s=this._constraints;a<s.length;a++){var r=(h=s[a]).bodyA.position;this._graphics.fillColor=cc.color(227,156,73),this._graphics.circle(r[0],r[1],4),this._graphics.fill()}for(var c=0,l=this._constraints;c<l.length;c++){r=(h=l[c]).bodyA.position;var h,u=h.bodyB.position;this._graphics.lineWidth=10,this._graphics.strokeColor=cc.color(203,132,47),this._graphics.moveTo(r[0],r[1]),this._graphics.lineTo(u[0],u[1]),this._graphics.stroke(),this._graphics.lineWidth=5,this._graphics.strokeColor=cc.color(227,156,73),this._graphics.moveTo(r[0],r[1]),this._graphics.lineTo(u[0],u[1]),this._graphics.stroke()}}}},e.prototype._lose=function(){this._isGameOver=!0,o.default.instance.gotoResultWithLoading(!1,this.node.parent)},e.prototype._win=function(){this._isGameOver=!0,this._level++,this._startLevel()},e.prototype.onTouchStart=function(t){this._startPoint=this.node.convertToNodeSpaceAR(t.getLocation())},e.prototype.onTouchMove=function(t){var e=this;if(this._knifeGraphics){this._endPoint=this.node.convertToNodeSpaceAR(t.getLocation()),this._knifeGraphics.clear();var i=function(){if(e._knifeGraphics){for(var t=e._startPoint,i=e._endPoint,o=t.sub(i).mag(),n=Math.floor(o/15),a=i.sub(t).normalize(),s=0;s<n;s++){var r=t.add(a.mul(15*s)),c=r.add(a.mul(10));e._knifeGraphics.moveTo(r.x,r.y),e._knifeGraphics.lineTo(c.x,c.y)}var l=o-15*n;if(l>0){var h=t.add(a.mul(15*n)),u=h.add(a.mul(l));e._knifeGraphics.moveTo(h.x,h.y),e._knifeGraphics.lineTo(u.x,u.y)}}};this._knifeGraphics.lineWidth=10,this._knifeGraphics.strokeColor=cc.color(218,17,17),i(),this._knifeGraphics.lineWidth=5,this._knifeGraphics.strokeColor=cc.color(200,8,8),i(),this._knifeGraphics.stroke()}},e.prototype.onTouchEnd=function(){this._knifeGraphics&&this._knifeGraphics.clear();for(var t=0;t<this._constraints.length;t++){var e=this._constraints[t],i=e.bodyA,o=e.bodyB,n=new cc.Vec2(i.position[0],i.position[1]),a=new cc.Vec2(o.position[0],o.position[1]);this._intersects(this._startPoint,this._endPoint,n,a)&&(this._world.removeConstraint(e),this._constraints.splice(t,1),t--)}},e.prototype._direction=function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)},e.prototype._onSegment=function(t,e,i){return Math.min(t.x,e.x)<=i.x&&i.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=i.y&&i.y<=Math.max(t.y,e.y)},e.prototype._intersects=function(t,e,i,o){var n=this._direction(i,o,t),a=this._direction(i,o,e),s=this._direction(t,e,i),r=this._direction(t,e,o);return(n>0&&a<0||n<0&&a>0)&&(s>0&&r<0||s<0&&r>0)||!(0!==n||!this._onSegment(i,o,t))||!(0!==a||!this._onSegment(i,o,e))||!(0!==s||!this._onSegment(t,e,i))||!(0!==r||!this._onSegment(t,e,o))},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([c([a.default])],e.prototype,"levelData",void 0),__decorate([c(cc.Node)],e.prototype,"knife",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./fishFlyRope":"fishFlyRope"}],fishFlyModel:[function(t,e,i){"use strict";cc._RF.push(e,"63247RybhxPnIPhEGkKbhYK","fishFlyModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/fishFly/fishFlyMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.fishFly)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],fishFlyRope:[function(t,e,i){"use strict";cc._RF.push(e,"51ae5vktWtAX5tv9F/LODms","fishFlyRope"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scene=null,e.fishNodes=[],e.ropes=[],e.stones=[],e.shakes=[],e.fishes=[],e}return __extends(e,t),__decorate([a(cc.Node)],e.prototype,"scene",void 0),__decorate([a([cc.Node])],e.prototype,"fishNodes",void 0),__decorate([a([cc.Vec2])],e.prototype,"ropes",void 0),__decorate([a([cc.Integer])],e.prototype,"stones",void 0),__decorate([a([cc.Integer])],e.prototype,"shakes",void 0),__decorate([a([cc.Integer])],e.prototype,"fishes",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],fishGoldBurstBullet:[function(t,e,i){"use strict";cc._RF.push(e,"be69bXFrx9MAJXhRk8DhgFg","fishGoldBurstBullet"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spines=[],e.skillSpines=[],e.skillBoom=null,e._spine=null,e._boom=null,e.gameInstance=null,e._boomTime=1,e._attackRate=.4,e._attackRadius=50,e._damage=20,e._speed=1500,e.type=0,e}return __extends(e,t),e.prototype.init=function(t){var e=this;if(cc.Tween.stopAllByTarget(this.node),6==this.type&&(t=cc.v2(0,0)),this.spines.length>0){var i=this.type;7==i&&(i=Math.floor(6*Math.random())),i<this.spines.length&&(this._spine=this.spines[i]);for(var o=0;o<this.spines.length;o++)this.spines[o].node.active=o==i;for((i-=6)>=0&&i<this.skillSpines.length&&(this._spine=this.skillSpines[i]),o=0;o<this.skillSpines.length;o++)this.skillSpines[o].node.active=o==i;this.skillBoom&&(this.skillBoom.node.active=!1)}this._boomTime=1,this._attackRate=.4,this._attackRadius=50,this._damage=20,this._speed=1e3,6==this.type&&(this._attackRadius=300,this._damage=100,this._speed=4e3,this._attackRate=.5,this._boomTime=-1),7==this.type&&(this._speed=1500),this._spine&&(this._boom=this._spine.node.getChildByName("boom").getComponent(sp.Skeleton),this._spine.enabled=!0),this._boom&&(this._boom.enabled=!1);var n=t.sub(this.node.getPosition()).mag()/this._speed;cc.tween(this.node).call(function(){var i=t.sub(e.node.getPosition()).normalize(),o=Math.atan2(i.y,i.x);o=cc.misc.radiansToDegrees(o),e.node.angle=o}).to(n,{x:t.x,y:t.y},{easing:"linear"}).call(function(){if(e._spine&&(e._spine.enabled=!1),e._boom){e.node.angle=0,e._boom.enabled=!0;var t=e._boom.skeletonData.getRuntimeData().findAnimation("animation");if(t){e._boomTime<0&&(e._boomTime=t.duration);var i=e._boomTime,o=t.duration/i;e._boom.setAnimation(0,"animation",!1).timeScale=o}}6==e.type?cc.tween(e.node).delay(1).call(function(){e.skillBoom&&(e.skillBoom.node.active=!0,e.skillBoom.setAnimation(0,"animation",!1))}).delay(e._boomTime*e._attackRate-1).call(function(){e._attack()}).delay(e._boomTime*(1-e._attackRate)).call(function(){e.die()}).start():cc.tween(e.node).delay(e._boomTime*e._attackRate).call(function(){e._attack()}).delay(e._boomTime*(1-e._attackRate)).call(function(){e.die()}).start()}).start()},e.prototype.update=function(){this.node.zIndex=1e3-this.node.position.y},e.prototype._attack=function(){var t=this;if(this.gameInstance){var e=this.gameInstance.enemySet,i=this.node.getPosition();e.forEach(function(e){var o=t.node.position.sub(e.node.position).mag();if(o<1.7*t._attackRadius&&0==e.isProtect){o=Math.max(o,t._attackRadius/3);var n=t._damage*Math.pow(t._attackRadius/o,2);if(e.onHit(n),e.HP<=0&&t.gameInstance){var a=10*Math.random()+5*e.type,s=e.node.getPosition();if(t.gameInstance)for(var r=0;r<a;r++)t.gameInstance.readySpawnGold.push({center:i,position:s})}}})}},e.prototype.die=function(){var t;null===(t=this.gameInstance)||void 0===t||t.deSpawnBullet(this)},__decorate([a([sp.Skeleton])],e.prototype,"spines",void 0),__decorate([a([sp.Skeleton])],e.prototype,"skillSpines",void 0),__decorate([a(sp.Skeleton)],e.prototype,"skillBoom",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],fishGoldBurstEnemy:[function(t,e,i){"use strict";cc._RF.push(e,"f36b7rTUxZKB402G8/md+qL","fishGoldBurstEnemy"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spines=[],e.spine=null,e.progressHP=null,e.gameInstance=null,e.sceneSize=cc.size(0,0),e.moveSpeed=50,e.maxHP=100,e.HP=100,e.type=0,e.isProtect=!1,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.init=function(t){var e=this;if(this.gameInstance){var i=Math.floor(Math.pow(Math.random()*Math.pow(6,1/3),3));this.isProtect=!0,this.type=i;for(var o=0;o<6;o++)o<this.spines.length&&(this.spines[o].node.active=!1,o==i&&(this.spines[o].node.active=!0));this.spines.length>0&&(this.spine=this.spines[i]),this.spine&&(this.progressHP=this.spine.node.getChildByName("progressHP").getComponent(cc.ProgressBar),this.spine.enableBatch=!0),this.gameInstance.enemySet.add(this),this.sceneSize=this.gameInstance.sceneSize,this.node.setPosition(t),this.maxHP=50*this.type+100,this.gameInstance.totalHP+=this.maxHP,this.HP=this.maxHP,this.gameInstance&&this.spine&&this.gameInstance.playSpineAnimation(this.spine,"show",function(){e._moveRandomly(),e.isProtect=!1,e.spine&&e.spine.setAnimation(0,"walk",!0)})}},e.prototype.update=function(){this.node.zIndex=1e3-this.node.position.y,this.progressHP&&(this.progressHP.progress=this.HP/this.maxHP)},e.prototype._moveRandomly=function(){var t=this,e=this.sceneSize,i=e.width,o=e.height,n=Math.random()*i-i/2,a=Math.random()*o-o/2,s=new cc.Vec2(n,a),r=s.sub(this.node.getPosition()).mag()/this.moveSpeed;cc.tween(this.node).call(function(){s.x>t.node.x&&(t.node.scaleX=-1,t.progressHP&&(t.progressHP.reverse=!0)),s.x<t.node.x&&(t.node.scaleX=1,t.progressHP&&(t.progressHP.reverse=!1))}).to(r,{x:s.x,y:s.y},{easing:"linear"}).call(function(){return t._moveRandomly()}).start()},e.prototype.onHit=function(t){var e=this;this.HP<=0||!this.gameInstance||(t=Math.min(this.HP,t),this.HP-=t,this.gameInstance.setNowHP(this.gameInstance.nowHP-t),this.gameInstance.showDamage(t,this.node.getPosition()),this.HP<=0?this.die():this.gameInstance&&this.spine&&this.gameInstance.playSpineAnimation(this.spine,"cheer",function(){e.spine&&e.spine.setAnimation(0,"walk",!0)}))},e.prototype.die=function(){var t;cc.Tween.stopAllByTarget(this.node),null===(t=this.gameInstance)||void 0===t||t.deSpawnEnemy(this)},__decorate([a([sp.Skeleton])],e.prototype,"spines",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],fishGoldBurstGoldAni:[function(t,e,i){"use strict";cc._RF.push(e,"1a157LWhEtEpIjM6/GiYKnx","fishGoldBurstGoldAni"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frames=[],e.sprite=null,e.frameIndex=0,e.speed=1,e.loop=0,e.isPlaying=!1,e.callback=null,e.startPoint=0,e.deltaTime=0,e}return __extends(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getComponent(cc.Sprite)},e.prototype.play=function(t,e,i,o){void 0===i&&(i=null),void 0===o&&(o=7),this.speed=t,this.loop=e,this.callback=i,this.startPoint=o,this.isPlaying=!0,this.frameIndex=o,this.deltaTime=0,this.sprite&&(this.sprite.spriteFrame=this.frames[o])},e.prototype.update=function(t){if(0!=this.frames.length&&0!=this.speed){this.deltaTime+=t;var e=Math.abs(this.speed)/this.frames.length,i=Math.floor(this.deltaTime/e);for(this.deltaTime-=i*e,i%=this.frames.length;i>0&&i<100;)i--,this._updateAnimation()}},e.prototype.reverse=function(t){this.speed=t?-Math.abs(this.speed):Math.abs(this.speed)},e.prototype.stop=function(){this.isPlaying=!1},e.prototype._updateAnimation=function(){this.isPlaying&&this.sprite&&(this.sprite.spriteFrame=this.frames[(this.frameIndex+2*this.frames.length)%this.frames.length],this.frameIndex+=this.speed>0?1:-1,(this.speed>0?this.frameIndex>=this.frames.length&&this.frameIndex%this.frames.length===this.startPoint:this.frameIndex<0&&(this.frameIndex+this.frames.length)%this.frames.length===this.startPoint)&&(this.loop--,0!=this.loop?this.frameIndex=(this.frameIndex+2*this.frames.length)%this.frames.length:(this.stop(),this.callback&&this.callback())))},__decorate([a([cc.SpriteFrame])],e.prototype,"frames",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],fishGoldBurstGold:[function(t,e,i){"use strict";cc._RF.push(e,"ec70f7eJ6hIrada4VF8Eunf","fishGoldBurstGold"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./fishGoldBurstGoldAni")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon1=null,e.icon2=null,e.shadow1=new cc.Node,e.shadow2=new cc.Node,e._shadowNode=new cc.Node,e._heightForNoRealShadow=50,e._heightForTransparentPenumbra=200,e._lightHeight=111111111,e._lightWidth=1111111,e._goldWidth=40,e.gameInstance=null,e.speed=100,e.moveDir=cc.v2(0,0),e.friction=400,e.isCollecting=!1,e.gravityHeight=400,e.id=0,e.flyHeight=500,e.flyScale=1.6,e.position={vec:cc.v2(0,0)},e.offsetYObject={y:0},e}return __extends(e,t),e.prototype.onDisable=function(){this.position={vec:cc.v2(0,0)},this.offsetYObject={y:0}},e.prototype.init=function(){this._shadowNode=this.shadow1.parent.parent,this._shadowNode.parent=this.node.parent,this._shadowNode.setPosition(this.node.position),this.gameInstance&&(this.flyScale=this.gameInstance.cameraDis/(this.gameInstance.cameraDis-this.flyHeight)),this.icon2&&this.icon2.play(.3,-1),this.launch(),this.isCollecting=!1,this.node.setPosition(this.position.vec.add(cc.v2(0,this.offsetYObject.y))),this._shadowNode.setPosition(this.position.vec.sub(cc.v2(0,this.offsetYObject.y)))},e.prototype.update=function(t){if(this.gameInstance){if(this.speed>2&&(this.position.vec=this.position.vec.add(this.moveDir.mul(this.speed*t)),this._checkPosition(),this.icon2&&(this.moveDir.y>0&&this.icon2.reverse(!1),this.moveDir.y<0&&this.icon2.reverse(!0))),this.node.setPosition(this.position.vec.add(cc.v2(0,this.offsetYObject.y))),this._shadowNode.setPosition(this.position.vec.sub(cc.v2(0,this.offsetYObject.y))),this.icon1&&this.icon2)if(this.offsetYObject.y<=1){if(this.speed>1){var e=this.friction*t;this.speed=Math.max(0,this.speed-e)}if(this.gameInstance.shakeAmount>=5){var i=this.gameInstance.shakeAmount,o=(2*Math.random()-1)*Math.sqrt(i)/2,n=(2*Math.random()-1)*Math.sqrt(i)/2;this.position.vec.addSelf(cc.v2(o,n))}this.node.zIndex=cc.macro.MIN_ZINDEX+10,this._shadowNode.zIndex=cc.macro.MIN_ZINDEX,this.isCollecting||(this.icon1.node.active=!0,this.icon2.node.active=!1)}else this.node.zIndex=1e3-this.position.vec.y,this._shadowNode.zIndex=1e3-this.position.vec.y,this.isCollecting||(this.icon1.node.active=!1,this.icon2.node.active=!0);if(this.shadow1&&this.shadow2&&this.offsetYObject.y>1){var a=this.offsetYObject.y,s=(this._lightHeight-a)*(this._lightWidth/(this._lightWidth-this._goldWidth)),r=(s-this._lightHeight)/(s-this._lightHeight+a);(r=Math.max(0,this._heightForNoRealShadow-a)/this._heightForNoRealShadow)<0&&(r=0),this.shadow1.setScale(r),this.shadow1.opacity=255;var c;this._lightHeight,this._goldWidth,this._goldWidth,this._lightWidth;c=this._heightForTransparentPenumbra/Math.max(1e-4,this._heightForTransparentPenumbra-a);var l=1/Math.pow(c,2);this.shadow2.setScale(c),this.shadow2.opacity=255*l}this.speed<2&&this.gameInstance&&!this.isCollecting&&0==this.gameInstance.enemySet.size&&(this.isCollecting=!0,this.gameInstance.readyCollectGold.push(this))}},e.prototype._checkPosition=function(){if(this.gameInstance){var t=this.gameInstance.goldArea.getContentSize(),e=this.gameInstance.goldArea.getPosition(),i=t.width/2,o=t.height/2,n=this.position.vec.sub(e);(n.x<=-i||n.x>=i)&&(this.moveDir.x*=-1,n.x=cc.misc.clampf(n.x,-i,i)),(n.y<=-o||n.y>=o)&&(this.moveDir.y*=-1,n.y=cc.misc.clampf(n.y,-o,o)),this.position.vec=n.add(e)}},e.prototype.launch=function(){var t=Math.sqrt(this.flyHeight/this.gravityHeight);cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.5*t,{scale:this.flyScale},{easing:"quadOut"}).to(.5*t,{scale:1},{easing:"quadIn"}).to(.25*t,{scale:1+.25*(this.flyScale-1)},{easing:"quadOut"}).to(.25*t,{scale:1},{easing:"quadIn"}).start(),cc.Tween.stopAllByTarget(this.offsetYObject),cc.tween(this.offsetYObject).to(.5*t,{y:this.flyHeight},{easing:"quadOut"}).to(.5*t,{y:0},{easing:"quadIn"}).to(.25*t,{y:.25*this.flyHeight},{easing:"quadOut"}).to(.25*t,{y:0},{easing:"quadIn"}).start()},e.prototype.collect=function(t){var e=this;cc.Tween.stopAllByTarget(this.node);var i=Math.floor(t.sub(this.position.vec).mag()/100),o=.1*Math.sqrt(i);cc.tween(this.node).to(o,{scale:1.2},{easing:cc.easing.smooth}).start(),cc.tween(this.offsetYObject).to(o,{y:200},{easing:cc.easing.smooth}).start(),this.gameInstance&&this.icon2&&this.icon1&&(this.icon2.node.active=!0,this.icon1.node.active=!1,this.icon2.play(.5,1,function(){e.icon1&&e.icon2&&(e.icon2.node.active=!1,e.icon1.node.active=!0,cc.tween(e.node).to(o,{scale:1},{easing:"quadIn"}).call(function(){e.die()}).start(),cc.tween(e.position).to(o,{vec:t},{easing:cc.easing.smooth}).start(),cc.tween(e.offsetYObject).to(o,{y:0},{easing:"quadIn"}).start())}))},e.prototype.die=function(){var t;this._shadowNode.parent=this.node,null===(t=this.gameInstance)||void 0===t||t.deSpawnGold(this)},__decorate([s(cc.Sprite)],e.prototype,"icon1",void 0),__decorate([s(o.default)],e.prototype,"icon2",void 0),__decorate([s(cc.Node)],e.prototype,"shadow1",void 0),__decorate([s(cc.Node)],e.prototype,"shadow2",void 0),__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"./fishGoldBurstGoldAni":"fishGoldBurstGoldAni"}],fishGoldBurstHero:[function(t,e,i){"use strict";cc._RF.push(e,"3222dqHAilG26j2CqcNsVGG","fishGoldBurstHero"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spines=[],e.muzzle=null,e.gameInstance=null,e.initX=-280,e.initY=200,e.initDY=300,e.shootInterval=1,e.aniTimeScale=1,e.spine=null,e.type=0,e.shootTime=.6,e.isShoot=!1,e.attackType="attack",e}return __extends(e,t),e.prototype.init=function(t){this.type=t;var e=this.initX,i=this.initY;if(t>=3&&(e=-e,this.node.scaleX=-1,t-=3),i=this.initY-t*this.initDY,this.node.setPosition(cc.v2(e,i)),this.node.zIndex=1e3-i,this.attackType="attack",this.spines.length>0){var o=Math.min(this.type,this.spines.length-1);this.spine=this.spines[o];for(var n=0;n<this.spines.length;n++)this.spines[n].node.active=n==o}if(this.spine){this.muzzle=this.spine.node.getChildByName("muzzle");var a=this.attackType,s=this.spine.skeletonData.getRuntimeData().findAnimation(a);if(s){var r=this.shootInterval,c=s.duration/r;this.spine.setAnimation(0,a,!0).timeScale=c,this.aniTimeScale=c}}},e.prototype.update=function(){if(this.spine){var t=this.spine.getCurrent(0);if(t){var e=t.trackTime/t.animation.duration;(e=Math.min(Math.max(e,0),1))>this.shootTime&&0==this.isShoot&&(this.isShoot=!0,this._shoot()),e<this.shootTime&&(this.isShoot=!1),1==e&&(this.spine.setAnimation(0,this.attackType,!0).timeScale=this.aniTimeScale)}}},e.prototype._shoot=function(){var t,e=this.muzzle;if(e){var i=e.convertToWorldSpaceAR(cc.Vec2.ZERO),o=this.node.parent.convertToNodeSpaceAR(i);null===(t=this.gameInstance)||void 0===t||t.spawnBullet(o,this.type)}},__decorate([a([sp.Skeleton])],e.prototype,"spines",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],fishGoldBurstMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"8e5ee9xET9HcZ1q7A6IbkAk","fishGoldBurstMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=__importDefault(t("./fishGoldBurstBullet")),a=__importDefault(t("./fishGoldBurstEnemy")),s=__importDefault(t("./fishGoldBurstGold")),r=__importDefault(t("./fishGoldBurstHero")),c=cc._decorator,l=c.ccclass,h=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.goldSink=null,e.goldArea=new cc.Node,e.goldCountLabel=null,e.totalHPProgress=null,e.skillProgress=null,e.skillIcon=null,e.enemyParent=new cc.Node,e.bulletParent=new cc.Node,e.heroParent=new cc.Node,e.goldParent=new cc.Node,e.damageNumParent=new cc.Node,e.enemyPrefab=null,e.bulletPrefab=null,e.heroPrefab=null,e.goldPrefab=null,e.damagePrefab=null,e._enemyPool=new cc.NodePool,e._bulletPool=new cc.NodePool,e._heroPool=new cc.NodePool,e._goldPool=new cc.NodePool,e._damagePool=new cc.NodePool,e.readySpawnGold=[],e.readyCollectGold=[],e.enemySet=new Set,e._totalGoldCount=0,e._goldCount=0,e._isCanCollect=!1,e._isTouching=!1,e._touchPosition=cc.v2(0,0),e._skillTotalCD=5,e._skillCD=0,e._attackCD=0,e._level=1,e.shakeAmount=0,e.totalHP=0,e.nowHP=0,e.FOV=30,e.cameraDis=100,e.sceneSize=cc.size(0,0),e}return __extends(e,t),e.prototype.onEnable=function(){cc.game.setFrameRate(60)},e.prototype.start=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStartAndMove,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchStartAndMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this),this.enemyParent.destroyAllChildren(),this.bulletParent.destroyAllChildren(),this.damageNumParent.destroyAllChildren(),this.goldParent.destroyAllChildren(),this.heroParent.destroyAllChildren(),this.sceneSize=this.enemyParent.getContentSize(),this._spawnHero(6),this._startLevel(),this.cameraDis=this.node.getContentSize().height/(2*Math.sqrt(2))/Math.tan(cc.misc.degreesToRadians(this.FOV/2)),cc.log(this.cameraDis)},e.prototype.update=function(t){var e;if(this._attackCD-=t,this._skillCD+=t,this._isTouching&&this._touchAttack(),this.skillProgress&&this.skillIcon&&(this.skillProgress.setContentSize(300,200*this._skillCD/this._skillTotalCD),this._skillCD>this._skillTotalCD?this.skillIcon.color=cc.Color.WHITE:this.skillIcon.color=cc.Color.GRAY),this.goldCountLabel&&(this.goldCountLabel.string=this._totalGoldCount.toString()),this.enemyPrefab&&this.bulletPrefab&&this.damagePrefab&&this.heroPrefab&&this.goldPrefab&&(this._readyPool(this._enemyPool,this.enemyPrefab,100),this._readyPool(this._bulletPool,this.bulletPrefab,100),this._readyPool(this._damagePool,this.damagePrefab,200),this._readyPool(this._heroPool,this.heroPrefab,20),this._readyPool(this._goldPool,this.goldPrefab)),this.shakeAmount>=5){var i=(2*Math.random()-1)*Math.sqrt(this.shakeAmount)/1.1,o=(2*Math.random()-1)*Math.sqrt(this.shakeAmount)/1.1;this.node.setPosition(i,o)}this.shakeAmount=Math.max(0,this.shakeAmount-Math.pow(this.shakeAmount,1.1)*t);for(var n=0;n<10;n++){var a=this.readySpawnGold.shift();a&&this._spawnGold(1,a.center,a.position)}if(this._isCanCollect)for(n=0;n<2;n++){var s=this.readyCollectGold.shift();s&&this.goldSink&&s.collect(null===(e=this.goldSink)||void 0===e?void 0:e.getPosition())}else this.readyCollectGold.length==this._goldCount&&this._goldCount&&(this._isCanCollect=!0,this.readyCollectGold.sort(function(t,e){return 700-t.position.vec.y-(700-e.position.vec.y)}))},e.prototype._readyPool=function(t,e,i){void 0===i&&(i=1e3),e&&t.size()<i&&t.put(cc.instantiate(e))},e.prototype._startLevel=function(){this._totalGoldCount>=1e4?o.default.instance.gotoResultWithLoading(!0,this.node.parent):(this._level+=1,this._skillCD=0,this.totalHP=0,this._isCanCollect=!1,this._spawnEnemies(5*Math.random()+1*this._level),this.nowHP=this.totalHP,this.totalHPProgress&&(this.totalHPProgress.progress=1))},e.prototype.setNowHP=function(t){this.totalHPProgress&&(this.nowHP=t,cc.tween(this.totalHPProgress).to(.5,{progress:t/this.totalHP}).start())},e.prototype._spawnEnemies=function(t){t=Math.round(t);for(var e=0;e<t;e++){if(!this.enemyParent||!this.sceneSize)return;this._enemyPool.size()<=0&&this._readyPool(this._enemyPool,this.enemyPrefab);var i=this._enemyPool.get(),o=i.getComponent(a.default);this.enemySet.add(o),i.parent=this.enemyParent,o.gameInstance=this,o.init(this._randomPointInRectangle(this.sceneSize))}},e.prototype.deSpawnEnemy=function(t){this.enemySet.delete(t),this._enemyPool.put(t.node)},e.prototype._spawnHero=function(t){t=Math.round(t);for(var e=0;e<Math.min(t,6);e++){this._heroPool.size()<=0&&this._readyPool(this._heroPool,this.heroPrefab);var i=this._heroPool.get(),o=i.getComponent(r.default);i.parent=this.enemyParent,o.gameInstance=this,o.init(e)}},e.prototype.spawnBullet=function(t,e){void 0===e&&(e=0),this._bulletPool.size()<=0&&this._readyPool(this._bulletPool,this.bulletPrefab);var i=this._bulletPool.get(),o=i.getComponent(n.default);i.parent=this.enemyParent,i.setPosition(t),o.gameInstance=this;var a=this._getRandomEnemyPosition();o.type=e,o.init(a)},e.prototype.deSpawnBullet=function(t){this._bulletPool.put(t.node)},e.prototype._spawnGold=function(t,e,i){t=Math.round(t),this.shakeAmount+=t,this._goldCount+=t;for(var o=0;o<t;o++){this._goldPool.size()<=0&&this._readyPool(this._goldPool,this.goldPrefab);var n=this._goldPool.get(),a=n.getComponent(s.default);n.parent=this.enemyParent,a.position.vec=i,a.gameInstance=this,a.id=this._goldCount,a.speed=200*Math.random()+200,a.flyHeight=200*Math.random()+200;var r=this._randomExplosionDirection(e,i);a.moveDir=r,a.init()}},e.prototype.deSpawnGold=function(t){this._goldCount--,this._totalGoldCount++,0==this._goldCount&&0==this.enemySet.size&&this._startLevel(),this._goldPool.put(t.node)},e.prototype.showDamage=function(t,e){var i=this;if(this.damagePrefab&&!(t<1)){this._damagePool.size()<=0&&this._readyPool(this._damagePool,this.damagePrefab);var o=this._damagePool.get(),n=o.getComponent(cc.Label);n&&(n.string=Math.floor(t).toString()),o.parent=this.damageNumParent,o.setPosition(e),cc.tween(o).by(.7,{y:50},{easing:"sineOut"}).call(function(){i._damagePool.put(o),n.string=""}).start()}},e.prototype._getRandomEnemyPosition=function(){var t=this.enemySet,e=Array.from(t);return 0===e.length?this._randomPointInRectangle(this.sceneSize):e[Math.floor(Math.random()*e.length)].node.getPosition()},e.prototype._randomPointInRectangle=function(t){var e=t.width,i=t.height,o=e/2,n=i/2,a=Math.random()*e-o,s=Math.random()*i-n;return new cc.Vec2(a,s)},e.prototype._randomExplosionDirection=function(t,e){var i=e.sub(t),o=i.mag(),n=0;o<30?(n=2*Math.PI,i=cc.v2(1,0)):n=Math.atan(100/o);var a=Math.random()*n*2-n;return cc.v2(i).rotate(a).normalize()},e.prototype._onTouchStartAndMove=function(t){this._touchPosition=this.node.convertToNodeSpaceAR(t.getLocation()),this._isTouching=!0},e.prototype._touchAttack=function(){var t=this._touchPosition;this.skillIcon&&t.sub(this.skillIcon.parent.getPosition()).mag()<50&&this._skillCD>=this._skillTotalCD?(this._skillCD=0,this.spawnBullet(t,6)):this._attackCD<0&&(this._attackCD=.1,this.spawnBullet(t,7))},e.prototype._onTouchEnd=function(){this._attackCD=0,this._isTouching=!1},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},e.prototype.onDisable=function(){cc.game.setFrameRate(30),this._enemyPool.clear(),this._goldPool.clear(),this._bulletPool.clear(),this._damagePool.clear(),this._heroPool.clear(),this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStartAndMove,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchStartAndMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this)},e.prototype.playSpineAnimation=function(t,e,i){t&&(t.setAnimation(0,e,!1),t.setCompleteListener(function(t){t.animation.name===e&&i()}))},__decorate([h(cc.Node)],e.prototype,"goldSink",void 0),__decorate([h(cc.Node)],e.prototype,"goldArea",void 0),__decorate([h(cc.Label)],e.prototype,"goldCountLabel",void 0),__decorate([h(cc.ProgressBar)],e.prototype,"totalHPProgress",void 0),__decorate([h(cc.Node)],e.prototype,"skillProgress",void 0),__decorate([h(cc.Node)],e.prototype,"skillIcon",void 0),__decorate([h(cc.Node)],e.prototype,"enemyParent",void 0),__decorate([h(cc.Node)],e.prototype,"bulletParent",void 0),__decorate([h(cc.Node)],e.prototype,"heroParent",void 0),__decorate([h(cc.Node)],e.prototype,"goldParent",void 0),__decorate([h(cc.Node)],e.prototype,"damageNumParent",void 0),__decorate([h(cc.Prefab)],e.prototype,"enemyPrefab",void 0),__decorate([h(cc.Prefab)],e.prototype,"bulletPrefab",void 0),__decorate([h(cc.Prefab)],e.prototype,"heroPrefab",void 0),__decorate([h(cc.Prefab)],e.prototype,"goldPrefab",void 0),__decorate([h(cc.Prefab)],e.prototype,"damagePrefab",void 0),__decorate([l],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./fishGoldBurstBullet":"fishGoldBurstBullet","./fishGoldBurstEnemy":"fishGoldBurstEnemy","./fishGoldBurstGold":"fishGoldBurstGold","./fishGoldBurstHero":"fishGoldBurstHero"}],fishGoldBurstModel:[function(t,e,i){"use strict";cc._RF.push(e,"3bf43EDJJ1C26kpLao9dZuS","fishGoldBurstModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/fishGoldBurst/fishGoldBurstMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.fishGoldBurst)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],guessPlaceMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"2330d3GqyVH2Kv9gSy+zj90","guessPlaceMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=cc._decorator,a=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scene=null,e.nowLevel=0,e.levels=[],e}var i;return __extends(e,t),i=e,e.prototype.onEnable=function(){i.instance=this,this.scene&&(this.levels=this.scene.children),this.nextLevel()},e.prototype.onDisable=function(){i.instance=null},e.prototype.nextLevel=function(){if(this.nowLevel!=this.levels.length){this.nowLevel>0&&(this.levels[this.nowLevel-1].active=!1);var t=this.levels[this.nowLevel];t&&(t.active=!0),this.nowLevel++}else o.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},e.instance=null,__decorate([s(cc.Node)],e.prototype,"scene",void 0),i=__decorate([a],e)}(cc.Component);i.default=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager"}],guessPlaceModel:[function(t,e,i){"use strict";cc._RF.push(e,"f5655SBTyVOBLsbHBI6+Tlw","guessPlaceModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.GuessPlaceModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),s=cc._decorator,r=(s.ccclass,s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/guessPlace/guessPlaceMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.guessPlace)],e)}(a.default));i.GuessPlaceModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],guessPlacePanel:[function(t,e,i){"use strict";cc._RF.push(e,"13e92Vq0mhHzIjh4dgAeLtr","guessPlacePanel"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./guessPlaceMainGame")),n=cc._decorator,a=n.ccclass,s=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onNodeClicked,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onNodeClicked,this)},e.prototype.onNodeClicked=function(t){var e,i=this.node.convertToNodeSpaceAR(t.getLocation());cc.log(i);for(var n=0,a=this.node.children;n<a.length;n++){var s=a[n];if(s.getBoundingBox().contains(i)){s.parent=this.node,null===(e=o.default.instance)||void 0===e||e.nextLevel();break}}},__decorate([a],e)}(cc.Component));i.default=s,cc._RF.pop()},{"./guessPlaceMainGame":"guessPlaceMainGame"}],hanoiTowerDisk:[function(t,e,i){"use strict";cc._RF.push(e,"3c612TjFdJBdpljbP6xfVde","hanoiTowerDisk"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spritePre=[],e.frontNode=null,e.backNode=null,e.colorID=0,e.tower=null,e.offSetForTower=cc.v2(),e.isMoving=!1,e.scale=0,e}return __extends(e,t),e.prototype.init=function(){if(this.spritePre.length>=this.colorID){var t=cc.instantiate(this.spritePre[this.colorID-1]);if(!t||!this.tower)return;this.frontNode=t.getChildByName("f"),this.backNode=t.getChildByName("b"),this.frontNode.parent=this.node.parent,this.backNode.parent=this.node.parent,this.node.zIndex=this.tower.disks.length+this.tower.node.zIndex,this.frontNode.scale*=this.scale,this.backNode.scale*=this.scale}this.updatePosition()},e.prototype.updatePosition=function(){this.tower&&this.node.setPosition(this.tower.node.getPosition().add(this.offSetForTower))},e.prototype.setPosition=function(){var t,e=this.node.x,i=(this.node.y- -700-200)/1200,o=900*(i=(2-525/900*4)*(t=i)*t+(525/900*4-1)*t)-425,n=(375-125*i)/375,a=e*n;this.frontNode&&this.backNode&&(this.frontNode.setPosition(cc.v2(a,o)),this.backNode.setPosition(cc.v2(a,o)),this.frontNode.scaleX=this.scale*n,this.backNode.scaleX=this.scale*n,this.frontNode.scaleY=this.scale*n*1.1,this.backNode.scaleY=this.scale*n*1.1)},e.prototype.update=function(){this.isMoving||this.updatePosition(),this.frontNode&&this.backNode&&(this.frontNode.setPosition(this.node.getPosition()),this.backNode.setPosition(this.node.getPosition()),this.frontNode.zIndex=this.node.zIndex+111,this.backNode.zIndex=this.node.zIndex-111)},e.prototype.moveAnotherTower=function(t){var e=this;if(this.tower){var i=cc.v2(this.node.x,this.tower.getTopPos().y),o=t.getTopPos(),n=t.getDropDiskPos();this.offSetForTower=n.sub(t.node.getPosition());var a=cc.tween().to(Math.abs(i.y-this.node.y)/800,{y:i.y}),s=cc.v2((i.x+o.x)/2,Math.max(i.y,o.y)+200),r=cc.tween().bezierTo(.5,cc.v2(i.x,i.y),s,cc.v2(o.x,o.y)),c=cc.tween().to(Math.abs(o.y-n.y)/800,{position:cc.v3(n.x,n.y,0)});this.isMoving=!0;var l=t.disks.length+t.node.zIndex;cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).then(a).then(r).then(c).call(function(){e.node.zIndex=l,e.isMoving=!1}).start(),t.disks.push(this),this.node.zIndex=l+1e4,this.tower=t}},__decorate([a(cc.Node)],e.prototype,"spritePre",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],hanoiTowerMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"a9749z42XpGB61MS6qr2usa","hanoiTowerMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("./hanoiTowerDisk")),s=__importDefault(t("./hanoiTowerTower")),r=cc._decorator,c=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sceneNode=null,e.diskPre=null,e.towerPre=null,e.shareNode=null,e.levelLabel=null,e.shareBut=null,e.towers=[],e.movingTowerID=-1,e.initPos=cc.v2(),e.intervalPos=cc.v2(),e.maxDiskNum=0,e.levelData=[],e.levels=[],e._levelCount=0,e.isGameOver=!1,e.finishTowerNum=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"levelCount",{get:function(){return this._levelCount},set:function(t){this._levelCount=t,this.levelLabel&&(this.levelLabel.string="\u7b2c"+(t+1)+"\u5173")},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStart,this),cc.game.setFrameRate(60)},e.prototype.onDisable=function(){cc.Tween.stopAllByTarget(this),this.node.off(cc.Node.EventType.TOUCH_START,this._touchStart,this),cc.game.setFrameRate(30)},e.prototype.start=function(){for(var t=7;t<=10;t++)for(var e=3;e<=9;e++)this.levels.push([e,t]);this.levelCount=0,this._gameInit(),this.init()},e.prototype._gameInit=function(){var t=cc.sys.localStorage.getItem("miniGameHanoiTower");if(t){var e=JSON.parse(t);e&&(this.levelCount=e.nowLevel)}},e.prototype._gameSave=function(){var t={nowLevel:0};t.nowLevel=this.levelCount,cc.sys.localStorage.setItem("miniGameHanoiTower",JSON.stringify(t))},e.prototype.reStart=function(){this.isGameOver||this.init(!0)},e.prototype.init=function(t){var e=this;if(void 0===t&&(t=!1),this.towers=[],this.diskPre&&this.diskPre&&this.sceneNode&&this.shareBut&&this.towerPre){if(this.sceneNode.destroyAllChildren(),this.finishTowerNum=0,!t){var i=this.generateRandomDisks();this.maxDiskNum=i.diskNum,this.levelData=i.array}var o=this.levelData.length,n=1;this.shareBut.active=!1,o>6&&(n=2,this.shareBut.active=!0),this.towerPre.height=40*this.maxDiskNum,this.intervalPos=cc.v2(700/Math.min(o,6),-(n-1)*(this.towerPre.height+100)),this.initPos=cc.v2(-(Math.min(o,6)-1)/2*this.intervalPos.x,-(n-1)*this.intervalPos.y/2-100),this.towers=this.levelData.map(function(t,i){var o=cc.instantiate(e.towerPre);o.zIndex=1e3*i;var n=o.getComponent(s.default);return n.maxDiskNum=e.maxDiskNum,n.diskInterval=e.towerPre.height/e.maxDiskNum,t.map(function(t,i){var o=cc.instantiate(e.diskPre);o.parent=e.sceneNode;var s=o.getComponent(a.default);s.tower=n,s.offSetForTower=cc.v2(0,i*n.diskInterval),s.colorID=t,s.scale=.8,s.init(),n.disks.push(o.getComponent(a.default))}),o.parent=e.sceneNode,n.oriPosition=cc.v2(i%6*e.intervalPos.x+e.initPos.x,(i>=6?1:0)*e.intervalPos.y+e.initPos.y),o.setPosition(n.oriPosition),n})}},e.prototype.addTower=function(){var t=cc.instantiate(this.towerPre);t.zIndex=1e3*this.towers.length;var e=t.getComponent(s.default);e.maxDiskNum=this.maxDiskNum,e.diskInterval=this.towerPre.height/this.maxDiskNum,t.parent=this.sceneNode;var i=this.towers.length;e.oriPosition=cc.v2(i%6*this.intervalPos.x+this.initPos.x,(i>=6?1:0)*this.intervalPos.y+this.initPos.y),t.setPosition(e.oriPosition),this.towers.push(e)},e.prototype.generateRandomDisks=function(){for(var t=this.levels[Math.min(this.levelCount,this.levels.length-1)],e=t[0],i=t[1],o=new Array(e).fill(0).map(function(t,e){return new Array(i).fill(e+1)}),n=0;n<2;n++)o.push([]);for(var a=[],s=0,r=o;s<r.length;s++){var c=r[s];a.push.apply(a,c)}(function(t){for(var e,i,o=t.length;0!==o;)i=Math.floor(Math.random()*o),e=t[o-=1],t[o]=t[i],t[i]=e})(a);for(var l=0,h=o;l<h.length;l++)for(c=h[l],n=0;n<c.length;n++)c[n]=a.pop();return{towerNum:e+=2,diskNum:i,array:o}},e.prototype._touchStart=function(t){var e=this;if(!this.isGameOver){var i=this.node.convertToNodeSpaceAR(t.getLocation()).add(cc.v2(0,100)),o=this.towers.findIndex(function(t){return e.isPointInsideNode(i,t.node)});if(-1!==o)if(-1===this.movingTowerID)this.moveTowerUp(o);else{var n=this.movingTowerID;this.moveTowerDown(this.movingTowerID),this.moveDisks(n,o)}}},e.prototype.isPointInsideNode=function(t,e){return e.getBoundingBox().contains(t)},e.prototype.moveTowerUp=function(t){this.movingTowerID=t,this.towers[t].moveUp()},e.prototype.moveTowerDown=function(t){this.movingTowerID=-1,this.towers[t].moveDown()},e.prototype.moveDisks=function(t,e){if(t!=e){var i=this.towers[t],n=this.towers[e],a=n.getTopDisk(),s=0,r=i.getTopDisk();a?s=a.colorID:r&&(s=r.colorID);for(var c=0;r&&r.colorID==s&&!n.isMaxDisk();)c++,r.moveAnotherTower(n),i.getAndRemoveDisk(),r=i.getTopDisk();0==c?this.moveTowerUp(e):(this.checkGameOver(),o.default.instance.miniGameAdapter.vibrateShort(10))}},e.prototype.checkGameOver=function(){var t=this,e=0;this.isGameOver=!0;for(var i=0,n=this.towers;i<n.length;i++){var a=n[i],s=a.disks;if(s.length){if(s.length<this.maxDiskNum){this.isGameOver=!1;continue}var r=s[0].colorID;e++;for(var c=0,l=a.disks;c<l.length;c++)if(l[c].colorID!=r){e--,this.isGameOver=!1;break}}}if(e>this.finishTowerNum&&(cc.tween(this).delay(1.2).call(function(){o.default.instance.miniGameAdapter.vibrateLong(.4),cc.log("\u957f\u9707\u52a8")}).start(),this.finishTowerNum=e),this.isGameOver)return cc.tween(this).delay(2).call(function(){t.levelCount++,t._gameSave(),t.init(),t.isGameOver=!1}).start(),!0},e.prototype.share=function(){var t=this;this.towers.length>this.levelData.length?this.flyText("\u6700\u591a\u589e\u52a0\u4e00\u6b21",cc.Color.RED):this.shareNode&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareNode,{miniGame:n.SubPackageKey.hanoiTower}).then(function(e){e?(t.flyText("\u5206\u4eab\u6210\u529f",cc.Color.GREEN),t.addTower()):t.flyText("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a",cc.Color.RED)}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.flyText=function(t){if(this.levelLabel){var e=cc.instantiate(this.levelLabel.node),i=e.getComponent(cc.Label);e.zIndex=cc.macro.MAX_ZINDEX,i.string=t,this.sceneNode&&(e.parent=this.sceneNode,e.setPosition(0,0),cc.tween(e).by(1,{y:50}).by(.5,{y:50,opacity:-255}).start())}},e.prototype.getAns=function(){var t=this,e=this.levelData.map(function(t){return t.slice()}),i=new Set,o=[],n=e.length,a=e[0].length,s=!1,r=function(t,e){var i=0;if(t.length){var o=t[t.length-1];if(!e.length||e[e.length-1]==o)for(;t.length-1-i>=0&&e.length+i<a&&t[t.length-1-i]==o;)i++}return i},c=function(t,e,i){e.push.apply(e,t.splice(t.length-i,i))},l=function(){var t=e.map(function(t){return t.join("")});t.sort();var o=t.join();return!i.has(o)&&(i.add(o),!0)},h=function(){for(var t=function(t){return 0==t.length||t.length==a&&t.every(function(e){return e==t[0]})?"continue":{value:!1}},i=0,o=e;i<o.length;i++){var n=t(o[i]);if("object"==typeof n)return n.value}return!0},u=0,d=function(){if(u++,h())s=!0;else for(var t=0;t<n;t++)for(var i=0;i<n;i++)if(t!=i){var a=r(e[t],e[i]);if(0!=a)if(c(e[t],e[i],a),l()){if(o.push({a:t,b:i,c:a}),d(),s)return;var p=o.pop();p&&c(e[p.b],e[p.a],a)}else c(e[i],e[t],a)}};d(),cc.log(u,s,e);for(var p=cc.tween(this),m=function(e){p=p.delay(.3).call(function(){t.moveDisks(e.a,e.b)})},f=0,g=o;f<g.length;f++)m(g[f]);p.start()},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([l(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([l(cc.Node)],e.prototype,"diskPre",void 0),__decorate([l(cc.Node)],e.prototype,"towerPre",void 0),__decorate([l(cc.Node)],e.prototype,"shareNode",void 0),__decorate([l(cc.Label)],e.prototype,"levelLabel",void 0),__decorate([l(cc.Node)],e.prototype,"shareBut",void 0),__decorate([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","./hanoiTowerDisk":"hanoiTowerDisk","./hanoiTowerTower":"hanoiTowerTower"}],hanoiTowerModel:[function(t,e,i){"use strict";cc._RF.push(e,"d0fa4ALS8FFc4XPFRc3rFd7","hanoiTowerModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/hanoiTower/hanoiTowerMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.hanoiTower)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],hanoiTowerTower:[function(t,e,i){"use strict";cc._RF.push(e,"94c78Aw5d5PMqWRR2bEqUCR","hanoiTowerTower"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spriteNode=null,e.oriPosition=cc.v2(),e.disks=[],e.diskInterval=50,e.maxDiskNum=7,e}return __extends(e,t),e.prototype.start=function(){this.spriteNode&&(this.spriteNode.height=this.node.height+40),this.update(1)},e.prototype.update=function(){},e.prototype.isMaxDisk=function(){return this.disks.length>=this.maxDiskNum},e.prototype.getTopPos=function(){var t=cc.v2(0,this.diskInterval*this.maxDiskNum);return this.node.getPosition().add(t)},e.prototype.getTopDisk=function(){return this.disks[this.disks.length-1]},e.prototype.getAndRemoveDisk=function(){return this.disks.pop()},e.prototype.stopNode=function(){cc.Tween.stopAllByTarget(this.node)},e.prototype.moveUp=function(){this.stopNode(),cc.tween(this.node).to(.3,{y:this.oriPosition.y+50}).start()},e.prototype.moveDown=function(){this.stopNode(),cc.tween(this.node).to(.3,{y:this.oriPosition.y}).start()},e.prototype.getDropDiskPos=function(){var t=cc.v2(0,this.disks.length*this.diskInterval);return this.node.getPosition().add(t)},__decorate([a(cc.Node)],e.prototype,"spriteNode",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],huntEvolutionBullet:[function(t,e,i){"use strict";cc._RF.push(e,"d87f4WQS19PhrNScv67SC1q","huntEvolutionBullet"),Object.defineProperty(i,"__esModule",{value:!0}),i.HuntEvolutionBulletType=void 0;var o,n=t("./huntEvolutionEnemy"),a=t("./huntEvolutionMainGame"),s=__importDefault(t("./huntEvolutionSkillManager")),r=cc._decorator,c=r.ccclass;r.property,function(t){t[t.Normal=0]="Normal",t[t.sniper=1]="sniper",t[t.Splitting=2]="Splitting",t[t.SplittingLv2=3]="SplittingLv2",t[t.Shrapnel=4]="Shrapnel"}(o=i.HuntEvolutionBulletType||(i.HuntEvolutionBulletType={}));var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameInstance=null,e.skillManager=new s.default,e.streakNode=null,e.player=null,e.hitEnemySet=new Set,e.blockWidth=100,e.oriSize=20,e.size=20,e.position=cc.v2(0,0),e.lastPosition=e.position,e.oriSpeed=600,e.speed=e.oriSpeed,e.damagesRate=1,e.sniperRate=1,e.bulletPenetration=1,e.pierceCount=0,e.moveDir=cc.v2(0,0),e.bulletType=o.Normal,e.enemyMap=null,e.currentDistance=0,e.maxDistance=0,e.trackEnemy=null,e}return __extends(e,t),e.prototype.init=function(t){if(void 0===t&&(t=o.Normal),this.gameInstance&&this.gameInstance.player&&(this.skillManager=this.gameInstance.skillManager,this.streakNode=this.gameInstance.streakNode,this.node.zIndex=a.HuntEvolutionZIndex.bullet,this.player=this.gameInstance.player,this.player)){this.blockWidth=this.gameInstance.blockWidth,this.sniperRate=1,this.skillManager.isZoomEX&&t==o.Normal&&(t=o.sniper),t!=o.Normal&&t!=o.sniper||(this.hitEnemySet.clear(),this.position=this.player.position,this.damagesRate=1,t==o.sniper&&(this.sniperRate=this.skillManager.sniperBulletMultiplier)),t==o.Splitting&&(this.damagesRate=this.skillManager.splitBulletDamagePercentage),t==o.SplittingLv2&&(this.damagesRate=this.skillManager.splitBulletDamagePercentageLv2),t==o.Shrapnel&&(this.damagesRate=.3),this.size=this.skillManager.bulletSize*this.damagesRate*this.sniperRate,this.bulletPenetration=this.skillManager.bulletPenetration*this.damagesRate*this.sniperRate,this.maxDistance=this.skillManager.bulletRange*Math.pow(this.damagesRate,1/6)*this.sniperRate;var e=this.skillManager.bulletScale*this.damagesRate*this.sniperRate;this.node.scale=e,this.pierceCount=0,this.oriSpeed=this.skillManager.bulletSpeed,this.speed=this.oriSpeed,this.currentDistance=0,this.bulletType=t,this.lastPosition=this.position,this.enemyMap=this.gameInstance.enemyMap,this.trackEnemy=null,this.updateSprite()}},e.prototype.update=function(t){var e;this.skillManager.isPause||(this.moveDir||cc.log(this.moveDir),this.lastPosition=this.position,this.position=this.position.add(this.moveDir.mul(this.speed*t)),this.currentDistance+=this.speed*t,this.currentDistance>this.maxDistance?this._die():(this.updateSprite(),this.player&&this.position.sub(null===(e=this.player)||void 0===e?void 0:e.position).mag()>1e4&&this._die(),this._checkHitWithEnemiesInSurroundingBlocks(),this.trackEnemy&&(this.trackEnemy.HP<0||this.hitEnemySet.has(this.trackEnemy))&&(this.trackEnemy=null),this._updateBulletDirection(t)))},e.prototype._getSurroundingBlocks=function(t){for(var e=[],i=-1;i<=1;i++)for(var o=-1;o<=1;o++){var n=new cc.Vec2(t.x+i,t.y+o);e.push(n)}return e},e.prototype._checkHitWithEnemiesInSurroundingBlocks=function(){if(this.enemyMap){var t=Number.MAX_SAFE_INTEGER,e=this._getSurroundingBlocks(this._getBlockPos(this.position));null==this.trackEnemy||this.skillManager.isEliteTarget&&this.trackEnemy.enemyType!=n.HuntEvolutionEnemyType.suicideElite?e.push.apply(e,this._getSurroundingBlocks(this._getBlockPos(this.position.add(this.moveDir.mul(200))))):t=-Number.MAX_SAFE_INTEGER;for(var i=0;i<e.length;i++){var a=this.enemyMap.get(this._getVec2String(e[i]));if(a)for(var s=0;s<a.length;s++){var r=a[s];if(!(r.HP<=0)){var c=this.position.sub(r.position).mag();if(this.skillManager.isEliteTarget&&(c-=Number.MAX_SAFE_INTEGER),c<t&&this.moveDir.dot(r.position.add(this.position))>0&&!this.hitEnemySet.has(r)&&(this.trackEnemy=r,t=c),(c=this._shortestDistanceToSegment(this.lastPosition,this.position,r.position))<r.size+this.size){if(this.hitEnemySet.has(r)||r.HP<=0)continue;if(this.hitEnemySet.add(r),Math.random()<this.skillManager.enemyDodgeProbability){r.onDodge();continue}var l=this.skillManager.knockBackDistance,h=this.skillManager.bulletDamage;this.player&&(h+=this.player.hurtCount*this.skillManager.hurtBoostedDamage),h+=this.pierceCount*this.skillManager.damageIncreaseOnPierce,h+=r.HP*this.skillManager.damageBasedOnCurrentHealth+r.maxHP*this.skillManager.damageBasedOnTotalHealth,r.HPPercentage()<=this.skillManager.enemyLowHpThreshold&&(h*=1+this.skillManager.extraLowHpDamagePercentage);var u=!1;if((this.skillManager.isCenterHitCrit&&c<this.size||Math.random()<this.skillManager.criticalRate)&&(u=!0),u&&(h*=this.skillManager.criticalDamage),h*=1-this.skillManager.EnemyDamageReduction,l*=this.damagesRate,h*=this.damagesRate,this.bulletType==o.Shrapnel&&(h=0,r.isBeHit))continue;if(this.gameInstance&&(this.gameInstance.isShakeInThis=!0),r.onHit(this.moveDir,l,h),this.gameInstance&&this.gameInstance.showDamage(h,r.position,u),this.gameInstance&&(r.HP<=0&&(this.skillManager.isInfiniteSplit||this.bulletType==o.Normal)&&this.gameInstance.gun.splitFire(r),this.bulletType==o.Normal&&Math.random()<this.skillManager.shrapnelSpawnChance&&this.gameInstance.gun.shrapnelFire(r,this.moveDir)),this.skillManager.isLonelyStar&&this.bulletType==o.sniper)return void this._die();if(this.pierceCount++,this.skillManager.isNoPierceCountOnKill&&r.HP<=0||u&&Math.random()<this.skillManager.critNoPenetrationChance)continue;if(this.bulletPenetration-=1,this.bulletPenetration<=0)return void this._die()}}}}}},e.prototype._updateBulletDirection=function(t){if(this.trackEnemy){var e=this.trackEnemy.position.sub(this.position).normalize();if(this.moveDir.mag()&&e.mag()){var i=this.moveDir.angle(e),o=this.skillManager.trackingAngularSpeed*Math.PI/180*t,n=Math.min(o,i),a=this.moveDir.cross(e)>=0?1:-1;this.moveDir=cc.v2(this.moveDir).rotate(a*n)}}},e.prototype.updateSprite=function(){this.node.angle=cc.misc.radiansToDegrees(Math.atan2(this.moveDir.y,this.moveDir.x)),this.node.setPosition(this.position)},e.prototype._getBlockPos=function(t){return cc.v2(Math.floor(t.x/this.blockWidth),Math.floor(t.y/this.blockWidth))},e.prototype._getVec2String=function(t){return t.x+","+t.y},e.prototype._die=function(){var t;this.gameInstance&&this.skillManager.isLonelyStar&&this.bulletType==o.sniper&&this.gameInstance.gun.splitFireNormal(this.position),null===(t=this.gameInstance)||void 0===t||t.deSpawnBullet(this.node)},e.prototype._shortestDistanceToSegment=function(t,e,i){var o;t=(o=this._extendLineSegment(t,e,.5))[0];var n=(e=o[1]).sub(t),a=i.sub(t),s=(i.sub(e),n.dot(n)),r=a.dot(n)/s;if(r<0||r>1)return Number.MAX_SAFE_INTEGER;var c=t.add(n.mul(r));return i.sub(c).mag()},e.prototype._extendLineSegment=function(t,e,i){var o=e.sub(t).normalize();return[t.sub(o.mul(i*t.sub(e).mag())),e.add(o.mul(i*t.sub(e).mag()))]},__decorate([c],e)}(cc.Component);i.default=l,cc._RF.pop()},{"./huntEvolutionEnemy":"huntEvolutionEnemy","./huntEvolutionMainGame":"huntEvolutionMainGame","./huntEvolutionSkillManager":"huntEvolutionSkillManager"}],huntEvolutionEnemySpawner:[function(t,e,i){"use strict";cc._RF.push(e,"dbc9d+dhX5NQrzyOQ+zAYjD","huntEvolutionEnemySpawner"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importStar(t("./huntEvolutionEnemy")),n=__importDefault(t("./huntEvolutionSkillManager")),a=function(){function t(){this.gameInstance=null,this.enemyPrefab=null,this.skillManager=new n.default,this.enemyPool=null,this.gameScene=null,this.player=null}return t.prototype.init=function(){this.gameInstance&&(this.enemyPool=this.gameInstance.enemyPool,this.enemyPrefab=this.gameInstance.enemyPrefab,this.skillManager=this.gameInstance.skillManager,this.gameScene=this.gameInstance.gameScene,this.player=this.gameInstance.player)},t.prototype.spawnEnemy=function(){if(this.player){var t=this.player.position.add(this.getRandomPosition()),e=Math.random();(e-=this.skillManager.groupEnemySpawnChance)<0?this.spawnGroupEnemy(this.skillManager.groupEnemyCount,this.player.position):(e-=this.skillManager.enemySpawnNearPlayerProbability)<0?(t=this.player.position.add(this.getRandomPosition(200,300)),this.spawnNormalEnemy(t)):(e-=this.skillManager.highHpEliteSpawnProbability)<0?this.spawnHighHpElite(t):(e-=this.skillManager.suicideEliteSpawnProbability)<0?(t=this.player.position.add(this.getRandomPosition(1400,1500)),this.spawnSuicideElite(t)):this.spawnNormalEnemy(t)}},t.prototype.spawnHighHpElite=function(t){var e=this.getEnemyComponent();e&&this.player&&(e.position=t,e.init(o.HuntEvolutionEnemyType.highHpElite))},t.prototype.spawnSuicideElite=function(t){var e=this.getEnemyComponent();e&&this.player&&(e.position=t,e.init(o.HuntEvolutionEnemyType.suicideElite))},t.prototype.spawnGroupEnemy=function(t,e){for(var i=2*Math.random()*Math.PI,o=0;o<t;o++){i+=2*Math.PI/t;var n=400*Math.cos(i),a=400*Math.sin(i),s=e.add(cc.v2(n,a));this.spawnNormalEnemy(s)}},t.prototype.spawnNormalEnemy=function(t){var e=this.getEnemyComponent();e&&this.player&&(e.position=t,e.init())},t.prototype.getEnemyComponent=function(){var t;if(this.enemyPrefab&&this.gameInstance){var e=null===(t=this.enemyPool)||void 0===t?void 0:t.get();e||(e=cc.instantiate(this.enemyPrefab)),this.gameScene&&(e.parent=this.gameScene);var i=e.getComponent(o.default);return i.gameInstance=this.gameInstance,i}},t.prototype.getRandomPosition=function(t,e){void 0===t&&(t=600),void 0===e&&(e=1200);var i=t,o=e,n=2*Math.random()*Math.PI,a=i+Math.random()*(o-i),s=a*Math.cos(n),r=a*Math.sin(n);return cc.v2(s,r)},t}();i.default=a,cc._RF.pop()},{"./huntEvolutionEnemy":"huntEvolutionEnemy","./huntEvolutionSkillManager":"huntEvolutionSkillManager"}],huntEvolutionEnemy:[function(t,e,i){"use strict";cc._RF.push(e,"a6063LHmgtKHLLQmoAkAnKh","huntEvolutionEnemy"),Object.defineProperty(i,"__esModule",{value:!0}),i.HuntEvolutionEnemyType=void 0;var o,n=__importDefault(t("./huntEvolutionSkillManager")),a=cc._decorator,s=a.ccclass,r=a.property;(function(t){t[t.Normal=0]="Normal",t[t.highHpElite=1]="highHpElite",t[t.suicideElite=2]="suicideElite"})(o=i.HuntEvolutionEnemyType||(i.HuntEvolutionEnemyType={}));var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spines=[],e.spineID=0,e.shadow=null,e.position=cc.v2(0,0),e.gameInstance=null,e.skillManager=new n.default,e.player=null,e.enemySpawner=null,e.spriteNode=null,e.size=30,e.enemyMap=null,e.blockWidth=100,e._blockPos=cc.v2(0,0),e._moveDir=cc.v2(0,0),e._lastMoveDir=cc.v2(0,0),e.enemyType=o.Normal,e._repulsionRadius=100,e._repulsionFactor=Math.pow(e._repulsionRadius/2,2),e._minRepulsionRadius=e._repulsionRadius/4,e.isBeHit=!1,e._hitBackTween=null,e.maxHP=20,e.HP=3,e._slowdownPercentage=0,e._slowdownDuration=0,e.invincibilityTime=0,e._tweens=[],e}return __extends(e,t),e.prototype.init=function(t){var e=this;if(void 0===t&&(t=o.Normal),this.gameInstance&&this.gameInstance.player){this.skillManager=this.gameInstance.skillManager,this.enemySpawner=this.gameInstance.enemySpawner,this.player=this.gameInstance.player,this.enemyMap=this.gameInstance.enemyMap,this._blockPos=this._getBlockPos(this.position),this.blockWidth=this.gameInstance.blockWidth,this._moveDir=cc.v2(0,0),this._lastMoveDir=cc.v2(0,0),this.isBeHit=!1,this.enemyType=t,this._slowdownPercentage=0,this.maxHP=this.skillManager.enemyMaxHP,t==o.highHpElite&&(this.maxHP*=this.skillManager.highHpEliteHealth),this.HP=this.maxHP,cc.Tween.stopAllByTarget(this.node),cc.Tween.stopAllByTarget(this.shadow),this.spriteNode=this.node.getChildByName("sprite"),this.spriteNode&&(this.spriteNode.color=cc.Color.RED);for(var i=0;i<this.spines.length;i++)this.spines[i].active=!1;this.spineID=0,t==o.Normal&&this.skillManager.currentEnemyCount>5e3?this.spineID=0:this.spineID=t+1,this.spines[this.spineID].active=!0,this.shadow=this.spines[this.spineID].getChildByName("sd"),this.shadow||(this.shadow=new cc.Node),this.gameInstance.shadowNode&&(this.shadow.parent=this.gameInstance.shadowNode),this.shadow.setPosition(this.node.getPosition()),this.invincibilityTime=1,this.shadow.opacity=0,this.node.opacity=255,this.node.scale=0,cc.tween(this.node).to(.5,{scale:1}).call(function(){e.invincibilityTime=0,e.shadow&&(e.shadow.opacity=255)}).start(),this.skillManager.currentEnemyCount++,this._insertEnemyToMap(this,this._blockPos),this._updateSprite()}},e.prototype._getBlockPos=function(t){return cc.v2(Math.floor(t.x/this.blockWidth),Math.floor(t.y/this.blockWidth))},e.prototype._getVec2String=function(t){return t.x+","+t.y},e.prototype._insertEnemyToMap=function(t,e){if(this.enemyMap){var i=this._getVec2String(e),o=this.enemyMap.get(i);o||(o=[],this.enemyMap.set(i,o)),o.push(t)}},e.prototype._removeEnemyFromMap=function(t,e){if(this.enemyMap){var i=this._getVec2String(e),o=this.enemyMap.get(i);if(o){var n=o.indexOf(t);-1!==n&&(o.splice(n,1),0===o.length&&this.enemyMap.delete(i))}}},e.prototype._getSurroundingBlocks=function(){for(var t=this._blockPos,e=[],i=-1;i<=1;i++)for(var o=-1;o<=1;o++){var n=new cc.Vec2(t.x+i,t.y+o);e.push(n)}return e},e.prototype._checkRepulsionWithEnemiesInSurroundingBlocks=function(t){if(this.enemyMap)for(var e=this._getSurroundingBlocks(),i=0;i<e.length;i++){var o=this.enemyMap.get(this._getVec2String(e[i]));if(o)for(var n=0;n<o.length;n++){var a=o[n];if(a!==this){var s=t.sub(a.position).mag();if(s>this._repulsionRadius)continue;s=Math.max(s,this._minRepulsionRadius);var r=1*this._repulsionFactor/(s*s),c=a.position.sub(t).normalize();a._moveDir=a._moveDir.add(c.mul(r/2)),this._moveDir=this._moveDir.add(c.mul(-r/2))}}}},e.prototype.updateMoveDir=function(){if(this.player){var t=this.player.position.sub(this.position).normalize();t.x<0?this.node.scaleX=-1:this.node.scaleX=1,this.invincibilityTime||(this.player.position.sub(this.position).mag()>this.size?this._moveDir=this._moveDir.add(t):(this.player.onHit(),this.enemyType==o.suicideElite&&this._die())),this._checkRepulsionWithEnemiesInSurroundingBlocks(this.position)}},e.prototype.updateLogic=function(t){if(this.player){var e=this.skillManager.enemySpeed*t*(1-this._slowdownPercentage);this.enemyType==o.suicideElite&&(e*=this.skillManager.suicideEliteSpeed);var i=this.player.position.sub(this.position).mag();i<1e3&&(e*=1+(1e3-i)/1e3*this.skillManager.speedIncreaseBasedOnDistance),this.enemyType==o.suicideElite&&(this._moveDir=this.player.position.sub(this.position).normalize(),0!=this._lastMoveDir.mag()&&(this._moveDir=this._lastMoveDir.add(this._moveDir.sub(this._lastMoveDir).normalize().mul(t/1.5)))),this.isBeHit?this.position=this.node.getPosition():this.position=this.position.add(this._moveDir.mul(e)),this._lastMoveDir=this._moveDir,this._moveDir=cc.v2(0,0);var n=this._getBlockPos(this.position);this._getVec2String(n)!=this._getVec2String(this._blockPos)&&(this._removeEnemyFromMap(this,this._blockPos),this._blockPos=n,this._insertEnemyToMap(this,this._blockPos))}},e.prototype.update=function(t){if(this.player){var e=this.player.position.y-this.position.y;this.node.zIndex=Math.min(Math.max(e+1e6,cc.macro.MIN_ZINDEX),cc.macro.MAX_ZINDEX)}this._slowdownDuration>0&&(this._slowdownDuration-=t,this._slowdownDuration<=0&&(this._slowdownPercentage=0)),this._updateSprite()},e.prototype._updateSprite=function(){this.node.setPosition(this.position),this.shadow&&this.shadow.setPosition(this.position)},e.prototype.onDodge=function(){var t,e=this;this.invincibilityTime||(this.node.opacity=127.5,null===(t=this.gameInstance)||void 0===t||t.setTimeout(function(){e.node.opacity=255},100))},e.prototype.onHit=function(t,e,i){var n=this;if(void 0===e&&(e=50),void 0===i&&(i=1),this.HP-=i,this.HP>0&&this.HPPercentage()<this.skillManager.enemyInstantKillPercentage&&(this.HP=0),this.HP<0&&(this.HP=0),!(this.enemyType==o.suicideElite&&this.HP>0||(this.enemyType==o.highHpElite&&this.HP>0&&(e=e/2-25),e<=0))){this._hitBackTween&&this._hitBackTween.stop();var a=Math.sqrt(e)/35;this.isBeHit=!0;var s=t.mul(e);this.HP<=0&&cc.tween(this.shadow).to(a,{opacity:0},{easing:"sineOut"}).start(),this._hitBackTween=cc.tween(this.node).parallel(cc.tween().by(a,{x:s.x,y:s.y},{easing:"sineOut"}),cc.tween().to(a,{opacity:this.HP<=0?0:255},{easing:"sineOut"})).call(function(){n.isBeHit=!1,n._hitBackTween=null,n.HP<=0?n._die():Math.random()<n.skillManager.slowdownProbability&&(n._slowdownPercentage=n.skillManager.slowdownPercentage,n._slowdownDuration=n.skillManager.slowdownDuration)}).start(),this._tweens.push(this._hitBackTween)}},e.prototype.onDisable=function(){for(var t=0,e=this._tweens;t<e.length;t++){var i=e[t];null==i||i.stop()}this._tweens.length=0},e.prototype.HPPercentage=function(){return this.HP/this.maxHP},e.prototype._die=function(){var t,e;this.shadow&&(this.shadow.parent=this.spines[this.spineID]),this.enemySpawner&&Math.random()<this.skillManager.enemyRespawnOnDeathProbability&&this.enemySpawner.spawnEnemy();var i=1;this.enemyType==o.highHpElite?(this._spawnExpBall(15),i=10):this.enemyType==o.suicideElite?(this._spawnExpBall(6),i=3):this._spawnExpBall(1),this.skillManager.currentEnemyCount--,this.skillManager.killEnemyCount+=i,null===(t=this.gameInstance)||void 0===t||t.addTimeKillCount(i),this._removeEnemyFromMap(this,this._blockPos),null===(e=this.gameInstance)||void 0===e||e.deSpawnEnemy(this.node)},e.prototype._spawnExpBall=function(t){var e;if(this.gameInstance)for(var i=0;i<t;i++)null===(e=this.gameInstance)||void 0===e||e.spawnExpBall(this.position.add(this._getRandomPosition()))},e.prototype._getRandomPosition=function(t,e){void 0===t&&(t=5),void 0===e&&(e=50);var i=t,o=e,n=2*Math.random()*Math.PI,a=i+Math.random()*(o-i),s=a*Math.cos(n),r=a*Math.sin(n);return cc.v2(s,r)},__decorate([r([cc.Node])],e.prototype,"spines",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"./huntEvolutionSkillManager":"huntEvolutionSkillManager"}],huntEvolutionExpBall:[function(t,e,i){"use strict";cc._RF.push(e,"dd5deX9tZJI+qCUDi+5nPCk","huntEvolutionExpBall"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./huntEvolutionMainGame"),n=__importDefault(t("./huntEvolutionSkillManager")),a=cc._decorator,s=a.ccclass,r=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameInstance=null,e._isGetting=!1,e._player=null,e._skillManager=new n.default,e._moveSpeed=cc.v2(0,0),e._acceleration=cc.v2(0,0),e._maxSpeed=600,e._getRadius=50,e._accelerationMagnitude=e._maxSpeed*e._maxSpeed/e._getRadius,e}return __extends(e,t),e.prototype.init=function(){this.gameInstance&&(this._skillManager=this.gameInstance.skillManager,this._player=this.gameInstance.player),this._isGetting=!1,this.node.zIndex=o.HuntEvolutionZIndex.exp,Math.random()<this._skillManager.directExpGainChance&&(this._isGetting=!0),this._moveSpeed=cc.v2(0,0)},e.prototype.update=function(t){if(this._player){var e=this._player.position.sub(this.node.getPosition()).mag();if(e<=this._skillManager.expRange&&(this._isGetting=!0,e<=this._getRadius))return this._skillManager.addExp(),void this._die();this._isGetting&&this._moveTowardsTarget(this._player.position,t)}},e.prototype._moveTowardsTarget=function(t,e){var i=this.node.getPosition(),o=t.sub(i).normalize();this._acceleration=o.multiplyScalar(this._accelerationMagnitude),this._moveSpeed=this._moveSpeed.add(this._acceleration.multiplyScalar(e)),this._moveSpeed.mag()>this._maxSpeed&&(this._moveSpeed=this._moveSpeed.normalize().multiplyScalar(this._maxSpeed));var n=this._moveSpeed.clone().multiplyScalar(e),a=i.add(n);this.node.setPosition(a)},e.prototype._die=function(){var t;null===(t=this.gameInstance)||void 0===t||t.deSpawnExpBall(this.node)},__decorate([s],e)}(cc.Component));i.default=r,cc._RF.pop()},{"./huntEvolutionMainGame":"huntEvolutionMainGame","./huntEvolutionSkillManager":"huntEvolutionSkillManager"}],huntEvolutionGun:[function(t,e,i){"use strict";cc._RF.push(e,"33e2b1gntRCd5SiFdvZal9E","huntEvolutionGun"),Object.defineProperty(i,"__esModule",{value:!0}),i.HuntEvolutionGunType=void 0;var o,n=__importStar(t("./huntEvolutionBullet")),a=t("./huntEvolutionEnemy"),s=__importDefault(t("./huntEvolutionSkillManager"));(function(t){t[t.Normal=0]="Normal",t[t.Sniper=1]="Sniper",t[t.MachineGun=2]="MachineGun",t[t.circleGun=3]="circleGun"})(o=i.HuntEvolutionGunType||(i.HuntEvolutionGunType={}));var r=function(){function t(){this.gameInstance=null,this.skillManager=new s.default,this.enemyMap=new Map,this.bulletPrefab=null,this.gameScene=null,this._shootDir=cc.v2(0,0),this.player=null,this.bulletPool=new cc.NodePool}return t.prototype.init=function(){this.gameInstance&&(this.skillManager=this.gameInstance.skillManager,this.enemyMap=this.gameInstance.enemyMap,this.bulletPool=this.gameInstance.bulletPool,this.bulletPrefab=this.gameInstance.bulletPrefab,this.gameScene=this.gameInstance.gameScene,this.player=this.gameInstance.player)},t.prototype.fire=function(t){var e,i=this;if(!this.skillManager.isPause)if(t!=o.Sniper)if(t!=o.MachineGun)if(this._getFireDir(0),this.skillManager.isZoomEX&&this.player&&this.player.moveDir.mag()>.1&&(this._shootDir=this.player.moveDir),this.skillManager.isOneByOne){var a=new Array(this.skillManager.firedBulletsCount).fill(this._shootDir);if(this.skillManager.firedBackBulletsCount&&a.push.apply(a,this._generateRandomBulletDirections(this._shootDir.mul(-1),this.skillManager.bulletSpreadAngle,this.skillManager.firedBackBulletsCount)),Math.random()<this.skillManager.burstFireChance)for(var s=1;s<=this.skillManager.burstFireCount;s++)a.push.apply(a,new Array(this.skillManager.firedBulletsCount).fill(this._shootDir)),this.skillManager.firedBackBulletsCount&&a.push.apply(a,new Array(this.skillManager.firedBackBulletsCount).fill(this._shootDir.mul(-1)));this._shootOneByOne(a,n.HuntEvolutionBulletType.Normal)}else{var r=this._generateBulletDirections(this._shootDir,this.skillManager.bulletSpreadAngle,this.skillManager.firedBulletsCount);if(this.skillManager.firedBackBulletsCount&&r.push.apply(r,this._generateBulletDirections(this._shootDir.mul(-1),this.skillManager.bulletSpreadAngle,this.skillManager.firedBackBulletsCount)),this._shoot(r,n.HuntEvolutionBulletType.Normal),Math.random()<this.skillManager.burstFireChance)for(s=1;s<=this.skillManager.burstFireCount;s++)null===(e=this.gameInstance)||void 0===e||e.setTimeout(function(){i._shoot(r,n.HuntEvolutionBulletType.Normal)},100*s)}else this._machineGunFire();else this._sniperFire()},t.prototype._sniperFire=function(){this.skillManager.isLonelyStar?this._getFireDir(0):this._getFireDir(.5);var t=this._generateBulletDirections(this._shootDir,this.skillManager.bulletSpreadAngle,1);this._shoot(t,n.HuntEvolutionBulletType.sniper)},t.prototype._machineGunFire=function(){var t,e=this;this._getFireDir(.5);for(var i=this._generateBulletDirections(this._shootDir,this.skillManager.bulletSpreadAngle,1),o=1;o<=this.skillManager.machineGunBurstCount;o++)null===(t=this.gameInstance)||void 0===t||t.setTimeout(function(){e._shoot(i,n.HuntEvolutionBulletType.Normal)},100*o)},t.prototype._shoot=function(t,e){if(this.bulletPrefab)for(var i=0,o=t;i<o.length;i++){var a=o[i],s=this.bulletPool.get();s||(s=cc.instantiate(this.bulletPrefab)),this.gameScene&&(s.parent=this.gameScene);var r=s.getComponent(n.default);r&&(r.gameInstance=this.gameInstance,r.moveDir=a,r.init(e))}},t.prototype._shootOneByOne=function(t,e){var i=this;if(this.bulletPrefab&&this.gameInstance)for(var o=this.gameInstance.spawnBulletInterval/t.length,a=0,s=function(t){r.gameInstance.setTimeout(function(){if(i.bulletPrefab&&i.gameInstance){var o=i.bulletPool.get();o||(o=cc.instantiate(i.bulletPrefab)),i.gameScene&&(o.parent=i.gameScene);var a=o.getComponent(n.default);if(a&&(a.gameInstance=i.gameInstance,a.moveDir=t,a.init(e),i.player&&t.dot(i._shootDir)>.9)){var s=i._shootDir,r=cc.v2(-s.y,s.x),c=100*Math.random()-50;i.skillManager.isZoomEX&&(c=200*Math.random()-100),s=s.add(r.mul(c/100)).normalize(),a.moveDir=s,a.position=i.player.position.add(r.mul(c))}}},1e3*a),a+=o},r=this,c=0,l=t;c<l.length;c++)s(l[c])},t.prototype.circleFire=function(t,e,i){var o=this;void 0===t&&(t=0),void 0===e&&(e=2),void 0===i&&(i=cc.v2(1,0));var a=this._generateBulletDirections(i,360,t);0==t&&(a=this._generateBulletDirections(i,360,36),this.circleFire(36,2,i.mul(-1)));var s=1e3*e/a.length,r=function(t){var e;if(!(t>=a.length)&&o.bulletPrefab){var i=a[t],c=o.bulletPool.get();c||(c=cc.instantiate(o.bulletPrefab)),o.gameScene&&(c.parent=o.gameScene);var l=c.getComponent(n.default);l&&(l.gameInstance=o.gameInstance,l.moveDir=i,l.init()),s<1?r(t+1):null===(e=o.gameInstance)||void 0===e||e.setTimeout(function(){r(t+1)},s)}};r(0)},t.prototype.splitFireNormal=function(t){var e=Math.floor(this.skillManager.bulletCount*(1+this.skillManager.sniperIncreasedFireInterval));cc.log(e);var i=this._generateBulletDirections(this._getRandomDir(),360,e);this._splitTypeBulletShoot(i,t,n.HuntEvolutionBulletType.Normal)},t.prototype.splitFire=function(t){var e=this._generateBulletDirections(this._getRandomDir(),360,this.skillManager.splitBulletCount);this._splitTypeBulletShoot(e,t,n.HuntEvolutionBulletType.Splitting)},t.prototype.splitFireLv2=function(t){var e=this._generateBulletDirections(this._getRandomDir(),360,this.skillManager.splitBulletCountLv2);this._splitTypeBulletShoot(e,t,n.HuntEvolutionBulletType.SplittingLv2)},t.prototype.shrapnelFire=function(t,e){var i=this._generateBulletDirections(e,120,this.skillManager.shrapnelCount);this._splitTypeBulletShoot(i,t,n.HuntEvolutionBulletType.Shrapnel)},t.prototype._splitTypeBulletShoot=function(t,e,i){if(this.bulletPrefab)for(var o=0,a=t;o<a.length;o++){var s=a[o],r=this.bulletPool.get();r||(r=cc.instantiate(this.bulletPrefab)),this.gameScene&&(r.parent=this.gameScene);var c=r.getComponent(n.default);c&&(c.gameInstance=this.gameInstance,c.init(i),c.moveDir=s,c.hitEnemySet.clear(),e instanceof cc.Vec2?c.position=e:(c.position=e.position,c.hitEnemySet.add(e)),c.updateSprite())}},t.prototype._getFireDir=function(t){var e=this,i=Number.MAX_SAFE_INTEGER,o=null;this.enemyMap.forEach(function(n){n.forEach(function(n){var a=n.position.sub(e.player.position).mag();a<i&&Math.random()>t&&(o=n,i=a)})}),this.skillManager.isEliteTarget&&(i=Number.MAX_SAFE_INTEGER,this.enemyMap.forEach(function(n){n.forEach(function(n){var s=n.position.sub(e.player.position).mag();n.enemyType==a.HuntEvolutionEnemyType.suicideElite&&s<i&&Math.random()>t&&(o=n,i=s)})})),null!=o&&this.player?(o=o,this._shootDir=o.position.sub(this.player.position).normalize(),this._shootDir=this._addRandomOffsetToDirectionVector(this._shootDir,this.skillManager.aimingShakeAngle)):this._shootDir=this._getRandomDir()},t.prototype._generateBulletDirections=function(t,e,i){if(0==i)return[];if(1==i)return[t];var o=[],n=e/(i-1);360==e&&(n=e/i);for(var a=e/2,s=0;s<i;s++){var r=(s*n-a)*Math.PI/180,c=t.x*Math.cos(r)-t.y*Math.sin(r),l=t.x*Math.sin(r)+t.y*Math.cos(r),h=cc.v2(c,l).normalize();o.push(h)}return o},t.prototype._generateRandomBulletDirections=function(t,e,i){for(var o=[],n=e/2,a=0;a<i;a++){var s=(Math.random()*e-n)*Math.PI/180,r=t.x*Math.cos(s)-t.y*Math.sin(s),c=t.x*Math.sin(s)+t.y*Math.cos(s),l=cc.v2(r,c).normalize();o.push(l)}return o},t.prototype._addRandomOffsetToDirectionVector=function(t,e){e*=Math.PI/180;var i=Math.random()*e-e/2,o=cc.v2(t.x*Math.cos(i)-t.y*Math.sin(i),t.x*Math.sin(i)+t.y*Math.cos(i));return t.add(o).normalize()},t.prototype._getRandomDir=function(){var t=2*Math.random()*Math.PI;return cc.v2(Math.sin(t),Math.cos(t))},t.prototype._shuffleArray=function(t){for(var e,i=t.length-1;i>0;i--){var o=Math.floor(Math.random()*(i+1));e=[t[o],t[i]],t[i]=e[0],t[o]=e[1]}return t},t}();i.default=r,cc._RF.pop()},{"./huntEvolutionBullet":"huntEvolutionBullet","./huntEvolutionEnemy":"huntEvolutionEnemy","./huntEvolutionSkillManager":"huntEvolutionSkillManager"}],huntEvolutionMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"4c97dqhB61MSoil8eRnNJE5","huntEvolutionMainGame"),Object.defineProperty(i,"__esModule",{value:!0}),i.HuntEvolutionZIndex=void 0;var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=__importDefault(t("./huntEvolutionEnemySpawner")),a=__importDefault(t("./huntEvolutionExpBall")),s=__importStar(t("./huntEvolutionGun")),r=t("./huntEvolutionMapSpawner"),c=__importDefault(t("./huntEvolutionPlayer")),l=__importDefault(t("./huntEvolutionSkillBoard")),h=__importStar(t("./huntEvolutionSkillManager")),u=cc._decorator,d=u.ccclass,p=u.property;(function(t){t[t.bullet=0]="bullet",t[t.exp=1]="exp"})(i.HuntEvolutionZIndex||(i.HuntEvolutionZIndex={}));var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bgNode=null,e.shadowNode=null,e.playerSprite=null,e.enemyPrefab=null,e.bulletPrefab=null,e.damageNumPrefab=null,e.expBallPrefab=null,e.boomPrefab=null,e.gameScene=null,e.streakNode=null,e.skillBoard=null,e.skillEnemyBoard=null,e.progressHP=null,e.progressEXP=null,e.killCountLabel=null,e.progressEnemyTime=null,e.player=null,e.skillManager=new h.default,e.gun=new s.default,e.enemySpawner=new n.default,e.enemyMap=new Map,e.blockWidth=100,e.skillUpType=h.HuntEvolutionSkillType.player,e.startTouchPos=cc.v2(0,0),e._nowTouchPos=cc.v2(0,0),e.enemyPool=new cc.NodePool,e.bulletPool=new cc.NodePool,e.damageLabelPool=new cc.NodePool,e.expBallPool=new cc.NodePool,e.boomPool=new cc.NodePool,e.spawnEnemyInterval=1,e.spawnBulletInterval=1,e._tempKillCount=0,e.isShakeInThis=!1,e}return __extends(e,t),e.prototype.onLoad=function(){cc.game.setFrameRate(60)},e.prototype.start=function(){if(this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this),!this.player){var t=new cc.Node;if(t.name="player",this.gameScene&&this.gameScene.addChild(t),!t)return;var e=t.addComponent(c.default);this.player=e}this.player.gameInstance=this,this.streakNode&&(this.streakNode.zIndex=2),this.bgNode&&(this.bgNode.player=this.player),this.gun.gameInstance=this,this.gun.init(),this.enemySpawner.gameInstance=this,this.enemySpawner.init(),this.skillManager.init(),this.skillBoard&&(this.skillBoard.gameInstance=this),this.skillEnemyBoard&&(this.skillEnemyBoard.gameInstance=this);for(var i=0;i<4;i++)this.spawnBullet(i);this.spawnEnemy()},e.prototype.update=function(t){this.phoneShake(),this.enemyPrefab&&this.bulletPrefab&&this.expBallPrefab&&this.damageNumPrefab&&this.boomPrefab&&(this.enemyPool.size()<2e3&&this.enemyPool.put(cc.instantiate(this.enemyPrefab)),this.bulletPool.size()<2e3&&this.bulletPool.put(cc.instantiate(this.bulletPrefab)),this.damageLabelPool.size()<2e3&&this.damageLabelPool.put(cc.instantiate(this.damageNumPrefab)),this.expBallPool.size()<2e3&&this.expBallPool.put(cc.instantiate(this.expBallPrefab)),this.boomPool.size()<2e3&&this.boomPool.put(cc.instantiate(this.boomPrefab))),!this.skillManager.isPause&&this.player&&(this.skillManager.update(),this.progressHP&&(this.progressHP.progress=this.player.HPProgress),this.progressEXP&&(this.progressEXP.progress=this.skillManager.EXPProgress),this.progressEnemyTime&&(this.progressEnemyTime.progress=this.skillManager.enemyTimeProgress),this.player.HP<=0&&(this.skillManager.isPause=!0,o.default.instance.gotoResultWithLoading(!1,this.node.parent)),this.skillManager.levelUp()?(this.skillUpType=h.HuntEvolutionSkillType.player,this._skillBoardOpen()):this.skillManager.enemyUp(t)&&(this.skillUpType=h.HuntEvolutionSkillType.enemy,this._skillBoardOpen()),this.updateNodePos(),this.updateEnemy(t),this.updateBullet(t),this._updateKillCount(t))},e.prototype.updateBullet=function(){var t=this.skillManager.fireRate;this.player&&this.player.moveDir.mag()<.1?t+=this.skillManager.stationaryFireRateIncrease:t+=this.skillManager.exSpeedToShoot,this.spawnBulletInterval=1/t},e.prototype.updateEnemy=function(t){this.spawnEnemyInterval=1/this.skillManager.enemySpawnRate,this.enemyMap.forEach(function(e){e.forEach(function(e){e.updateMoveDir(),e.updateLogic(t/2)})}),this.enemyMap.forEach(function(e){e.forEach(function(e){e.updateMoveDir(),e.updateLogic(t/2)})})},e.prototype.updateNodePos=function(){this.player&&this.gameScene&&(this.gameScene.scale=1/this.skillManager.viewScale,this.gameScene.setPosition(this.player.position.mul(-this.gameScene.scale)),this.player.node.parent.setPosition(this.player.position))},e.prototype.spawnEnemy=function(){var t=this;0==this.skillManager.isPause&&this.enemySpawner.spawnEnemy(),this.setTimeout(function(){t.spawnEnemy()},1e3*this.spawnEnemyInterval)},e.prototype.deSpawnEnemy=function(t){this.enemyPool.put(t)},e.prototype.spawnBullet=function(t){var e=this;t==s.HuntEvolutionGunType.Normal&&(this.gun.fire(t),this.setTimeout(function(){e.spawnBullet(t)},1e3*Math.min(this.spawnBulletInterval,2))),t==s.HuntEvolutionGunType.Sniper&&(this.skillManager.heldWeaponsCount>t&&this.gun.fire(t),this.setTimeout(function(){e.spawnBullet(s.HuntEvolutionGunType.Sniper)},1e3*this.spawnBulletInterval*(1+this.skillManager.sniperIncreasedFireInterval))),t==s.HuntEvolutionGunType.MachineGun&&(this.skillManager.heldWeaponsCount>t&&this.gun.fire(t),this.setTimeout(function(){e.spawnBullet(s.HuntEvolutionGunType.MachineGun)},1e3*this.spawnBulletInterval*(1+this.skillManager.machineGunIncreasedFireInterval))),t==s.HuntEvolutionGunType.circleGun&&(this.skillManager.circularFireChance>0&&0==this.skillManager.isPause&&this.gun.circleFire(),this.setTimeout(function(){e.spawnBullet(s.HuntEvolutionGunType.circleGun)},1e3*this.skillManager.circularFireInterval))},e.prototype.deSpawnBullet=function(t){this.bulletPool.put(t)},e.prototype.spawnExpBall=function(t){if(this.expBallPrefab){var e=this.expBallPool.get();e||(e=cc.instantiate(this.expBallPrefab)),this.gameScene&&(e.parent=this.gameScene,e.setPosition(t));var i=e.getComponent(a.default);i&&(i.gameInstance=this,i.init())}},e.prototype.deSpawnExpBall=function(t){this.expBallPool.put(t)},e.prototype.showDamage=function(t,e,i){var o=this;if(this.damageNumPrefab&&!(t<1)){var n=this.damageLabelPool.get();n||(n=cc.instantiate(this.damageNumPrefab),cc.log("damagePool++"));var a=n.getChildByName("critical"),s=n.getComponent(cc.Label);s.string="",i&&(s=a.getComponent(cc.Label)),a.getComponent(cc.Label).string="",s&&(s.string=Math.floor(t).toString()),this.gameScene&&(n.parent=this.gameScene,this.boomPrefab,e=e.add(cc.v2(20*Math.random()-10,20*Math.random()-10)),n.setPosition(e),n.zIndex=cc.macro.MAX_ZINDEX,cc.tween(n).by(.7,{y:50},{easing:"sineOut"}).call(function(){o.damageLabelPool.put(n),n.removeFromParent(),s.string=""}).start())}},e.prototype._skillBoardOpen=function(){if(this.skillManager.isPause=!0,this.skillBoard&&this.skillUpType==h.HuntEvolutionSkillType.player&&(this.skillBoard.node.active=!0,this.skillBoard.init(this.skillManager.getSelectSkills(this.skillUpType))),this.skillEnemyBoard&&this.skillUpType==h.HuntEvolutionSkillType.enemy){if(21==this.skillManager.enemyLevel)return void o.default.instance.gotoResultWithLoading(!0,this.node.parent);this.skillEnemyBoard.node.active=!0,this.skillEnemyBoard.init(this.skillManager.getSelectSkills(this.skillUpType))}this.gun.circleFire(2*this.skillManager.level+20,0)},e.prototype.skillBoardClose=function(t){this.skillManager.isPause=!1,this.skillManager.selectSkill(t,this.skillUpType),this.skillBoard&&(this.skillBoard.node.active=!1),this.skillEnemyBoard&&(this.skillEnemyBoard.node.active=!1)},e.prototype._updateKillCount=function(t){if(this.killCountLabel){this.killCountLabel.string=this.skillManager.killEnemyCount.toString(),this._tempKillCount*=1-t*this._tempKillCount,this._tempKillCount<0&&(this._tempKillCount=.1);var e=.3*Math.pow(this._tempKillCount,.7)/1.2;this.killCountLabel.node.parent.scale=.3*Math.pow(this._tempKillCount,.7)+1;var i=this._interpolateWhiteToRed(e);this.killCountLabel.node.color=i,this.killCountLabel.node.parent.color=i}},e.prototype.addTimeKillCount=function(t){void 0===t&&(t=1),this._tempKillCount+=t},e.prototype._interpolateWhiteToRed=function(t){t=Math.max(0,Math.min(1,t));var e=cc.Color.RED,i=cc.Color.WHITE,o=i.r+(e.r-i.r)*t,n=i.g+(e.g-i.g)*t,a=i.b+(e.b-i.b)*t;return new cc.Color(o,n,a)},e.prototype.phoneShake=function(){this.isShakeInThis&&o.default.instance.miniGameAdapter.vibrateShort(1),this.isShakeInThis=!1},e.prototype._onTouchStart=function(t){this.startTouchPos=this.node.convertToNodeSpaceAR(t.getLocation()),this._nowTouchPos=this.startTouchPos},e.prototype._onTouchMove=function(t){this.player&&(this._nowTouchPos=this.node.convertToNodeSpaceAR(t.getLocation()),this.player.moveDir=this._nowTouchPos.sub(this.startTouchPos).normalize())},e.prototype._onTouchEnd=function(){this.player&&(this.player.moveDir=cc.v2(0,0))},e.prototype.onClickExit=function(){this._offBind(),o.default.instance.getModel().gameExit()},e.prototype.onDisable=function(){cc.game.setFrameRate(30),this._offBind(),this.enemyPool.clear(),this.bulletPool.clear(),this.damageLabelPool.clear(),this.expBallPool.clear()},e.prototype._offBind=function(){this.skillBoard&&this.skillBoard.offBind(),this.skillEnemyBoard&&this.skillEnemyBoard.offBind(),this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this)},e.prototype.setTimeout=function(t,e){var i=this;cc.tween({value:0}).delay(e/1e3).call(function(){i.node&&t()}).start()},__decorate([p(r.HuntEvolutionMapSpawner)],e.prototype,"bgNode",void 0),__decorate([p(cc.Node)],e.prototype,"shadowNode",void 0),__decorate([p(cc.SpriteFrame)],e.prototype,"playerSprite",void 0),__decorate([p(cc.Prefab)],e.prototype,"enemyPrefab",void 0),__decorate([p(cc.Prefab)],e.prototype,"bulletPrefab",void 0),__decorate([p(cc.Prefab)],e.prototype,"damageNumPrefab",void 0),__decorate([p(cc.Prefab)],e.prototype,"expBallPrefab",void 0),__decorate([p(cc.Prefab)],e.prototype,"boomPrefab",void 0),__decorate([p(cc.Node)],e.prototype,"gameScene",void 0),__decorate([p(cc.Node)],e.prototype,"streakNode",void 0),__decorate([p(l.default)],e.prototype,"skillBoard",void 0),__decorate([p(l.default)],e.prototype,"skillEnemyBoard",void 0),__decorate([p(cc.ProgressBar)],e.prototype,"progressHP",void 0),__decorate([p(cc.ProgressBar)],e.prototype,"progressEXP",void 0),__decorate([p(cc.Label)],e.prototype,"killCountLabel",void 0),__decorate([p(cc.ProgressBar)],e.prototype,"progressEnemyTime",void 0),__decorate([p(c.default)],e.prototype,"player",void 0),__decorate([d],e)}(cc.Component);i.default=m,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./huntEvolutionEnemySpawner":"huntEvolutionEnemySpawner","./huntEvolutionExpBall":"huntEvolutionExpBall","./huntEvolutionGun":"huntEvolutionGun","./huntEvolutionMapSpawner":"huntEvolutionMapSpawner","./huntEvolutionPlayer":"huntEvolutionPlayer","./huntEvolutionSkillBoard":"huntEvolutionSkillBoard","./huntEvolutionSkillManager":"huntEvolutionSkillManager"}],huntEvolutionMapSpawner:[function(t,e,i){"use strict";cc._RF.push(e,"60218axNXVD240ywqEmOzmj","huntEvolutionMapSpawner"),Object.defineProperty(i,"__esModule",{value:!0}),i.HuntEvolutionMapSpawner=void 0;var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.objects=[],e.player=null,e.blockSize=1e3,e.objectsPerBlock=20,e._spawnedBlocks=new Map,e._objectPool=new cc.NodePool,e._pendingSpawns=[],e}return __extends(e,t),e.prototype.update=function(){this._spawnObjectsAroundPlayer()},e.prototype._spawnObjectsAroundPlayer=function(){var t,e;if(this.player&&this.objects.length){for(var i=this._getPlayerBlock(),o=this._getNeighborBlocks(i),n=this._getExtendedNeighborBlocks(i),a=0,s=o;a<s.length;a++){var r=s[a];if(!this._spawnedBlocks.has(r)){var c=this._getSpawnPositionsInBlock(r);(t=this._pendingSpawns).push.apply(t,c),this._spawnedBlocks.set(r,[])}}if(this._pendingSpawns.length>0){var l=this._pendingSpawns.shift();if(l){var h=this._spawnObjectAtPosition(l);r=this._getPositionBlock(l),null===(e=this._spawnedBlocks.get(r))||void 0===e||e.push(h)}}var u=[];this._spawnedBlocks.forEach(function(t,e){n.includes(e)||u.push(e)});for(var d=0,p=u;d<p.length;d++)r=p[d],this._removeObjectsInBlock(r),this._spawnedBlocks.delete(r)}},e.prototype._getPlayerBlock=function(){if(!this.player)return"";var t=this.player.position;return Math.round(t.x/this.blockSize)+","+Math.round(t.y/this.blockSize)},e.prototype._getNeighborBlocks=function(t){var e=t.split(",").map(Number),i=e[0],o=e[1],n=[];n.push(i+","+o);for(var a=-1;a<=1;a++)for(var s=-1;s<=1;s++)0==a&&0==s||n.push(i+a+","+(o+s));return n},e.prototype._getPositionBlock=function(t){return Math.round(t.x/this.blockSize)+","+Math.round(t.y/this.blockSize)},e.prototype._getExtendedNeighborBlocks=function(t){for(var e=t.split(",").map(Number),i=e[0],o=e[1],n=[],a=-2;a<=2;a++)for(var s=-2;s<=2;s++)n.push(i+a+","+(o+s));return n},e.prototype._getSpawnPositionsInBlock=function(t){for(var e=t.split(",").map(Number),i=e[0],o=e[1],n=new cc.Vec2(i*this.blockSize,o*this.blockSize),a=[],s=0;s<this.objectsPerBlock;s++){var r=n.x+Math.random()*this.blockSize-this.blockSize/2,c=n.y+Math.random()*this.blockSize-this.blockSize/2;a.push(cc.v2(r,c))}return a},e.prototype._spawnObjectAtPosition=function(t){var e=this._objectPool.get();e||(e=new cc.Node).addComponent(cc.Sprite),e.parent=this.node,e.setPosition(t.x,t.y,0),e.scale=1.2;var i=e.getComponent(cc.Sprite),o=this._getRandomIntInRange(0,this.objects.length-1);return i&&(i.spriteFrame=this.objects[o]),e},e.prototype._getRandomIntInRange=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t},e.prototype._removeObjectsInBlock=function(t){var e=this._spawnedBlocks.get(t);if(e)for(var i=0,o=e;i<o.length;i++){var n=o[i];this._objectPool.put(n)}},__decorate([a([cc.SpriteFrame])],e.prototype,"objects",void 0),__decorate([a],e.prototype,"blockSize",void 0),__decorate([a],e.prototype,"objectsPerBlock",void 0),__decorate([n],e)}(cc.Component);i.HuntEvolutionMapSpawner=s,cc._RF.pop()},{}],huntEvolutionModel:[function(t,e,i){"use strict";cc._RF.push(e,"79aa7yroGpF4qmxMTImPzRr","huntEvolutionModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/huntEvolution/huntEvolutionMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.huntEvolution)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],huntEvolutionPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"01c9ar09fBOTacawrLxMIIx","huntEvolutionPlayer"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("./huntEvolutionSkillManager")),n=cc._decorator,a=n.ccclass,s=(n.property,function(t){function e(){var e=t.call(this)||this;return e.position=cc.v2(0,0),e.sprite=null,e.moveDir=cc.v2(0,0),e.spine=null,e.gameInstance=null,e.skillManager=new o.default,e._invincibilityTime=0,e._maxHP=100,e.HP=100,e.hurtCount=0,e._extraHP=0,e.state="run",e}return __extends(e,t),Object.defineProperty(e.prototype,"HPProgress",{get:function(){return this.HP/this._maxHP},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gameInstance?(this.skillManager=this.gameInstance.skillManager,this.spine=this.node.getComponent(sp.Skeleton),this.spine?(this.spine.setAnimation(0,"run",!0),this.state="run"):(this.sprite=this.node.addComponent(cc.Sprite),this.gameInstance.playerSprite&&(this.sprite.spriteFrame=this.gameInstance.playerSprite),this.node.setContentSize(50,50),this.node.color=cc.Color.BLUE)):this.destroy()},e.prototype.update=function(t){if(this.skillManager.isPause)this.spine&&(this.spine.paused=!0);else{this.spine&&(this.spine.paused=!1),this.skillManager.playerRecoveryHealth>this._extraHP&&(this.HP+=this.skillManager.playerRecoveryHealth,this.HP>100&&(this.HP=100),this._extraHP=this.skillManager.playerRecoveryHealth);var e=this.skillManager.playerMoveSpeed+this.hurtCount*this.skillManager.hurtBoostedMoveSpeed;this.spine&&(this.moveDir.x<0&&(this.node.scaleX=-1),this.moveDir.x>0&&(this.node.scaleX=1),this.moveDir.mag()<.1?("run"==this.state&&(this.spine.setAnimation(0,"idle",!0),this.state="idle"),this.spine.timeScale=1):("idle"==this.state&&(this.spine.setAnimation(0,"run",!0),this.state="run"),this.spine.timeScale=e/200)),this.position=this.position.add(this.moveDir.mul(t*e))}},e.prototype.fireAni=function(){},e.prototype.onHit=function(){var t=this;this._invincibilityTime>0||(Math.random()>Math.min(.9,this.skillManager.playerDodgeProbability+this.hurtCount*this.skillManager.hurtBoostedDodge)&&(this.HP-=20,this.hurtCount++,this.skillManager.playerHurtCount=this.hurtCount),this._invincibilityTime=1,cc.tween(this.node).repeat(5,cc.tween().to(.1,{opacity:0}).to(.1,{opacity:255})).call(function(){t._invincibilityTime=0}).start())},__decorate([a],e)}(cc.Component));i.default=s,cc._RF.pop()},{"./huntEvolutionSkillManager":"huntEvolutionSkillManager"}],huntEvolutionSkillBoard:[function(t,e,i){"use strict";cc._RF.push(e,"4bd2eYpBjNGS5BwG6tICXEl","huntEvolutionSkillBoard"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skillItem=null,e.firstItemPosition=cc.v2(0,0),e.ItemInterval=0,e.iconFrame=[],e.items=[],e.gameInstance=null,e.confirmButListeners=[],e}return __extends(e,t),e.prototype.start=function(){},e.prototype.init=function(t){var e=this;if(cc.log(t.length),this.skillItem&&this.gameInstance){this.items=[],this.confirmButListeners=[];for(var i=function(i){var n=cc.instantiate(o.skillItem);o.items.push(n),n.parent=o.node,n.setPosition(o.firstItemPosition.add(cc.v2(0,i*o.ItemInterval)));var a=n.getChildByName("name").getComponent(cc.Label),s=n.getChildByName("text").getComponent(cc.Label),r=n.getChildByName("icon").getComponent(cc.Sprite),c=n.getChildByName("confirm");if(!a||!s||!c)return{value:void 0};a.string=t[i].name;var l=s;l.enableWrapText=!0,l.string=t[i].text,r&&t[i].iconId<o.iconFrame.length&&-1!=t[i].iconId&&(r.spriteFrame=o.iconFrame[t[i].iconId]);var h=function(){e.confirmDialog(i)};c.on(cc.Node.EventType.TOUCH_END,h,o),o.confirmButListeners[i]=h},o=this,n=0;n<t.length;n++){var a=i(n);if("object"==typeof a)return a.value}}},e.prototype.confirmDialog=function(t){this.offBind(),this.gameInstance&&this.gameInstance.skillBoardClose(t)},e.prototype.offBind=function(){for(var t=0;t<this.items.length;t++){var e=this.items[t].getChildByName("confirm"),i=this.confirmButListeners[t];e.off(cc.Node.EventType.TOUCH_END,i,this),this.items[t].destroy()}this.items=[],this.confirmButListeners=[]},__decorate([a(cc.Prefab)],e.prototype,"skillItem",void 0),__decorate([a(cc.Vec2)],e.prototype,"firstItemPosition",void 0),__decorate([a],e.prototype,"ItemInterval",void 0),__decorate([a([cc.SpriteFrame])],e.prototype,"iconFrame",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],huntEvolutionSkillManager:[function(t,e,i){"use strict";var o;cc._RF.push(e,"e5bfdDK5aFDEZYXavr529eu","huntEvolutionSkillManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.HuntAttributes=i.HuntEvolutionSkillType=void 0,function(t){t[t.player=0]="player",t[t.enemy=1]="enemy"}(o=i.HuntEvolutionSkillType||(i.HuntEvolutionSkillType={}));var n=function(){function t(){this._skills=[],this._allowEnemySkills=[],this._allowSkills=[],this._selectingSkills=[],this._oriAttributes=new a,this._nowAttributes=new a,this.isPause=!1,this.currentEnemyCount=0,this.killEnemyCount=0,this.initPlayerSkills=0,this.initEnemySkills=0,this.playerHurtCount=0,this._nowEXP=0,this.level=0,this.nextLevelEXP=100,this._nowTime=0,this.nextTime=20,this.enemyLevel=0}return t.prototype.addExp=function(){this._nowEXP+=this._nowAttributes.expFromEnemy*(1+this.expGainPercentage)},t.prototype.levelUp=function(){return(this._nowEXP>=this.nextLevelEXP||this.initPlayerSkills-- >0)&&(this.level++,cc.log("player",this.level),this._nowEXP=0,this.nextLevelEXP=1e3*Math.pow(1.2,this.level),!0)},Object.defineProperty(t.prototype,"EXPProgress",{get:function(){return this._nowEXP/this.nextLevelEXP},enumerable:!1,configurable:!0}),t.prototype.enemyUp=function(t){return this._nowTime+=t,(this._nowTime>=this.nextTime||this.initEnemySkills-- >0)&&(this._nowTime=0,this.enemyLevel++,cc.log("enemy",this.enemyLevel),20==this.enemyLevel?this.nextTime=180:this.nextTime=17+2*this.enemyLevel,!0)},Object.defineProperty(t.prototype,"enemyTimeProgress",{get:function(){return this._nowTime/this.nextTime},enumerable:!1,configurable:!0}),t.prototype.init=function(){this._allowSkills=[new s,new d,new b,new M,new B,new E,new D,new V,new K,new X,new $,new it],this._allowEnemySkills=[new at,new ht,new ft,new Pt]},t.prototype.getSelectSkills=function(t){if(t==o.player)for(;this._selectingSkills.length<3&&this._allowSkills.length>0;){var e=Math.floor(Math.random()*this._allowSkills.length),i=this._allowSkills.splice(e,1)[0];this._selectingSkills.push(i)}if(t==o.enemy)for(;this._selectingSkills.length<1&&this._allowEnemySkills.length>0;)e=Math.floor(Math.random()*this._allowEnemySkills.length),i=this._allowEnemySkills.splice(e,1)[0],this._selectingSkills.push(i);return this._selectingSkills},t.prototype.selectSkill=function(t,e){var i=this._selectingSkills.splice(t,1)[0];for(e==o.player&&i.beSelected(this._allowSkills),e==o.enemy&&i.beSelected(this._allowEnemySkills),this._skills.push(i);this._selectingSkills.length;)e==o.player&&this._allowSkills.push(this._selectingSkills.pop()),e==o.enemy&&this._allowEnemySkills.push(this._selectingSkills.pop())},t.prototype.isIn=function(t,e){return t.some(function(t){return t instanceof e})},t.prototype.areIn=function(t,e){for(var i=0,o=e;i<o.length;i++){var n=o[i];if(!this.isIn(t,n))return!1}return!0},t.prototype.orIn=function(t,e){for(var i=0,o=e;i<o.length;i++){var n=o[i];if(this.isIn(t,n))return!0}return!1},t.prototype.update=function(){this._nowAttributes=new a;for(var t=0,e=this._skills;t<e.length;t++){var i=e[t];i.activate(this._oriAttributes,this._nowAttributes),-1==i.iconId&&(this._nowAttributes.enemyMaxHP*=1.03)}this._nowAttributes.isHurtBoostSkill&&(this._allowSkills=this._allowSkills.filter(function(t){return!(t instanceof u||t instanceof l||t instanceof L)})),__spreadArrays(this._skills,this._allowSkills),this.orIn(this._skills,[h,x])?this._allowSkills=this._allowSkills.filter(function(t){return!(t instanceof h||t instanceof x)}):(this.isIn(this._allowSkills,h)||this.areIn(this._skills,[l,v,S,J])&&(cc.log("\u672b\u65e5\u94c1\u62f3"),this._allowSkills.push(new h)),this.isIn(this._allowSkills,x)||this.areIn(this._skills,[b,Z,C])&&(cc.log("\u5b64\u661f\u5206\u88c2\u5f39"),this._allowSkills.push(new x)))},Object.defineProperty(t.prototype,"bulletCount",{get:function(){var t=this._nowAttributes.firedBulletsCount;return t+=this._nowAttributes.firedBackBulletsCount,this._nowAttributes.circularFireChance&&(t+=72/this._nowAttributes.circularFireInterval/this.fireRate),this._nowAttributes.machineGunIncreasedFireInterval&&(t+=this._nowAttributes.machineGunBurstCount/this._nowAttributes.machineGunIncreasedFireInterval/this.fireRate),Math.floor(t*(1+this._nowAttributes.totalBulletMul))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playerMoveSpeed",{get:function(){return this._nowAttributes.playerMoveSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playerRecoveryHealth",{get:function(){return this._nowAttributes.playerRecoveryHealth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firedBulletsCount",{get:function(){return this._nowAttributes.isLonelyStar?0:this._nowAttributes.firedBulletsCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firedBackBulletsCount",{get:function(){return this._nowAttributes.isLonelyStar?0:this._nowAttributes.firedBackBulletsCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heldWeaponsCount",{get:function(){return this._nowAttributes.heldWeaponsCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bulletDamage",{get:function(){return this._nowAttributes.bulletDamage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bulletPenetration",{get:function(){return this._nowAttributes.bulletPenetration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"splitBulletCount",{get:function(){return this._nowAttributes.splitBulletCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"splitBulletDamagePercentage",{get:function(){return this._nowAttributes.splitBulletDamagePercentage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"splitBulletCountLv2",{get:function(){return this._nowAttributes.splitBulletCountLv2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"splitBulletDamagePercentageLv2",{get:function(){return this._nowAttributes.splitBulletDamagePercentageLv2*this._nowAttributes.splitBulletDamagePercentage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"knockBackDistance",{get:function(){return this._nowAttributes.knockBackDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fireRate",{get:function(){var t=this._nowAttributes.fireRate;return this.isLonelyStar&&(t+=t*this._nowAttributes.burstFireChance*this._nowAttributes.burstFireCount),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bulletRange",{get:function(){return Math.max(.1*this._oriAttributes.bulletRange,this._nowAttributes.bulletRange)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bulletSpreadAngle",{get:function(){return Math.max(10,this._nowAttributes.bulletSpreadAngle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"aimingShakeAngle",{get:function(){return Math.max(0,this._nowAttributes.aimingShakeAngle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bulletSpeed",{get:function(){return this._nowAttributes.bulletSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expRange",{get:function(){return this._nowAttributes.expRange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"criticalRate",{get:function(){return this._nowAttributes.criticalRate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"criticalDamage",{get:function(){return this._nowAttributes.criticalDamage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bulletSize",{get:function(){return this._nowAttributes.bulletSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bulletScale",{get:function(){return this._nowAttributes.bulletSize/this._oriAttributes.bulletSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hurtBoostedMoveSpeed",{get:function(){return this._nowAttributes.hurtBoostedMoveSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"circularFireChance",{get:function(){return this._nowAttributes.isLonelyStar?0:this._nowAttributes.circularFireChance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"circularFireInterval",{get:function(){return this._nowAttributes.circularFireInterval},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"slowdownProbability",{get:function(){return this._nowAttributes.slowdownProbability},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"slowdownPercentage",{get:function(){return this._nowAttributes.slowdownPercentage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"slowdownDuration",{get:function(){return this._nowAttributes.slowdownDuration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shrapnelSpawnChance",{get:function(){return this._nowAttributes.shrapnelSpawnChance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shrapnelCount",{get:function(){return this._nowAttributes.shrapnelCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enemyLowHpThreshold",{get:function(){return this._nowAttributes.enemyLowHpThreshold},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"extraLowHpDamagePercentage",{get:function(){return this._nowAttributes.extraLowHpDamagePercentage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hurtBoostedDamage",{get:function(){return this._nowAttributes.hurtBoostedDamage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"burstFireChance",{get:function(){return this._nowAttributes.burstFireChance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"burstFireCount",{get:function(){return this._nowAttributes.burstFireCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stationaryFireRateIncrease",{get:function(){return this._nowAttributes.stationaryFireRateIncrease},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"damageIncreaseOnPierce",{get:function(){return this._nowAttributes.damageIncreaseOnPierce},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isNoPierceCountOnKill",{get:function(){return this._nowAttributes.isNoPierceCountOnKill},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trackingAngularSpeed",{get:function(){return this._nowAttributes.trackingAngularSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enemyInstantKillPercentage",{get:function(){return this._nowAttributes.enemyInstantKillPercentage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expGainPercentage",{get:function(){return this._nowAttributes.expGainPercentage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"directExpGainChance",{get:function(){return this._nowAttributes.directExpGainChance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"critNoPenetrationChance",{get:function(){return this._nowAttributes.critNoPenetrationChance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCenterHitCrit",{get:function(){return this._nowAttributes.isCenterHitCrit},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sniperBulletMultiplier",{get:function(){return this._nowAttributes.sniperBulletMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"machineGunBurstCount",{get:function(){return this._nowAttributes.isLonelyStar?0:this._nowAttributes.machineGunBurstCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sniperIncreasedFireInterval",{get:function(){return this._nowAttributes.sniperIncreasedFireInterval},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"machineGunIncreasedFireInterval",{get:function(){return this._nowAttributes.machineGunIncreasedFireInterval},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOneByOne",{get:function(){return this._nowAttributes.isOneByOne},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isInfiniteSplit",{get:function(){return this._nowAttributes.isInfiniteSplit},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playerDodgeProbability",{get:function(){return this._nowAttributes.playerDodgeProbability},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hurtBoostedDodge",{get:function(){return this._nowAttributes.hurtBoostedDodge},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isZoomEX",{get:function(){return this._nowAttributes.isZoomEX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exSpeedToShoot",{get:function(){var t=(this._nowAttributes.playerMoveSpeed+this.playerHurtCount*this._nowAttributes.hurtBoostedMoveSpeed)/this._oriAttributes.playerMoveSpeed-1;return(t=Math.max(0,t))*this._nowAttributes.exSpeedToShoot},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"damageBasedOnCurrentHealth",{get:function(){return this._nowAttributes.damageBasedOnCurrentHealth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"damageBasedOnTotalHealth",{get:function(){return this._nowAttributes.damageBasedOnTotalHealth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEliteTarget",{get:function(){return this._nowAttributes.isEliteTarget},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLonelyStar",{get:function(){return this._nowAttributes.isLonelyStar},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewScale",{get:function(){return this._nowAttributes.viewScale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enemyMaxHP",{get:function(){return this._nowAttributes.enemyMaxHP*(1+this.killEnemyCount*this.healthIncreasePerDeath)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enemySpeed",{get:function(){return this._nowAttributes.enemySpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enemySpawnRate",{get:function(){var t=this.currentEnemyCount/this.maxEnemyCount,e=Math.pow(1-t,2);return Math.max(4*this._nowAttributes.enemySpawnRate*e,.3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxEnemyCount",{get:function(){return this._nowAttributes.maxEnemyCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expFromEnemy",{get:function(){return this._nowAttributes.expFromEnemy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groupEnemySpawnChance",{get:function(){return this._nowAttributes.groupEnemySpawnChance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groupEnemyCount",{get:function(){return this._nowAttributes.groupEnemyCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"EnemyDamageReduction",{get:function(){return this._nowAttributes.maxEnemyDamageReductionBasedOnCount*(1-this.currentEnemyCount/this.maxEnemyCount)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enemyRespawnOnDeathProbability",{get:function(){return this._nowAttributes.enemyRespawnOnDeathProbability},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enemySpawnNearPlayerProbability",{get:function(){return this._nowAttributes.enemySpawnNearPlayerProbability},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highHpEliteSpawnProbability",{get:function(){return this._nowAttributes.highHpEliteSpawnProbability},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highHpEliteHealth",{get:function(){return this._nowAttributes.highHpEliteHealth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"healthIncreasePerDeath",{get:function(){return this._nowAttributes.healthIncreasePerDeath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enemyDodgeProbability",{get:function(){return this._nowAttributes.enemyDodgeProbability},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"suicideEliteSpawnProbability",{get:function(){return this._nowAttributes.suicideEliteSpawnProbability},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"suicideEliteSpeed",{get:function(){return this._nowAttributes.suicideEliteSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speedIncreaseBasedOnDistance",{get:function(){return this._nowAttributes.speedIncreaseBasedOnDistance},enumerable:!1,configurable:!0}),t}();i.default=n;var a=function(){function t(){this.playerMoveSpeed=100,this.playerRecoveryHealth=0,this.firedBulletsCount=1,this.firedBackBulletsCount=0,this.heldWeaponsCount=1,this.bulletDamage=10,this.bulletPenetration=1,this.splitBulletCount=0,this.splitBulletDamagePercentage=0,this.splitBulletCountLv2=0,this.splitBulletDamagePercentageLv2=0,this.knockBackDistance=40,this.fireRate=1.5,this.bulletRange=300,this.bulletSpreadAngle=0,this.aimingShakeAngle=20,this.bulletSpeed=600,this.expRange=200,this.criticalRate=0,this.criticalDamage=1,this.bulletSize=10,this.hurtBoostedMoveSpeed=0,this.circularFireChance=0,this.slowdownProbability=0,this.slowdownPercentage=0,this.slowdownDuration=0,this.shrapnelSpawnChance=0,this.shrapnelCount=0,this.enemyLowHpThreshold=0,this.extraLowHpDamagePercentage=0,this.hurtBoostedDamage=0,this.burstFireChance=0,this.burstFireCount=0,this.stationaryFireRateIncrease=0,this.damageIncreaseOnPierce=0,this.isNoPierceCountOnKill=!1,this.trackingAngularSpeed=0,this.enemyInstantKillPercentage=0,this.expGainPercentage=0,this.directExpGainChance=0,this.critNoPenetrationChance=0,this.isCenterHitCrit=!1,this.sniperBulletMultiplier=1,this.machineGunBurstCount=0,this.sniperIncreasedFireInterval=0,this.machineGunIncreasedFireInterval=0,this.isOneByOne=!1,this.isInfiniteSplit=!1,this.playerDodgeProbability=0,this.hurtBoostedDodge=0,this.circularFireInterval=5,this.isZoomEX=!1,this.exSpeedToShoot=0,this.damageBasedOnCurrentHealth=0,this.damageBasedOnTotalHealth=0,this.isEliteTarget=!1,this.isLonelyStar=!1,this.viewScale=1,this.totalBulletMul=0,this.enemyMaxHP=15,this.enemySpeed=60,this.enemySpawnRate=2,this.maxEnemyCount=200,this.expFromEnemy=100,this.groupEnemySpawnChance=0,this.groupEnemyCount=0,this.maxEnemyDamageReductionBasedOnCount=0,this.enemyRespawnOnDeathProbability=0,this.enemySpawnNearPlayerProbability=0,this.highHpEliteSpawnProbability=0,this.highHpEliteHealth=0,this.healthIncreasePerDeath=0,this.enemyDodgeProbability=0,this.suicideEliteSpawnProbability=0,this.suicideEliteSpeed=0,this.speedIncreaseBasedOnDistance=0,this.isHurtBoostSkill=!1}return t.prototype.copy=function(){return JSON.parse(JSON.stringify(this))},t}();i.HuntAttributes=a;var s=function(){function t(){this.name="\u75be\u98ce\u4e4b\u7ffcLv1",this.num=20,this.text="\u63d0\u9ad8\u89d2\u8272"+this.num+"%\u79fb\u52a8\u901f\u5ea6",this.iconId=10}return t.prototype.activate=function(t,e){e.playerMoveSpeed+=t.playerMoveSpeed*this.num/100},t.prototype.beSelected=function(t){t.push(new r)},t}(),r=function(){function t(){this.name="\u75be\u98ce\u4e4b\u7ffcLv2",this.num=30,this.text="\u63d0\u9ad8\u89d2\u8272"+this.num+"%\u79fb\u52a8\u901f\u5ea6",this.iconId=10}return t.prototype.activate=function(t,e){e.playerMoveSpeed+=t.playerMoveSpeed*this.num/100},t.prototype.beSelected=function(t){t.push(new c,new l)},t}(),c=function(){function t(){this.name="\u75be\u98ce\u4e4b\u7ffcLvMax",this.num1=20,this.num2=10,this.text="\u63d0\u9ad8\u89d2\u8272"+this.num1+"%\u79fb\u52a8\u901f\u5ea6,\u63d0\u9ad8"+this.num2+"%\u95ea\u907f",this.iconId=10}return t.prototype.activate=function(t,e){e.playerMoveSpeed+=t.playerMoveSpeed*this.num1/100,e.playerDodgeProbability+=this.num2/100},t.prototype.beSelected=function(t){t.push(new u)},t}(),l=function(){function t(){this.name="\u75be\u98ce\u4e4b\u7ffc-\u6781\u901f",this.num2=20,this.text="EX\u524d\u7f6e\u6280\u80fd\u3002\u6bcf\u6b21\u53d7\u4f24\u6c38\u4e45\u589e\u52a0"+this.num2+"%\u79fb\u52a8\u901f\u5ea6\uff0c\u5305\u62ec\u83b7\u5f97\u6b64\u6280\u80fd\u4e4b\u524d\u7684\u53d7\u4f24\u6b21\u6570,\u4e0e\u540c\u7c7b\u6280\u80fd\u4e92\u65a5",this.iconId=10}return t.prototype.activate=function(t,e){e.hurtBoostedMoveSpeed+=this.num2/100*t.playerMoveSpeed,e.isHurtBoostSkill=!0},t.prototype.beSelected=function(){},t}(),h=function(){function t(){this.name="EX:\u75be\u901f\u94c1\u62f3",this.num1=1.2,this.num2=90,this.num3=200,this.text="\u79fb\u52a8\u65f6\u6bcf\u989d\u59161%\u79fb\u901f\u589e\u52a0"+this.num1+"%\u5c04\u901f\uff0c\u9759\u6b62\u65f6\u964d\u4f4e"+this.num2+"%\u5c04\u901f\uff0c\u5b50\u5f39\u5c04\u51fb\u65b9\u5411\u4e3a\u79fb\u52a8\u65b9\u5411\uff0c\u6240\u6709\u666e\u901a\u5b50\u5f39\u53d8\u4e3a\u72d9\u51fb\u67aa\u5b50\u5f39\uff0c\u51fb\u9000\u8ddd\u79bb\u63d0\u5347"+this.num2+"%\uff0c\u5c04\u7a0b\u964d\u4f4e"+this.num3+"%,\u5b50\u5f39\u98de\u884c\u901f\u5ea6\u589e\u52a0"+this.num2+"%,\u589e\u52a0\u4f4d\u7f6e\u6269\u6563",this.iconId=10}return t.prototype.activate=function(t,e){e.isZoomEX=!0,e.exSpeedToShoot+=this.num1*t.fireRate,e.stationaryFireRateIncrease-=this.num2/100*t.fireRate,e.knockBackDistance+=t.knockBackDistance*this.num2/100,e.bulletRange-=t.bulletRange*this.num3/100,e.bulletSpeed+=t.bulletSpeed*this.num2/100},t.prototype.beSelected=function(){},t}(),u=function(){function t(){this.name="\u75be\u98ce\u4e4b\u7ffc-\u5e7d\u7075",this.num2=10,this.text="\u6bcf\u6b21\u53d7\u4f24\u6c38\u4e45\u589e\u52a0"+this.num2+"%\u95ea\u907f(\u4e0a\u965090%\uff09\uff0c\u5305\u62ec\u83b7\u5f97\u6b64\u6280\u80fd\u4e4b\u524d\u7684\u53d7\u4f24\u6b21\u6570,\u4e0e\u540c\u7c7b\u6280\u80fd\u4e92\u65a5",this.iconId=10}return t.prototype.activate=function(t,e){e.hurtBoostedDodge+=this.num2/100,e.isHurtBoostSkill=!0},t.prototype.beSelected=function(){},t}(),d=function(){function t(){this.name="\u591a\u91cd\u706b\u529bLv1",this.num1=20,this.num2=10,this.text="\u4e3b\u6b66\u5668\u591a\u53d1\u5c041\u9897\u5b50\u5f39,\u6269\u6563\u89d2\u5ea6+"+this.num1+",\u5b50\u5f39\u4f24\u5bb3\u51cf\u5c11"+this.num2+"%",this.iconId=8}return t.prototype.activate=function(t,e){e.firedBulletsCount++,e.bulletSpreadAngle+=this.num1,e.bulletDamage-=this.num2/100*t.bulletDamage},t.prototype.beSelected=function(t){t.push(new p)},t}(),p=function(){function t(){this.name="\u591a\u91cd\u706b\u529bLv2",this.num1=20,this.num2=10,this.text="\u4e3b\u6b66\u5668\u591a\u53d1\u5c041\u9897\u5b50\u5f39,\u6269\u6563\u89d2\u5ea6+"+this.num1+",\u5b50\u5f39\u4f24\u5bb3\u51cf\u5c11"+this.num2+"%",this.iconId=8}return t.prototype.activate=function(t,e){e.firedBulletsCount++,e.bulletSpreadAngle+=this.num1,e.bulletDamage-=this.num2/100*t.bulletDamage},t.prototype.beSelected=function(t){t.push(new m,new v,new y)},t}(),m=function(){function t(){this.name="\u591a\u91cd\u706b\u529bLvMax",this.num1=15,this.text="\u4e3b\u6b66\u5668\u591a\u53d1\u5c041\u9897\u5b50\u5f39,\u6269\u6563\u89d2\u5ea6+"+this.num1,this.iconId=8}return t.prototype.activate=function(t,e){e.firedBulletsCount+=1,e.bulletSpreadAngle+=this.num1},t.prototype.beSelected=function(t){t.push(new f)},t}(),f=function(){function t(){this.name="\u5168\u65b9\u4f4d\u706b\u529bLv1",this.num1=5,this.num3=10,this.text="\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u56f4\u7ed5\u81ea\u5df1\u53d1\u5c04\u5927\u91cf\u7684\u5b50\u5f39",this.iconId=8}return t.prototype.activate=function(t,e){e.circularFireInterval=5,e.circularFireChance+=this.num3/100},t.prototype.beSelected=function(t){t.push(new g)},t}(),g=function(){function t(){this.name="\u5168\u65b9\u4f4d\u706b\u529bLv2",this.num1=2,this.num3=10,this.text="EX\u524d\u7f6e\u6280\u80fd\u3002\u56f4\u7ed5\u5c04\u51fb\u7684\u95f4\u9694\u7f29\u77ed",this.iconId=8}return t.prototype.activate=function(t,e){e.circularFireInterval-=1.5,e.circularFireChance+=this.num3/100},t.prototype.beSelected=function(t){t.push(new _)},t}(),_=function(){function t(){this.name="EX:\u5168\u65b9\u4f4d\u65e0\u95f4\u9694\u706b\u529b",this.num3=10,this.text="\u65e0\u95f4\u9694\u7684\u56f4\u7ed5\u5c04\u51fb",this.iconId=8}return t.prototype.activate=function(t,e){e.circularFireChance+=this.num3/100,e.circularFireInterval-=1.5},t.prototype.beSelected=function(){},t}(),y=function(){function t(){this.name="\u591a\u91cd\u706b\u529b-\u53cd\u5411",this.text="\u8eab\u540e\u53d1\u5c041\u9897\u5b50\u5f39",this.iconId=8}return t.prototype.activate=function(t,e){e.firedBackBulletsCount++},t.prototype.beSelected=function(){},t}(),v=function(){function t(){this.name="\u591a\u91cd\u706b\u529b-\u8fde\u7ef5\u4e0d\u7edd",this.num1=20,this.num2=15,this.text="\u4e3b\u6b66\u5668\u591a\u53d1\u5c042\u9897\u5b50\u5f39,\u5b50\u5f39\u4f24\u5bb3\u51cf\u5c11"+this.num2+"%,\u5b50\u5f39\u53d1\u5c04\u65b9\u5f0f\u4e3a\u4e00\u53d1\u63a5\u7740\u4e00\u53d1,\u6269\u6563\u6539\u4e3a\u56fa\u5b9a\u7684\u4f4d\u7f6e\u6269\u6563\u548c\u89d2\u5ea6\u6269\u6563",this.iconId=8}return t.prototype.activate=function(t,e){e.firedBulletsCount+=2,e.bulletSpreadAngle-=this.num1,e.bulletDamage-=this.num2/100*t.bulletDamage,e.isOneByOne=!0},t.prototype.beSelected=function(){},t}(),b=function(){function t(){this.name="\u989d\u5916\u6b66\u5668Lv1",this.num=15,this.num2=150,this.num3=190,this.text="\u7784\u51c6\u6296\u52a8\u89d2\u5ea6+"+this.num+",\u589e\u52a0\u4e00\u628a\u72d9\u51fb\u67aa,\u5c04\u7a0b\u3001\u5b50\u5f39\u5927\u5c0f\u3001\u7a7f\u900f\u589e\u52a0"+this.num2+"%,\u5c04\u51fb\u95f4\u9694\u589e\u52a0"+this.num3+"%,\u4f1a\u968f\u673a\u7684\u7784\u51c6\u654c\u4eba",this.iconId=7}return t.prototype.activate=function(t,e){e.heldWeaponsCount++,e.aimingShakeAngle+=this.num,e.sniperBulletMultiplier+=this.num2/100,e.sniperIncreasedFireInterval+=this.num3/100},t.prototype.beSelected=function(t){t.push(new P)},t}(),P=function(){function t(){this.name="\u989d\u5916\u6b66\u5668Lv2",this.num=15,this.num2=3,this.num3=130,this.text="\u7784\u51c6\u6296\u52a8\u89d2\u5ea6+"+this.num+",\u589e\u52a0\u4e00\u628a\u8fde\u5c04\u673a\u67aa,\u8fde\u5c04"+this.num2+"\u53d1\u5b50\u5f39,\u5c04\u51fb\u95f4\u9694\u589e\u52a0"+this.num3+"%,\u4f1a\u968f\u673a\u7684\u7784\u51c6\u654c\u4eba",this.iconId=7}return t.prototype.activate=function(t,e){e.heldWeaponsCount++,e.aimingShakeAngle+=this.num,e.machineGunBurstCount+=this.num2,e.machineGunIncreasedFireInterval+=this.num3/100},t.prototype.beSelected=function(t){t.push(new S)},t}(),S=function(){function t(){this.name="\u989d\u5916\u6b66\u5668LvMax",this.num=15,this.num2=150,this.num3=2,this.text="\u7784\u51c6\u6296\u52a8\u89d2\u5ea6+"+this.num+",\u72d9\u51fb\u67aa\u589e\u5f3a\u7cfb\u6570+"+this.num2+"%,\u673a\u67aa\u8fde\u5c04\u5b50\u5f39+"+this.num3,this.iconId=7}return t.prototype.activate=function(t,e){e.aimingShakeAngle+=this.num,e.sniperBulletMultiplier+=this.num2/100,e.machineGunBurstCount+=this.num3},t.prototype.beSelected=function(){},t}(),M=function(){function t(){this.name="\u5206\u88c2\u5f39\u5e55Lv1",this.num1=3,this.num2=15,this.text="\u654c\u4eba\u88ab\u4e3b\u6b66\u5668\u5b50\u5f39\u51fb\u6740\u65f6\u4f1a\u91ca\u653e"+this.num1+"\u4e2a\u5206\u88c2\u5b50\u5f39,\u4f24\u5bb3\u7b49\u5404\u79cd\u6548\u679c\u7684\u521d\u59cb\u7cfb\u6570\u4e3a"+this.num2+"%",this.iconId=13}return t.prototype.activate=function(t,e){e.splitBulletCount+=this.num1,e.splitBulletDamagePercentage+=this.num2/100},t.prototype.beSelected=function(t){t.push(new w)},t}(),w=function(){function t(){this.name="\u5206\u88c2\u5f39\u5e55Lv2",this.num1=1,this.num2=10,this.text="\u5206\u88c2\u5b50\u5f39\u589e\u52a0"+this.num1+"\u4e2a,\u4f24\u5bb3\u7cfb\u6570\u589e\u52a0"+this.num2+"%",this.iconId=13}return t.prototype.activate=function(t,e){e.splitBulletCount+=this.num1,e.splitBulletDamagePercentage+=this.num2/100},t.prototype.beSelected=function(t){t.push(new k,new C)},t}(),k=function(){function t(){this.name="\u5206\u88c2\u5f39\u5e55LvMax",this.num1=-1,this.num2=40,this.text="\u5206\u88c2\u5b50\u5f39"+this.num1+"\u4e2a,\u4f24\u5bb3\u7cfb\u6570\u589e\u52a0"+this.num2+"%",this.iconId=13}return t.prototype.activate=function(t,e){e.splitBulletCount+=this.num1,e.splitBulletDamagePercentage+=this.num2/100},t.prototype.beSelected=function(){},t}(),C=function(){function t(){this.name="\u5206\u88c2\u5f39\u5e55-\u88c2\u53d8",this.text="EX\u524d\u7f6e\uff0c\u654c\u4eba\u88ab\u4efb\u4f55\u5b50\u5f39\u51fb\u6740\u90fd\u53ef\u4ee5\u5206\u88c2\u51fa\u5b50\u5f39",this.iconId=13}return t.prototype.activate=function(t,e){e.isInfiniteSplit=!0},t.prototype.beSelected=function(t){t.push()},t}(),x=function(){function t(){this.name="EX:\u5b64\u661f\u5206\u88c2\u5f39",this.num1=120,this.num2=40,this.num3=120,this.num4=25,this.text="\u53ea\u4fdd\u7559\u72d9\u51fb\u67aa\uff0c\u5176\u4f59\u5b50\u5f39\u6362\u7b97\u4e3a\u72d9\u51fb\u5b50\u5f39\u6d88\u5931\u65f6\u91ca\u653e\u7684\u666e\u901a\u5b50\u5f39\u6570\u76ee\uff0c\u5b50\u5f39\u603b\u6570\u76ee\u589e\u52a0"+this.num4+"%\uff0c\u5c04\u7a0b\u589e\u52a0"+this.num1+"%\uff0c\u5b50\u5f39\u98de\u884c\u901f\u5ea6\u589e\u52a0"+this.num2+"%\uff0c\u5927\u5e45\u589e\u52a0\u5b50\u5f39\u8ffd\u8e2a\u80fd\u529b",this.iconId=13}return t.prototype.activate=function(t,e){e.isLonelyStar=!0,e.bulletRange+=t.bulletRange*this.num1/100,e.bulletSpeed+=t.bulletSpeed*this.num2/100,e.trackingAngularSpeed+=this.num3,e.totalBulletMul+=this.num4/100},t.prototype.beSelected=function(){},t}(),B=function(){function t(){this.name="\u9707\u8361\u51b2\u51fbLv1",this.num=40,this.text="\u589e\u52a0"+this.num+"%\u7684\u51fb\u9000\u8ddd\u79bb",this.iconId=1}return t.prototype.activate=function(t,e){e.knockBackDistance+=t.knockBackDistance*this.num/100},t.prototype.beSelected=function(t){t.push(new T)},t}(),T=function(){function t(){this.name="\u9707\u8361\u51b2\u51fbLv2",this.num1=30,this.num2=20,this.num3=50,this.num4=3,this.text="\u589e\u52a0"+this.num1+"%\u7684\u51fb\u9000\u8ddd\u79bb,\u6709"+this.num2+"%\u51e0\u7387\u4f7f\u654c\u4eba\u79fb\u52a8\u901f\u5ea6\u964d\u4f4e"+this.num3+"%\u6301\u7eed"+this.num4+"\u79d2",this.iconId=1}return t.prototype.activate=function(t,e){e.knockBackDistance+=t.knockBackDistance*this.num1/100,e.slowdownDuration+=this.num4,e.slowdownProbability+=this.num2/100,e.slowdownPercentage+=this.num3/100},t.prototype.beSelected=function(t){t.push(new F)},t}(),F=function(){function t(){this.name="\u9707\u8361\u51b2\u51fbLvMax",this.num1=40,this.num2=20,this.num3=3,this.text="\u589e\u52a0"+this.num1+"%\u7684\u51fb\u9000\u8ddd\u79bb,\u547d\u4e2d\u654c\u4eba\u65f6\u6709"+this.num2+"\u51e0\u7387\u751f\u6210"+this.num3+"\u679a\u4ec5\u7528\u4e8e\u51fb\u9000\u7684\u51b2\u51fb\u5f39\u7247",this.iconId=1}return t.prototype.activate=function(t,e){e.knockBackDistance+=t.knockBackDistance*this.num1/100,e.shrapnelCount+=this.num3,e.shrapnelSpawnChance+=this.num2/100},t.prototype.beSelected=function(){},t}(),E=function(){function t(){this.name="\u5f3a\u5316\u5f39\u5934Lv1",this.num1=40,this.num2=10,this.text="\u589e\u52a0"+this.num1+"%\u7684\u4f24\u5bb3,\u964d\u4f4e"+this.num2+"%\u5c04\u901f",this.iconId=0}return t.prototype.activate=function(t,e){e.bulletDamage+=t.bulletDamage*this.num1/100,e.fireRate-=this.num2/100*t.fireRate},t.prototype.beSelected=function(t){t.push(new N)},t}(),N=function(){function t(){this.name="\u5f3a\u5316\u5f39\u5934Lv2",this.num1=50,this.num4=15,this.text="\u589e\u52a0"+this.num1+"%\u7684\u4f24\u5bb3\uff0c\u964d\u4f4e"+this.num4+"%\u5c04\u901f",this.iconId=0}return t.prototype.activate=function(t,e){e.bulletDamage+=t.bulletDamage*this.num1/100,e.fireRate-=this.num4/100*t.fireRate},t.prototype.beSelected=function(t){t.push(new I,new G)},t}(),G=function(){function t(){this.name="\u5f3a\u5316\u5f39\u5934-\u843d\u4e95\u4e0b\u77f3",this.num2=40,this.num3=35,this.text="\u5bf9\u8840\u91cf\u4f4e\u4e8e"+this.num2+"%\u7684\u654c\u4eba\u9020\u6210\u989d\u5916"+this.num3+"%\u4f24\u5bb3(\u72ec\u7acb\u4e58\u533a)",this.iconId=0}return t.prototype.activate=function(t,e){e.enemyLowHpThreshold=this.num2/100,e.extraLowHpDamagePercentage+=this.num3/100},t.prototype.beSelected=function(){},t}(),A=function(){function t(){this.name="\u5f3a\u5316\u5f39\u5934-\u7834\u8d25",this.num2=5,this.text="\u589e\u52a0\u57fa\u4e8e\u654c\u4eba\u5f53\u524d\u751f\u547d\u503c"+this.num2+"%\u4f24\u5bb3",this.iconId=0}return t.prototype.activate=function(t,e){e.damageBasedOnCurrentHealth+=this.num2/100},t.prototype.beSelected=function(){},t}(),R=function(){function t(){this.name="\u5f3a\u5316\u5f39\u5934-\u5de8\u4eba\u6740\u624b",this.num2=3,this.text="\u589e\u52a0\u57fa\u4e8e\u654c\u4eba\u603b\u751f\u547d\u503c"+this.num2+"%\u4f24\u5bb3",this.iconId=0}return t.prototype.activate=function(t,e){e.damageBasedOnTotalHealth+=this.num2/100},t.prototype.beSelected=function(){},t}(),I=function(){function t(){this.name="\u5f3a\u5316\u5f39\u5934LvMax",this.num1=60,this.num3=20,this.text="\u589e\u52a0"+this.num1+"%\u7684\u4f24\u5bb3\uff0c\u964d\u4f4e\u5c04\u901f"+this.num3+"%",this.iconId=0}return t.prototype.activate=function(t,e){e.bulletDamage+=t.bulletDamage*this.num1/100,e.fireRate-=this.num3/100*t.fireRate},t.prototype.beSelected=function(t){t.push(new L,new A,new R)},t}(),L=function(){function t(){this.name="\u5f3a\u5316\u5f39\u5934-\u66b4\u6012",this.num3=25,this.text="\u6bcf\u6b21\u53d7\u4f24\u6c38\u4e45\u589e\u52a0"+this.num3+"%\u4f24\u5bb3\uff0c\u5305\u62ec\u83b7\u5f97\u6b64\u6280\u80fd\u4e4b\u524d\u7684\u53d7\u4f24\u6b21\u6570,\u4e0e\u540c\u7c7b\u6280\u80fd\u4e92\u65a5",this.iconId=0}return t.prototype.activate=function(t,e){e.hurtBoostedDamage+=this.num3/100*t.bulletDamage,e.isHurtBoostSkill=!0},t.prototype.beSelected=function(){},t}(),D=function(){function t(){this.name="\u6025\u901f\u5c04\u51fbLv1",this.num=40,this.text="\u5c04\u901f\u63d0\u9ad8"+this.num+"%",this.iconId=4}return t.prototype.activate=function(t,e){e.fireRate+=t.fireRate*this.num/100},t.prototype.beSelected=function(t){t.push(new O)},t}(),O=function(){function t(){this.name="\u6025\u901f\u5c04\u51fbLv2",this.num1=50,this.num2=5,this.text="\u5c04\u901f\u63d0\u9ad8"+this.num1+"%,\u6bcf\u6b21\u5c04\u51fb\u65f6"+this.num2+"%\u51e0\u7387\u89e6\u53d1\u8fde\u5c04\u6548\u679c",this.iconId=4}return t.prototype.activate=function(t,e){e.fireRate+=t.fireRate*this.num1/100,e.burstFireChance+=this.num2/100,e.burstFireCount+=1},t.prototype.beSelected=function(t){t.push(new U,new z)},t}(),z=function(){function t(){this.name="\u6025\u901f\u5c04\u51fb-\u9ad8\u538b\u8fde\u5c04",this.num2=15,this.text="\u589e\u52a0\u6bcf\u6b21\u5c04\u51fb\u65f6"+this.num2+"%\u51e0\u7387\u89e6\u53d1\u8fde\u5c04\u6548\u679c\uff0c\u8fde\u5c04\u6b21\u6570+1",this.iconId=4}return t.prototype.activate=function(t,e){e.burstFireChance+=this.num2/100,e.burstFireCount+=1},t.prototype.beSelected=function(){},t}(),U=function(){function t(){this.name="\u6025\u901f\u5c04\u51fbLvMax",this.num1=70,this.text="\u5c04\u901f\u63d0\u9ad8"+this.num1+"%",this.iconId=4}return t.prototype.activate=function(t,e){e.fireRate+=t.fireRate*this.num1/100},t.prototype.beSelected=function(t){t.push(new H)},t}(),H=function(){function t(){this.name="\u6025\u901f\u5c04\u51fb-\u9759\u6001\u5c04\u51fb",this.num3=90,this.num1=120,this.text="\u79fb\u901f\u964d\u4f4e"+this.num3+"%,\u4e0d\u79fb\u52a8\u65f6\u5c04\u901f\u589e\u52a0"+this.num1+"%",this.iconId=4}return t.prototype.activate=function(t,e){e.stationaryFireRateIncrease+=this.num1/100*t.fireRate,e.playerMoveSpeed-=t.playerMoveSpeed*this.num3/100},t.prototype.beSelected=function(){},t}(),V=function(){function t(){this.name="\u7a7f\u900f\u4e4b\u529bLv1",this.num=15,this.text="\u5b50\u5f39\u7a7f\u900f\u654c\u4eba\u6570\u91cf+1,\u589e\u52a0"+this.num+"%\u5b50\u5f39\u98de\u884c\u901f\u5ea6",this.iconId=9}return t.prototype.activate=function(t,e){e.bulletPenetration+=1,e.bulletSpeed+=t.bulletSpeed*this.num/100},t.prototype.beSelected=function(t){t.push(new j)},t}(),j=function(){function t(){this.name="\u7a7f\u900f\u4e4b\u529bLv2",this.num1=15,this.text="\u5b50\u5f39\u7a7f\u900f\u654c\u4eba\u6570\u91cf+1,\u589e\u52a0"+this.num1+"%\u5b50\u5f39\u98de\u884c\u901f\u5ea6",this.iconId=9}return t.prototype.activate=function(t,e){e.bulletPenetration+=1,e.bulletSpeed+=t.bulletSpeed*this.num1/100},t.prototype.beSelected=function(t){t.push(new q,new W)},t}(),W=function(){function t(){this.name="\u7a7f\u900f\u4e4b\u529b-\u78e8\u783a",this.num2=20,this.text="\u6bcf\u7a7f\u8fc7\u4e00\u4e2a\u654c\u4eba\uff0c\u4f24\u5bb3\u589e\u52a0"+this.num2+"%",this.iconId=9}return t.prototype.activate=function(t,e){e.damageIncreaseOnPierce+=this.num2/100*t.bulletDamage},t.prototype.beSelected=function(){},t}(),q=function(){function t(){this.name="\u7a7f\u900f\u4e4b\u529bLvMax",this.num=15,this.text="\u5b50\u5f39\u7a7f\u900f\u654c\u4eba\u6570\u91cf+1,\u589e\u52a0"+this.num+"%\u5b50\u5f39\u98de\u884c\u901f\u5ea6,\u5f53\u76f4\u63a5\u51fb\u6740\u654c\u4eba\u65f6\u4e0d\u6d88\u8017\u7a7f\u900f\u6b21\u6570",this.iconId=9}return t.prototype.activate=function(t,e){e.bulletPenetration+=1,e.bulletSpeed+=t.bulletSpeed*this.num/100,e.isNoPierceCountOnKill=!0},t.prototype.beSelected=function(){},t}(),K=function(){function t(){this.name="\u751f\u547d\u56de\u590d",this.num=100,this.text="\u8840\u91cf\u56de\u6ee1",this.iconId=11}return t.prototype.activate=function(t,e){e.playerRecoveryHealth+=this.num},t.prototype.beSelected=function(e){e.push(new t)},t}(),X=function(){function t(){this.name="\u72e9\u730e\u4e4b\u77b3Lv1",this.num1=50,this.num2=20,this.num3=25,this.text="\u5c04\u7a0b\u63d0\u5347"+this.num1+"%,\u6269\u6563\u51cf\u5c11"+this.num2+"\uff0c\u7cbe\u786e\u5ea6\u589e\u52a0"+this.num3,this.iconId=6}return t.prototype.activate=function(t,e){e.bulletRange+=t.bulletRange*this.num1/100,e.bulletSpreadAngle-=this.num2,e.aimingShakeAngle-=this.num3},t.prototype.beSelected=function(t){t.push(new Z,new Y)},t}(),Y=function(){function t(){this.name="\u72e9\u730e\u4e4b\u77b3-\u9e70\u773c",this.num1=40,this.num2=50,this.text="\u5c04\u7a0b\u63d0\u5347"+this.num1+"%,\u89c6\u91ce\u589e\u52a0"+this.num2+"%",this.iconId=6}return t.prototype.activate=function(t,e){e.bulletRange+=t.bulletRange*this.num1/100,e.viewScale+=this.num2/100},t.prototype.beSelected=function(){},t}(),Z=function(){function t(){this.name="\u72e9\u730e\u4e4b\u77b3Lv2",this.num1=40,this.num2=15,this.num3=20,this.num4=30,this.text="\u5c04\u7a0b\u63d0\u5347"+this.num1+"%,\u6269\u6563\u51cf\u5c11"+this.num2+"\uff0c\u7cbe\u786e\u5ea6\u589e\u52a0"+this.num3+",\u5b50\u5f39\u83b7\u5f97\u8ffd\u8e2a\u80fd\u529b",this.iconId=6}return t.prototype.activate=function(t,e){e.bulletRange+=t.bulletRange*this.num1/100,e.bulletSpreadAngle-=this.num2,e.aimingShakeAngle-=this.num3,e.trackingAngularSpeed+=this.num4},t.prototype.beSelected=function(t){t.push(new J)},t}(),J=function(){function t(){this.name="\u72e9\u730e\u4e4b\u77b3LvMax",this.num1=30,this.num2=10,this.num3=20,this.num4=15,this.num5=30,this.text="\u5c04\u7a0b\u63d0\u5347"+this.num1+"%,\u6269\u6563\u51cf\u5c11"+this.num2+"\uff0c\u7cbe\u786e\u5ea6\u589e\u52a0"+this.num3+",\u8ffd\u8e2a\u80fd\u529b\u52a0\u5f3a,\u65a9\u6740\u8840\u91cf\u4f4e\u4e8e"+this.num4+"%\u7684\u654c\u4eba",this.iconId=6}return t.prototype.activate=function(t,e){e.bulletRange+=t.bulletRange*this.num1/100,e.bulletSpreadAngle-=this.num2,e.aimingShakeAngle-=this.num3,e.enemyInstantKillPercentage+=this.num4/100,e.trackingAngularSpeed+=this.num5},t.prototype.beSelected=function(t){t.push(new Q)},t}(),Q=function(){function t(){this.name="\u72e9\u730e\u4e4b\u77b3-\u7cbe\u82f1\u76ee\u6807",this.text="\u4f18\u5148\u5c04\u51fb\u88ad\u51fb\u8005",this.iconId=6}return t.prototype.activate=function(t,e){e.isEliteTarget=!0},t.prototype.beSelected=function(){},t}(),$=function(){function t(){this.name="\u667a\u6167\u4e4b\u73afLv1",this.num=60,this.num2=30,this.text="\u7ecf\u9a8c\u62fe\u53d6\u8303\u56f4\u589e\u52a0"+this.num+"%,\u51fb\u6740\u654c\u4eba\u65f6\u6709"+this.num2+"%\u6982\u7387\u76f4\u63a5\u83b7\u5f97\u7ecf\u9a8c\u7403",this.iconId=3}return t.prototype.activate=function(t,e){e.expRange+=t.expRange*this.num/100,e.directExpGainChance+=this.num2/100},t.prototype.beSelected=function(t){t.push(new tt)},t}(),tt=function(){function t(){this.name="\u667a\u6167\u4e4b\u73afLv2",this.num1=15,this.num2=30,this.text="\u83b7\u5f97\u7ecf\u9a8c\u589e\u52a0"+this.num1+"%,\u51fb\u6740\u654c\u4eba\u65f6\u589e\u52a0"+this.num2+"%\u6982\u7387\u76f4\u63a5\u83b7\u5f97\u7ecf\u9a8c\u7403",this.iconId=3}return t.prototype.activate=function(t,e){e.expGainPercentage+=this.num1/100,e.directExpGainChance+=this.num2/100},t.prototype.beSelected=function(t){t.push(new et)},t}(),et=function(){function t(){this.name="\u667a\u6167\u4e4b\u73afLvMax",this.num1=30,this.num2=40,this.text="\u83b7\u5f97\u7ecf\u9a8c\u589e\u52a0"+this.num1+"%,\u51fb\u6740\u654c\u4eba\u65f6\u589e\u52a0"+this.num2+"%\u6982\u7387\u76f4\u63a5\u83b7\u5f97\u7ecf\u9a8c\u7403",this.iconId=3}return t.prototype.activate=function(t,e){e.expGainPercentage+=this.num1/100,e.directExpGainChance+=this.num2/100},t.prototype.beSelected=function(){},t}(),it=function(){function t(){this.name="\u7a7f\u5fc3\u4e4b\u7badLv1",this.num1=25,this.num2=60,this.text="\u589e\u52a0\u66b4\u51fb\u6548\u679c,\u66b4\u51fb\u7387"+this.num1+"%\uff0c\u989d\u5916\u66b4\u51fb\u4f24\u5bb3"+this.num2+"%",this.iconId=2}return t.prototype.activate=function(t,e){e.criticalRate+=this.num1/100,e.criticalDamage+=this.num2/100},t.prototype.beSelected=function(t){t.push(new ot)},t}(),ot=function(){function t(){this.name="\u7a7f\u5fc3\u4e4b\u7badLv2",this.num1=10,this.num2=50,this.num3=30,this.text="\u66b4\u51fb\u7387\u589e\u52a0"+this.num1+"%\uff0c\u66b4\u51fb\u4f24\u5bb3\u589e\u52a0"+this.num2+"%\uff0c\u66b4\u51fb\u65f6\u6709"+this.num3+"\u6982\u7387\u4e0d\u6d88\u8017\u7a7f\u900f\u6b21\u6570",this.iconId=2}return t.prototype.activate=function(t,e){e.criticalRate+=this.num1/100,e.criticalDamage+=this.num2/100,e.critNoPenetrationChance+=this.num3/100},t.prototype.beSelected=function(t){t.push(new nt)},t}(),nt=function(){function t(){this.name="\u7a7f\u5fc3\u4e4b\u7badLvMax",this.num1=50,this.text="\u66b4\u51fb\u4f24\u5bb3\u589e\u52a0"+this.num1+"%,\u5b50\u5f39\u547d\u4e2d\u654c\u4eba\u4e2d\u5fc3\u5fc5\u5b9a\u66b4\u51fb",this.iconId=2}return t.prototype.activate=function(t,e){e.criticalDamage+=this.num1/100,e.isCenterHitCrit=!0},t.prototype.beSelected=function(){},t}(),at=function(){function t(){this.name="\u8fc7\u5ea6\u7e41\u6b96Lv1",this.num=40,this.text="\u654c\u4eba\u7684\u6570\u91cf\u4e0a\u9650\u589e\u52a0"+this.num+"%",this.iconId=-1}return t.prototype.activate=function(t,e){e.maxEnemyCount+=t.maxEnemyCount*this.num/100},t.prototype.beSelected=function(t){t.push(new st)},t}(),st=function(){function t(){this.name="\u8fc7\u5ea6\u7e41\u6b96Lv2",this.num=50,this.text="\u654c\u4eba\u7684\u6570\u91cf\u4e0a\u9650\u589e\u52a0"+this.num+"%",this.iconId=-1}return t.prototype.activate=function(t,e){e.maxEnemyCount+=t.maxEnemyCount*this.num/100},t.prototype.beSelected=function(t){t.push(new rt)},t}(),rt=function(){function t(){this.name="\u8fc7\u5ea6\u7e41\u6b96Lv3",this.num=60,this.text="\u654c\u4eba\u7684\u6570\u91cf\u4e0a\u9650\u589e\u52a0"+this.num+"%",this.iconId=-1}return t.prototype.activate=function(t,e){e.maxEnemyCount+=t.maxEnemyCount*this.num/100},t.prototype.beSelected=function(t){t.push(new ct)},t}(),ct=function(){function t(){this.name="\u8fc7\u5ea6\u7e41\u6b96Lv4",this.num=60,this.num2=1,this.num3=10,this.text="\u654c\u4eba\u7684\u6570\u91cf\u4e0a\u9650\u589e\u52a0"+this.num+"%,\u6709"+this.num2+"%\u6982\u7387\u4e00\u6b21\u6027\u751f\u6210"+this.num3+"\u4e2a\u62b1\u56e2\u5305\u56f4\u7684\u654c\u4eba",this.iconId=-1}return t.prototype.activate=function(t,e){e.maxEnemyCount+=t.maxEnemyCount*this.num/100,e.groupEnemySpawnChance+=this.num2/100,e.groupEnemyCount+=this.num3},t.prototype.beSelected=function(t){t.push(new lt)},t}(),lt=function(){function t(){this.name="\u8fc7\u5ea6\u7e41\u6b96Lv5",this.num=60,this.num2=50,this.text="\u654c\u4eba\u7684\u6570\u91cf\u4e0a\u9650\u589e\u52a0"+this.num+"%,\u6839\u636e\u573a\u4e0a\u654c\u4eba\u5b58\u6d3b\u7684\u6570\u91cf\uff0c\u654c\u4eba\u6700\u9ad8\u83b7\u5f97"+this.num2+"%\u7684\u51cf\u4f24\uff0c\u654c\u4eba\u8d8a\u5c11\u51cf\u4f24\u8d8a\u9ad8",this.iconId=-1}return t.prototype.activate=function(t,e){e.maxEnemyCount+=t.maxEnemyCount*this.num/100,e.maxEnemyDamageReductionBasedOnCount+=this.num2/100},t.prototype.beSelected=function(){},t}(),ht=function(){function t(){this.name="\u5f02\u53d8\u5b75\u5316Lv1",this.num=30,this.text="\u654c\u4eba\u4ea7\u751f\u901f\u5ea6\u589e\u52a0"+this.num+"%\uff08\u72ec\u7acb\u4e58\u533a\uff09",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpawnRate*=1+this.num/100},t.prototype.beSelected=function(t){t.push(new ut)},t}(),ut=function(){function t(){this.name="\u5f02\u53d8\u5b75\u5316Lv2",this.num=40,this.text="\u654c\u4eba\u4ea7\u751f\u901f\u5ea6\u589e\u52a0"+this.num+"%",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpawnRate*=1+this.num/100},t.prototype.beSelected=function(t){t.push(new dt)},t}(),dt=function(){function t(){this.name="\u5f02\u53d8\u5b75\u5316Lv3",this.num=50,this.text="\u654c\u4eba\u4ea7\u751f\u901f\u5ea6\u589e\u52a0"+this.num+"%",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpawnRate*=1+this.num/100},t.prototype.beSelected=function(t){t.push(new pt)},t}(),pt=function(){function t(){this.name="\u5f02\u53d8\u5b75\u5316Lv4",this.num=40,this.num2=35,this.text="\u654c\u4eba\u4ea7\u751f\u901f\u5ea6\u589e\u52a0"+this.num+"%,\u654c\u4eba\u6b7b\u4ea1\u65f6\u6709"+this.num2+"%\u6982\u7387\u7acb\u5373\u751f\u6210\u4e00\u4e2a\u654c\u4eba",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpawnRate*=1+this.num/100,e.enemyRespawnOnDeathProbability+=this.num2/100},t.prototype.beSelected=function(t){t.push(new mt)},t}(),mt=function(){function t(){this.name="\u5f02\u53d8\u5b75\u5316Lv5",this.num=40,this.num2=3,this.text="\u654c\u4eba\u4ea7\u751f\u901f\u5ea6\u589e\u52a0"+this.num+"%,\u654c\u4eba\u6709"+this.num2+"\u6982\u7387\u751f\u6210\u5728\u73a9\u5bb6\u8eab\u8fb9",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpawnRate*=1+this.num/100,e.enemySpawnNearPlayerProbability+=this.num2/100},t.prototype.beSelected=function(){},t}(),ft=function(){function t(){this.name="\u575a\u97e7\u8680\u523bLv1",this.num=40,this.text="\u654c\u4eba\u8840\u91cf\u589e\u52a0"+this.num+"%(\u6bcf\u6b21\u90fd\u662f\u72ec\u7acb\u4e58\u533a),\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemyMaxHP*=1+this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100},t.prototype.beSelected=function(t){t.push(new gt)},t}(),gt=function(){function t(){this.name="\u575a\u97e7\u8680\u523bLv2",this.num=40,this.text="\u654c\u4eba\u8840\u91cf\u589e\u52a0"+this.num+"%(\u6bcf\u6b21\u90fd\u662f\u72ec\u7acb\u4e58\u533a),\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemyMaxHP*=1+this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100*1.2},t.prototype.beSelected=function(t){t.push(new _t)},t}(),_t=function(){function t(){this.name="\u575a\u97e7\u8680\u523bLv3",this.num=50,this.text="\u654c\u4eba\u8840\u91cf\u589e\u52a0"+this.num+"%(\u6bcf\u6b21\u90fd\u662f\u72ec\u7acb\u4e58\u533a),\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemyMaxHP*=1+this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100*1.3},t.prototype.beSelected=function(t){t.push(new yt)},t}(),yt=function(){function t(){this.name="\u575a\u97e7\u8680\u523bLv4",this.num=50,this.num2=2.5,this.num3=1500,this.text="\u654c\u4eba\u8840\u91cf\u589e\u52a0"+this.num+"%(\u6bcf\u6b21\u90fd\u662f\u72ec\u7acb\u4e58\u533a),\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0\u3002\u6709"+this.num2+"%\u6982\u7387\u751f\u6210"+this.num3+"%\u8840\u91cf\u7684\u7279\u5f02\u4e2a\u4f53,\u6709\u51fb\u9000\u6297\u6027\uff0c\u6253\u8d25\u83b7\u5f97\u5927\u91cf\u7ecf\u9a8c",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemyMaxHP*=1+this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100*1.4,e.highHpEliteSpawnProbability+=this.num2/100,e.highHpEliteHealth+=this.num3/100},t.prototype.beSelected=function(t){t.push(new vt)},t}(),vt=function(){function t(){this.name="\u575a\u97e7\u8680\u523bLv5",this.num=50,this.num2=.005,this.text="\u654c\u4eba\u8840\u91cf\u589e\u52a0"+this.num+"%(\u6bcf\u6b21\u90fd\u662f\u72ec\u7acb\u4e58\u533a),\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0\uff0c\u6bcf\u4e2a\u88ab\u6740\u6b7b\u7684\u654c\u4eba\u4f1a\u4f7f\u654c\u4eba\u8840\u91cf\u589e\u52a0"+this.num2+"%",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemyMaxHP*=1+this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100*1.5,e.healthIncreasePerDeath+=this.num2/100},t.prototype.beSelected=function(t){t.push(new bt)},t}(),bt=function(){function t(){this.name="\u575a\u97e7\u8680\u523bLv6",this.num=15,this.text="\u589e\u52a0"+this.num+"%\u6982\u7387\u751f\u6210\u9ad8\u8840\u91cf\u7684\u7279\u5f02\u4e2a\u4f53",this.iconId=-1}return t.prototype.activate=function(t,e){e.highHpEliteSpawnProbability+=this.num/100},t.prototype.beSelected=function(){},t}(),Pt=function(){function t(){this.name="\u72e1\u733e\u673a\u52a8Lv1",this.num=20,this.text="\u654c\u4eba\u7684\u79fb\u52a8\u901f\u5ea6\u589e\u52a0"+this.num+"%,\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpeed+=t.enemySpeed*this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100},t.prototype.beSelected=function(t){t.push(new St)},t}(),St=function(){function t(){this.name="\u72e1\u733e\u673a\u52a8Lv2",this.num=20,this.text="\u654c\u4eba\u7684\u79fb\u52a8\u901f\u5ea6\u589e\u52a0"+this.num+"%,\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpeed+=t.enemySpeed*this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100},t.prototype.beSelected=function(t){t.push(new Mt)},t}(),Mt=function(){function t(){this.name="\u72e1\u733e\u673a\u52a8Lv3",this.num=20,this.num2=10,this.text="\u654c\u4eba\u7684\u79fb\u52a8\u901f\u5ea6\u589e\u52a0"+this.num+"%,\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0,\u6709"+this.num2+"%\u6982\u7387\u95ea\u907f\u653b\u51fb",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpeed+=t.enemySpeed*this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100,e.enemyDodgeProbability+=this.num2/100},t.prototype.beSelected=function(t){t.push(new wt)},t}(),wt=function(){function t(){this.name="\u72e1\u733e\u673a\u52a8Lv4",this.num=20,this.num2=5,this.num3=325,this.text="\u654c\u4eba\u7684\u79fb\u52a8\u901f\u5ea6\u589e\u52a0"+this.num+"%,\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0,\u6709"+this.num2+"%\u6982\u7387\u751f\u6210"+this.num3+"%\u79fb\u901f\u4e14\u514d\u75ab\u51fb\u9000\u548c\u78b0\u649e\u7684\u88ad\u51fb\u7279\u5f02\u4e2a\u4f53",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpeed+=t.enemySpeed*this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100,e.suicideEliteSpawnProbability+=this.num2/100,e.suicideEliteSpeed+=this.num3/100},t.prototype.beSelected=function(t){t.push(new kt)},t}(),kt=function(){function t(){this.name="\u72e1\u733e\u673a\u52a8Lv5",this.num=10,this.num2=25,this.text="\u654c\u4eba\u7684\u79fb\u52a8\u901f\u5ea6\u589e\u52a0"+this.num+"%,\u83b7\u5f97\u7684\u7ecf\u9a8c\u4e5f\u4f1a\u589e\u52a0,\u8ddd\u79bb\u73a9\u5bb6\u8d8a\u8fd1\u79fb\u901f\u8d8a\u9ad8\uff0c\u6700\u5927\u589e\u52a0"+this.num2+"%\u79fb\u901f\uff08\u72ec\u7acb\u4e58\u533a\uff09",this.iconId=-1}return t.prototype.activate=function(t,e){e.enemySpeed+=t.enemySpeed*this.num/100,e.expFromEnemy+=t.expFromEnemy*this.num/100,e.speedIncreaseBasedOnDistance+=this.num2/100},t.prototype.beSelected=function(t){t.push(new Ct)},t}(),Ct=function(){function t(){this.name="\u72e1\u733e\u673a\u52a8Lv6",this.num=10,this.text="\u589e\u52a0"+this.num+"%\u6982\u7387\u751f\u6210\u88ad\u51fb\u7279\u5f02\u4e2a\u4f53",this.iconId=-1}return t.prototype.activate=function(t,e){e.suicideEliteSpawnProbability+=this.num/100},t.prototype.beSelected=function(){},t}();cc._RF.pop()},{}],itemToDie:[function(t,e,i){"use strict";cc._RF.push(e,"bf540MCollMW7G4aCBNBgkQ","itemToDie"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=cc._decorator,a=n.ccclass;n.property,function(t){t[t.white=0]="white",t[t.down=1]="down"}(o||(o={}));var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mat=null,e.gameState=o.white,e.timer=0,e}return __extends(e,t),e.prototype.onEnable=function(){this.mat=this.node.getComponent(cc.RenderComponent).getMaterial(0)},e.prototype.update=function(t){this.mat&&(this.timer<=1&&this.gameState==o.white?(this.timer+=8*t,this.mat.setProperty("u_maskIntensity",this.timer)):this.gameState=o.down,this.gameState==o.down&&this.timer>=0&&(this.timer-=8*t,this.mat.setProperty("u_maskIntensity",this.timer)))},__decorate([a],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],loadCarRunMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"e4697Iur6FM6ZclbMdAflOL","loadCarRunMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=__importDefault(t("../../miniGamePackage/helpModel/diffLayerBG/diffLayerBG")),a=__importStar(t("../../miniGamePackage/SubPackageManager")),s=t("../../miniGamePackage/types-miniGame"),r=cc._decorator,c=r.ccclass,l=r.property;(function(t){t.zoom="\u6781\u901f",t.oneWheel="\u72ec\u8f6e\u7279\u6280",t.fly="\u7a7a\u4e2d\u98de\u8f66",t.dangerAngel="\u6709\u60ca\u65e0\u9669",t.safeDriver="\u5b89\u5168\u9a7e\u9a76",t.flyEgg="\u98a0\u52fa"})(o||(o={}));var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bg=null,e.sceneNode=null,e.leftBut=null,e.rightBut=null,e.stonesFrame=[],e.drawerPre=null,e.wheelNodes=[],e.carNode=null,e.smokePre=null,e.eggNode=null,e.cargoNode=[],e.distanceLabel=null,e.maxDistanceLabel=null,e.skillLabel=null,e.scoreLabel=null,e.totalScoreLabel=null,e.milestonePre=null,e.soundClip=[],e.shareNode=null,e._world=null,e._floorMaterial=null,e._wheelMaterial=null,e._floors=[],e._drawers=[],e._floorHeights=[],e._floorStones=[],e._wheels=[],e._carBody=null,e._eggBody=null,e.soundCaches=[],e._isInFloor=[!0,!0],e._outFLoorTime=[0,0],e._skills=[],e._skillLevel=["","\u4f18\u79c0","\u5353\u8d8a","\u5b8c\u7f8e","\u5dc5\u5cf0"],e._floorElementInterval=5,e._oneFloorLength=2e3,e._floorElementNoiseCnt=0,e._randomNoiseSeed=cc.v3(),e._distance=0,e._maxDistance=0,e._runDir=0,e.burstCD=0,e._milestoneOffset=500,e._milestones=[],e._showScore={value:0},e._realScore=0,e._showTotalScore={value:0},e._realTotalScore=0,e._voidScoreTime=0,e._reloadScoreTime=3,e._isCanShowScore=!0,e._scoreMulti=1,e._scoreShakeAmount=0,e._speedParts=[],e._carSpeed=0,e._zoomSpeed=600,e._zoomTime=0,e._zoomCombo=0,e._safeAngel=30,e._safeAngelTime=0,e._safeDriveCombo=0,e._dangerAngel=45,e._dangerAngelTime=0,e._eggOutCarTime=0,e._isEggInCar=0,e._startGameProgress=.1,e._isGameOver=!1,e.isShared=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"runDir",{get:function(){return this._runDir},set:function(t){var e=this,i=function(){e.burstCD<=0&&(e.soundCaches[0]=cc.audioEngine.play(e.soundClip[0],!1,.25)),e.burstCD=.5};!this._runDir&&t&&i(),!t&&this._runDir&&this.soundCaches[0],t&&this._runDir&&i(),this._runDir=t,this.rightBut&&this.leftBut&&(this.rightBut.active=!1,this.leftBut.active=!1,1==t&&(this.rightBut.active=!0),-1==t&&(this.leftBut.active=!0))},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){if(this.node.on(cc.Node.EventType.TOUCH_START,this._touchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this._touchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEnd,this),a.default.instance.miniGameAdapter.changeMainGameMusic(0),cc.game.setFrameRate(60),this.soundClip.length>=3){this.soundCaches.push(0);var t=cc.audioEngine.play(this.soundClip[1],!0,1);this.soundCaches.push(t);var e=cc.audioEngine.play(this.soundClip[2],!0,.3);this.soundCaches.push(e)}},e.prototype.onDisable=function(){cc.Tween.stopAllByTarget(this._showScore),cc.Tween.stopAllByTarget(this._showTotalScore),cc.Tween.stopAllByTarget(this),this.node.off(cc.Node.EventType.TOUCH_START,this._touchStart,this),this.node.off(cc.Node.EventType.TOUCH_END,this._touchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._touchEnd,this),cc.game.setFrameRate(30),this._world&&this._world.clear(),this._gameSave();for(var t=0;t<this.soundClip.length;t++)cc.audioEngine.uncache(this.soundClip[t]);a.default.instance.miniGameAdapter.changeMainGameMusic(1)},e.prototype._lose=function(){var t=this;this._isGameOver||(this._isGameOver=!0,function(){if(t.eggNode){var e=t.eggNode.getChildByName("0"),i=t.eggNode.getChildByName("1");e&&i&&(e.active=!1,i.active=!1,i.active=!0),t.eggNode.angle=0}}(),this.shareNode&&(this.shareNode.active=!0,this.shareNode.getChildByName("label").getComponent(cc.Label).string=this._distance+"m"))},e.prototype.share=function(){var t=this;this.isShared?a.default.instance.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.shareNode&&!this.isShared&&a.default.instance.miniGameAdapter.shareScreenShotSP(this.shareNode,{miniGame:s.SubPackageKey.loadCarRun}).then(function(e){e?(a.default.instance.showTip("\u5206\u4eab\u6210\u529f"),t.isShared=!0,t.shareNode&&(t.shareNode.active=!1),t.reLife()):a.default.instance.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.reLife=function(){var t=this;if(this._carBody&&this._eggBody){var e=new a.P2.RevoluteConstraint(this._carBody,this._eggBody,{localPivotA:[-100,100],localPivotB:[0,0],maxForce:8e4});this._carBody.angle=0,this._carBody.position[1]+=100,this._carBody.velocity=[0,0],this._eggBody.position=[this._carBody.position[0]-100,this._carBody.position[1]+100],this._wheels[0].position=[this._carBody.position[0]-100,this._carBody.position[1]-15],this._wheels[1].position=[this._carBody.position[0]+100,this._carBody.position[1]-15],this.shareNode&&(this.shareNode.active=!1),this._world&&(this._world.addConstraint(e),this._isGameOver=!1,function(){if(t.eggNode){var e=t.eggNode.getChildByName("0"),i=t.eggNode.getChildByName("1");e&&i&&(e.active=!1,i.active=!1,e.active=!0),t.eggNode.angle=0}}(),cc.tween(this).delay(3).call(function(){var i;null===(i=t._world)||void 0===i||i.removeConstraint(e)}).start())}},e.prototype.start=function(){var t=(cc.winSize.height-1334)/2;this.rightBut&&this.leftBut&&(this.rightBut.parent.y-=t,this.leftBut.parent.y-=t),a.p5Noise.noiseSeed(Math.floor(1e6*Math.random())),this._gameInit(),this._init(),this._spawnSmoke()},e.prototype._gameInit=function(){var t=cc.sys.localStorage.getItem("miniGameLoadCarRun");if(t){var e=JSON.parse(t);e&&(this._maxDistance=e.maxDistance)}this.maxDistanceLabel&&(this.maxDistanceLabel.string=this._maxDistance.toString()+"m")},e.prototype._gameSave=function(){var t={maxDistance:0};t.maxDistance=Math.max(this._maxDistance,this._distance),cc.sys.localStorage.setItem("miniGameLoadCarRun",JSON.stringify(t))},e.prototype._init=function(){var t,e,i,o,n=this;if(this._randomNoiseSeed=cc.v3(Math.random(),Math.random(),Math.random()).normalize(),this._world=new a.P2.World,this._world){this._wheels=[],this._world.gravity=[0,-2200],this._floorMaterial=new a.P2.Material(1),this._wheelMaterial=new a.P2.Material(2);var s=new a.P2.ContactMaterial(this._wheelMaterial,this._floorMaterial);if(s.friction=25,this._world.addContactMaterial(s),2==this.wheelNodes.length&&this.carNode){for(var r=0;r<this.wheelNodes.length;r++){var c=this.wheelNodes[r],l=new a.P2.Body({mass:.5,position:[c.x,c.y]}),h=new a.P2.Circle({radius:c.width/2});h.material=this._wheelMaterial,l.addShape(h),this._wheels.push(l),null===(t=this._world)||void 0===t||t.addBody(l)}if(this._carBody=new a.P2.Body({mass:5,position:[this.carNode.x,this.carNode.y]}),!this._carBody)return;for(var u=0,d=this.cargoNode;u<d.length;u++){c=d[u];var p=new a.P2.Box({width:c.width,height:c.height});null===(e=this._carBody)||void 0===e||e.addShape(p),p.position=[c.x,c.y]}this._world.addBody(this._carBody);var m=new a.P2.RevoluteConstraint(this._carBody,this._wheels[1],{localPivotA:[this._wheels[1].position[0]-(null===(i=this._carBody)||void 0===i?void 0:i.position[0]),-15],localPivotB:[0,0],maxForce:2e5});if(this._world.addConstraint(m),m=new a.P2.RevoluteConstraint(this._carBody,this._wheels[0],{localPivotA:[this._wheels[0].position[0]-(null===(o=this._carBody)||void 0===o?void 0:o.position[0]),-15],localPivotB:[0,0],maxForce:2e5}),this._world.addConstraint(m),this.eggNode){if(this._eggBody=new a.P2.Body({mass:1.2,position:[this.eggNode.x,this.eggNode.y]}),!this._eggBody)return;this._eggBody.addShape(new a.P2.Circle({radius:this.eggNode.width/2})),this._world.addBody(this._eggBody)}}this._crateFloor(cc.v2(-this._milestoneOffset,0)),this._showSkill(),this._world.on("beginContact",function(t){t.bodyA===n._eggBody&&(t.bodyB===n._floors[0]||n._floors.length>1&&t.bodyB===n._floors[1])?(console.log("\u9e21\u86cb\u843d\u5730"),n._lose()):t.bodyB===n._eggBody&&(t.bodyA===n._floors[0]||n._floors.length>1&&t.bodyA===n._floors[1])?(console.log("\u9e21\u86cb\u843d\u5730"),n._lose()):t.bodyA!==n._eggBody&&t.bodyB!==n._eggBody||n._isEggInCar++}),this._world.on("endContact",function(t){t.bodyA!==n._eggBody&&t.bodyB!==n._eggBody||n._isEggInCar--}),this._world.on("beginContact",function(t){t.bodyA!==n._wheels[0]&&t.bodyB!==n._wheels[0]||(n._isInFloor[0]=!0),t.bodyA!==n._wheels[1]&&t.bodyB!==n._wheels[1]||(n._isInFloor[1]=!0)}),this._world.on("endContact",function(t){t.bodyA!==n._wheels[0]&&t.bodyB!==n._wheels[0]||(n._isInFloor[0]=!1),t.bodyA!==n._wheels[1]&&t.bodyB!==n._wheels[1]||(n._isInFloor[1]=!1)})}},e.prototype._crateFloor=function(t){var e=this;t.y=-250,this._floorHeights.length&&(this._floorHeights=[this._floorHeights.pop()]);for(var i=0,o=(2+Math.pow(this._distance/1e3,.3))/200,n=0;n<this._oneFloorLength;n++){this._startGameProgress+=1/this._oneFloorLength,this._startGameProgress=Math.min(1,this._startGameProgress),this._floorElementNoiseCnt+=o;var s=this._floorElementNoiseCnt;a.p5Noise.noiseDetail(2,.7),i=a.p5Noise.noise(s*this._randomNoiseSeed.x,s*this._randomNoiseSeed.y,s*this._randomNoiseSeed.z),a.p5Noise.noiseDetail(12,1),i=300*(i+=(a.p5Noise.noise(s/6e3)-5)*this._startGameProgress*3)*this._startGameProgress,this._floorHeights.push(i)}var r=new a.P2.Heightfield({heights:this._floorHeights,elementWidth:this._floorElementInterval});this._floorMaterial&&(r.material=this._floorMaterial);var c=new a.P2.Body({mass:0,position:[t.x,t.y]});if(c.addShape(r),this._world&&(this._world.addBody(c),this._floors.push(c)),this._floors.length>=2&&this.milestonePre&&this.sceneNode&&this.carNode){var l=cc.instantiate(this.milestonePre),h=l.getChildByName("label").getComponent(cc.Label);if(h){var u=1e3*Math.floor((this._distance+1e3)/1e3);h.string=u.toString()+"m"}var d=Math.floor(this._milestoneOffset/this._floorElementInterval);for(l.parent=this.sceneNode,l.setPosition(cc.v2(t.x+this._milestoneOffset,t.y+this._floorHeights[d]));this._milestones.length&&this._milestones[0]&&this._milestones[0].position.x-this.carNode.x<-1e3;){var p=this._milestones.shift();p&&p.destroy()}this._milestones.push(l),l.zIndex=-1}if(this.sceneNode&&this.carNode){for(var m=0,f=cc.tween(this),g=__spreadArrays(this._floorHeights);m<this._oneFloorLength;){u=Math.floor(10);var _=function(){var i=m+500*Math.random(),o=200*Math.random()+50;f=f.delay(.01).call(function(){if(e.sceneNode&&e.carNode){var n=Math.floor(Math.random()*e.stonesFrame.length),a=new cc.Node;a.addComponent(cc.Sprite).spriteFrame=e.stonesFrame[n],a.parent=e.sceneNode,a.setPosition(t.x+i*e._floorElementInterval,t.y+g[Math.floor(i)]-o),e._floorStones.push(a)}})};for(n=0;n<u;n++)_();m+=500}for(var y=function(){var t=v._floorStones.shift();f=f.delay(.01).call(function(){t&&t.destroy()})},v=this;this._floorStones.length&&this._floorStones[0]&&this._floorStones[0].position.x-this.carNode.x<-1e3;)y();f=f.start()}if(this.drawerPre){var b=cc.instantiate(this.drawerPre.node).getComponent(cc.Graphics);b.node.parent=this.drawerPre.node.parent;var P=t.add(cc.v2(0,this._floorHeights[0]));for(n=1;n<this._floorHeights.length;n++){var S=t.add(cc.v2(n*this._floorElementInterval,this._floorHeights[n]));b.moveTo(P.x,P.y),b.lineTo(S.x,S.y),P=S}var M=t.add(cc.v2(0,this._floorHeights[0]));for(b.moveTo(M.x,M.y),n=1;n<this._floorHeights.length;n++)M=t.add(cc.v2(n*this._floorElementInterval,this._floorHeights[n])),b.lineTo(M.x,M.y);b.lineTo(M.x,M.y-1e5),b.lineTo(t.x,M.y-1e5),b.close(),b.fill(),this._drawers.push(b)}},e.prototype._removeFLoor=function(){var t=this._floors.shift();t&&this._world&&this._world.removeBody(t);var e=this._drawers.shift();e&&(e.clear(),e.node.destroy())},e.prototype._showSkill=function(){var t=this,e=this._isCanShowScore?this._skills.shift():void 0,i=1/(1+.1*this._skills.length),o="";if(e){this._voidScoreTime=0,e.level=Math.min(e.level,this._skillLevel.length-1);var n=100*e.level+100;o="+"+n,this._realScore+=n,cc.tween(this._showScore).to(2,{value:this._realScore}).start(),this._scoreMulti+=.11,this._scoreMulti=Math.floor(10*this._scoreMulti)/10}else if(e={name:"",level:0},this.skillLabel)return this.skillLabel.string=this._skillLevel[e.level]+e.name+o,void cc.tween(this.skillLabel.node).delay(.1).call(function(){t._showSkill()}).start();this.skillLabel&&(this.skillLabel.string=this._skillLevel[e.level]+e.name+o,cc.tween(this.skillLabel.node).set({y:50}).to(.1*i,{y:0},{easing:cc.easing.cubicOut}).delay(.8*i).to(.4*i,{y:-50},{easing:cc.easing.quartOut}).call(function(){t._showSkill()}).start())},e.prototype.update=function(t){var e=this;if(t>.02&&(t=.02),this._isGameOver&&this.eggNode&&(this.eggNode.angle=0),!this._isGameOver&&this._world&&this.carNode&&this._carBody&&this.sceneNode&&this.eggNode&&this._eggBody){this._world.step(t),0==this.runDir&&(this.burstCD-=t),cc.audioEngine.setVolume(this.soundCaches[2],Math.min(1,this._carSpeed/this._zoomSpeed*.4));var i=function(t){var i=0;if(e._outFLoorTime.every(function(t){return t>.3})){var n=Math.max.apply(Math,e._outFLoorTime),a=Math.floor(n/.3*5)-5;i=2,e._skills.push({name:o.fly,level:a})}else e._outFLoorTime[t]>=.7&&(n=e._outFLoorTime[t],a=Math.floor(n/.7*5)-5,i=1,e._skills.push({name:o.oneWheel,level:a}));2==i&&(e._outFLoorTime[0]=0,e._outFLoorTime[1]=0)},n=(this._wheels[0].angularVelocity+this._wheels[1].angularVelocity)/2;this._wheels[0].angularVelocity=this._wheels[1].angularVelocity=n;for(var a=0;a<this._wheels.length;a++){var s=this._wheels[a].position,r=(this._wheels[a].velocity,this._wheels[a].angularVelocity);(Math.abs(r)<1||r*this.runDir>0)&&(r=1),this._wheels[a].angularForce=-1e8/Math.abs(10*r)*this.runDir,this.wheelNodes[a].angle=180*this._wheels[a].angle/Math.PI,this.wheelNodes[a].setPosition(cc.v2(s[0],s[1])),0==this._isInFloor[a]?(this._outFLoorTime[a]+=t,this._outFLoorTime[a]>5&&this._carSpeed>this._zoomSpeed&&this._lose()):(this._carSpeed>this._zoomSpeed/3&&i(a),this._outFLoorTime[a]=0)}if(this.carNode.setPosition(cc.v2(this._carBody.position[0],this._carBody.position[1])),this.carNode.angle=180*this._carBody.angle/Math.PI,this.sceneNode.setPosition(cc.v2(-this.carNode.x,-this.carNode.y-250)),this.bg&&this.bg.setPosition(cc.v2(-this.carNode.x,-250)),Math.abs(this.carNode.angle)>this._dangerAngel)this._dangerAngelTime+=t;else{if(this._dangerAngelTime>0&&this._carSpeed>this._zoomSpeed/3){var c=Math.floor(this._dangerAngelTime/.1);this._skills.push({name:o.dangerAngel,level:c})}this._dangerAngelTime=0}Math.abs(this.carNode.angle)<=this._safeAngel&&this._carSpeed>this._zoomSpeed/3?this._safeAngelTime+=t:(this._safeAngelTime=0,this._safeDriveCombo=0),this._safeAngelTime>=5+3*this._safeDriveCombo&&(this._skills.push({name:o.safeDriver,level:this._safeDriveCombo}),this._safeDriveCombo++);var l=cc.v2(this._carBody.velocity[0],this._carBody.velocity[1]).mag();if(this._carSpeed+=l/60,this._speedParts.push(l),this._speedParts.length>60){var h=this._speedParts.shift();h&&(this._carSpeed-=h/60)}if(this._carSpeed>this._zoomSpeed?this._zoomTime+=t:(this._zoomTime=0,this._zoomCombo=0),this._zoomTime>=5+3*this._zoomCombo&&(this._skills.push({name:o.zoom,level:this._zoomCombo}),this._zoomCombo++),this._isEggInCar?(this._eggOutCarTime>.3&&(c=Math.floor(5*this._eggOutCarTime/.3)-5,this._skills.push({name:o.flyEgg,level:c})),this._eggOutCarTime=0):this._eggOutCarTime+=t,1==this._floors.length?this.carNode.x-this._floors[0].position[0]>this._floorElementInterval*this._oneFloorLength*.5&&this._crateFloor(cc.v2(this._floors[0].position[0]+this._floorElementInterval*(this._oneFloorLength-1),0)):2==this._floors.length&&this.carNode.x-this._floors[0].position[0]>this._floorElementInterval*this._oneFloorLength*1.5&&this._removeFLoor(),this._distance=Math.max(this._distance,Math.floor(this.carNode.x/10)),this.distanceLabel&&(this.distanceLabel.string=this._distance.toString()+"m"),this.eggNode.setPosition(cc.v2(this._eggBody.position[0],this._eggBody.position[1])),this.eggNode.angle=180*this._eggBody.angle/Math.PI,this._voidScoreTime+=t,(this._skills.length>0||0==this._realScore)&&(this._voidScoreTime=0),this._voidScoreTime>=this._reloadScoreTime&&(this._voidScoreTime=0,this._realTotalScore+=this._realScore*this._scoreMulti,this._realScore=0,this._isCanShowScore=!1,cc.tween(this._showTotalScore).to(2,{value:this._realTotalScore}).start(),cc.tween(this._showScore).to(2,{value:this._realScore}).call(function(){e&&(e._scoreMulti=1,e._isCanShowScore=!0)}).start()),this.scoreLabel&&(this.scoreLabel.string=this._showScore.value>0?Math.floor(this._showScore.value)+" x "+this._scoreMulti:"",this._scoreShakeAmount=10*this._scoreMulti-10,this._scoreShakeAmount>=3)){var u=(2*Math.random()-1)*Math.sqrt(this._scoreShakeAmount)/1.1,d=(2*Math.random()-1)*Math.sqrt(this._scoreShakeAmount)/1.1;this.scoreLabel.node.setPosition(u,d)}this.totalScoreLabel&&(this.totalScoreLabel.string=Math.floor(this._showTotalScore.value).toString())}},e.prototype._spawnSmoke=function(){var t=this,e=.2;if(0!=this.runDir&&(e/=2),cc.tween(this).delay(e).call(function(){t._spawnSmoke()}).start(),this.smokePre&&this.sceneNode&&this.carNode){var i=this.carNode.getChildByName("smoke");if(!i)return;var o=cc.instantiate(this.smokePre);o.parent=this.sceneNode;var n=this.carNode.convertToWorldSpaceAR(i.getPosition());o.setPosition(this.sceneNode.convertToNodeSpaceAR(n)),cc.tween(o).by(.3,{y:50,x:-40,scale:.6}).by(.3,{opacity:-255,y:20}).call(function(){o.destroy()}).start()}},e.prototype._touchStart=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation());e.x>0&&(this.runDir=1),e.x<0&&(this.runDir=-1)},e.prototype._touchEnd=function(){this.runDir=0},e.prototype.onClickExit=function(){a.default.instance.getModel().gameExit()},__decorate([l(n.default)],e.prototype,"bg",void 0),__decorate([l(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([l(cc.Node)],e.prototype,"leftBut",void 0),__decorate([l(cc.Node)],e.prototype,"rightBut",void 0),__decorate([l([cc.SpriteFrame])],e.prototype,"stonesFrame",void 0),__decorate([l(cc.Graphics)],e.prototype,"drawerPre",void 0),__decorate([l([cc.Node])],e.prototype,"wheelNodes",void 0),__decorate([l(cc.Node)],e.prototype,"carNode",void 0),__decorate([l(cc.Node)],e.prototype,"smokePre",void 0),__decorate([l(cc.Node)],e.prototype,"eggNode",void 0),__decorate([l([cc.Node])],e.prototype,"cargoNode",void 0),__decorate([l(cc.Label)],e.prototype,"distanceLabel",void 0),__decorate([l(cc.Label)],e.prototype,"maxDistanceLabel",void 0),__decorate([l(cc.Label)],e.prototype,"skillLabel",void 0),__decorate([l(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([l(cc.Label)],e.prototype,"totalScoreLabel",void 0),__decorate([l(cc.Prefab)],e.prototype,"milestonePre",void 0),__decorate([l([cc.AudioClip])],e.prototype,"soundClip",void 0),__decorate([l(cc.Node)],e.prototype,"shareNode",void 0),__decorate([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/helpModel/diffLayerBG/diffLayerBG":"diffLayerBG","../../miniGamePackage/types-miniGame":"types-miniGame"}],loadCarRunModel:[function(t,e,i){"use strict";cc._RF.push(e,"540a6VZSJRN8oUIEh+IaelE","loadCarRunModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/loadCarRun/loadCarRunMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.loadCarRun)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],match3_Model:[function(t,e,i){"use strict";cc._RF.push(e,"eb707D15htNOKQf5i5uuNo+","match3_Model"),Object.defineProperty(i,"__esModule",{value:!0}),i.Match3_Model=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/match3-game/match3-main-game",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.match3)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.Match3_Model=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],match3_gamelogic:[function(t,e,i){"use strict";cc._RF.push(e,"c3d22/TLRlMiaLVGj3ySaCQ","match3_gamelogic"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("./itemToDie")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=t.call(this)||this;return e.stopAllClick=null,e.createSpeed=2e3,e.smokeSpeed=500,e.shakeLevel=3,e.moveStepLength=105,e.scoreLabel=null,e.maxScoreLabel=null,e.ovenContainer=null,e.ovenContainerBuffer=null,e.mainContainer=null,e.mainContainerInitPosY=0,e.itemRowContainer=null,e.itemContainer=null,e.soundClip=[],e.ovenItem=null,e.itemArray=[],e.plateArray=[],e.smokeArray=[],e.dieBoard=null,e.gameOverBlock=null,e.effectPool=null,e.dieIcon=null,e.buttonGroup=null,e.fireAnim=null,e._score=0,e._maxScore=0,e._ovenItemNum=0,e._timer=0,e._smokeTimer=0,e._rowNum=6,e._elementContainer=[],e._ovenElementContainer=[],e._elementRowDestroy=[],e._topCollider=null,e._isGameOver=!1,e._distance=0,e._isShared=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this._gameInit(),this.gameOverBlock&&this.maxScoreLabel&&this.fireAnim&&(this._topCollider=this.gameOverBlock.getBoundingBoxToWorld(),this.maxScoreLabel.string=this._maxScore.toString(),this.fireAnim.play("burn").repeatCount=1/0)},e.prototype.onEnable=function(){this._timer=this.createSpeed,this._initGame(),this._isGameOver=!1,cc.game.setFrameRate(60)},e.prototype.onDisable=function(){cc.game.setFrameRate(30)},e.prototype.update=function(t){var e=this;if(this._timer-=t,this._smokeTimer-=t,this.stopAllClick&&this.mainContainer&&this._topCollider&&this._elementContainer&&this.stopAllClick){this._ovenItemNum>=6&&(this._ovenItemNum=-100,this.stopAllClick.active=!0,cc.tween(this.node).delay(.4).call(function(){e._gameOver()}).start());for(var i=0;i<this._elementContainer.length;i++)this.mainContainer.children[i].children[1].getBoundingBoxToWorld().intersects(this._topCollider)&&1!=this.mainContainer.children[i].skewX&&this._gameOver();if(this._distance=this._findFirstRow(),this._elementContainer.length-this._distance-6>0){if(this._elementContainer.length-this._distance-6==2){var o=(2*Math.random()-1)*Math.sqrt((this._elementContainer.length-this._distance-4)*this.shakeLevel)/1.1,n=(2*Math.random()-1)*Math.sqrt((this._elementContainer.length-this._distance-4)*this.shakeLevel)/1.1;this.mainContainer.children[this._distance].children[0].setPosition(o,n)}this._smokeTimer<=0&&-1!=this._distance&&(this._smokeTimer=this.smokeSpeed,this._elementContainer[this._distance].forEach(function(t){t.active&&e._smokeCreate(t,e._elementContainer.length-e._distance-7,1)}),this._elementContainer[this._distance+1].forEach(function(t){t.active&&1==t.skewX&&e._smokeCreate(t,e._elementContainer.length-e._distance-8,1)}))}this._timer<=0&&!this._isGameOver&&(this._timer=this.createSpeed,this._newItemRow(),cc.tween(this.mainContainer).by(1,{y:this.moveStepLength}).start())}},e.prototype._findFirstRow=function(){if(this.mainContainer&&this._topCollider)for(var t=0;t<this._elementContainer.length;t++)if(1!=this.mainContainer.children[t].skewX)return t;return console.log("\u672a\u80fd\u67e5\u8be2\u5230\u6ca1\u88ab\u6d88\u9664\u7684\u5143\u7d20"),-1},e.prototype._smokeCreate=function(t,e,i){var o=new cc.Node;o.addComponent(cc.Sprite).spriteFrame=this.smokeArray[e],o.position=cc.v3(t.width/2,t.height/2,0),o.scale=.5+Math.random();var n=Math.random()*Math.PI/4-Math.PI/8,a=cc.moveBy(i,cc.v2(100*Math.sin(n),100*Math.cos(n))),s=cc.rotateBy(i,360*Math.random()),r=cc.scaleTo(i,Math.random()),c=cc.fadeOut(i),l=cc.spawn(a,s,r,c);o.runAction(l),t.addChild(o)},e.prototype._gameInit=function(){var t=cc.sys.localStorage.getItem("miniGameMatch3");if(t){var e=JSON.parse(t);e&&(this._maxScore=e.maxScore)}this._distance=4},e.prototype._gameSave=function(){var t={maxScore:0};t.maxScore=this._maxScore,cc.sys.localStorage.setItem("miniGameMatch3",JSON.stringify(t))},e.prototype._gameOver=function(){var t=this;this._isGameOver=!0,cc.Tween.stopAllByTarget(this.mainContainer),this._elementContainer=[],this._elementRowDestroy=[],this._ovenElementContainer=[],this._ovenItemNum=0,cc.audioEngine.play(this.soundClip[2],!1,1),1==this._isShared&&this._score>this._maxScore&&(this._maxScore=this._score,this._gameSave()),this.dieBoard&&this.dieIcon&&this.buttonGroup&&this.ovenContainer&&this.mainContainer&&this.maxScoreLabel&&(this.dieBoard.active=!0,this.dieBoard.opacity=0,cc.tween(this.dieBoard).to(.3,{opacity:255},{easing:"quadIn"}).call(function(){t.stopAllClick&&(t.stopAllClick.active=!1)}).start(),this.dieIcon.opacity=0,cc.tween(this.dieIcon).to(.3,{scale:1.2,opacity:255,position:new cc.Vec3(this.dieIcon.x,this.dieIcon.y+10,0)},{easing:"sineOut"}).to(.05,{scale:1,position:new cc.Vec3(this.dieIcon.x,this.dieIcon.y,0)},{easing:"sineOut"}).to(.05,{scale:1.1,position:new cc.Vec3(this.dieIcon.x,this.dieIcon.y+5,0)},{easing:"sineIn"}).to(.05,{scale:1,position:new cc.Vec3(this.dieIcon.x,this.dieIcon.y,0)},{easing:"sineIn"}).start(),cc.tween(this.buttonGroup).delay(.6).call(function(){t.buttonGroup&&(t.buttonGroup.active=!0)}).start(),this.ovenContainer.children.forEach(function(t){t.destroy()}),this.mainContainer.y=this.mainContainerInitPosY,this.mainContainer.removeAllChildren(),this.ovenContainer.removeAllChildren(),this.maxScoreLabel.string=this._maxScore.toString())},e.prototype._initGame=function(){this._timer=this.createSpeed,this._score=0,this.scoreLabel&&(this.scoreLabel.string=this._score.toString());for(var t=0;t<4;t++)this._newItemRow()},e.prototype._findTriplets=function(t){for(var e={},i=0;i<t.length;++i)if(e[t[i]]||(e[t[i]]=[]),e[t[i]].push(i),3==e[t[i]].length)return e[t[i]];return[]},e.prototype._ovenAddItem=function(t){var e=this;if(this._ovenItemNum<=6&&this.ovenItem&&this.ovenContainer){var i=cc.instantiate(this.ovenItem);i.getComponent(cc.Sprite).spriteFrame=t,i.x=110*this._ovenItemNum-288,i.setParent(this.ovenContainer),this._ovenElementContainer.push(this.itemArray.findIndex(function(t){return t.name==i.getComponent(cc.Sprite).spriteFrame.name})),this._ovenItemNum++;var o=this._findTriplets(this._ovenElementContainer),n=this.ovenContainer.children;if(0!=o.length){o.sort(function(t,e){return e-t});var s=this._ovenItemNum-3,r=0;o.forEach(function(t){e._ovenElementContainer.splice(t,1);var i=n[t];i&&e.ovenContainerBuffer&&(i.parent=e.ovenContainerBuffer,i.x=110*s-288,e.effectPool&&(e.effectPool.children[s].active=!0),cc.tween(i).call(function(){i.getComponent(a.default).enabled=!0,e._shortShake()}).to(.2,{scale:1.2},{easing:"sineOut"}).to(.2,{scale:1},{easing:"sineIn"}).call(function(){i.destroy()}).start(),s++)}),n.forEach(function(t){t.x=110*r-288,r++}),this._ovenItemNum-=3,cc.audioEngine.play(this.soundClip[1],!1,1),this._score+=3,this.scoreLabel&&(this.scoreLabel.string=this._score.toString()),this._score%30==0&&(this.createSpeed-=.1)}else this.effectPool&&this.effectPool.children.forEach(function(t){t.active=!1,t.getComponent(sp.Skeleton).setAnimation(0,"animation",!1)}),i.y+=30,i.opacity=0,cc.tween(i).to(.1,{opacity:255},{easing:"quadIn"}).by(.1,{y:-30},{easing:"quadIn"}).by(.1,{y:10},{easing:"quadOut"}).by(.1,{y:-10},{easing:"quadIn"}).start()}},e.prototype._newItemRow=function(){var t=cc.instantiate(this.itemRowContainer),e=[];if(t&&this.mainContainer){t.y=-1e3,t.setParent(this.mainContainer);for(var i=0;i<this._rowNum;i++){var o,n=cc.instantiate(this.itemContainer);if(o=0!=this._elementContainer.length&&1==this._elementContainer[this._elementContainer.length-1][i].active?2*Math.floor(Math.random()*this.itemArray.length/2)+1:2*Math.floor(Math.random()*this.itemArray.length/2),n){var a=n.getChildByName("item"),s=n.getChildByName("plate");o%2==0?(n.skewX=1,s.getComponent(cc.Sprite).spriteFrame=this.plateArray[0]):s.getComponent(cc.Sprite).spriteFrame=this.plateArray[1],n.width=this._elementContainer.length,n.height=i,a.getComponent(cc.Sprite).spriteFrame=this.itemArray[o],n.setParent(t.children[0]),n.x=120*i-300,e.push(n)}}this._elementContainer.push(e),this._elementRowDestroy.push(this._rowNum)}},e.prototype._shortShake=function(){o.default.instance.miniGameAdapter.vibrateShort(10)},e.prototype.restart=function(){this._score>this._maxScore&&this.maxScoreLabel&&(this._maxScore=this._score,this._gameSave(),this.maxScoreLabel.string=this._maxScore.toString()),this.dieBoard&&this.buttonGroup&&(this.dieBoard.active=!1,this.buttonGroup.active=!1),this._isGameOver=!1,this._isShared=!1,this._initGame()},e.prototype.onElementClick=function(t){var e=this,i=t.target.parent.width,o=t.target.parent.height;if(0==i||0==this._elementContainer[i-1][o].active){if(this._elementContainer[i][o].active=!1,cc.audioEngine.play(this.soundClip[0],!1,1),i<this._elementContainer.length-1){var n=this.itemArray.findIndex(function(t){return t.name==e._elementContainer[i+1][o].children[1].getComponent(cc.Sprite).spriteFrame.name});this._elementContainer[i+1][o].children[1].getComponent(cc.Sprite).spriteFrame=this.itemArray[n-1],this._elementContainer[i+1][o].children[0].getComponent(cc.Sprite).spriteFrame=this.plateArray[0],this._elementContainer[i+1][o].skewX=1}this._elementRowDestroy[i]--,0==this._elementRowDestroy[i]&&this.mainContainer&&(this.mainContainer.children[i].skewX=1),this._ovenAddItem(this._elementContainer[i][o].children[1].getComponent(cc.Sprite).spriteFrame)}},e.prototype.share=function(){var t=this;console.log(this._isShared),this._isShared?o.default.instance.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.dieBoard&&!this._isShared&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.dieBoard,{miniGame:n.SubPackageKey.match3}).then(function(e){var i;if(e){o.default.instance.showTip("\u5206\u4eab\u6210\u529f"),t._isShared=!0,t.dieBoard&&(t.dieBoard.active=!1),t.mainContainer&&t.dieBoard&&t.buttonGroup&&(t.mainContainer.y=t.mainContainerInitPosY,t.dieBoard.active=!1,t.buttonGroup.active=!1),t._isGameOver=!1,t._timer=t.createSpeed,null===(i=t.mainContainer)||void 0===i||i.removeAllChildren(),t._elementContainer=[],t._elementRowDestroy=[];for(var n=0;n<4;n++)t._newItemRow()}else o.default.instance.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit(),this._score>this._maxScore&&this.maxScoreLabel&&(this._maxScore=this._score,this._gameSave(),this.maxScoreLabel.string=this._maxScore.toString())},__decorate([c(cc.Node)],e.prototype,"stopAllClick",void 0),__decorate([c],e.prototype,"createSpeed",void 0),__decorate([c],e.prototype,"smokeSpeed",void 0),__decorate([c],e.prototype,"shakeLevel",void 0),__decorate([c],e.prototype,"moveStepLength",void 0),__decorate([c(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([c(cc.Label)],e.prototype,"maxScoreLabel",void 0),__decorate([c(cc.Node)],e.prototype,"ovenContainer",void 0),__decorate([c(cc.Node)],e.prototype,"ovenContainerBuffer",void 0),__decorate([c(cc.Node)],e.prototype,"mainContainer",void 0),__decorate([c],e.prototype,"mainContainerInitPosY",void 0),__decorate([c(cc.Node)],e.prototype,"itemRowContainer",void 0),__decorate([c(cc.Node)],e.prototype,"itemContainer",void 0),__decorate([c([cc.AudioClip])],e.prototype,"soundClip",void 0),__decorate([c(cc.Node)],e.prototype,"ovenItem",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"itemArray",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"plateArray",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"smokeArray",void 0),__decorate([c(cc.Node)],e.prototype,"dieBoard",void 0),__decorate([c(cc.Node)],e.prototype,"gameOverBlock",void 0),__decorate([c(cc.Node)],e.prototype,"effectPool",void 0),__decorate([c(cc.Node)],e.prototype,"dieIcon",void 0),__decorate([c(cc.Node)],e.prototype,"buttonGroup",void 0),__decorate([c(cc.Animation)],e.prototype,"fireAnim",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","./itemToDie":"itemToDie"}],maxFlowSolver:[function(t,e,i){"use strict";cc._RF.push(e,"785ceECXu1LQYJvB8pLnje3","maxFlowSolver"),Object.defineProperty(i,"__esModule",{value:!0}),i.createFlowGraph=void 0;var o=t("./sheepGuardianMainGame"),n=cc._decorator,a=(n.ccclass,n.property,function(){function t(t,e){this.x=t,this.y=e,this.edges=[],this.residualEdges=[]}return t.prototype.addEdge=function(t){var e,i,o,n,a;e=t.from,i=t.to,o=t.capacity,n=new s(e,i,o),a=new s(i,e,0),n.residualEdge=a,a.residualEdge=n,e.edges.push(n),i.edges.push(a),e.residualEdges.push(a),i.residualEdges.push(n)},t}());var s=function(t,e,i){this.residualEdge=this,this.from=t,this.to=e,this.capacity=i,this.flow=0};function r(t,e){for(var i=0;;){var o=[t],n=new Set,a=new Map;for(n.add(t);o.length>0;){var s=o.shift();if(!s)break;for(var r=0,c=s.edges;r<c.length;r++){var l=(p=c[r]).capacity-p.flow,h=p.to;if(!n.has(h)&&l>0){if(n.add(h),a.set(h,p),h===e)break;o.push(h)}}}if(!n.has(e))break;for(var u=1/0,d=e;d!==t&&(p=a.get(d));)l=p.capacity-p.flow,u=Math.min(u,l),d=p.from;for(d=e;d!==t;){var p;if(!(p=a.get(d)))break;p.flow+=u,p.residualEdge.flow-=u,d=p.from}i+=u}return i}i.createFlowGraph=function(t,e,i,n){for(var c=new Map,l=function(t,e){return t.x+"_"+t.y+"_"+e},h=0;h<t;++h)for(var u=0;u<t;++u)if(e[h][u]!==o.SheepGuardianMapObject.Barrier){var d=new a(h,u),p=new a(h,u);c.set(l(cc.v2(h,u),"in"),d),c.set(l(cc.v2(h,u),"out"),p)}for(h=0;h<t;++h)for(u=0;u<t;++u)if(e[h][u]!==o.SheepGuardianMapObject.Barrier){d=c.get(l(cc.v2(h,u),"in")),p=c.get(l(cc.v2(h,u),"out"));var m=new s(d,p,1);d.addEdge(m);for(var f=0,g=[cc.v2(-1,0),cc.v2(1,0),cc.v2(0,-1),cc.v2(0,1)];f<g.length;f++){var _=g[f],y=h+_.x,v=u+_.y;if(!(y<0||y>=t||v<0||v>=t)&&e[y][v]!==o.SheepGuardianMapObject.Barrier){var b=c.get(l(cc.v2(y,v),"in")),P=new s(p,b,1/0);p.addEdge(P)}}}for(var S=new a(-1,-1),M=new a(-1,-1),w=function(t){return[cc.v2(t.x-1,t.y),cc.v2(t.x+1,t.y),cc.v2(t.x,t.y)]},k=0,C=i;k<C.length;k++)for(var x=0,B=w(C[k]);x<B.length;x++){var T=B[x];if(T.x>=0&&T.x<t&&T.y>=0&&T.y<t&&e[T.x][T.y]!==o.SheepGuardianMapObject.Barrier){var F=c.get(l(T,"out")),E=new s(S,F,1/0);S.addEdge(E)}}for(var N=0,G=n;N<G.length;N++)for(var A=0,R=w(G[N]);A<R.length;A++){var I=R[A];if(I.x>=0&&I.x<t&&I.y>=0&&I.y<t&&e[I.x][I.y]!==o.SheepGuardianMapObject.Barrier){var L=c.get(l(I,"in")),D=new s(L,M,1/0);L.addEdge(D)}}return r(S,M)},cc._RF.pop()},{"./sheepGuardianMainGame":"sheepGuardianMainGame"}],noise:[function(t,e,i){"use strict";cc._RF.push(e,"8d075JUKLJD0b00mStWsEez","noise"),i.__esModule=!0,i.default=void 0;var o,n=4,a=.5,s=function(t){return.5*(1-Math.cos(t*Math.PI))};function r(){}r.prototype.noise=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),null==o){o=new Array(4096);for(var r=0;r<4096;r++)o[r]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),i<0&&(i=-i);for(var c,l,h,u,d,p=Math.floor(t),m=Math.floor(e),f=Math.floor(i),g=t-p,_=e-m,y=i-f,v=0,b=.5,P=0;P<n;P++){var S=p+(m<<4)+(f<<8);c=s(g),l=s(_),h=o[4095&S],h+=c*(o[S+1&4095]-h),u=o[S+16&4095],h+=l*((u+=c*(o[S+16+1&4095]-u))-h),u=o[4095&(S+=256)],u+=c*(o[S+1&4095]-u),d=o[S+16&4095],u+=l*((d+=c*(o[S+16+1&4095]-d))-u),v+=(h+=s(y)*(u-h))*b,b*=a,p<<=1,m<<=1,f<<=1,(g*=2)>=1&&(p++,g--),(_*=2)>=1&&(m++,_--),(y*=2)>=1&&(f++,y--)}return v},r.prototype.noiseDetail=function(t,e){t>0&&(n=t),e>0&&(a=e)},r.prototype.noiseSeed=function(t){var e=function(){var t,e,i=4294967296;return{setSeed:function(o){e=t=(null==o?Math.random()*i:o)>>>0},getSeed:function(){return t},rand:function(){return(e=(1664525*e+1013904223)%i)/i}}}();e.setSeed(t),o=new Array(4096);for(var i=0;i<4096;i++)o[i]=e.rand()};var c=new r;i.default=c,e.exports=i.default,cc._RF.pop()},{}],numberMuzzleMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"d45c6u+quZIzpnBSoUkLXBT","numberMuzzleMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("./numberMuzzleMath")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.numPre=null,e.sceneNode=null,e.countDownLabel=null,e._countDown=0,e._initXY=cc.v2(-210,560),e._intervalXY=80,e._sizeXY=cc.v2(6,12),e._allCells=[],e._allCellNumbers=[],e._changeQueue=[],e._isCanplay=!1,e._isGameOver=!0,e._lastNum=0,e._lastVec=cc.v2(),e._levelData=[{size:cc.v2(3,2),countDown:300},{size:cc.v2(6,12),countDown:420},{size:cc.v2(6,12),countDown:300},{size:cc.v2(6,12),countDown:180}],e._level=0,e._isBackInDrag=!1,e.nowData=[],e.shareNode=null,e.isShared=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},e.prototype.start=function(){this._startAndInitBoard()},e.prototype._startAndInitBoard=function(){var t;if(this._level>=this._levelData.length)this.win();else{this._sizeXY=this._levelData[this._level].size,this._countDown=this._levelData[this._level].countDown,null===(t=this.sceneNode)||void 0===t||t.destroyAllChildren(),this._allCells=[],this._allCellNumbers=[],this._changeQueue=[],this._isCanplay=!1,this._lastNum=0,this._lastVec=cc.v2(),this._isGameOver=!1,this._initXY=cc.v2(-(this._sizeXY.x-1)/2*this._intervalXY,-(this._sizeXY.y-1)/2*this._intervalXY);for(var e=0;e<this._sizeXY.y;e++){for(var i=[],o=[],n=0;n<this._sizeXY.x;n++)if(this.numPre&&this.sceneNode){var a=cc.instantiate(this.numPre);this.sceneNode.addChild(a),a.setPosition(cc.v2(this._initXY.x+n*this._intervalXY,this._initXY.y+e*this._intervalXY)),i.push(a),this._changeCell(a,0),o.push(0)}this._allCells.push(i),this._allCellNumbers.push(o)}}},e.prototype.update=function(t){if(!this._isCanplay&&!this._isGameOver){var e=new a.default(this._sizeXY.x,this._sizeXY.y).generateHamiltonianPath();if(1==e.length)return;this._isCanplay=!0,this.nowData=e;for(var i=0,o=0;o<e.length;o++)if(i>Math.random()){i=.1;var n=e[o].x,s=e[o].y;this._allCellNumbers[s][n]=o+1,this._changeCell(this._allCells[s][n],o+1)}else i+=1.5/e.length}!this._isGameOver&&this._isCanplay&&(this._countDown-=t,this.countDownLabel&&(this.countDownLabel.string="\u5012\u8ba1\u65f6\uff1a"+Math.floor(this._countDown)),this._countDown<1&&this.lose())},e.prototype.share=function(){var t=this;this._isCanplay&&(this.isShared?o.default.instance.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.shareNode&&!this.isShared&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareNode,{miniGame:n.SubPackageKey.numberMuzzle}).then(function(e){if(e){for(o.default.instance.showTip("\u5206\u4eab\u6210\u529f");t._changeQueue.length;)t._cellBack();t.isShared=!0,t.shareNode&&(t.shareNode.active=!1),t.addTipNumber()}else o.default.instance.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)}))},e.prototype.addTipNumber=function(){for(var t=1,e=this.nowData,i=0;i<e.length;i++)if(t>Math.random()){t=.1;var o=e[i].x,n=e[i].y;this._allCellNumbers[n][o]=i+1,this._changeCell(this._allCells[n][o],i+1)}else t+=1.5/e.length;this._lastNum=1,this._lastVec=cc.v2(e[0].x,e[0].y),this._changeQueue.push(this._lastVec),this._checkLastNum(this._lastVec.x,this._lastVec.y)},e.prototype._changeCell=function(t,e){var i=t.getChildByName("1"),o=t.getChildByName("2");if(i&&o)if(0==e)i.active=!0,o.active=!1;else{i.active=!1,o.active=!0;var n=o.getChildByName("label").getComponent(cc.Label);n&&(n.string=e.toString())}},e.prototype._checkLastNum=function(t,e){if(this._lastNum!=this._sizeXY.x*this._sizeXY.y)for(var i=0,o=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}];i<o.length;i++){var n=o[i],a=e+n.x,s=t+n.y;a>=0&&a<this._sizeXY.x&&s>=0&&s<this._sizeXY.y&&this._allCellNumbers[s][a]==this._lastNum+1&&(this._lastNum++,this._lastVec=cc.v2(a,s),this._checkLastNum(s,a))}else this.nextLevel()},e.prototype.onTouchStart=function(t){this._isCanplay&&(this._isBackInDrag=!1,this.node.convertToNodeSpaceAR(t.getLocation()).y<-500&&this._cellBack())},e.prototype.onTouchEnd=function(t){if(this._isCanplay){var e=this.node.convertToNodeSpaceAR(t.getLocation());if(1==this._changeQueue.length&&this._isBackInDrag){var i=this._changeQueue[this._changeQueue.length-1];if(this._allCells[i.y][i.x].getBoundingBox().contains(e))return void this._cellBack()}}},e.prototype.onTouchMove=function(t){if(this._isCanplay){var e=this.node.convertToNodeSpaceAR(t.getLocation());if(this._changeQueue.length>=2){var i=this._changeQueue[this._changeQueue.length-2];if((s=this._allCells[i.y][i.x]).getBoundingBox().contains(e))return void this._cellBack()}for(var o=0;o<this._allCells.length;o++)for(var n=this._allCells[o],a=0;a<n.length;a++){var s;if((s=this._allCells[o][a]).getBoundingBox().contains(e)){if(this._allCellNumbers[o][a])return;for(var r=0,c=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}];r<c.length;r++){var l=c[r],h=a+l.x,u=o+l.y;if(h>=0&&h<this._sizeXY.x&&u>=0&&u<this._sizeXY.y&&(this._allCellNumbers[u][h]==this._lastNum||0==this._lastNum)){if(0!=this._lastNum&&(h!=this._lastVec.x||u!=this._lastVec.y))continue;return this._lastVec=cc.v2(a,o),this._lastNum++,this._allCellNumbers[o][a]=this._lastNum,this._changeCell(s,this._lastNum),this._changeQueue.push(cc.v2(a,o)),void this._checkLastNum(o,a)}}return}}}},e.prototype._cellBack=function(){if(!this.isShared||1!=this._changeQueue.length){var t=this._changeQueue.pop();if(t&&(this._isBackInDrag=!0,this._changeCell(this._allCells[t.y][t.x],0),this._lastNum=this._allCellNumbers[t.y][t.x]-1,this._allCellNumbers[t.y][t.x]=0,this._changeQueue.length>0)){var e=this._changeQueue[this._changeQueue.length-1];if(this._allCellNumbers[e.y][e.x]==this._lastNum)this._lastVec=e;else for(var i=0;i<this._allCellNumbers.length;i++)for(var o=this._allCellNumbers[i],n=0;n<o.length;n++)o[n]==this._lastNum&&(this._lastVec=cc.v2(n,i))}}},e.prototype.win=function(){this._isGameOver=!0,this._isCanplay=!1,o.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype.lose=function(){this._isGameOver=!0,this._isCanplay=!1,o.default.instance.gotoResultWithLoading(!1,this.node.parent)},e.prototype.nextLevel=function(){var t=this;this._level++,this._isGameOver=!0,this._isCanplay=!1,this.isShared=!1,cc.tween(this.node).delay(1).call(function(){t._startAndInitBoard()}).start()},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([c(cc.Prefab)],e.prototype,"numPre",void 0),__decorate([c(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([c(cc.Label)],e.prototype,"countDownLabel",void 0),__decorate([c(cc.Node)],e.prototype,"shareNode",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","./numberMuzzleMath":"numberMuzzleMath"}],numberMuzzleMath:[function(t,e,i){"use strict";cc._RF.push(e,"8e627lnM3REn6/Ehxa87OdV","numberMuzzleMath"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=(o.ccclass,o.property,function(){function t(t,e){this.width=t,this.height=e,this.directions=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}],this.board=Array(e).fill(0).map(function(){return Array(t).fill(0)}),this.path=[]}return t.prototype.shuffleDirections=function(){return this.directions.sort(function(){return Math.random()-.5})},t.prototype.isValidPoint=function(t){return t.x>=0&&t.x<this.width&&t.y>=0&&t.y<this.height},t.prototype.isVisited=function(t){return 1===this.board[t.y][t.x]},t.prototype.visit=function(t){this.board[t.y][t.x]=1,this.path.push(t)},t.prototype.unVisit=function(t){this.board[t.y][t.x]=0,this.path.pop()},t.prototype.dfsFromPoint=function(t,e){e[t.y][t.x]=!0;for(var i=0,o=this.shuffleDirections();i<o.length;i++){var n=o[i],a={x:t.x+n.x,y:t.y+n.y};!this.isValidPoint(a)||e[a.y][a.x]||this.isVisited(a)||this.dfsFromPoint(a,e)}},t.prototype.isConnected=function(){for(var t,e=this,i=Array(this.height).fill(!1).map(function(){return Array(e.width).fill(!1)}),o=0;o<this.height;o++){for(var n=0;n<this.width;n++)if(!this.board[o][n]){t={x:n,y:o};break}if(t)break}if(!t)return!0;for(this.dfsFromPoint(t,i),o=0;o<this.height;o++)for(n=0;n<this.width;n++)if(!this.board[o][n]&&!i[o][n])return!1;return!0},t.prototype.dfs=function(t){if(this.path.length===this.width*this.height)return!0;for(var e=0,i=this.shuffleDirections();e<i.length;e++){var o=i[e],n={x:t.x+o.x,y:t.y+o.y};if(this.isValidPoint(n)&&!this.isVisited(n)){if(this.visit(n),this.isConnected()&&this.dfs(n))return!0;this.unVisit(n)}}return!1},t.prototype.generateHamiltonianPath=function(){var t={x:Math.floor(Math.random()*this.width),y:Math.floor(Math.random()*this.height)};return this.visit(t),this.dfs(t),this.path},t}());i.default=n,cc._RF.pop()},{}],numberMuzzleModel:[function(t,e,i){"use strict";cc._RF.push(e,"8ec67arTf9Bn6eShu0C1HIm","numberMuzzleModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.NumberMuzzleModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=cc._decorator,r=(s.ccclass,s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/numberMuzzle/numberMuzzleMainGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.numberMuzzle)],e)}(n.default));i.NumberMuzzleModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],oilRushChest:[function(t,e,i){"use strict";cc._RF.push(e,"070ceuYF9dCt6y894PV+zAI","oilRushChest"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.score=0,e.life=100,e.sp=null,e.sprite=null,e.frames=[],e.shakeAmount=0,e.position=cc.v2(0,0),e.radius=0,e.maxLife=2,e}return __extends(e,t),e.prototype.init=function(){if(Math.random()>.3){var t=Math.floor(Math.random()*this.frames.length);this.sp&&(this.sp.node.active=!1),this.sprite&&(this.sprite.node.active=!0,this.sprite.spriteFrame=this.frames[t]),this.life=1,this.score=5,this.position=this.node.getPosition(),this.radius=Math.min(this.frames[t].getRect().width/2,this.frames[t].getRect().height/2)}else t=Math.floor(5*Math.random())+1,this.sp&&(this.sp.node.active=!0,this.sp.setSkin(t.toString())),this.sprite&&(this.sprite.node.active=!1),this.radius=65,this.life=1+.2*t,this.score=10*t,this.position=this.node.getPosition()},e.prototype.update=function(){this.node.setPosition(this.position.x+Math.random()*this.shakeAmount*2-this.shakeAmount,this.position.y+Math.random()*this.shakeAmount*2-this.shakeAmount),this.shakeAmount=0},e.prototype.shake=function(){this.shakeAmount=5-5*this.life/this.maxLife},__decorate([a(sp.Skeleton)],e.prototype,"sp",void 0),__decorate([a(cc.Sprite)],e.prototype,"sprite",void 0),__decorate([a([cc.SpriteFrame])],e.prototype,"frames",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],oilRushMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"cded1M/CEJGD4rYYbjZ6HxA","oilRushMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=__importDefault(t("./oilRushChest")),s=__importDefault(t("./oilRushOil")),r=cc._decorator,c=r.ccclass,l=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.drillNode=null,e.sceneNode=null,e.bg=null,e.graphicsNode=null,e.oilPrefab=null,e.chestPrefab=null,e.scoreLabel=null,e.depthLabel=null,e.floorFrames=[],e.dustFrame=null,e.dustNode=null,e.initY=-2664,e._floorX=748,e._floorY=1131,e._positions=[],e._graphics=null,e._currentAngle=0,e._drillSpeed=300,e._drillSk1=null,e._drillSk2=null,e._oilAmount=100,e._isMove=!0,e._addOilAmount={num:0},e._floors=[],e._posSet=new Set,e._baseOilConsumption=10,e._oilNodes=[],e._lastOilDepth=0,e._perFloorNum=10,e._treasureNodes=[],e._lastTreasureDepth=0,e._score=0,e._isGameOver=!1,e.shareNode=null,e.isShared=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"oilAmount",{get:function(){return this._oilAmount+this._addOilAmount.num},set:function(t){this._oilAmount=t-this._addOilAmount.num},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),cc.game.setFrameRate(60)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),cc.game.setFrameRate(30)},e.prototype.start=function(){this.graphicsNode&&this.drillNode&&(this._graphics=this.graphicsNode.addComponent(cc.Graphics),this.graphicsNode.zIndex=3,this.drillNode.zIndex=4,this._drillSk1=this.drillNode.getChildByName("1"),this._drillSk2=this.drillNode.getChildByName("2"))},e.prototype._checkFloor=function(){var t=function(t,e){return t+"_"+e};if(this.drillNode&&this.bg&&this.dustFrame&&this.dustNode){var e=Math.floor(this.drillNode.x/this._floorX),i=Math.floor((this.drillNode.y-this.initY)/this._floorY);i=Math.min(-1,i);for(var o=-2;o<=1;o++)for(var n=-2;n<=2;n++){var a=e+n,s=i+o;if(!this._posSet.has(t(a,s))){this._posSet.add(t(a,s));var r=(d=new cc.Node).addComponent(cc.Sprite),c=Math.min(this.floorFrames.length-1,Math.floor(-s/this._perFloorNum));r.spriteFrame=this.floorFrames[c],a%2!=0&&(d.scaleX=-1),d.parent=this.bg,d.setPosition(a*this._floorX,s*this._floorY+this.initY),this._floors.push(d);for(var l=1;l<=8;l++){var h=new cc.Node;h.addComponent(cc.Sprite).spriteFrame=this.dustFrame;var u=cc.v2(Math.random()*this._floorX-this._floorX/2,Math.random()*this._floorY-this._floorY/2);h.parent=this.dustNode,h.setPosition(d.getPosition().add(u))}}}for(o=0;o<this._floors.length;o++){var d;(d=this._floors[o]).getPosition().sub(this.drillNode.getPosition()).mag()>1e4&&(this._floors.splice(o,1),d.destroy())}}},e.prototype.update=function(t){var e=this;if(!this._isGameOver&&this.drillNode&&this.sceneNode){this.scoreLabel&&(this.scoreLabel.string="\u5206\u6570\uff1a"+this._score.toString()),this.depthLabel&&(this.depthLabel.string="\u6df1\u5ea6\uff1a"+Math.floor(-this.drillNode.y).toString()),this._score>=1e3&&this.win(),this._checkFloor();var i=this.drillNode.position,o=cc.misc.degreesToRadians(this._currentAngle);if(i.x+=Math.sin(o)*this._drillSpeed*t,i.y-=Math.cos(o)*this._drillSpeed*t,this._isMove&&(this.drillNode.position=i,this.sceneNode&&(this.sceneNode.y=-this.drillNode.y,this.sceneNode.x=-this.drillNode.x),this._positions.push(this.drillNode.getPosition().clone())),this._positions.length>1e3&&this._positions.shift(),this._graphics){var n=function(t){if(void 0===t&&(t=2e3),e._graphics&&e._positions.length>1){e._graphics.moveTo(e._positions[e._positions.length-1].x,e._positions[e._positions.length-1].y);for(var i=2;i<=e._positions.length;i++){var o=e._positions.length-i,n=e._positions[o+1].sub(e._positions[o]).mag();if(n>t){var a=e._positions[o+1].add(e._positions[o].sub(e._positions[o+1]).normalize().mul(t));e._graphics.lineTo(a.x,a.y);break}e._graphics.lineTo(e._positions[o].x,e._positions[o].y),t-=n}e._graphics.stroke()}};this._graphics.clear(),this._graphics.strokeColor=cc.Color.GRAY,this._graphics.lineWidth=40,n(),this._graphics.strokeColor=cc.color(168,168,168),this._graphics.lineWidth=30,n(),this._graphics.strokeColor=cc.Color.BLACK,this._graphics.lineWidth=30,n(5*this.oilAmount)}var a=-this.drillNode.position.y,s=t*this._baseOilConsumption*Math.pow(1.015,1+a/1e3);this.oilAmount-=s,this.oilAmount<=0&&this.lose(),this._checkOil(),this._checkChest(t)}},e.prototype._checkOil=function(){if(this.drillNode&&this.sceneNode){for(var t=this._oilNodes.length-1;t>=0;t--)(e=this._oilNodes[t]).node.position.y>this.drillNode.position.y+1e3?(e.use(),this._oilNodes.splice(t,1)):e.node.position.sub(this.drillNode.position).mag()<65&&(e.use(),this._oilNodes.splice(t,1),cc.tween(this._addOilAmount).by(.5,{num:50}).start());if(this.drillNode.position.y<this._lastOilDepth-500&&this.oilPrefab){var e,i=cc.v2(this.drillNode.position.x+600*Math.random()-300,this.drillNode.position.y-1500);for(t=0;t<this._treasureNodes.length;t++)if(i.sub(this._treasureNodes[t].position).mag()<200)return;(e=cc.instantiate(this.oilPrefab)).parent=this.sceneNode,e.setPosition(i);var o=Math.max(0,-Math.floor((e.y-this.initY)/this._floorY/this._perFloorNum)-1),n=e.getComponent(s.default);n.init(o),this._oilNodes.push(n),this._lastOilDepth=this.drillNode.position.y}}},e.prototype._checkChest=function(t){if(this.drillNode&&this.sceneNode&&this.chestPrefab){this._isMove=!0;for(var e=this._treasureNodes.length-1;e>=0;e--)(i=this._treasureNodes[e]).position.y>this.drillNode.position.y+1e3?(i.node.destroy(),this._treasureNodes.splice(e,1)):i.position.sub(this.drillNode.getPosition()).mag()<i.radius&&(i.life<=0?(this._drillSk1&&(this._drillSk1.active=!0),this._drillSk2&&(this._drillSk2.active=!1),this._treasureNodes.splice(e,1),this._score+=i.score,this._showAddScore(i.score,i.position),i.node.destroy()):(this._drillSk1&&(this._drillSk1.active=!1),this._drillSk2&&(this._drillSk2.active=!0),i.life-=t,i.shake(),this._isMove=!1));var i;this.drillNode.position.y<this._lastTreasureDepth-200*Math.random()-200&&(this._lastTreasureDepth=this.drillNode.position.y,(i=cc.instantiate(this.chestPrefab).getComponent(a.default)).node.parent=this.sceneNode,i.node.setPosition(cc.v2(this.drillNode.position.x+1e3*Math.random()-500,this.drillNode.position.y-2e3)),i.init(),this._treasureNodes.push(i))}},e.prototype._showAddScore=function(t,e){var i=new cc.Node("addScore"),o=i.addComponent(cc.Label);i.color=cc.Color.YELLOW,o.string="+"+t.toString(),this.sceneNode&&this.sceneNode.addChild(i),i.setPosition(e),i.zIndex=cc.macro.MAX_ZINDEX,cc.tween(i).by(1,{position:cc.v3(0,50,0),opacity:-255}).call(function(){i.destroy()}).start()},e.prototype.lose=function(){this._isGameOver=!0,this.shareNode&&(this.shareNode.active=!0,this.shareNode.getChildByName("label").getComponent(cc.Label).string=this._score+"")},e.prototype.win=function(){this._isGameOver=!0,o.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype.share=function(){var t=this;this.isShared?o.default.instance.showTip("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.shareNode&&!this.isShared&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareNode,{miniGame:n.SubPackageKey.oilRush}).then(function(e){e?(o.default.instance.showTip("\u5206\u4eab\u6210\u529f"),t.isShared=!0,t.shareNode&&(t.shareNode.active=!1),t._addOilAmount.num+=50,t._isGameOver=!1,cc.tween(t._addOilAmount).by(.5,{num:150}).start()):o.default.instance.showTip("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.onTouchMove=function(t){if(this.drillNode){var e=.25*t.getDelta().x,i=this._currentAngle+e;i<-60?i=-60:i>60&&(i=60),this._currentAngle=i,this.drillNode.angle=this._currentAngle}},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([l(cc.Node)],e.prototype,"drillNode",void 0),__decorate([l(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([l(cc.Node)],e.prototype,"bg",void 0),__decorate([l(cc.Node)],e.prototype,"graphicsNode",void 0),__decorate([l(cc.Prefab)],e.prototype,"oilPrefab",void 0),__decorate([l(cc.Prefab)],e.prototype,"chestPrefab",void 0),__decorate([l(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([l(cc.Label)],e.prototype,"depthLabel",void 0),__decorate([l([cc.SpriteFrame])],e.prototype,"floorFrames",void 0),__decorate([l(cc.SpriteFrame)],e.prototype,"dustFrame",void 0),__decorate([l(cc.Node)],e.prototype,"dustNode",void 0),__decorate([l(cc.Float)],e.prototype,"initY",void 0),__decorate([l(cc.Node)],e.prototype,"shareNode",void 0),__decorate([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame","./oilRushChest":"oilRushChest","./oilRushOil":"oilRushOil"}],oilRushModel:[function(t,e,i){"use strict";cc._RF.push(e,"70008EPmIROkoJSkySFgHW+","oilRushModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.OilRushModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=cc._decorator,r=(s.ccclass,s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/oilRush/oilRushMainGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.oilRush)],e)}(n.default));i.OilRushModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],oilRushOil:[function(t,e,i){"use strict";cc._RF.push(e,"70e6dM0G+FC5K9YdXzdRZN3","oilRushOil"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.graphicsNode=null,e.frames=[],e.mask=null,e.sprite=null,e.graphics=null,e.height={num:100},e.time=0,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.init=function(t){if(t=Math.min(4,t),this.graphicsNode&&(this.graphics=this.graphicsNode.addComponent(cc.Graphics)),this.height={num:30*Math.random()+50},this.mask&&this.sprite){var e=Math.floor(7*Math.random());e+=7*t,cc.log(e),e>=this.frames.length&&cc.error("runtime error"),this.mask.spriteFrame=this.frames[e],this.mask.node.setContentSize(this.frames[e].getRect()),this.sprite.spriteFrame=this.frames[e]}},e.prototype.use=function(){var t=this;cc.tween(this.height).to(1,{num:0}).delay(5).call(function(){t&&t.node&&t.node.destroy()}).start()},e.prototype.update=function(t){this.time+=90*t,this.graphics&&(this.graphics.clear(),this.graphics.lineWidth=5,this.graphics.strokeColor=cc.Color.BLACK,this.graphics.fillColor=cc.color(30,44,79),this.draw(this.time,this.height.num+10),this.graphics.strokeColor=cc.Color.BLACK,this.graphics.fillColor=cc.Color.BLACK,this.draw(this.time+180,this.height.num))},e.prototype.draw=function(t,e){if(t=t*Math.PI/180,this.graphics){this.graphics.moveTo(-100,7*Math.sin(t)-60+e);for(var i=0;i<200;i++){var o=7*Math.sin(.02*i+t)-60+e;this.graphics.lineTo(i-100,o)}this.graphics.lineTo(100,-60),this.graphics.lineTo(-100,-60),this.graphics.close(),this.graphics.stroke(),this.graphics.fill()}},__decorate([a(cc.Node)],e.prototype,"graphicsNode",void 0),__decorate([a([cc.SpriteFrame])],e.prototype,"frames",void 0),__decorate([a(cc.Mask)],e.prototype,"mask",void 0),__decorate([a(cc.Sprite)],e.prototype,"sprite",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],oneLayer:[function(t,e,i){"use strict";cc._RF.push(e,"7a2b1no0n1Juq/KUPatQgi9","oneLayer"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scenePres=[],e.scenes=[],e.viewportWidth=1e4,e}return __extends(e,t),e.prototype.update=function(){this._manageScenes()},e.prototype.setPosition=function(t){this.node.setPosition(t)},e.prototype._scenePrefab=function(){var t=Math.floor(Math.random()*this.scenePres.length);return this.scenePres[t]},e.prototype._manageScenes=function(){for(var t=-this.node.x,e=this.scenes.length-1;e>=0;e--)this.scenes[e].x+this.scenes[e].width/2<t-this.viewportWidth/2&&this.scenes.splice(e,1)[0].destroy();var i=this.scenes[this.scenes.length-1];if(!i||i.x+i.width/2<t+this.viewportWidth/2){var o=cc.instantiate(this._scenePrefab());o.parent=this.node,o.x=(null!=i?i.x+i.width/2:t-this.viewportWidth/2)+o.width/2,this.scenes.push(o)}},__decorate([a([cc.Node])],e.prototype,"scenePres",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],p2:[function(t,e,i){(function(o){"use strict";var n;cc._RF.push(e,"df2493vXLtE3pr4WP12Aj2f","p2"),"undefined"!=typeof window?n=window:void 0!==o?n=o:"undefined"!=typeof self&&(n=self),n.p2=function e(i,o,n){function a(r,c){if(!o[r]){if(!i[r]){var l="function"==typeof t&&t;if(!c&&l)return l(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var h=o[r]={exports:{}};i[r][0].call(h.exports,function(t){return a(i[r][1][t]||t)},h,h.exports,e,i,o,n)}return o[r].exports}for(var s="function"==typeof t&&t,r=0;r<n.length;r++)a(n[r]);return a}({1:[function(t,e){function i(){}var o=t("./Scalar");e.exports=i,i.lineInt=function(t,e,i){i=i||0;var n,a,s,r,c,l,h,u=[0,0];return n=t[1][1]-t[0][1],a=t[0][0]-t[1][0],s=n*t[0][0]+a*t[0][1],r=e[1][1]-e[0][1],c=e[0][0]-e[1][0],l=r*e[0][0]+c*e[0][1],h=n*c-r*a,o.eq(h,0,i)||(u[0]=(c*s-a*l)/h,u[1]=(n*l-r*s)/h),u},i.segmentsIntersect=function(t,e,i,o){var n=e[0]-t[0],a=e[1]-t[1],s=o[0]-i[0],r=o[1]-i[1];if(s*a-r*n==0)return!1;var c=(n*(i[1]-t[1])+a*(t[0]-i[0]))/(s*a-r*n),l=(s*(t[1]-i[1])+r*(i[0]-t[0]))/(r*n-s*a);return c>=0&&1>=c&&l>=0&&1>=l}},{"./Scalar":4}],2:[function(t,e){function i(){}e.exports=i,i.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},i.left=function(t,e,o){return i.area(t,e,o)>0},i.leftOn=function(t,e,o){return i.area(t,e,o)>=0},i.right=function(t,e,o){return i.area(t,e,o)<0},i.rightOn=function(t,e,o){return i.area(t,e,o)<=0};var o=[],n=[];i.collinear=function(t,e,a,s){if(s){var r=o,c=n;r[0]=e[0]-t[0],r[1]=e[1]-t[1],c[0]=a[0]-e[0],c[1]=a[1]-e[1];var l=r[0]*c[0]+r[1]*c[1],h=Math.sqrt(r[0]*r[0]+r[1]*r[1]),u=Math.sqrt(c[0]*c[0]+c[1]*c[1]);return s>Math.acos(l/(h*u))}return 0==i.area(t,e,a)},i.sqdist=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o}},{}],3:[function(t,e){function i(){this.vertices=[]}function o(t,e,i,o,n){n=n||0;var a=e[1]-t[1],r=t[0]-e[0],c=a*t[0]+r*t[1],l=o[1]-i[1],h=i[0]-o[0],u=l*i[0]+h*i[1],d=a*h-l*r;return s.eq(d,0,n)?[0,0]:[(h*c-r*u)/d,(a*u-l*c)/d]}var n=t("./Line"),a=t("./Point"),s=t("./Scalar");e.exports=i,i.prototype.at=function(t){var e=this.vertices,i=e.length;return e[0>t?t%i+i:t%i]},i.prototype.first=function(){return this.vertices[0]},i.prototype.last=function(){return this.vertices[this.vertices.length-1]},i.prototype.clear=function(){this.vertices.length=0},i.prototype.append=function(t,e,i){if(void 0===e)throw new Error("From is not given!");if(void 0===i)throw new Error("To is not given!");if(e>i-1)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(0>e)throw new Error("lol3");for(var o=e;i>o;o++)this.vertices.push(t.vertices[o])},i.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);a.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},i.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},i.prototype.isReflex=function(t){return a.right(this.at(t-1),this.at(t),this.at(t+1))};var r=[],c=[];i.prototype.canSee=function(t,e){var i,o,s=r,l=c;if(a.leftOn(this.at(t+1),this.at(t),this.at(e))&&a.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;o=a.sqdist(this.at(t),this.at(e));for(var h=0;h!==this.vertices.length;++h)if((h+1)%this.vertices.length!==t&&h!==t&&a.leftOn(this.at(t),this.at(e),this.at(h+1))&&a.rightOn(this.at(t),this.at(e),this.at(h))&&(s[0]=this.at(t),s[1]=this.at(e),l[0]=this.at(h),l[1]=this.at(h+1),i=n.lineInt(s,l),a.sqdist(this.at(t),i)<o))return!1;return!0},i.prototype.copy=function(t,e,o){var n=o||new i;if(n.clear(),e>t)for(var a=t;e>=a;a++)n.vertices.push(this.vertices[a]);else{for(a=0;e>=a;a++)n.vertices.push(this.vertices[a]);for(a=t;a<this.vertices.length;a++)n.vertices.push(this.vertices[a])}return n},i.prototype.getCutEdges=function(){for(var t=[],e=[],o=[],n=new i,a=Number.MAX_VALUE,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var r=0;r<this.vertices.length;++r)if(this.canSee(s,r)){e=this.copy(s,r,n).getCutEdges(),o=this.copy(r,s,n).getCutEdges();for(var c=0;c<o.length;c++)e.push(o[c]);e.length<a&&(t=e,a=e.length,t.push([this.at(s),this.at(r)]))}return t},i.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},i.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var o=t[i],n=0;n<e.length;n++){var a=e[n].slice(o);if(a){e.splice(n,1),e.push(a[0],a[1]);break}}return e}return o=t,i=this.vertices.indexOf(o[0]),n=this.vertices.indexOf(o[1]),-1!=i&&-1!=n&&[this.copy(i,n),this.copy(n,i)]},i.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;e-1>i;i++)if(n.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(e=1;e<t.length-2;e++)if(n.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},i.prototype.quickDecomp=function(t,e,n,s,r,c){r=r||100,c=c||0,s=s||25,t=void 0!==t?t:[],e=e||[],n=n||[];var l=[0,0],h=[0,0],u=[0,0],d=0,p=0,m=0,f=0,g=0,_=0,y=0,v=new i,b=new i,P=this,S=this.vertices;if(S.length<3)return t;if(++c>r)return console.warn("quickDecomp: max level ("+r+") reached."),t;for(var M=0;M<this.vertices.length;++M)if(P.isReflex(M)){e.push(P.vertices[M]),d=p=Number.MAX_VALUE;for(var w=0;w<this.vertices.length;++w)a.left(P.at(M-1),P.at(M),P.at(w))&&a.rightOn(P.at(M-1),P.at(M),P.at(w-1))&&(u=o(P.at(M-1),P.at(M),P.at(w),P.at(w-1)),a.right(P.at(M+1),P.at(M),u)&&p>(m=a.sqdist(P.vertices[M],u))&&(p=m,h=u,_=w)),a.left(P.at(M+1),P.at(M),P.at(w+1))&&a.rightOn(P.at(M+1),P.at(M),P.at(w))&&(u=o(P.at(M+1),P.at(M),P.at(w),P.at(w+1)),a.left(P.at(M-1),P.at(M),u)&&d>(m=a.sqdist(P.vertices[M],u))&&(d=m,l=u,g=w));if(_==(g+1)%this.vertices.length)u[0]=(h[0]+l[0])/2,u[1]=(h[1]+l[1])/2,n.push(u),g>M?(v.append(P,M,g+1),v.vertices.push(u),b.vertices.push(u),0!=_&&b.append(P,_,P.vertices.length),b.append(P,0,M+1)):(0!=M&&v.append(P,M,P.vertices.length),v.append(P,0,g+1),v.vertices.push(u),b.vertices.push(u),b.append(P,_,M+1));else{if(_>g&&(g+=this.vertices.length),f=Number.MAX_VALUE,_>g)return t;for(w=_;g>=w;++w)a.leftOn(P.at(M-1),P.at(M),P.at(w))&&a.rightOn(P.at(M+1),P.at(M),P.at(w))&&f>(m=a.sqdist(P.at(M),P.at(w)))&&(f=m,y=w%this.vertices.length);y>M?(v.append(P,M,y+1),0!=y&&b.append(P,y,S.length),b.append(P,0,M+1)):(0!=M&&v.append(P,M,S.length),v.append(P,0,y+1),b.append(P,y,M+1))}return v.vertices.length<b.vertices.length?(v.quickDecomp(t,e,n,s,r,c),b.quickDecomp(t,e,n,s,r,c)):(b.quickDecomp(t,e,n,s,r,c),v.quickDecomp(t,e,n,s,r,c)),t}return t.push(this),t},i.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)a.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e){function i(){}e.exports=i,i.eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],5:[function(t,e){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e){e.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(t,e){function i(t){this.lowerBound=o.create(),t&&t.lowerBound&&o.copy(this.lowerBound,t.lowerBound),this.upperBound=o.create(),t&&t.upperBound&&o.copy(this.upperBound,t.upperBound)}var o=t("../math/vec2");t("../utils/Utils"),e.exports=i;var n=o.create();i.prototype.setFromPoints=function(t,e,i,a){var s=this.lowerBound,r=this.upperBound;"number"!=typeof i&&(i=0),0!==i?o.rotate(s,t[0],i):o.copy(s,t[0]),o.copy(r,s);for(var c=Math.cos(i),l=Math.sin(i),h=1;h<t.length;h++){var u=t[h];if(0!==i){var d=u[0],p=u[1];n[0]=c*d-l*p,n[1]=l*d+c*p,u=n}for(var m=0;2>m;m++)u[m]>r[m]&&(r[m]=u[m]),u[m]<s[m]&&(s[m]=u[m])}e&&(o.add(this.lowerBound,this.lowerBound,e),o.add(this.upperBound,this.upperBound,e)),a&&(this.lowerBound[0]-=a,this.lowerBound[1]-=a,this.upperBound[0]+=a,this.upperBound[1]+=a)},i.prototype.copy=function(t){o.copy(this.lowerBound,t.lowerBound),o.copy(this.upperBound,t.upperBound)},i.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);var o=t.upperBound[e];this.upperBound[e]<o&&(this.upperBound[e]=o)}},i.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,o=t.lowerBound,n=t.upperBound;return(o[0]<=i[0]&&i[0]<=n[0]||e[0]<=n[0]&&n[0]<=i[0])&&(o[1]<=i[1]&&i[1]<=n[1]||e[1]<=n[1]&&n[1]<=i[1])},i.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},i.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],o=(this.lowerBound[0]-t.from[0])*e,n=(this.upperBound[0]-t.from[0])*e,a=(this.lowerBound[1]-t.from[1])*i,s=(this.upperBound[1]-t.from[1])*i,r=Math.max(Math.max(Math.min(o,n),Math.min(a,s))),c=Math.min(Math.min(Math.max(o,n),Math.max(a,s)));return 0>c?-1:r>c?-1:r}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e){function i(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=i.AABB}var o=t("../math/vec2"),n=t("../objects/Body");e.exports=i,i.AABB=1,i.BOUNDING_CIRCLE=2,i.prototype.setWorld=function(t){this.world=t},i.prototype.getCollisionPairs=function(){};var a=o.create();i.boundingRadiusCheck=function(t,e){o.sub(a,t.position,e.position);var i=o.squaredLength(a),n=t.boundingRadius+e.boundingRadius;return n*n>=i},i.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},i.prototype.boundingVolumeCheck=function(t,e){var o;switch(this.boundingVolumeType){case i.BOUNDING_CIRCLE:o=i.boundingRadiusCheck(t,e);break;case i.AABB:o=i.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return o},i.canCollide=function(t,e){var i=n.KINEMATIC,o=n.STATIC;return!(t.type===o&&e.type===o||t.type===i&&e.type===o||t.type===o&&e.type===i||t.type===i&&e.type===i||t.sleepState===n.SLEEPING&&e.sleepState===n.SLEEPING||t.sleepState===n.SLEEPING&&e.type===o||e.sleepState===n.SLEEPING&&t.type===o)},i.NAIVE=1,i.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e){function i(){o.call(this,o.NAIVE)}var o=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2"),e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var n=0,a=e.length;n!==a;n++)for(var s=e[n],r=0;n>r;r++){var c=e[r];o.canCollide(s,c)&&this.boundingVolumeCheck(s,c)&&i.push(s,c)}return i},i.prototype.aabbQuery=function(t,e,i){i=i||[];for(var o=t.bodies,n=0;n<o.length;n++){var a=o[n];a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(e)&&i.push(a)}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e){function i(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new l({size:32}),this.frictionEquationPool=new h({size:64}),this.restitution=0,this.stiffness=d.DEFAULT_STIFFNESS,this.relaxation=d.DEFAULT_RELAXATION,this.frictionStiffness=d.DEFAULT_STIFFNESS,this.frictionRelaxation=d.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new u,this.contactSkinSize=.01}function o(t,e){a.set(t.vertices[0],.5*-e.length,-e.radius),a.set(t.vertices[1],.5*e.length,-e.radius),a.set(t.vertices[2],.5*e.length,e.radius),a.set(t.vertices[3],.5*-e.length,e.radius)}function n(t,e,i,o){for(var n=j,c=W,l=q,h=K,u=t,d=e.vertices,p=null,m=0;m!==d.length+1;m++){var f=d[m%d.length],g=d[(m+1)%d.length];a.rotate(n,f,o),a.rotate(c,g,o),r(n,n,i),r(c,c,i),s(l,n,u),s(h,c,u);var _=a.crossLength(l,h);if(null===p&&(p=_),0>=_*p)return!1;p=_}return!0}var a=t("../math/vec2"),s=a.sub,r=a.add,c=a.dot,l=(t("../utils/Utils"),t("../utils/ContactEquationPool")),h=t("../utils/FrictionEquationPool"),u=t("../utils/TupleDictionary"),d=t("../equations/Equation"),p=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),m=t("../shapes/Convex"),f=t("../shapes/Shape"),g=(t("../objects/Body"),t("../shapes/Box"));e.exports=i;var _=a.fromValues(0,1),y=a.fromValues(0,0),v=a.fromValues(0,0),b=a.fromValues(0,0),P=a.fromValues(0,0),S=a.fromValues(0,0),M=a.fromValues(0,0),w=a.fromValues(0,0),k=a.fromValues(0,0),C=a.fromValues(0,0),x=a.fromValues(0,0),B=a.fromValues(0,0),T=a.fromValues(0,0),F=a.fromValues(0,0),E=a.fromValues(0,0),N=a.fromValues(0,0),G=a.fromValues(0,0),A=a.fromValues(0,0),R=a.fromValues(0,0),I=[],L=a.create(),D=a.create();i.prototype.bodiesOverlap=function(t,e){for(var i=L,o=D,n=0,a=t.shapes.length;n!==a;n++){var s=t.shapes[n];t.toWorldFrame(i,s.position);for(var r=0,c=e.shapes.length;r!==c;r++){var l=e.shapes[r];if(e.toWorldFrame(o,l.position),this[s.type|l.type](t,s,i,s.angle+t.angle,e,l,o,l.angle+e.angle,!0))return!0}}return!1},i.prototype.collidedLastStep=function(t,e){var i=0|t.id,o=0|e.id;return!!this.collidingBodiesLastStep.get(i,o)},i.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],o=i.bodyA.id,n=i.bodyB.id;this.collidingBodiesLastStep.set(o,n,!0)}for(var a=this.contactEquations,s=this.frictionEquations,r=0;r<a.length;r++)this.contactEquationPool.release(a[r]);for(r=0;r<s.length;r++)this.frictionEquationPool.release(s[r]);this.contactEquations.length=this.frictionEquations.length=0},i.prototype.createContactEquation=function(t,e,i,o){var n=this.contactEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=o,n.restitution=this.restitution,n.firstImpact=!this.collidedLastStep(t,e),n.stiffness=this.stiffness,n.relaxation=this.relaxation,n.needsUpdate=!0,n.enabled=this.enabledEquations,n.offset=this.contactSkinSize,n},i.prototype.createFrictionEquation=function(t,e,i,o){var n=this.frictionEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=o,n.setSlipForce(this.slipForce),n.frictionCoefficient=this.frictionCoefficient,n.relativeVelocity=this.surfaceVelocity,n.enabled=this.enabledEquations,n.needsUpdate=!0,n.stiffness=this.frictionStiffness,n.relaxation=this.frictionRelaxation,n.contactEquations.length=0,n},i.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return a.copy(e.contactPointA,t.contactPointA),a.copy(e.contactPointB,t.contactPointB),a.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},i.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),o=e.bodyA;e.bodyB,a.set(i.contactPointA,0,0),a.set(i.contactPointB,0,0),a.set(i.t,0,0);for(var n=0;n!==t;n++)(e=this.contactEquations[this.contactEquations.length-1-n]).bodyA===o?(a.add(i.t,i.t,e.normalA),a.add(i.contactPointA,i.contactPointA,e.contactPointA),a.add(i.contactPointB,i.contactPointB,e.contactPointB)):(a.sub(i.t,i.t,e.normalA),a.add(i.contactPointA,i.contactPointA,e.contactPointB),a.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var s=1/t;return a.scale(i.contactPointA,i.contactPointA,s),a.scale(i.contactPointB,i.contactPointB,s),a.normalize(i.t,i.t),a.rotate90cw(i.t,i.t),i},i.prototype[f.LINE|f.CONVEX]=i.prototype.convexLine=function(t,e,i,o,n,a,s,r,c){return!c&&0},i.prototype[f.LINE|f.BOX]=i.prototype.lineBox=function(t,e,i,o,n,a,s,r,c){return!c&&0};var O=new g({width:1,height:1}),z=a.create();i.prototype[f.CAPSULE|f.CONVEX]=i.prototype[f.CAPSULE|f.BOX]=i.prototype.convexCapsule=function(t,e,i,n,s,r,c,l,h){var u=z;a.set(u,r.length/2,0),a.rotate(u,u,l),a.add(u,u,c);var d=this.circleConvex(s,r,u,l,t,e,i,n,h,r.radius);a.set(u,-r.length/2,0),a.rotate(u,u,l),a.add(u,u,c);var p=this.circleConvex(s,r,u,l,t,e,i,n,h,r.radius);if(h&&(d||p))return!0;var m=O;return o(m,r),this.convexConvex(t,e,i,n,s,m,c,l,h)+d+p},i.prototype[f.CAPSULE|f.LINE]=i.prototype.lineCapsule=function(t,e,i,o,n,a,s,r,c){return!c&&0};var U=a.create(),H=a.create(),V=new g({width:1,height:1});i.prototype[f.CAPSULE|f.CAPSULE]=i.prototype.capsuleCapsule=function(t,e,i,n,s,r,c,l,h){for(var u=U,d=H,p=0,m=0;2>m;m++){a.set(u,(0===m?-1:1)*e.length/2,0),a.rotate(u,u,n),a.add(u,u,i);for(var f=0;2>f;f++){a.set(d,(0===f?-1:1)*r.length/2,0),a.rotate(d,d,l),a.add(d,d,c),this.enableFrictionReduction&&(v=this.enableFriction,this.enableFriction=!1);var g=this.circleCircle(t,e,u,n,s,r,d,l,h,e.radius,r.radius);if(this.enableFrictionReduction&&(this.enableFriction=v),h&&g)return!0;p+=g}}this.enableFrictionReduction&&(v=this.enableFriction,this.enableFriction=!1);var _=V;o(_,e);var y=this.convexCapsule(t,_,i,n,s,r,c,l,h);if(this.enableFrictionReduction&&(this.enableFriction=v),h&&y)return!0;if(p+=y,this.enableFrictionReduction){var v=this.enableFriction;this.enableFriction=!1}o(_,r);var b=this.convexCapsule(s,_,c,l,t,e,i,n,h);return this.enableFrictionReduction&&(this.enableFriction=v),!(!h||!b)||(p+=b,this.enableFrictionReduction&&p&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(p)),p)},i.prototype[f.LINE|f.LINE]=i.prototype.lineLine=function(t,e,i,o,n,a,s,r,c){return!c&&0},i.prototype[f.PLANE|f.LINE]=i.prototype.planeLine=function(t,e,i,o,n,l,h,u,d){var p=y,m=v,f=b,g=P,x=S,B=M,T=w,F=k,E=C,N=I,G=0;a.set(p,-l.length/2,0),a.set(m,l.length/2,0),a.rotate(f,p,u),a.rotate(g,m,u),r(f,f,h),r(g,g,h),a.copy(p,f),a.copy(m,g),s(x,m,p),a.normalize(B,x),a.rotate90cw(E,B),a.rotate(F,_,o),N[0]=p,N[1]=m;for(var A=0;A<N.length;A++){var R=N[A];s(T,R,i);var L=c(T,F);if(0>L){if(d)return!0;var D=this.createContactEquation(t,n,e,l);G++,a.copy(D.normalA,F),a.normalize(D.normalA,D.normalA),a.scale(T,F,L),s(D.contactPointA,R,T),s(D.contactPointA,D.contactPointA,t.position),s(D.contactPointB,R,h),r(D.contactPointB,D.contactPointB,h),s(D.contactPointB,D.contactPointB,n.position),this.contactEquations.push(D),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}}return!d&&(this.enableFrictionReduction||G&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(G)),G)},i.prototype[f.PARTICLE|f.CAPSULE]=i.prototype.particleCapsule=function(t,e,i,o,n,a,s,r,c){return this.circleLine(t,e,i,o,n,a,s,r,c,a.radius,0)},i.prototype[f.CIRCLE|f.LINE]=i.prototype.circleLine=function(t,e,i,o,n,l,h,u,d,p,m){p=p||0,m=void 0!==m?m:e.radius;var f=y,g=v,_=b,N=P,G=S,A=M,R=w,L=k,D=C,O=x,z=B,U=T,H=F,V=E,j=I;a.set(L,-l.length/2,0),a.set(D,l.length/2,0),a.rotate(O,L,u),a.rotate(z,D,u),r(O,O,h),r(z,z,h),a.copy(L,O),a.copy(D,z),s(A,D,L),a.normalize(R,A),a.rotate90cw(G,R),s(U,i,L);var W=c(U,G);s(N,L,h),s(H,i,h);var q=m+p;if(Math.abs(W)<q){a.scale(f,G,W),s(_,i,f),a.scale(g,G,c(G,H)),a.normalize(g,g),a.scale(g,g,p),r(_,_,g);var K=c(R,_),X=c(R,L),Y=c(R,D);if(K>X&&Y>K){if(d)return!0;var Z=this.createContactEquation(t,n,e,l);return a.scale(Z.normalA,f,-1),a.normalize(Z.normalA,Z.normalA),a.scale(Z.contactPointA,Z.normalA,m),r(Z.contactPointA,Z.contactPointA,i),s(Z.contactPointA,Z.contactPointA,t.position),s(Z.contactPointB,_,h),r(Z.contactPointB,Z.contactPointB,h),s(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}j[0]=L,j[1]=D;for(var J=0;J<j.length;J++){var Q=j[J];if(s(U,Q,i),a.squaredLength(U)<Math.pow(q,2))return!!d||(Z=this.createContactEquation(t,n,e,l),a.copy(Z.normalA,U),a.normalize(Z.normalA,Z.normalA),a.scale(Z.contactPointA,Z.normalA,m),r(Z.contactPointA,Z.contactPointA,i),s(Z.contactPointA,Z.contactPointA,t.position),s(Z.contactPointB,Q,h),a.scale(V,Z.normalA,-p),r(Z.contactPointB,Z.contactPointB,V),r(Z.contactPointB,Z.contactPointB,h),s(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1)}return 0},i.prototype[f.CIRCLE|f.CAPSULE]=i.prototype.circleCapsule=function(t,e,i,o,n,a,s,r,c){return this.circleLine(t,e,i,o,n,a,s,r,c,a.radius)},i.prototype[f.CIRCLE|f.CONVEX]=i.prototype[f.CIRCLE|f.BOX]=i.prototype.circleConvex=function(t,e,i,o,c,l,h,u,d,p){p="number"==typeof p?p:e.radius;for(var m=y,f=v,g=b,_=P,M=S,w=x,k=B,C=F,T=E,A=N,R=G,I=!1,L=Number.MAX_VALUE,D=l.vertices,O=0;O!==D.length+1;O++){var z=D[O%D.length],U=D[(O+1)%D.length];if(a.rotate(m,z,u),a.rotate(f,U,u),r(m,m,h),r(f,f,h),s(g,f,m),a.normalize(_,g),a.rotate90cw(M,_),a.scale(T,M,-e.radius),r(T,T,i),n(T,l,h,u)){a.sub(A,m,T);var H=Math.abs(a.dot(A,M));L>H&&(a.copy(R,T),L=H,a.scale(C,M,H),a.add(C,C,T),I=!0)}}if(I){if(d)return!0;var V=this.createContactEquation(t,c,e,l);return a.sub(V.normalA,R,i),a.normalize(V.normalA,V.normalA),a.scale(V.contactPointA,V.normalA,p),r(V.contactPointA,V.contactPointA,i),s(V.contactPointA,V.contactPointA,t.position),s(V.contactPointB,C,h),r(V.contactPointB,V.contactPointB,h),s(V.contactPointB,V.contactPointB,c.position),this.contactEquations.push(V),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(V)),1}if(p>0)for(O=0;O<D.length;O++){var j=D[O];if(a.rotate(k,j,u),r(k,k,h),s(w,k,i),a.squaredLength(w)<Math.pow(p,2))return!!d||(V=this.createContactEquation(t,c,e,l),a.copy(V.normalA,w),a.normalize(V.normalA,V.normalA),a.scale(V.contactPointA,V.normalA,p),r(V.contactPointA,V.contactPointA,i),s(V.contactPointA,V.contactPointA,t.position),s(V.contactPointB,k,h),r(V.contactPointB,V.contactPointB,h),s(V.contactPointB,V.contactPointB,c.position),this.contactEquations.push(V),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(V)),1)}return 0};var j=a.create(),W=a.create(),q=a.create(),K=a.create();i.prototype[f.PARTICLE|f.CONVEX]=i.prototype[f.PARTICLE|f.BOX]=i.prototype.particleConvex=function(t,e,i,o,l,h,u,d,p){var m=y,f=v,g=b,_=P,k=S,C=M,B=w,T=x,E=F,N=A,G=R,I=Number.MAX_VALUE,L=!1,D=h.vertices;if(!n(i,h,u,d))return 0;if(p)return!0;for(var O=0;O!==D.length+1;O++){var z=D[O%D.length],U=D[(O+1)%D.length];a.rotate(m,z,d),a.rotate(f,U,d),r(m,m,u),r(f,f,u),s(g,f,m),a.normalize(_,g),a.rotate90cw(k,_),s(T,i,m),c(T,k),s(C,m,u),s(B,i,u),a.sub(N,m,i);var H=Math.abs(a.dot(N,k));I>H&&(I=H,a.scale(E,k,H),a.add(E,E,i),a.copy(G,k),L=!0)}if(L){var V=this.createContactEquation(t,l,e,h);return a.scale(V.normalA,G,-1),a.normalize(V.normalA,V.normalA),a.set(V.contactPointA,0,0),r(V.contactPointA,V.contactPointA,i),s(V.contactPointA,V.contactPointA,t.position),s(V.contactPointB,E,u),r(V.contactPointB,V.contactPointB,u),s(V.contactPointB,V.contactPointB,l.position),this.contactEquations.push(V),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(V)),1}return 0},i.prototype[f.CIRCLE]=i.prototype.circleCircle=function(t,e,i,o,n,c,l,h,u,d,p){var m=y;d=d||e.radius,p=p||c.radius,s(m,i,l);var f=d+p;if(a.squaredLength(m)>Math.pow(f,2))return 0;if(u)return!0;var g=this.createContactEquation(t,n,e,c);return s(g.normalA,l,i),a.normalize(g.normalA,g.normalA),a.scale(g.contactPointA,g.normalA,d),a.scale(g.contactPointB,g.normalA,-p),r(g.contactPointA,g.contactPointA,i),s(g.contactPointA,g.contactPointA,t.position),r(g.contactPointB,g.contactPointB,l),s(g.contactPointB,g.contactPointB,n.position),this.contactEquations.push(g),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(g)),1},i.prototype[f.PLANE|f.CONVEX]=i.prototype[f.PLANE|f.BOX]=i.prototype.planeConvex=function(t,e,i,o,n,l,h,u,d){var p=y,m=v,f=b,g=0;a.rotate(m,_,o);for(var P=0;P!==l.vertices.length;P++){var S=l.vertices[P];if(a.rotate(p,S,u),r(p,p,h),s(f,p,i),c(f,m)<=0){if(d)return!0;g++;var M=this.createContactEquation(t,n,e,l);s(f,p,i),a.copy(M.normalA,m);var w=c(f,M.normalA);a.scale(f,M.normalA,w),s(M.contactPointB,p,n.position),s(M.contactPointA,p,f),s(M.contactPointA,M.contactPointA,t.position),this.contactEquations.push(M),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(M))}}return this.enableFrictionReduction&&this.enableFriction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},i.prototype[f.PARTICLE|f.PLANE]=i.prototype.particlePlane=function(t,e,i,o,n,r,l,h,u){var d=y,p=v;h=h||0,s(d,i,l),a.rotate(p,_,h);var m=c(d,p);if(m>0)return 0;if(u)return!0;var f=this.createContactEquation(n,t,r,e);return a.copy(f.normalA,p),a.scale(d,f.normalA,m),s(f.contactPointA,i,d),s(f.contactPointA,f.contactPointA,n.position),s(f.contactPointB,i,t.position),this.contactEquations.push(f),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(f)),1},i.prototype[f.CIRCLE|f.PARTICLE]=i.prototype.circleParticle=function(t,e,i,o,n,c,l,h,u){var d=y;if(s(d,l,i),a.squaredLength(d)>Math.pow(e.radius,2))return 0;if(u)return!0;var p=this.createContactEquation(t,n,e,c);return a.copy(p.normalA,d),a.normalize(p.normalA,p.normalA),a.scale(p.contactPointA,p.normalA,e.radius),r(p.contactPointA,p.contactPointA,i),s(p.contactPointA,p.contactPointA,t.position),s(p.contactPointB,l,n.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1};var X=new p({radius:1}),Y=a.create(),Z=a.create();a.create(),i.prototype[f.PLANE|f.CAPSULE]=i.prototype.planeCapsule=function(t,e,i,o,n,s,c,l,h){var u,d=Y,p=Z,m=X;a.set(d,-s.length/2,0),a.rotate(d,d,l),r(d,d,c),a.set(p,s.length/2,0),a.rotate(p,p,l),r(p,p,c),m.radius=s.radius,this.enableFrictionReduction&&(u=this.enableFriction,this.enableFriction=!1);var f=this.circlePlane(n,m,d,0,t,e,i,o,h),g=this.circlePlane(n,m,p,0,t,e,i,o,h);if(this.enableFrictionReduction&&(this.enableFriction=u),h)return f||g;var _=f+g;return this.enableFrictionReduction&&_&&this.frictionEquations.push(this.createFrictionFromAverage(_)),_},i.prototype[f.CIRCLE|f.PLANE]=i.prototype.circlePlane=function(t,e,i,o,n,l,h,u,d){var p=t,m=e,f=i,g=n,P=h,S=u;S=S||0;var M=y,w=v,k=b;s(M,f,P),a.rotate(w,_,S);var C=c(w,M);if(C>m.radius)return 0;if(d)return!0;var x=this.createContactEquation(g,p,l,e);return a.copy(x.normalA,w),a.scale(x.contactPointB,x.normalA,-m.radius),r(x.contactPointB,x.contactPointB,f),s(x.contactPointB,x.contactPointB,p.position),a.scale(k,x.normalA,C),s(x.contactPointA,M,k),r(x.contactPointA,x.contactPointA,P),s(x.contactPointA,x.contactPointA,g.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x)),1},i.prototype[f.CONVEX]=i.prototype[f.CONVEX|f.BOX]=i.prototype[f.BOX]=i.prototype.convexConvex=function(t,e,o,n,l,h,u,d,p,m){var f=y,g=v,_=b,M=P,x=S,B=w,T=k,F=C,E=0;if(m="number"==typeof m?m:0,!i.findSeparatingAxis(e,o,n,h,u,d,f))return 0;s(T,u,o),c(f,T)>0&&a.scale(f,f,-1);var N=i.getClosestEdge(e,n,f,!0),G=i.getClosestEdge(h,d,f);if(-1===N||-1===G)return 0;for(var A=0;2>A;A++){var R,I=N,L=G,D=e,O=h,z=o,U=u,H=n,V=d,j=t,W=l;0===A&&(R=I,I=L,L=R,R=D,D=O,O=R,R=z,z=U,U=R,R=H,H=V,V=R,R=j,j=W,W=R);for(var q=L;L+2>q;q++){var K=O.vertices[(q+O.vertices.length)%O.vertices.length];a.rotate(g,K,V),r(g,g,U);for(var X=0,Y=I-1;I+2>Y;Y++){var Z=D.vertices[(Y+D.vertices.length)%D.vertices.length],J=D.vertices[(Y+1+D.vertices.length)%D.vertices.length];a.rotate(_,Z,H),a.rotate(M,J,H),r(_,_,z),r(M,M,z),s(x,M,_),a.rotate90cw(F,x),a.normalize(F,F),s(T,g,_);var Q=c(F,T);(Y===I&&m>=Q||Y!==I&&0>=Q)&&X++}if(X>=3){if(p)return!0;var $=this.createContactEquation(j,W,D,O);E++,Z=D.vertices[I%D.vertices.length],J=D.vertices[(I+1)%D.vertices.length],a.rotate(_,Z,H),a.rotate(M,J,H),r(_,_,z),r(M,M,z),s(x,M,_),a.rotate90cw($.normalA,x),a.normalize($.normalA,$.normalA),s(T,g,_),Q=c($.normalA,T),a.scale(B,$.normalA,Q),s($.contactPointA,g,z),s($.contactPointA,$.contactPointA,B),r($.contactPointA,$.contactPointA,z),s($.contactPointA,$.contactPointA,j.position),s($.contactPointB,g,U),r($.contactPointB,$.contactPointB,U),s($.contactPointB,$.contactPointB,W.position),this.contactEquations.push($),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact($))}}}return this.enableFrictionReduction&&this.enableFriction&&E&&this.frictionEquations.push(this.createFrictionFromAverage(E)),E};var J=a.fromValues(0,0);i.projectConvexOntoAxis=function(t,e,i,o,n){var s,r,l=null,h=null,u=J;a.rotate(u,o,-i);for(var d=0;d<t.vertices.length;d++)s=t.vertices[d],r=c(s,u),(null===l||r>l)&&(l=r),(null===h||h>r)&&(h=r);if(h>l){var p=h;h=l,l=p}var m=c(e,o);a.set(n,h+m,l+m)};var Q=a.fromValues(0,0),$=a.fromValues(0,0),tt=a.fromValues(0,0),et=a.fromValues(0,0),it=a.fromValues(0,0),ot=a.fromValues(0,0);i.findSeparatingAxis=function(t,e,o,n,r,c,l){var h=null,u=!1,d=!1,p=Q,m=$,f=tt,_=et,y=it,v=ot;if(t instanceof g&&n instanceof g)for(var b=0;2!==b;b++){var P=t,S=o;1===b&&(P=n,S=c);for(var M=0;2!==M;M++){0===M?a.set(_,0,1):1===M&&a.set(_,1,0),0!==S&&a.rotate(_,_,S),i.projectConvexOntoAxis(t,e,o,_,y),i.projectConvexOntoAxis(n,r,c,_,v);var w=y,k=v;y[0]>v[0]&&(k=y,w=v),u=0>=(C=k[0]-w[1]),(null===h||C>h)&&(a.copy(l,_),h=C,d=u)}}else for(b=0;2!==b;b++)for(P=t,S=o,1===b&&(P=n,S=c),M=0;M!==P.vertices.length;M++){var C;a.rotate(m,P.vertices[M],S),a.rotate(f,P.vertices[(M+1)%P.vertices.length],S),s(p,f,m),a.rotate90cw(_,p),a.normalize(_,_),i.projectConvexOntoAxis(t,e,o,_,y),i.projectConvexOntoAxis(n,r,c,_,v),w=y,k=v,y[0]>v[0]&&(k=y,w=v),u=0>=(C=k[0]-w[1]),(null===h||C>h)&&(a.copy(l,_),h=C,d=u)}return d};var nt=a.fromValues(0,0),at=a.fromValues(0,0),st=a.fromValues(0,0);i.getClosestEdge=function(t,e,i,o){var n=nt,r=at,l=st;a.rotate(n,i,-e),o&&a.scale(n,n,-1);for(var h=-1,u=t.vertices.length,d=-1,p=0;p!==u;p++){s(r,t.vertices[(p+1)%u],t.vertices[p%u]),a.rotate90cw(l,r),a.normalize(l,l);var m=c(l,n);(-1===h||m>d)&&(h=p%u,d=m)}return h};var rt=a.create(),ct=a.create(),lt=a.create(),ht=a.create(),ut=a.create(),dt=a.create(),pt=a.create();i.prototype[f.CIRCLE|f.HEIGHTFIELD]=i.prototype.circleHeightfield=function(t,e,i,o,n,c,l,h,u,d){var p=c.heights,m=(d=d||e.radius,c.elementWidth),f=ct,g=rt,_=ut,y=pt,v=dt,b=lt,P=ht,S=Math.floor((i[0]-d-l[0])/m),M=Math.ceil((i[0]+d-l[0])/m);0>S&&(S=0),M>=p.length&&(M=p.length-1);for(var w=p[S],k=p[M],C=S;M>C;C++)p[C]<k&&(k=p[C]),p[C]>w&&(w=p[C]);if(i[1]-d>w)return!u&&0;var x=!1;for(C=S;M>C;C++){a.set(b,C*m,p[C]),a.set(P,(C+1)*m,p[C+1]),a.add(b,b,l),a.add(P,P,l),a.sub(v,P,b),a.rotate(v,v,Math.PI/2),a.normalize(v,v),a.scale(g,v,-d),a.add(g,g,i),a.sub(f,g,b);var B=a.dot(f,v);if(g[0]>=b[0]&&g[0]<P[0]&&0>=B){if(u)return!0;x=!0,a.scale(f,v,-B),a.add(_,g,f),a.copy(y,v);var T=this.createContactEquation(n,t,c,e);a.copy(T.normalA,y),a.scale(T.contactPointB,T.normalA,-d),r(T.contactPointB,T.contactPointB,i),s(T.contactPointB,T.contactPointB,t.position),a.copy(T.contactPointA,_),a.sub(T.contactPointA,T.contactPointA,n.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T))}}if(x=!1,d>0)for(C=S;M>=C;C++)if(a.set(b,C*m,p[C]),a.add(b,b,l),a.sub(f,i,b),a.squaredLength(f)<Math.pow(d,2)){if(u)return!0;x=!0,T=this.createContactEquation(n,t,c,e),a.copy(T.normalA,f),a.normalize(T.normalA,T.normalA),a.scale(T.contactPointB,T.normalA,-d),r(T.contactPointB,T.contactPointB,i),s(T.contactPointB,T.contactPointB,t.position),s(T.contactPointA,b,l),r(T.contactPointA,T.contactPointA,l),s(T.contactPointA,T.contactPointA,n.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T))}return x?1:0};var mt=a.create(),ft=a.create(),gt=a.create(),_t=new m({vertices:[a.create(),a.create(),a.create(),a.create()]});i.prototype[f.BOX|f.HEIGHTFIELD]=i.prototype[f.CONVEX|f.HEIGHTFIELD]=i.prototype.convexHeightfield=function(t,e,i,o,n,s,r,c,l){var h=s.heights,u=s.elementWidth,d=mt,p=ft,m=gt,f=_t,g=Math.floor((t.aabb.lowerBound[0]-r[0])/u),_=Math.ceil((t.aabb.upperBound[0]-r[0])/u);0>g&&(g=0),_>=h.length&&(_=h.length-1);for(var y=h[g],v=h[_],b=g;_>b;b++)h[b]<v&&(v=h[b]),h[b]>y&&(y=h[b]);if(t.aabb.lowerBound[1]>y)return!l&&0;var P=0;for(b=g;_>b;b++)a.set(d,b*u,h[b]),a.set(p,(b+1)*u,h[b+1]),a.add(d,d,r),a.add(p,p,r),a.set(m,.5*(p[0]+d[0]),.5*(p[1]+d[1]-100)),a.sub(f.vertices[0],p,m),a.sub(f.vertices[1],d,m),a.copy(f.vertices[2],f.vertices[1]),a.copy(f.vertices[3],f.vertices[0]),f.vertices[2][1]-=100,f.vertices[3][1]-=100,P+=this.convexConvex(t,e,i,o,n,f,m,0,l);return P}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e){function i(t){t=t||{},this.from=t.from?n.fromValues(t.from[0],t.from[1]):n.create(),this.to=t.to?n.fromValues(t.to[0],t.to[1]):n.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:i.ANY,this.callback=t.callback||function(){},this.direction=n.create(),this.length=1,this.update()}function o(t,e,i){n.sub(s,i,t);var o=n.dot(s,e);return n.scale(r,e,o),n.add(r,r,t),n.squaredDistance(i,r)}e.exports=i;var n=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB"),i.prototype.constructor=i,i.CLOSEST=1,i.ANY=2,i.ALL=4,i.prototype.update=function(){var t=this.direction;n.sub(t,this.to,this.from),this.length=n.length(t),n.normalize(t,t)},i.prototype.intersectBodies=function(t,e){for(var i=0,o=e.length;!t.shouldStop(this)&&o>i;i++){var n=e[i],a=n.getAABB();(a.overlapsRay(this)>=0||a.containsPoint(this.from))&&this.intersectBody(t,n)}};var a=n.create();i.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var o=a,s=0,r=e.shapes.length;r>s;s++){var c=e.shapes[s];if((!i||c.collisionResponse)&&0!=(this.collisionGroup&c.collisionMask)&&0!=(c.collisionGroup&this.collisionMask)){n.rotate(o,c.position,e.angle),n.add(o,o,e.position);var l=c.angle+e.angle;if(this.intersectShape(t,c,l,o,e),t.shouldStop(this))break}}},i.prototype.intersectShape=function(t,e,i,n,a){o(this.from,this.direction,n)>e.boundingRadius*e.boundingRadius||(this._currentBody=a,this._currentShape=e,e.raycast(t,this,n,i),this._currentBody=this._currentShape=null)},i.prototype.getAABB=function(t){var e=this.to,i=this.from;n.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),n.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))},n.create(),i.prototype.reportIntersection=function(t,e,o,a){var s=(this.from,this.to,this._currentShape),r=this._currentBody;if(!(this.skipBackfaces&&n.dot(o,this.direction)>0))switch(this.mode){case i.ALL:t.set(o,s,r,e,a),this.callback(t);break;case i.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(o,s,r,e,a);break;case i.ANY:t.set(o,s,r,e,a)}};var s=n.create(),r=n.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e){function i(){this.normal=o.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var o=t("../math/vec2"),n=t("../collision/Ray");e.exports=i,i.prototype.reset=function(){o.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},i.prototype.getHitDistance=function(t){return o.distance(t.from,t.to)*this.fraction},i.prototype.hasHit=function(){return-1!==this.fraction},i.prototype.getHitPoint=function(t,e){o.lerp(t,e.from,e.to,this.fraction)},i.prototype.stop=function(){this.isStopped=!0},i.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===n.ANY},i.prototype.set=function(t,e,i,n,a){o.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=n,this.faceIndex=a}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e){function i(){n.call(this,n.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var i=t.axisList.indexOf(e.body);-1!==i&&t.axisList.splice(i,1)}}var o=t("../utils/Utils"),n=t("../collision/Broadphase");e.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.setWorld=function(t){this.axisList.length=0,o.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},i.sortAxisList=function(t,e){e|=0;for(var i=1,o=t.length;o>i;i++){for(var n=t[i],a=i-1;a>=0&&!(t[a].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);a--)t[a+1]=t[a];t[a+1]=n}return t},i.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;i.sortAxisList(t,e)},i.prototype.getCollisionPairs=function(){var t=this.axisList,e=this.result,i=this.axisIndex;e.length=0;for(var o=t.length;o--;){var a=t[o];a.aabbNeedsUpdate&&a.updateAABB()}this.sortList();for(var s=0,r=0|t.length;s!==r;s++)for(var c=t[s],l=s+1;r>l;l++){var h=t[l];if(!(h.aabb.lowerBound[i]<=c.aabb.upperBound[i]))break;n.canCollide(c,h)&&this.boundingVolumeCheck(c,h)&&e.push(c,h)}return e},i.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();var o=this.axisIndex,n="x";1===o&&(n="y"),2===o&&(n="z");for(var a=this.axisList,s=(e.lowerBound[n],e.upperBound[n],0);s<a.length;s++){var r=a[s];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&i.push(r)}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e){function i(t,e,i,n){this.type=i,n=o.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=i;var o=t("../utils/Utils");i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.DISTANCE=1,i.GEAR=2,i.LOCK=3,i.PRISMATIC=4,i.REVOLUTE=5,i.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.stiffness=t,o.needsUpdate=!0}},i.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.relaxation=t,o.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e){function i(t,e,i){i=s.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),o.call(this,t,e,o.DISTANCE,i),this.localAnchorA=a.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=a.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var r,c=this.localAnchorA,l=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var h=a.create(),u=a.create(),d=a.create();a.rotate(h,c,t.angle),a.rotate(u,l,e.angle),a.add(d,e.position,u),a.sub(d,d,h),a.sub(d,d,t.position),this.distance=a.length(d)}r=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce;var p=new n(t,e,-r,r);this.equations=[p],this.maxForce=r,d=a.create();var m=a.create(),f=a.create(),g=this;p.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,o=e.position;return a.rotate(m,c,t.angle),a.rotate(f,l,e.angle),a.add(d,o,f),a.sub(d,d,m),a.sub(d,d,i),a.length(d)-g.distance},this.setMaxForce(r),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var o=t("./Constraint"),n=t("../equations/Equation"),a=t("../math/vec2"),s=t("../utils/Utils");e.exports=i,i.prototype=new o,i.prototype.constructor=i;var r=a.create(),c=a.create(),l=a.create();i.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,o=(this.distance,e.position),n=i.position,s=this.equations[0],h=t.G;a.rotate(c,this.localAnchorA,e.angle),a.rotate(l,this.localAnchorB,i.angle),a.add(r,n,l),a.sub(r,r,c),a.sub(r,r,o),this.position=a.length(r);var u=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(s.maxForce=0,s.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(s.maxForce=this.maxForce,s.minForce=0,this.distance=this.lowerLimit,u=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||u){s.enabled=!0,a.normalize(r,r);var d=a.crossLength(c,r),p=a.crossLength(l,r);h[0]=-r[0],h[1]=-r[1],h[2]=-d,h[3]=r[0],h[4]=r[1],h[5]=p}else s.enabled=!1},i.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},i.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e){function i(t,e,i){i=i||{},o.call(this,t,e,o.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new n(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}var o=t("./Constraint"),n=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2"),e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},i.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},i.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e){function i(t,e,i){i=i||{},o.call(this,t,e,o.LOCK,i);var s=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce,r=(i.localAngleB,new a(t,e,-s,s)),c=new a(t,e,-s,s),l=new a(t,e,-s,s),h=n.create(),u=n.create(),d=this;r.computeGq=function(){return n.rotate(h,d.localOffsetB,t.angle),n.sub(u,e.position,t.position),n.sub(u,u,h),u[0]},c.computeGq=function(){return n.rotate(h,d.localOffsetB,t.angle),n.sub(u,e.position,t.position),n.sub(u,u,h),u[1]};var p=n.create(),m=n.create();l.computeGq=function(){return n.rotate(p,d.localOffsetB,e.angle-d.localAngleB),n.scale(p,p,-1),n.sub(u,t.position,e.position),n.add(u,u,p),n.rotate(m,p,-Math.PI/2),n.normalize(m,m),n.dot(u,m)},this.localOffsetB=n.create(),i.localOffsetB?n.copy(this.localOffsetB,i.localOffsetB):(n.sub(this.localOffsetB,e.position,t.position),n.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(r,c,l),this.setMaxForce(s)}var o=t("./Constraint"),n=t("../math/vec2"),a=t("../equations/Equation");e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},i.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=n.create(),r=n.create(),c=n.create(),l=n.fromValues(1,0),h=n.fromValues(0,1);i.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],o=this.bodyA,a=this.bodyB;n.rotate(s,this.localOffsetB,o.angle),n.rotate(r,this.localOffsetB,a.angle-this.localAngleB),n.scale(r,r,-1),n.rotate(c,r,Math.PI/2),n.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-n.crossLength(s,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-n.crossLength(s,h),e.G[4]=1,i.G[0]=-c[0],i.G[1]=-c[1],i.G[3]=c[0],i.G[4]=c[1],i.G[5]=n.crossLength(r,c)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e){function i(t,e,i){i=i||{},o.call(this,t,e,o.PRISMATIC,i);var c=s.fromValues(0,0),l=s.fromValues(1,0),h=s.fromValues(0,0);i.localAnchorA&&s.copy(c,i.localAnchorA),i.localAxisA&&s.copy(l,i.localAxisA),i.localAnchorB&&s.copy(h,i.localAnchorB),this.localAnchorA=c,this.localAnchorB=h,this.localAxisA=l;var u=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE,d=new a(t,e,-u,u),p=new s.create,m=new s.create,f=new s.create,g=new s.create;if(d.computeGq=function(){return s.dot(f,g)},d.updateJacobian=function(){var i=this.G,o=t.position,n=e.position;s.rotate(p,c,t.angle),s.rotate(m,h,e.angle),s.add(f,n,m),s.sub(f,f,o),s.sub(f,f,p),s.rotate(g,l,t.angle+Math.PI/2),i[0]=-g[0],i[1]=-g[1],i[2]=-s.crossLength(p,g)+s.crossLength(g,f),i[3]=g[0],i[4]=g[1],i[5]=s.crossLength(m,g)},this.equations.push(d),!i.disableRotationalLock){var _=new r(t,e,-u,u);this.equations.push(_)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==i.lowerLimit,this.upperLimitEnabled=void 0!==i.upperLimit,this.lowerLimit=void 0!==i.lowerLimit?i.lowerLimit:0,this.upperLimit=void 0!==i.upperLimit?i.upperLimit:1,this.upperLimitEquation=new n(t,e),this.lowerLimitEquation=new n(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=u,this.motorEquation=new a(t,e),this.motorEnabled=!1,this.motorSpeed=0;var y=this,v=this.motorEquation;v.computeGW,v.computeGq=function(){return 0},v.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,n=i.velocity,a=e.angularVelocity,s=i.angularVelocity;return this.gmult(t,o,a,n,s)+y.motorSpeed}}var o=t("./Constraint"),n=t("../equations/ContactEquation"),a=t("../equations/Equation"),s=t("../math/vec2"),r=t("../equations/RotationalLockEquation");e.exports=i,i.prototype=new o,i.prototype.constructor=i;var c=s.create(),l=s.create(),h=s.create(),u=s.create(),d=s.create(),p=s.create();i.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,o=this.lowerLimit,n=this.upperLimitEquation,a=this.lowerLimitEquation,r=this.bodyA,m=this.bodyB,f=this.localAxisA,g=this.localAnchorA,_=this.localAnchorB;e.updateJacobian(),s.rotate(c,f,r.angle),s.rotate(u,g,r.angle),s.add(l,u,r.position),s.rotate(d,_,m.angle),s.add(h,d,m.position);var y,v=this.position=s.dot(h,c)-s.dot(l,c);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=c[0],b[1]=c[1],b[2]=s.crossLength(c,d),b[3]=-c[0],b[4]=-c[1],b[5]=-s.crossLength(c,u)}this.upperLimitEnabled&&v>i?(s.scale(n.normalA,c,-1),s.sub(n.contactPointA,l,r.position),s.sub(n.contactPointB,h,m.position),s.scale(p,c,i),s.add(n.contactPointA,n.contactPointA,p),-1===t.indexOf(n)&&t.push(n)):-1!==(y=t.indexOf(n))&&t.splice(y,1),this.lowerLimitEnabled&&o>v?(s.scale(a.normalA,c,1),s.sub(a.contactPointA,l,r.position),s.sub(a.contactPointB,h,m.position),s.scale(p,c,o),s.sub(a.contactPointB,a.contactPointB,p),-1===t.indexOf(a)&&t.push(a)):-1!==(y=t.indexOf(a))&&t.splice(y,1)},i.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},i.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},i.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e){function i(t,e,i){i=i||{},o.call(this,t,e,o.REVOLUTE,i);var p=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=r.create(),this.pivotB=r.create(),i.worldPivot?(r.sub(this.pivotA,i.worldPivot,t.position),r.sub(this.pivotB,i.worldPivot,e.position),r.rotate(this.pivotA,this.pivotA,-t.angle),r.rotate(this.pivotB,this.pivotB,-e.angle)):(r.copy(this.pivotA,i.localPivotA),r.copy(this.pivotB,i.localPivotB));var m=this.equations=[new n(t,e,-p,p),new n(t,e,-p,p)],f=m[0],g=m[1],_=this;f.computeGq=function(){return r.rotate(c,_.pivotA,t.angle),r.rotate(l,_.pivotB,e.angle),r.add(d,e.position,l),r.sub(d,d,t.position),r.sub(d,d,c),r.dot(d,h)},g.computeGq=function(){return r.rotate(c,_.pivotA,t.angle),r.rotate(l,_.pivotB,e.angle),r.add(d,e.position,l),r.sub(d,d,t.position),r.sub(d,d,c),r.dot(d,u)},g.minForce=f.minForce=-p,g.maxForce=f.maxForce=p,this.motorEquation=new a(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new s(t,e),this.lowerLimitEquation=new s(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var o=t("./Constraint"),n=t("../equations/Equation"),a=t("../equations/RotationalVelocityEquation"),s=t("../equations/RotationalLockEquation"),r=t("../math/vec2");e.exports=i;var c=r.create(),l=r.create(),h=r.fromValues(1,0),u=r.fromValues(0,1),d=r.create();i.prototype=new o,i.prototype.constructor=i,i.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},i.prototype.update=function(){var t,e=this.bodyA,i=this.bodyB,o=this.pivotA,n=this.pivotB,a=this.equations,s=(a[0],a[1],a[0]),d=a[1],p=this.upperLimit,m=this.lowerLimit,f=this.upperLimitEquation,g=this.lowerLimitEquation,_=this.angle=i.angle-e.angle;this.upperLimitEnabled&&_>p?(f.angle=p,-1===a.indexOf(f)&&a.push(f)):-1!==(t=a.indexOf(f))&&a.splice(t,1),this.lowerLimitEnabled&&m>_?(g.angle=m,-1===a.indexOf(g)&&a.push(g)):-1!==(t=a.indexOf(g))&&a.splice(t,1),r.rotate(c,o,e.angle),r.rotate(l,n,i.angle),s.G[0]=-1,s.G[1]=0,s.G[2]=-r.crossLength(c,h),s.G[3]=1,s.G[4]=0,s.G[5]=r.crossLength(l,h),d.G[0]=0,d.G[1]=-1,d.G[2]=-r.crossLength(c,u),d.G[3]=0,d.G[4]=1,d.G[5]=r.crossLength(l,u)},i.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},i.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},i.prototype.motorIsEnabled=function(){return!!this.motorEnabled},i.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},i.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e){function i(t,e,i){i=i||{},o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}var o=t("./Equation");t("../math/vec2"),e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},i.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},i.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e){function i(t,e){o.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=n.create(),this.penetrationVec=n.create(),this.contactPointB=n.create(),this.normalA=n.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var o=t("./Equation"),n=t("../math/vec2");e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.computeB=function(t,e,i){var o,a,s=this.bodyA,r=this.bodyB,c=this.contactPointA,l=this.contactPointB,h=s.position,u=r.position,d=this.penetrationVec,p=this.normalA,m=this.G,f=n.crossLength(c,p),g=n.crossLength(l,p);return m[0]=-p[0],m[1]=-p[1],m[2]=-f,m[3]=p[0],m[4]=p[1],m[5]=g,n.add(d,u,l),n.sub(d,d,h),n.sub(d,d,c),this.firstImpact&&0!==this.restitution?(a=0,o=1/e*(1+this.restitution)*this.computeGW()):(a=n.dot(p,d)+this.offset,o=this.computeGW()),-a*t-o*e-i*this.computeGiMf()}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e){function i(t,e,o,a){this.minForce=void 0===o?-Number.MAX_VALUE:o,this.maxForce=void 0===a?Number.MAX_VALUE:a,this.bodyA=t,this.bodyB=e,this.stiffness=i.DEFAULT_STIFFNESS,this.relaxation=i.DEFAULT_RELAXATION,this.G=new n.ARRAY_TYPE(6);for(var s=0;6>s;s++)this.G[s]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=i;var o=t("../math/vec2"),n=t("../utils/Utils");t("../objects/Body"),i.prototype.constructor=i,i.DEFAULT_STIFFNESS=1e6,i.DEFAULT_RELAXATION=4,i.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},i.prototype.gmult=function(t,e,i,o,n){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*o[0]+t[4]*o[1]+t[5]*n},i.prototype.computeB=function(t,e,i){var o=this.computeGW();return-this.computeGq()*t-o*e-this.computeGiMf()*i};var a=o.create(),s=o.create();i.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=(e.position,i.position,e.angle),n=i.angle;return this.gmult(t,a,o,s,n)+this.offset},i.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,n=i.velocity,a=e.angularVelocity,s=i.angularVelocity;return this.gmult(t,o,a,n,s)+this.relativeVelocity},i.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.vlambda,n=i.vlambda,a=e.wlambda,s=i.wlambda;return this.gmult(t,o,a,n,s)};var r=o.create(),c=o.create();i.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,n=t.angularForce,a=e.force,s=e.angularForce,l=t.invMassSolve,h=e.invMassSolve,u=t.invInertiaSolve,d=e.invInertiaSolve,p=this.G;return o.scale(r,i,l),o.multiply(r,t.massMultiplier,r),o.scale(c,a,h),o.multiply(c,e.massMultiplier,c),this.gmult(p,r,n*u,c,s*d)},i.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,o=e.invMassSolve,n=t.invInertiaSolve,a=e.invInertiaSolve,s=this.G;return s[0]*s[0]*i*t.massMultiplier[0]+s[1]*s[1]*i*t.massMultiplier[1]+s[2]*s[2]*n+s[3]*s[3]*o*e.massMultiplier[0]+s[4]*s[4]*o*e.massMultiplier[1]+s[5]*s[5]*a};var l=o.create(),h=o.create(),u=o.create();o.create(),o.create(),o.create(),i.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,n=l,a=h,s=u,r=e.invMassSolve,c=i.invMassSolve,d=e.invInertiaSolve,p=i.invInertiaSolve,m=this.G;a[0]=m[0],a[1]=m[1],s[0]=m[3],s[1]=m[4],o.scale(n,a,r*t),o.multiply(n,n,e.massMultiplier),o.add(e.vlambda,e.vlambda,n),e.wlambda+=d*m[2]*t,o.scale(n,s,c*t),o.multiply(n,n,i.massMultiplier),o.add(i.vlambda,i.vlambda,n),i.wlambda+=p*m[5]*t},i.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e){function i(t,e,i){n.call(this,t,e,-i,i),this.contactPointA=o.create(),this.contactPointB=o.create(),this.t=o.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var o=t("../math/vec2"),n=t("./Equation");t("../utils/Utils"),e.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},i.prototype.getSlipForce=function(){return this.maxForce},i.prototype.computeB=function(t,e,i){var n=(this.bodyA,this.bodyB,this.contactPointA),a=this.contactPointB,s=this.t,r=this.G;return r[0]=-s[0],r[1]=-s[1],r[2]=-o.crossLength(n,s),r[3]=s[0],r[4]=s[1],r[5]=o.crossLength(a,s),-this.computeGW()*e-i*this.computeGiMf()}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e){function i(t,e,i){i=i||{},o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var n=this.G;n[2]=1,n[5]=-1}var o=t("./Equation"),n=t("../math/vec2");e.exports=i,i.prototype=new o,i.prototype.constructor=i;var a=n.create(),s=n.create(),r=n.fromValues(1,0),c=n.fromValues(0,1);i.prototype.computeGq=function(){return n.rotate(a,r,this.bodyA.angle+this.angle),n.rotate(s,c,this.bodyB.angle),n.dot(a,s)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e){function i(t,e){o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var o=t("./Equation");t("../math/vec2"),e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.computeB=function(t,e,i){var o=this.G;o[2]=-1,o[5]=this.ratio;var n=this.computeGiMf();return-this.computeGW()*e-i*n}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e){var i=function(){};e.exports=i,i.prototype={constructor:i,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[t]&&(o[t]=[]),-1===o[t].indexOf(e)&&o[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&-1!==i[t].indexOf(e))return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,o=i[t].indexOf(e);return-1!==o&&i[t].splice(o,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=0,o=e.length;o>i;i++){var n=e[i];n.call(n.context,t)}}return this}}},{}],27:[function(t,e){function i(t,e,a){if(a=a||{},!(t instanceof o&&e instanceof o))throw new Error("First two arguments must be Material instances.");this.id=i.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==a.friction?Number(a.friction):.3,this.restitution=void 0!==a.restitution?Number(a.restitution):0,this.stiffness=void 0!==a.stiffness?Number(a.stiffness):n.DEFAULT_STIFFNESS,this.relaxation=void 0!==a.relaxation?Number(a.relaxation):n.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==a.frictionStiffness?Number(a.frictionStiffness):n.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==a.frictionRelaxation?Number(a.frictionRelaxation):n.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==a.surfaceVelocity?Number(a.surfaceVelocity):0,this.contactSkinSize=.005}var o=t("./Material"),n=t("../equations/Equation");e.exports=i,i.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e){function i(t){this.id=t||i.idCounter++}e.exports=i,i.idCounter=0},{}],29:[function(t,e){var i={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,o=0;e>o;o+=2)i+=(t[o+2]-t[o])*(t[o+1]+t[o+3]);return.5*-(i+=(t[0]-t[e])*(t[e+1]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(3>e)return[];for(var o=[],n=[],a=0;e>a;a++)n.push(a);a=0;for(var s=e;s>3;){var r=n[(a+0)%s],c=n[(a+1)%s],l=n[(a+2)%s],h=t[2*r],u=t[2*r+1],d=t[2*c],p=t[2*c+1],m=t[2*l],f=t[2*l+1],g=!1;if(i._convex(h,u,d,p,m,f)){g=!0;for(var _=0;s>_;_++){var y=n[_];if(y!=r&&y!=c&&y!=l&&i._PointInTriangle(t[2*y],t[2*y+1],h,u,d,p,m,f)){g=!1;break}}}if(g)o.push(r,c,l),n.splice((a+1)%s,1),s--,a=0;else if(a++>3*s)break}return o.push(n[0],n[1],n[2]),o},_PointInTriangle:function(t,e,i,o,n,a,s,r){var c=s-i,l=r-o,h=n-i,u=a-o,d=t-i,p=e-o,m=c*c+l*l,f=c*h+l*u,g=c*d+l*p,_=h*h+u*u,y=h*d+u*p,v=1/(m*_-f*f),b=(_*g-f*y)*v,P=(m*y-f*g)*v;return b>=0&&P>=0&&1>b+P},_convex:function(t,e,i,o,n,a){return(e-o)*(n-i)+(i-t)*(a-o)>=0}};e.exports=i},{}],30:[function(t,e){var i=e.exports={},o=t("../utils/Utils");i.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},i.crossVZ=function(t,e,o){return i.rotate(t,e,-Math.PI/2),i.scale(t,t,o),t},i.crossZV=function(t,e,o){return i.rotate(t,o,Math.PI/2),i.scale(t,t,e),t},i.rotate=function(t,e,i){if(0!==i){var o=Math.cos(i),n=Math.sin(i),a=e[0],s=e[1];t[0]=o*a-n*s,t[1]=n*a+o*s}else t[0]=e[0],t[1]=e[1]},i.rotate90cw=function(t,e){var i=e[0],o=e[1];t[0]=o,t[1]=-i},i.toLocalFrame=function(t,e,o,n){i.copy(t,e),i.sub(t,t,o),i.rotate(t,t,-n)},i.toGlobalFrame=function(t,e,o,n){i.copy(t,e),i.rotate(t,t,n),i.add(t,t,o)},i.vectorToLocalFrame=function(t,e,o){i.rotate(t,e,-o)},i.vectorToGlobalFrame=function(t,e,o){i.rotate(t,e,o)},i.centroid=function(t,e,o,n){return i.add(t,e,o),i.add(t,t,n),i.scale(t,t,1/3),t},i.create=function(){var t=new o.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},i.clone=function(t){var e=new o.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},i.fromValues=function(t,e){var i=new o.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},i.set=function(t,e,i){return t[0]=e,t[1]=i,t},i.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},i.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},i.sub=i.subtract,i.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},i.mul=i.multiply,i.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},i.div=i.divide,i.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},i.distance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(i*i+o*o)},i.dist=i.distance,i.squaredDistance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o},i.sqrDist=i.squaredDistance,i.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},i.len=i.length,i.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},i.sqrLen=i.squaredLength,i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},i.normalize=function(t,e){var i=e[0],o=e[1],n=i*i+o*o;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},i.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},i.lerp=function(t,e,i,o){var n=e[0],a=e[1];return t[0]=n+o*(i[0]-n),t[1]=a+o*(i[1]-a),t},i.reflect=function(t,e,i){var o=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*o,t[1]=e[1]-2*i[1]*o},i.getLineSegmentsIntersection=function(t,e,o,n,a){var s=i.getLineSegmentsIntersectionFraction(e,o,n,a);return!(0>s||(t[0]=e[0]+s*(o[0]-e[0]),t[1]=e[1]+s*(o[1]-e[1]),0))},i.getLineSegmentsIntersectionFraction=function(t,e,i,o){var n,a,s=e[0]-t[0],r=e[1]-t[1],c=o[0]-i[0],l=o[1]-i[1];return n=(-r*(t[0]-i[0])+s*(t[1]-i[1]))/(-c*r+s*l),a=(c*(t[1]-i[1])-l*(t[0]-i[0]))/(-c*r+s*l),n>=0&&1>=n&&a>=0&&1>=a?a:-1}},{"../utils/Utils":57}],31:[function(t,e){function i(t){t=t||{},l.call(this),this.id=t.id||++i._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=o.create(),this.position=o.fromValues(0,0),t.position&&o.copy(this.position,t.position),this.interpolatedPosition=o.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=o.fromValues(0,0),this.previousAngle=0,this.velocity=o.fromValues(0,0),t.velocity&&o.copy(this.velocity,t.velocity),this.vlambda=o.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=o.create(),t.force&&o.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=i.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=i.DYNAMIC:this.type=i.STATIC,this.boundingRadius=0,this.aabb=new c,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=i.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var o=t("../math/vec2"),n=t("poly-decomp"),a=t("../shapes/Convex"),s=t("../collision/RaycastResult"),r=t("../collision/Ray"),c=t("../collision/AABB"),l=t("../events/EventEmitter");e.exports=i,i.prototype=new l,i.prototype.constructor=i,i._idCounter=0,i.prototype.updateSolveMassProperties=function(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},i.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},i.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},i.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var h=new c,u=o.create();i.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=u,n=this.angle,a=0;a!==e;a++){var s=t[a],r=s.angle+n;o.rotate(i,s.position,n),o.add(i,i,this.position),s.computeAABB(h,i,r),0===a?this.aabb.copy(h):this.aabb.extend(h)}this.aabbNeedsUpdate=!1},i.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,n=0;n!==e;n++){var a=t[n],s=o.length(a.position),r=a.boundingRadius;s+r>i&&(i=s+r)}this.boundingRadius=i},i.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?o.copy(t.position,e):o.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},i.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},i.prototype.updateMassProperties=function(){if(this.type===i.STATIC||this.type===i.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,n=this.mass/e,a=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var s=0;e>s;s++){var r=t[s],c=o.squaredLength(r.position);a+=r.computeMomentOfInertia(n)+n*c}this.inertia=a,this.invInertia=a>0?1/a:0}this.invMass=1/this.mass,o.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},o.create(),i.prototype.applyForce=function(t,e){if(o.add(this.force,this.force,t),e){var i=o.crossLength(e,t);this.angularForce+=i}};var d=o.create(),p=o.create(),m=o.create();i.prototype.applyForceLocal=function(t,e){e=e||m;var i=d,o=p;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyForce(i,o)};var f=o.create();i.prototype.applyImpulse=function(t,e){if(this.type===i.DYNAMIC){var n=f;if(o.scale(n,t,this.invMass),o.multiply(n,this.massMultiplier,n),o.add(this.velocity,n,this.velocity),e){var a=o.crossLength(e,t);a*=this.invInertia,this.angularVelocity+=a}}};var g=o.create(),_=o.create(),y=o.create();i.prototype.applyImpulseLocal=function(t,e){e=e||y;var i=g,o=_;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyImpulse(i,o)},i.prototype.toLocalFrame=function(t,e){o.toLocalFrame(t,e,this.position,this.angle)},i.prototype.toWorldFrame=function(t,e){o.toGlobalFrame(t,e,this.position,this.angle)},i.prototype.vectorToLocalFrame=function(t,e){o.vectorToLocalFrame(t,e,this.angle)},i.prototype.vectorToWorldFrame=function(t,e){o.vectorToGlobalFrame(t,e,this.angle)},i.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);var s,r=new n.Polygon;if(r.vertices=t,r.makeCCW(),"number"==typeof e.removeCollinearPoints&&r.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!r.isSimple())return!1;for(this.concavePath=r.vertices.slice(0),i=0;i<this.concavePath.length;i++){var c=[0,0];o.copy(c,this.concavePath[i]),this.concavePath[i]=c}s=e.optimalDecomp?r.decomp():r.quickDecomp();var l=o.create();for(i=0;i!==s.length;i++){for(var h=new a({vertices:s[i].vertices}),u=0;u!==h.vertices.length;u++)c=h.vertices[u],o.sub(c,c,h.centerOfMass);o.scale(l,h.centerOfMass,1),h.updateTriangles(),h.updateCenterOfMass(),h.updateBoundingRadius(),this.addShape(h,l)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var v=(o.fromValues(0,0),o.fromValues(0,0)),b=o.fromValues(0,0),P=o.fromValues(0,0);i.prototype.adjustCenterOfMass=function(){var t=v,e=b,i=P,n=0;o.set(e,0,0);for(var a=0;a!==this.shapes.length;a++){var s=this.shapes[a];o.scale(t,s.position,s.area),o.add(e,e,t),n+=s.area}for(o.scale(i,e,1/n),a=0;a!==this.shapes.length;a++)s=this.shapes[a],o.sub(s.position,s.position,i);for(o.add(this.position,this.position,i),a=0;this.concavePath&&a<this.concavePath.length;a++)o.sub(this.concavePath[a],this.concavePath[a],i);this.updateMassProperties(),this.updateBoundingRadius()},i.prototype.setZeroForce=function(){o.set(this.force,0,0),this.angularForce=0},i.prototype.resetConstraintVelocity=function(){var t=this.vlambda;o.set(t,0,0),this.wlambda=0},i.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;o.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},i.prototype.applyDamping=function(t){if(this.type===i.DYNAMIC){var e=this.velocity;o.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},i.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=i.AWAKE,this.idleTime=0,t!==i.AWAKE&&this.emit(i.wakeUpEvent)},i.prototype.sleep=function(){this.sleepState=i.SLEEPING,this.angularVelocity=0,this.angularForce=0,o.set(this.velocity,0,0),o.set(this.force,0,0),this.emit(i.sleepEvent)},i.prototype.sleepTick=function(t,e,n){this.allowSleep&&this.type!==i.SLEEPING&&(this.wantsToSleep=!1,this.sleepState,o.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)>=Math.pow(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=i.AWAKE):(this.idleTime+=n,this.sleepState=i.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep()))},i.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var S=o.create(),M=o.create();i.prototype.integrate=function(t){var e=this.invMass,i=this.force,n=this.position,a=this.velocity;o.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),o.scale(S,i,t*e),o.multiply(S,this.massMultiplier,S),o.add(a,S,a),this.integrateToTimeOfImpact(t)||(o.scale(M,a,t),o.add(n,n,M),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var w=new s,k=new r({mode:r.ALL}),C=o.create(),x=o.create(),B=o.create(),T=o.create();i.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||o.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;o.normalize(C,this.velocity),o.scale(x,this.velocity,t),o.add(x,x,this.position),o.sub(B,x,this.position);var e,i=this.angularVelocity*t,n=o.length(B),a=1,s=this;if(w.reset(),k.callback=function(t){t.body!==s&&(e=t.body,t.getHitPoint(x,k),o.sub(B,x,s.position),a=o.length(B)/n,t.stop())},o.copy(k.from,this.position),o.copy(k.to,x),k.update(),this.world.raycast(w,k),!e)return!1;var r=this.angle;o.copy(T,this.position);for(var c=0,l=0,h=0,u=a;u>=l&&c<this.ccdIterations;)c++,h=(u-l)/2,o.scale(M,B,a),o.add(this.position,T,M),this.angle=r+i*a,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?l=h:u=h;return a=h,o.copy(this.position,T),this.angle=r,o.scale(M,B,a),o.add(this.position,this.position,M),this.fixedRotation||(this.angle+=i*a),!0},i.prototype.getVelocityAtPoint=function(t,e){return o.crossVZ(t,e,this.angularVelocity),o.subtract(t,this.velocity,t),t},i.sleepyEvent={type:"sleepy"},i.sleepEvent={type:"sleep"},i.wakeUpEvent={type:"wakeup"},i.DYNAMIC=1,i.STATIC=2,i.KINEMATIC=4,i.AWAKE=0,i.SLEEPY=1,i.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e){function i(t,e,i){i=i||{},n.call(this,t,e,i),this.localAnchorA=o.fromValues(0,0),this.localAnchorB=o.fromValues(0,0),i.localAnchorA&&o.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&o.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var a=o.create(),s=o.create();this.getWorldAnchorA(a),this.getWorldAnchorB(s);var r=o.distance(a,s);this.restLength="number"==typeof i.restLength?i.restLength:r}var o=t("../math/vec2"),n=t("./Spring");t("../utils/Utils"),e.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},i.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},i.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},i.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var a=o.create(),s=o.create(),r=o.create(),c=o.create(),l=o.create(),h=o.create(),u=o.create(),d=o.create(),p=o.create();i.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,n=this.bodyA,m=this.bodyB,f=a,g=s,_=r,y=c,v=p,b=l,P=h,S=u,M=d;this.getWorldAnchorA(b),this.getWorldAnchorB(P),o.sub(S,b,n.position),o.sub(M,P,m.position),o.sub(f,P,b);var w=o.len(f);o.normalize(g,f),o.sub(_,m.velocity,n.velocity),o.crossZV(v,m.angularVelocity,M),o.add(_,_,v),o.crossZV(v,n.angularVelocity,S),o.sub(_,_,v),o.scale(y,g,-t*(w-i)-e*o.dot(_,g)),o.sub(n.force,n.force,y),o.add(m.force,m.force,y);var k=o.crossLength(S,y),C=o.crossLength(M,y);n.angularForce-=k,m.angularForce+=C}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e){function i(t,e,i){i=i||{},o.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}var o=(t("../math/vec2"),t("./Spring"));e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,o=this.bodyA,n=this.bodyB,a=-t*(n.angle-o.angle-i)-e*(n.angularVelocity-o.angularVelocity)*0;o.angularForce-=a,n.angularForce+=a}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e){function i(t,e,i){i=o.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}var o=(t("../math/vec2"),t("../utils/Utils"));e.exports=i,i.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e){function i(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new r({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function o(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new s(t.chassisBody,t.groundBody),this.sideEquation=new s(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=n.fromValues(0,1),e.localForwardVector&&n.copy(this.localForwardVector,e.localForwardVector),this.localPosition=n.fromValues(0,0),e.localPosition&&n.copy(this.localPosition,e.localPosition),a.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var n=t("../math/vec2"),a=(t("../utils/Utils"),t("../constraints/Constraint")),s=t("../equations/FrictionEquation"),r=t("../objects/Body");e.exports=i,i.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},i.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},i.prototype.addWheel=function(t){var e=new o(this,t);return this.wheels.push(e),e},i.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},o.prototype=new a,o.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},o.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=n.create(),l=n.create();o.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(l,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(c,l),n.dot(c,l)};var h=n.create();o.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),n.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),n.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),n.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),n.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),n.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),n.normalize(h,this.forwardEquation.t),n.scale(h,h,this.engineForce),this.vehicle.chassisBody.applyForce(h,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e){var i=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(i,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e){function i(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,s=[o.fromValues(-e/2,-i/2),o.fromValues(e/2,-i/2),o.fromValues(e/2,i/2),o.fromValues(-e/2,i/2)],r=[o.fromValues(1,0),o.fromValues(0,1)];t.vertices=s,t.axes=r,t.type=n.BOX,a.call(this,t)}var o=t("../math/vec2"),n=t("./Shape"),a=t("./Convex");e.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},i.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},o.create(),o.create(),o.create(),o.create(),i.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},i.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e){function i(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=o.CAPSULE,o.call(this,t)}var o=t("./Shape"),n=t("../math/vec2");e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,o=2*e;return t*(o*o+i*i)/12},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var a=n.create();i.prototype.computeAABB=function(t,e,i){var o=this.radius;n.set(a,this.length/2,0),0!==i&&n.rotate(a,a,i),n.set(t.upperBound,Math.max(a[0]+o,-a[0]+o),Math.max(a[1]+o,-a[1]+o)),n.set(t.lowerBound,Math.min(a[0]-o,-a[0]-o),Math.min(a[1]-o,-a[1]-o)),n.add(t.lowerBound,t.lowerBound,e),n.add(t.upperBound,t.upperBound,e)};var s=n.create(),r=n.create(),c=n.create(),l=n.create(),h=n.fromValues(0,1);i.prototype.raycast=function(t,e,i,o){for(var a=e.from,u=e.to,d=(e.direction,s),p=r,m=c,f=l,g=this.length/2,_=0;2>_;_++){var y=this.radius*(2*_-1);if(n.set(m,-g,y),n.set(f,g,y),n.toGlobalFrame(m,m,i,o),n.toGlobalFrame(f,f,i,o),(b=n.getLineSegmentsIntersectionFraction(a,u,m,f))>=0&&(n.rotate(p,h,o),n.scale(p,p,2*_-1),e.reportIntersection(t,b,p,-1),t.shouldStop(e)))return}var v=Math.pow(this.radius,2)+Math.pow(g,2);for(_=0;2>_;_++){n.set(m,g*(2*_-1),0),n.toGlobalFrame(m,m,i,o);var b,P=Math.pow(u[0]-a[0],2)+Math.pow(u[1]-a[1],2),S=2*((u[0]-a[0])*(a[0]-m[0])+(u[1]-a[1])*(a[1]-m[1])),M=Math.pow(a[0]-m[0],2)+Math.pow(a[1]-m[1],2)-Math.pow(this.radius,2);if(!(0>(b=Math.pow(S,2)-4*P*M)))if(0===b){if(n.lerp(d,a,u,b),n.squaredDistance(d,i)>v&&(n.sub(p,d,m),n.normalize(p,p),e.reportIntersection(t,b,p,-1),t.shouldStop(e)))return}else{var w=Math.sqrt(b),k=1/(2*P),C=(-S-w)*k,x=(-S+w)*k;if(C>=0&&1>=C&&(n.lerp(d,a,u,C),n.squaredDistance(d,i)>v&&(n.sub(p,d,m),n.normalize(p,p),e.reportIntersection(t,C,p,-1),t.shouldStop(e))))return;if(x>=0&&1>=x&&(n.lerp(d,a,u,x),n.squaredDistance(d,i)>v&&(n.sub(p,d,m),n.normalize(p,p),e.reportIntersection(t,x,p,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e){function i(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=o.CIRCLE,o.call(this,t)}var o=t("./Shape"),n=t("../math/vec2");e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},i.prototype.computeAABB=function(t,e){var i=this.radius;n.set(t.upperBound,i,i),n.set(t.lowerBound,-i,-i),e&&(n.add(t.lowerBound,t.lowerBound,e),n.add(t.upperBound,t.upperBound,e))};var a=n.create(),s=n.create();i.prototype.raycast=function(t,e,i){var o=e.from,r=e.to,c=this.radius,l=Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2),h=2*((r[0]-o[0])*(o[0]-i[0])+(r[1]-o[1])*(o[1]-i[1])),u=Math.pow(o[0]-i[0],2)+Math.pow(o[1]-i[1],2)-Math.pow(c,2),d=Math.pow(h,2)-4*l*u,p=a,m=s;if(!(0>d))if(0===d)n.lerp(p,o,r,d),n.sub(m,p,i),n.normalize(m,m),e.reportIntersection(t,d,m,-1);else{var f=Math.sqrt(d),g=1/(2*l),_=(-h-f)*g,y=(-h+f)*g;if(_>=0&&1>=_&&(n.lerp(p,o,r,_),n.sub(m,p,i),n.normalize(m,m),e.reportIntersection(t,_,m,-1),t.shouldStop(e)))return;y>=0&&1>=y&&(n.lerp(p,o,r,y),n.sub(m,p,i),n.normalize(m,m),e.reportIntersection(t,y,m,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e){function i(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var a=n.create();n.copy(a,e[i]),this.vertices.push(a)}if(this.axes=[],t.axes)for(i=0;i<t.axes.length;i++){var s=n.create();n.copy(s,t.axes[i]),this.axes.push(s)}else for(i=0;i<this.vertices.length;i++){var r=this.vertices[i],c=this.vertices[(i+1)%this.vertices.length],l=n.create();n.sub(l,c,r),n.rotate90cw(l,l),n.normalize(l,l),this.axes.push(l)}if(this.centerOfMass=n.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=o.CONVEX,o.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var o=t("./Shape"),n=t("../math/vec2"),a=t("../math/polyk");t("poly-decomp"),e.exports=i,i.prototype=new o,i.prototype.constructor=i;var s=n.create(),r=n.create();i.prototype.projectOntoLocalAxis=function(t,e){for(var i,o,a=null,r=null,c=(t=s,0);c<this.vertices.length;c++)i=this.vertices[c],o=n.dot(i,t),(null===a||o>a)&&(a=o),(null===r||r>o)&&(r=o);if(r>a){var l=r;r=a,a=l}n.set(e,r,a)},i.prototype.projectOntoWorldAxis=function(t,e,i,o){var a=r;this.projectOntoLocalAxis(t,o),0!==i?n.rotate(a,t,i):a=t;var s=n.dot(e,a);n.set(o,o[0]+s,o[1]+s)},i.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}var o=a.Triangulate(t);for(e=0;e<o.length;e+=3){var n=o[e],s=o[e+1],r=o[e+2];this.triangles.push([n,s,r])}};var c=n.create(),l=n.create(),h=n.create(),u=n.create(),d=n.create();n.create(),n.create(),n.create(),n.create(),i.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,o=this.centerOfMass,a=c,s=h,r=u,p=d,m=l;n.set(o,0,0);for(var f=0,g=0;g!==t.length;g++){var _=t[g];s=e[_[0]],r=e[_[1]],p=e[_[2]],n.centroid(a,s,r,p);var y=i.triangleArea(s,r,p);f+=y,n.scale(m,a,y),n.add(o,o,m)}n.scale(o,o,1/f)},i.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,o=this.vertices.length,a=o-1,s=0;o>s;a=s,s++){var r=this.vertices[a],c=this.vertices[s],l=Math.abs(n.crossLength(r,c));e+=l*(n.dot(c,c)+n.dot(c,r)+n.dot(r,r)),i+=l}return t/6*(e/i)},i.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var o=n.squaredLength(t[i]);o>e&&(e=o)}this.boundingRadius=Math.sqrt(e)},i.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},i.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,o=0;o!==t.length;o++){var n=t[o],a=e[n[0]],s=e[n[1]],r=e[n[2]],c=i.triangleArea(a,s,r);this.area+=c}},i.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var p=n.create(),m=n.create(),f=n.create();i.prototype.raycast=function(t,e,i,o){var a=p,s=m,r=f,c=this.vertices;n.toLocalFrame(a,e.from,i,o),n.toLocalFrame(s,e.to,i,o);for(var l=c.length,h=0;l>h&&!t.shouldStop(e);h++){var u=c[h],d=c[(h+1)%l],g=n.getLineSegmentsIntersectionFraction(a,s,u,d);g>=0&&(n.sub(r,d,u),n.rotate(r,r,-Math.PI/2+o),n.normalize(r,r),e.reportIntersection(t,g,r,h))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e){function i(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,(void 0===t.maxValue||void 0===t.minValue)&&this.updateMaxMinValues(),t.type=o.HEIGHTFIELD,o.call(this,t)}var o=t("./Shape"),n=t("../math/vec2");t("../utils/Utils"),e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],o=0;o!==t.length;o++){var n=t[o];n>e&&(e=n),i>n&&(i=n)}this.maxValue=e,this.minValue=i},i.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},i.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var a=[n.create(),n.create(),n.create(),n.create()];i.prototype.computeAABB=function(t,e,i){n.set(a[0],0,this.maxValue),n.set(a[1],this.elementWidth*this.heights.length,this.maxValue),n.set(a[2],this.elementWidth*this.heights.length,this.minValue),n.set(a[3],0,this.minValue),t.setFromPoints(a,e,i)},i.prototype.getLineSegment=function(t,e,i){var o=this.heights,a=this.elementWidth;n.set(t,i*a,o[i]),n.set(e,(i+1)*a,o[i+1])},i.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},i.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return Math.min(this.heights.length,Math.max(e,0))};var s=(n.create(),n.create()),r=n.create(),c=n.create(),l=n.create(),h=n.create();n.fromValues(0,1),i.prototype.raycast=function(t,e,i,o){var a=e.from,u=e.to,d=(e.direction,s),p=r,m=c,f=l,g=h;n.toLocalFrame(f,a,i,o),n.toLocalFrame(g,u,i,o);var _=this.getClampedSegmentIndex(f),y=this.getClampedSegmentIndex(g);if(_>y){var v=_;_=y,y=v}for(var b=0;b<this.heights.length-1;b++){this.getLineSegment(p,m,b);var P=n.getLineSegmentsIntersectionFraction(f,g,p,m);if(P>=0&&(n.sub(d,m,p),n.rotate(d,d,o+Math.PI/2),n.normalize(d,d),e.reportIntersection(t,P,d,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e){function i(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=o.LINE,o.call(this,t)}var o=t("./Shape"),n=t("../math/vec2");e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var a=[n.create(),n.create()];i.prototype.computeAABB=function(t,e,i){var o=this.length/2;n.set(a[0],-o,0),n.set(a[1],o,0),t.setFromPoints(a,e,i,0)};var s=(n.create(),n.create()),r=n.create(),c=n.create(),l=n.fromValues(0,1);i.prototype.raycast=function(t,e,i,o){var a=e.from,h=e.to,u=r,d=c,p=this.length/2;n.set(u,-p,0),n.set(d,p,0),n.toGlobalFrame(u,u,i,o),n.toGlobalFrame(d,d,i,o);var m=n.getLineSegmentsIntersectionFraction(u,d,a,h);if(m>=0){var f=s;n.rotate(f,l,o),e.reportIntersection(t,m,f,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e){function i(t){(t=t||{}).type=o.PARTICLE,o.call(this,t)}var o=t("./Shape"),n=t("../math/vec2");e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(){return 0},i.prototype.updateBoundingRadius=function(){this.boundingRadius=0},i.prototype.computeAABB=function(t,e){n.copy(t.lowerBound,e),n.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e){function i(t){(t=t||{}).type=o.PLANE,o.call(this,t)}var o=t("./Shape"),n=t("../math/vec2");t("../utils/Utils"),e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(){return 0},i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},i.prototype.computeAABB=function(t,e,i){var o=i%(2*Math.PI),a=n.set,s=Number.MAX_VALUE,r=t.lowerBound,c=t.upperBound;0===o?(a(r,-s,-s),a(c,s,0)):o===Math.PI/2?(a(r,0,-s),a(c,s,s)):o===Math.PI?(a(r,-s,0),a(c,s,s)):o===3*Math.PI/2?(a(r,-s,-s),a(c,0,s)):(a(r,-s,-s),a(c,s,s)),n.add(r,r,e),n.add(c,c,e)},i.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var a=n.create(),s=(n.create(),n.create(),n.create()),r=n.create();i.prototype.raycast=function(t,e,i,o){var c=e.from,l=e.to,h=e.direction,u=a,d=s,p=r;n.set(d,0,1),n.rotate(d,d,o),n.sub(p,c,i);var m=n.dot(p,d);if(n.sub(p,l,i),!(m*n.dot(p,d)>0||n.squaredDistance(c,l)<m*m)){var f=n.dot(d,h);n.sub(u,c,i);var g=-n.dot(d,u)/f/e.length;e.reportIntersection(t,g,d,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e){function i(t){t=t||{},this.body=null,this.position=o.fromValues(0,0),t.position&&o.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=i.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=i;var o=t("../math/vec2");i.idCounter=0,i.CIRCLE=1,i.PARTICLE=2,i.PLANE=4,i.CONVEX=8,i.LINE=16,i.BOX=32,Object.defineProperty(i,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),i.BOX}}),i.CAPSULE=64,i.HEIGHTFIELD=128,i.prototype.computeMomentOfInertia=function(){},i.prototype.updateBoundingRadius=function(){},i.prototype.updateArea=function(){},i.prototype.computeAABB=function(){},i.prototype.raycast=function(){}},{"../math/vec2":30}],46:[function(t,e){function i(t){a.call(this,t,a.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new s.ARRAY_TYPE(this.arrayStep),this.Bs=new s.ARRAY_TYPE(this.arrayStep),this.invCs=new s.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function o(t){for(var e=t.length;e--;)t[e]=0}var n=t("../math/vec2"),a=t("./Solver"),s=t("../utils/Utils"),r=t("../equations/FrictionEquation");e.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.solve=function(t,e){this.sortEquations();var a,c,l=0,h=this.iterations,u=this.frictionIterations,d=this.equations,p=d.length,m=Math.pow(this.tolerance*p,2),f=e.bodies,g=e.bodies.length,_=(n.add,n.set,this.useZeroRHS),y=this.lambda;if(this.usedIterations=0,p)for(var v=0;v!==g;v++)f[v].updateSolveMassProperties();y.length<p&&(y=this.lambda=new s.ARRAY_TYPE(p+this.arrayStep),this.Bs=new s.ARRAY_TYPE(p+this.arrayStep),this.invCs=new s.ARRAY_TYPE(p+this.arrayStep)),o(y);var b=this.invCs,P=this.Bs;for(v=(y=this.lambda,0);v!==d.length;v++){var S;((S=d[v]).timeStep!==t||S.needsUpdate)&&(S.timeStep=t,S.update()),P[v]=S.computeB(S.a,S.b,t),b[v]=S.computeInvC(S.epsilon)}if(0!==p){for(v=0;v!==g;v++)f[v].resetConstraintVelocity();if(u){for(l=0;l!==u;l++){for(a=0,c=0;c!==p;c++){S=d[c];var M=i.iterateEquation(c,S,S.epsilon,P,b,y,_,t,l);a+=Math.abs(M)}if(this.usedIterations++,m>=a*a)break}for(i.updateMultipliers(d,y,1/t),c=0;c!==p;c++){var w=d[c];if(w instanceof r){for(var k=0,C=0;C!==w.contactEquations.length;C++)k+=w.contactEquations[C].multiplier;k*=w.frictionCoefficient/w.contactEquations.length,w.maxForce=k,w.minForce=-k}}}for(l=0;l!==h;l++){for(a=0,c=0;c!==p;c++)S=d[c],M=i.iterateEquation(c,S,S.epsilon,P,b,y,_,t,l),a+=Math.abs(M);if(this.usedIterations++,m>=a*a)break}for(v=0;v!==g;v++)f[v].addConstraintVelocity();i.updateMultipliers(d,y,1/t)}},i.updateMultipliers=function(t,e,i){for(var o=t.length;o--;)t[o].multiplier=e[o]*i},i.iterateEquation=function(t,e,i,o,n,a,s,r){var c=o[t],l=n[t],h=a[t],u=e.computeGWlambda(),d=e.maxForce,p=e.minForce;s&&(c=0);var m=l*(c-u-i*h),f=h+m;return p*r>f?m=p*r-h:f>d*r&&(m=d*r-h),a[t]+=m,e.addToWlambda(m),m}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e){function i(t,e){t=t||{},o.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var o=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var n={bodies:[]};i.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),n.bodies.length=0,e.getBodies(n.bodies),n.bodies.length&&this.solve(t,n))},i.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var o=t[e];o.enabled&&this.equations.push(o)}},i.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},i.prototype.removeAllEquations=function(){this.equations.length=0},i.GS=1,i.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e){function i(){n.apply(this,arguments)}var o=t("../equations/ContactEquation"),n=t("./Pool");e.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.create=function(){return new o},i.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e){function i(){n.apply(this,arguments)}var o=t("../equations/FrictionEquation"),n=t("./Pool");e.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.create=function(){return new o},i.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e){function i(){n.apply(this,arguments)}var o=t("../world/IslandNode"),n=t("./Pool");e.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.create=function(){return new o},i.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e){function i(){n.apply(this,arguments)}var o=t("../world/Island"),n=t("./Pool");e.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.create=function(){return new o},i.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e){function i(){this.overlappingShapesLastState=new o,this.overlappingShapesCurrentState=new o,this.recordPool=new n({size:16}),this.tmpDict=new o,this.tmpArray1=[]}var o=t("./TupleDictionary"),n=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils"),e.exports=i,i.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var o=t.keys[i],n=t.getByKey(o);e.getByKey(o),n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},i.prototype.setOverlapping=function(t,e,i,o){var n=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!n.get(e.id,o.id)){var a=this.recordPool.get();a.set(t,e,i,o),n.set(e.id,o.id,a)}},i.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},i.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},i.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,o=i.keys.length;o--;){var n=i.keys[o],a=i.data[n];if(a.bodyA===t&&a.bodyB===e||a.bodyA===e&&a.bodyB===t)return!0}return!1},i.prototype.getDiff=function(t,e,i){var o=t,n=e;(i=i||[]).length=0;for(var a=n.keys.length;a--;){var s=n.keys[a],r=n.data[s];if(!r)throw new Error("Key "+s+" had no data!");o.data[s]||i.push(r)}return i},i.prototype.isNewOverlap=function(t,e){var i=0|t.id,o=0|e.id,n=this.overlappingShapesLastState,a=this.overlappingShapesCurrentState;return!n.get(i,o)&&!!a.get(i,o)},i.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},i.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},i.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,o=t.length;o--;){var n=t[o];i.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(o=i.keys.length;o--;)(n=i.getByKey(i.keys[o]))&&e.push(n.bodyA,n.bodyB);return i.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e){function i(t,e,i,o){this.shapeA=e,this.shapeB=o,this.bodyA=t,this.bodyB=i}e.exports=i,i.prototype.set=function(t,e,o,n){i.call(this,t,e,o,n)}},{}],54:[function(t,e){function i(){n.apply(this,arguments)}var o=t("./OverlapKeeperRecord"),n=t("./Pool");e.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.create=function(){return new o},i.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e){function i(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}e.exports=i,i.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},i.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},i.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e){function i(){this.data={},this.keys=[]}var o=t("./Utils");e.exports=i,i.prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},i.prototype.getByKey=function(t){return t|=0,this.data[t]},i.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},i.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var o=this.getKey(t,e);return this.data[o]||this.keys.push(o),this.data[o]=i,o},i.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},i.prototype.copy=function(t){this.reset(),o.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e){function i(){}e.exports=i,i.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,o=e.length;i!==o;++i)t.push(e[i])},i.splice=function(t,e,i){i=i||1;for(var o=e,n=t.length-i;n>o;o++)t[o]=t[o+i];t.length=n},"undefined"!=typeof P2_ARRAY_TYPE?i.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?i.ARRAY_TYPE=Float32Array:i.ARRAY_TYPE=Array,i.extend=function(t,e){for(var i in e)t[i]=e[i]},i.defaults=function(t,e){for(var i in t=t||{},e)i in t||(t[i]=e[i]);return t}},{}],58:[function(t,e){function i(){this.equations=[],this.bodies=[]}var o=t("../objects/Body");e.exports=i,i.prototype.reset=function(){this.equations.length=this.bodies.length=0};var n=[];i.prototype.getBodies=function(t){var e=t||[],i=this.equations;n.length=0;for(var o=0;o!==i.length;o++){var a=i[o];-1===n.indexOf(a.bodyA.id)&&(e.push(a.bodyA),n.push(a.bodyA.id)),-1===n.indexOf(a.bodyB.id)&&(e.push(a.bodyB),n.push(a.bodyB.id))}return e},i.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===o.DYNAMIC&&!e.wantsToSleep)return!1}return!0},i.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].sleep();return!0}},{"../objects/Body":31}],59:[function(t,e){function i(){this.nodePool=new o({size:16}),this.islandPool=new n({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var o=(t("../math/vec2"),t("./Island"),t("./IslandNode"),t("./../utils/IslandNodePool")),n=t("./../utils/IslandPool"),a=t("../objects/Body");e.exports=i,i.getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var o=t[i];if(!o.visited&&o.body.type===a.DYNAMIC)return o}return!1},i.prototype.visit=function(t,e,i){e.push(t.body);for(var o=t.equations.length,n=0;n!==o;n++){var a=t.equations[n];-1===i.indexOf(a)&&i.push(a)}},i.prototype.bfs=function(t,e,o){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,o);n.length;)for(var s,r=n.pop();s=i.getUnvisitedNode(r.neighbors);)s.visited=!0,this.visit(s,e,o),s.body.type===a.DYNAMIC&&n.push(s)},i.prototype.split=function(t){for(var e=t.bodies,o=this.nodes,n=this.equations;o.length;)this.nodePool.release(o.pop());for(var a=0;a!==e.length;a++){var s=this.nodePool.get();s.body=e[a],o.push(s)}for(var r=0;r!==n.length;r++){var c=n[r],l=(a=e.indexOf(c.bodyA),e.indexOf(c.bodyB)),h=o[a],u=o[l];h.neighbors.push(u),u.neighbors.push(h),h.equations.push(c),u.equations.push(c)}var d,p=this.islands;for(a=0;a<p.length;a++)this.islandPool.release(p[a]);for(p.length=0;d=i.getUnvisitedNode(o);){var m=this.islandPool.get();this.bfs(d,m.bodies,m.equations),p.push(m)}return p}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e){function i(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=i,i.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e){function i(t){h.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new o,this.narrowphase=new g(this),this.islandManager=new v,this.gravity=n.fromValues(0,-9.78),t.gravity&&n.copy(this.gravity,t.gravity),this.frictionGravity=n.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new f,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new d,this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=i.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new y}var o=t("../solver/GSSolver"),n=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),a=t("../shapes/Circle"),s=t("../shapes/Convex"),r=(t("../shapes/Line"),t("../shapes/Plane")),c=t("../shapes/Capsule"),l=t("../shapes/Particle"),h=t("../events/EventEmitter"),u=t("../objects/Body"),d=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),p=t("../material/ContactMaterial"),m=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),f=t("../collision/SAPBroadphase"),g=t("../collision/Narrowphase"),_=t("../utils/Utils"),y=t("../utils/OverlapKeeper"),v=t("./IslandManager");t("../objects/RotationalSpring"),e.exports=i,i.prototype=new Object(h.prototype),i.prototype.constructor=i,i.NO_SLEEPING=1,i.BODY_SLEEPING=2,i.ISLAND_SLEEPING=4,i.prototype.addConstraint=function(t){this.constraints.push(t)},i.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},i.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&_.splice(this.contactMaterials,e,1)},i.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,o=0,n=i.length;o!==n;o++){var a=i[o];if(a.materialA.id===t.id&&a.materialB.id===e.id||a.materialA.id===e.id&&a.materialB.id===t.id)return a}return!1},i.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&_.splice(this.constraints,e,1)};var b=(n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create()),P=n.fromValues(0,0),S=n.fromValues(0,0);n.fromValues(0,0),n.fromValues(0,0),i.prototype.step=function(t,e,i){if(i=i||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var o=0;this.accumulator>=t&&i>o;)this.internalStep(t),this.time+=t,this.accumulator-=t,o++;for(var a=this.accumulator%t/t,s=0;s!==this.bodies.length;s++){var r=this.bodies[s];n.lerp(r.interpolatedPosition,r.previousPosition,r.position,a),r.interpolatedAngle=r.previousAngle+a*(r.angle-r.previousAngle)}}};var M=[];i.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,o=this.springs,a=this.bodies,s=this.gravity,r=this.solver,c=this.bodies.length,l=this.broadphase,h=this.narrowphase,d=this.constraints,p=b,m=(n.scale,n.add),f=(n.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var g=n.length(this.gravity);0===g&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=g)}if(this.applyGravity)for(var y=0;y!==c;y++){var v=(P=a[y]).force;P.type===u.DYNAMIC&&P.sleepState!==u.SLEEPING&&(n.scale(p,s,P.mass*P.gravityScale),m(v,v,p))}if(this.applySpringForces)for(y=0;y!==e;y++)o[y].applyForce();if(this.applyDamping)for(y=0;y!==c;y++){var P;(P=a[y]).type===u.DYNAMIC&&P.applyDamping(t)}var S=l.getCollisionPairs(this),w=this.disabledBodyCollisionPairs;for(y=w.length-2;y>=0;y-=2)for(var k=S.length-2;k>=0;k-=2)(w[y]===S[k]&&w[y+1]===S[k+1]||w[y+1]===S[k]&&w[y]===S[k+1])&&S.splice(k,2);var C=d.length;for(y=0;y!==C;y++){var x=d[y];if(!x.collideConnected)for(k=S.length-2;k>=0;k-=2)(x.bodyA===S[k]&&x.bodyB===S[k+1]||x.bodyB===S[k]&&x.bodyA===S[k+1])&&S.splice(k,2)}this.postBroadphaseEvent.pairs=S,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,h.reset(this),y=0;for(var B=S.length;y!==B;y+=2)for(var T=S[y],F=S[y+1],E=0,N=T.shapes.length;E!==N;E++)for(var G=T.shapes[E],A=G.position,R=G.angle,I=0,L=F.shapes.length;I!==L;I++){var D=F.shapes[I],O=D.position,z=D.angle,U=this.defaultContactMaterial;if(G.material&&D.material){var H=this.getContactMaterial(G.material,D.material);H&&(U=H)}this.runNarrowphase(h,T,G,A,R,F,D,O,z,U,this.frictionGravity)}for(y=0;y!==c;y++)(q=a[y])._wakeUpAfterNarrowphase&&(q.wakeUp(),q._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(M);var V=this.endContactEvent;for(I=M.length;I--;){var j=M[I];V.shapeA=j.shapeA,V.shapeB=j.shapeB,V.bodyA=j.bodyA,V.bodyB=j.bodyB,this.emit(V)}M.length=0}var W=this.preSolveEvent;for(W.contactEquations=h.contactEquations,W.frictionEquations=h.frictionEquations,this.emit(W),W.contactEquations=W.frictionEquations=null,C=d.length,y=0;y!==C;y++)d[y].update();if(h.contactEquations.length||h.frictionEquations.length||C)if(this.islandSplit){for(f.equations.length=0,_.appendArray(f.equations,h.contactEquations),_.appendArray(f.equations,h.frictionEquations),y=0;y!==C;y++)_.appendArray(f.equations,d[y].equations);for(f.split(this),y=0;y!==f.islands.length;y++)(Y=f.islands[y]).equations.length&&r.solveIsland(t,Y)}else{for(r.addEquations(h.contactEquations),r.addEquations(h.frictionEquations),y=0;y!==C;y++)r.addEquations(d[y].equations);this.solveConstraints&&r.solve(t,this),r.removeAllEquations()}for(y=0;y!==c;y++){var q;(q=a[y]).integrate(t)}for(y=0;y!==c;y++)a[y].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var K=this.impactEvent;for(y=0;y!==h.contactEquations.length;y++){var X=h.contactEquations[y];X.firstImpact&&(K.bodyA=X.bodyA,K.bodyB=X.bodyB,K.shapeA=X.shapeA,K.shapeB=X.shapeB,K.contactEquation=X,this.emit(K))}}if(this.sleepMode===i.BODY_SLEEPING)for(y=0;y!==c;y++)a[y].sleepTick(this.time,!1,t);else if(this.sleepMode===i.ISLAND_SLEEPING&&this.islandSplit){for(y=0;y!==c;y++)a[y].sleepTick(this.time,!0,t);for(y=0;y<this.islandManager.islands.length;y++){var Y;(Y=this.islandManager.islands[y]).wantsToSleep()&&Y.sleep()}}this.stepping=!1;var Z=this.bodiesToBeRemoved;for(y=0;y!==Z.length;y++)this.removeBody(Z[y]);Z.length=0,this.emit(this.postStepEvent)},i.prototype.runNarrowphase=function(t,e,i,o,a,s,r,c,l,h,d){if(0!=(i.collisionGroup&r.collisionMask)&&0!=(r.collisionGroup&i.collisionMask)){n.rotate(P,o,e.angle),n.rotate(S,c,s.angle),n.add(P,P,e.position),n.add(S,S,s.position);var p,m=a+e.angle,f=l+s.angle;t.enableFriction=h.friction>0,t.frictionCoefficient=h.friction,p=e.type===u.STATIC||e.type===u.KINEMATIC?s.mass:s.type===u.STATIC||s.type===u.KINEMATIC?e.mass:e.mass*s.mass/(e.mass+s.mass),t.slipForce=h.friction*d*p,t.restitution=h.restitution,t.surfaceVelocity=h.surfaceVelocity,t.frictionStiffness=h.frictionStiffness,t.frictionRelaxation=h.frictionRelaxation,t.stiffness=h.stiffness,t.relaxation=h.relaxation,t.contactSkinSize=h.contactSkinSize,t.enabledEquations=e.collisionResponse&&s.collisionResponse&&i.collisionResponse&&r.collisionResponse;var g=t[i.type|r.type],_=0;if(g){var y=i.sensor||r.sensor,v=t.frictionEquations.length;_=i.type<r.type?g.call(t,e,i,P,m,s,r,S,f,y):g.call(t,s,r,S,f,e,i,P,m,y);var b=t.frictionEquations.length-v;if(_){if(e.allowSleep&&e.type===u.DYNAMIC&&e.sleepState===u.SLEEPING&&s.sleepState===u.AWAKE&&s.type!==u.STATIC&&n.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2)>=2*Math.pow(s.sleepSpeedLimit,2)&&(e._wakeUpAfterNarrowphase=!0),s.allowSleep&&s.type===u.DYNAMIC&&s.sleepState===u.SLEEPING&&e.sleepState===u.AWAKE&&e.type!==u.STATIC&&n.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2)>=2*Math.pow(e.sleepSpeedLimit,2)&&(s._wakeUpAfterNarrowphase=!0),this.overlapKeeper.setOverlapping(e,i,s,r),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,r)){var M=this.beginContactEvent;if(M.shapeA=i,M.shapeB=r,M.bodyA=e,M.bodyB=s,M.contactEquations.length=0,"number"==typeof _)for(var w=t.contactEquations.length-_;w<t.contactEquations.length;w++)M.contactEquations.push(t.contactEquations[w]);this.emit(M)}if("number"==typeof _&&b>1)for(w=t.frictionEquations.length-b;w<t.frictionEquations.length;w++){var k=t.frictionEquations[w];k.setSlipForce(k.getSlipForce()/b)}}}}},i.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},i.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&_.splice(this.springs,e,1)},i.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},i.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(_.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},i.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var o=e[i];if(o.id===t)return o}return!1},i.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},i.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,o=0;o<i.length;o+=2)if(i[o]===t&&i[o+1]===e||i[o+1]===t&&i[o]===e)return void i.splice(o,2)},i.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);var o=this.bodies;for(e=o.length-1;e>=0;e--)this.removeBody(o[e]);var n=this.springs;for(e=n.length-1;e>=0;e--)this.removeSpring(n[e]);var a=this.contactMaterials;for(e=a.length-1;e>=0;e--)this.removeContactMaterial(a[e]);i.apply(this)};var w=n.create(),k=(n.fromValues(0,0),n.fromValues(0,0));i.prototype.hitTest=function(t,e,i){i=i||0;var o=new u({position:t}),h=new l,d=t,p=w,m=k;o.addShape(h);for(var f=this.narrowphase,g=[],_=0,y=e.length;_!==y;_++)for(var v=e[_],b=0,P=v.shapes.length;b!==P;b++){var S=v.shapes[b];n.rotate(p,S.position,v.angle),n.add(p,p,v.position);var M=S.angle+v.angle;(S instanceof a&&f.circleParticle(v,S,p,M,o,h,d,0,!0)||S instanceof s&&f.particleConvex(o,h,d,0,v,S,p,M,!0)||S instanceof r&&f.particlePlane(o,h,d,0,v,S,p,M,!0)||S instanceof c&&f.particleCapsule(o,h,d,0,v,S,p,M,!0)||S instanceof l&&n.squaredLength(n.sub(m,p,t))<i*i)&&g.push(v)}return g},i.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var o=e[i],n=0;n!==o.equations.length;n++){var a=o.equations[n];a.stiffness=t,a.needsUpdate=!0}var s=this.contactMaterials;for(i=0;i!==s.length;i++)(o=s[i]).stiffness=o.frictionStiffness=t;(o=this.defaultContactMaterial).stiffness=o.frictionStiffness=t},i.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],o=0;o!==i.equations.length;o++){var n=i.equations[o];n.relaxation=t,n.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++)(i=this.contactMaterials[e]).relaxation=i.frictionRelaxation=t;(i=this.defaultContactMaterial).relaxation=i.frictionRelaxation=t};var C=new m,x=[];i.prototype.raycast=function(t,e){return e.getAABB(C),this.broadphase.aabbQuery(this,C,x),e.intersectBodies(t,x),x.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36),"object"==typeof i&&(e.exports=n.p2),cc._RF.pop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],personData:[function(t,e,i){"use strict";cc._RF.push(e,"35785CcvnJMGLftd8sQLE2l","personData"),Object.defineProperty(i,"__esModule",{value:!0}),i.DrawHomePathGamePersonData=void 0;var o=t("./drawHomePathMainGame"),n=function(){function t(t,e){void 0===t&&(t=0),this._oriSpeed=600,this._oriDis=2e3,this.path=[],this._id=-1,this.isPathComplete=!1,this.pathDis=0,this.node=null,this.isRightHome=!1,this.homeNode=null,this._speed=0,this.color=cc.Color.WHITE,this.pathFailId=-1,this.pathFailDis=0,this._position=e,this.path=[this._position],this.isPathComplete=!1,this._id=t,this._speed=this._oriSpeed,this.color=o.drawHomeColors[t],this.pathDis=0,this.pathFailId=-1}return t.prototype.moveAlongPath=function(t){var e=this;if(this.node&&this.path.length>1){-1==this.pathFailId&&(this._speed=Math.sqrt(this.pathDis/this._oriDis)*this._oriSpeed);for(var i=cc.tween(this.node),o=this.pathFailId>=0?this.pathFailId+1:this.path.length,n=function(t){var o=a.path[t-1],n=a.path[t],s=o.sub(n).mag()/a._speed;i=i.call(function(){n.x>o.x?e.node.scaleX=-1:e.node.scaleX=1}).to(s,{x:n.x,y:n.y})},a=this,s=1;s<o;s++)n(s);(i=i.call(function(){e.isRightHome&&e.homeNode&&-1==e.pathFailId&&(e.homeNode.getChildByName("bigFish").getComponent(sp.Skeleton).animation="eat")}).delay(1).call(function(){t._moveComplete()})).start()}},t.prototype.stopTween=function(){cc.Tween.stopAllByTarget(this.node)},t.prototype.setFailPathSpeed=function(t){var e=Math.max(t,this.pathFailDis),i=Math.sqrt(e/this._oriDis)*this._oriSpeed;this._speed=this.pathFailDis/e*i},t.prototype.destroy=function(){var t,e;null===(t=this.node)||void 0===t||t.destroy(),null===(e=this.homeNode)||void 0===e||e.destroy()},t}();i.DrawHomePathGamePersonData=n,cc._RF.pop()},{"./drawHomePathMainGame":"drawHomePathMainGame"}],platesMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"575fc1FEulF3Ym6JHyi/roJ","platesMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=__importDefault(t("./platesPlate")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.platePre=null,e.cityPre=null,e.truePre=null,e.sceneNode=null,e.countDownLabel=null,e._platesData=new n.default,e._intervalX=110.8,e._intervalY=134,e._initXY=cc.v2(e._intervalX-52-225,247),e._cityOffsetY=-54,e._cities=[],e._plates=[],e._provinces=[],e._isCorrects=[],e._plateInstances=[],e._dragPlate=null,e._dragPlateIdx=null,e._level=0,e._isCanDrag=!0,e._isGameOver=!1,e._countDown=0,e._maxCountDown=120,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},e.prototype.start=function(){this._isCanDrag=!0,this._provinces=this._platesData.provinces,this._startLevelAndInitPlates()},e.prototype.update=function(t){this._isGameOver||(this._countDown-=t,this.countDownLabel&&(this.countDownLabel.string=Math.floor(this._countDown).toString()),this._countDown<1&&this.lose())},e.prototype._startLevelAndInitPlates=function(){if(this.platePre&&this.sceneNode&&this.cityPre){var t,e=(this._level-1)/2;if(e>0)this.win();else if(t=this._level%2==1?this._platesData.getCitiesAndPlates(this._provinces[e]):this._platesData.getChinaCitesAndPlates(),this._level++,void 0!==t){var i=t.cities,o=t.plates;this._cities=i,this._plates=o,this.sceneNode.destroyAllChildren(),this._countDown=this._maxCountDown,this._plateInstances=[],this._isCorrects=[];for(var n=0,a=0;a<5;a++)for(var s=0;s<4&&!((n=4*a+s)>=this._plates.length);s++){var r=cc.instantiate(this.platePre);r.parent=this.sceneNode,r.setPosition(cc.v2(this._initXY.x+s*this._intervalX,this._initXY.y-a*this._intervalY));var c=r.getChildByName("label").getComponent(cc.Label);c&&(c.string=this._plates[n]),this._plateInstances.push(r);var l=cc.instantiate(this.cityPre);l.parent=this.sceneNode,l.setPosition(cc.v2(this._initXY.x+s*this._intervalX,this._initXY.y-a*this._intervalY+this._cityOffsetY)),(c=l.getChildByName("label").getComponent(cc.Label))&&(c.string=this._cities[n]),this._isCorrects.push(!1)}}else cc.error("no province")}else console.error("Plate prefab is not assigned")},e.prototype._checkAns=function(){for(var t=this,e=!0,i=0;i<this._plates.length;i++)if(!this._isCorrects[i]){var o=this._platesData.getCity(this._plates[i]);if(!o)return void cc.error("no city");if(this._cities[i]!=o)e=!1;else{if(this._isCorrects[i]=!0,!this.truePre)return;var n=cc.instantiate(this.truePre);n.parent=this._plateInstances[i],n.setPosition(cc.v2()),cc.tween(n).to(.1,{scale:1.5}).to(.1,{scale:.8}).to(.1,{scale:1.2}).to(.1,{scale:.9}).to(.6,{scale:1}).start()}}e&&cc.tween(this.node).delay(1).call(function(){t._startLevelAndInitPlates()}).start()},e.prototype.onTouchStart=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation());if(this._isCanDrag)for(var i=0;i<this._plateInstances.length;i++)if(!this._isCorrects[i]){var o=this._plateInstances[i];if(o.getBoundingBox().contains(e)){this._dragPlate=o,this._dragPlateIdx=i,this._dragPlate.zIndex=2,this._isCanDrag=!1;break}}},e.prototype.onTouchMove=function(t){if(this._dragPlate){var e=t.getDelta();this._dragPlate.x+=e.x,this._dragPlate.y+=e.y}},e.prototype.onTouchEnd=function(t){var e,i,o=this;if(this._dragPlate&&null!==this._dragPlateIdx){for(var n=this.node.convertToNodeSpaceAR(t.getLocation()),a=null,s=0;s<this._plateInstances.length;s++)if(s!==this._dragPlateIdx&&!this._isCorrects[s]&&this._plateInstances[s].getBoundingBox().contains(n)){a=s;break}var r=Math.floor(this._dragPlateIdx/4),c=this._dragPlateIdx%4,l=cc.v3(this._initXY.x+c*this._intervalX,this._initXY.y-r*this._intervalY,0),h=cc.v3();null!==a?(h=this._plateInstances[a].position,this._plateInstances[a].zIndex=1,cc.tween(this._plateInstances[a]).to(.5,{position:l,zIndex:0}).start(),e=[this._plates[a],this._plates[this._dragPlateIdx]],this._plates[this._dragPlateIdx]=e[0],this._plates[a]=e[1],i=[this._plateInstances[a],this._plateInstances[this._dragPlateIdx]],this._plateInstances[this._dragPlateIdx]=i[0],this._plateInstances[a]=i[1]):h=l,cc.tween(this._dragPlate).to(.5,{position:h,zIndex:0}).call(function(){o._isCanDrag=!0,o._checkAns()}).start(),this._dragPlate=null,this._dragPlateIdx=null}},e.prototype.win=function(){this._isGameOver=!0,o.default.instance.gotoResultWithLoading(!0,this.node.parent)},e.prototype.lose=function(){this._isGameOver=!0,o.default.instance.gotoResultWithLoading(!1,this.node.parent)},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([r(cc.Prefab)],e.prototype,"platePre",void 0),__decorate([r(cc.Prefab)],e.prototype,"cityPre",void 0),__decorate([r(cc.Prefab)],e.prototype,"truePre",void 0),__decorate([r(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([r(cc.Label)],e.prototype,"countDownLabel",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./platesPlate":"platesPlate"}],platesModel:[function(t,e,i){"use strict";cc._RF.push(e,"ad5fd+OGf1Nq6yo2vs4NH2c","platesModel"),Object.defineProperty(i,"__esModule",{value:!0}),i.PlatesModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=cc._decorator,r=(s.ccclass,s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/plates/platesMainGame",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.plates)],e)}(n.default));i.PlatesModel=r,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],platesPlate:[function(t,e,i){"use strict";cc._RF.push(e,"d0201bmiFZM05xunwbhUqqv","platesPlate"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=(o.property,function(){function t(){this._chinaPlates=[],this.provinces=["\u5b89\u5fbd","\u798f\u5efa","\u7518\u8083","\u5e7f\u4e1c","\u5e7f\u897f","\u8d35\u5dde","\u6d77\u5357","\u6cb3\u5317","\u9ed1\u9f99\u6c5f","\u6cb3\u5357","\u6e56\u5317","\u6e56\u5357","\u6c5f\u82cf","\u6c5f\u897f","\u5409\u6797","\u8fbd\u5b81","\u5185\u8499\u53e4","\u5b81\u590f","\u9752\u6d77","\u5c71\u4e1c","\u5c71\u897f","\u9655\u897f","\u56db\u5ddd","\u5929\u6d25","\u65b0\u7586","\u897f\u85cf","\u4e91\u5357","\u6d59\u6c5f"],this._provincePlateMap=new Map,this._chinaPlateMap=new Map,this.shuffleArray(this.provinces),this.shuffleArray(this.provinces),this._initProvinceMap("\u5c71\u4e1c",[["\u9c81A","\u6d4e\u5357"],["\u9c81B","\u9752\u5c9b"],["\u9c81C","\u6dc4\u535a"],["\u9c81D","\u67a3\u5e84"],["\u9c81E","\u4e1c\u8425"],["\u9c81F","\u70df\u53f0"],["\u9c81G","\u6f4d\u574a"],["\u9c81H","\u6d4e\u5b81"],["\u9c81J","\u6cf0\u5b89"],["\u9c81K","\u5a01\u6d77"],["\u9c81L","\u65e5\u7167"],["\u9c81M","\u6ee8\u5dde"],["\u9c81N","\u5fb7\u5dde"],["\u9c81P","\u804a\u57ce"],["\u9c81Q","\u4e34\u6c82"],["\u9c81R","\u83cf\u6cfd"]]),this._initProvinceMap("\u6cb3\u5317",[["\u5180A","\u77f3\u5bb6\u5e84"],["\u5180B","\u5510\u5c71"],["\u5180C","\u79e6\u7687\u5c9b"],["\u5180D","\u90af\u90f8"],["\u5180E","\u90a2\u53f0"],["\u5180F","\u4fdd\u5b9a"],["\u5180G","\u5f20\u5bb6\u53e3"],["\u5180H","\u627f\u5fb7"],["\u5180J","\u6ca7\u5dde"],["\u5180R","\u5eca\u574a"],["\u5180T","\u8861\u6c34"]]),this._initProvinceMap("\u6cb3\u5357",[["\u8c6bA","\u90d1\u5dde"],["\u8c6bB","\u5f00\u5c01"],["\u8c6bC","\u6d1b\u9633"],["\u8c6bD","\u5e73\u9876\u5c71"],["\u8c6bE","\u5b89\u9633"],["\u8c6bF","\u9e64\u58c1"],["\u8c6bG","\u65b0\u4e61"],["\u8c6bH","\u7126\u4f5c"],["\u8c6bJ","\u6fee\u9633"],["\u8c6bK","\u8bb8\u660c"],["\u8c6bL","\u6f2f\u6cb3"],["\u8c6bM","\u4e09\u95e8\u5ce1"],["\u8c6bN","\u5546\u4e18"],["\u8c6bP","\u5468\u53e3"],["\u8c6bQ","\u9a7b\u9a6c\u5e97"],["\u8c6bR","\u5357\u9633"],["\u8c6bS","\u4fe1\u9633"],["\u8c6bU","\u6d4e\u6e90"]]),this._initProvinceMap("\u5c71\u897f",[["\u664bA","\u592a\u539f"],["\u664bB","\u5927\u540c"],["\u664bC","\u9633\u6cc9"],["\u664bD","\u957f\u6cbb"],["\u664bE","\u664b\u57ce"],["\u664bF","\u6714\u5dde"],["\u664bH","\u5ffb\u5dde"],["\u664bJ","\u5415\u6881"],["\u664bK","\u664b\u4e2d"],["\u664bL","\u4e34\u6c7e"],["\u664bM","\u8fd0\u57ce"]]),this._initProvinceMap("\u5b89\u5fbd",[["\u7696A","\u5408\u80a5"],["\u7696B","\u829c\u6e56"],["\u7696C","\u868c\u57e0"],["\u7696D","\u6dee\u5357"],["\u7696E","\u9a6c\u978d\u5c71"],["\u7696F","\u6dee\u5317"],["\u7696G","\u94dc\u9675"],["\u7696H","\u5b89\u5e86"],["\u7696J","\u9ec4\u5c71"],["\u7696K","\u961c\u9633"],["\u7696L","\u5bbf\u5dde"],["\u7696M","\u6ec1\u5dde"],["\u7696N","\u516d\u5b89"],["\u7696P","\u5ba3\u57ce"],["\u7696Q","\u5de2\u6e56"],["\u7696R","\u6c60\u5dde"],["\u7696S","\u6beb\u5dde"]]),this._initProvinceMap("\u798f\u5efa",[["\u95fdA","\u798f\u5dde"],["\u95fdB","\u8386\u7530"],["\u95fdC","\u6cc9\u5dde"],["\u95fdD","\u53a6\u95e8"],["\u95fdE","\u6f33\u5dde"],["\u95fdF","\u9f99\u5ca9"],["\u95fdG","\u4e09\u660e"],["\u95fdH","\u5357\u5e73"],["\u95fdJ","\u5b81\u5fb7"]]),this._initProvinceMap("\u7518\u8083",[["\u7518A","\u5170\u5dde"],["\u7518B","\u5609\u5cea\u5173"],["\u7518C","\u91d1\u660c"],["\u7518D","\u767d\u94f6"],["\u7518E","\u5929\u6c34"],["\u7518F","\u9152\u6cc9"],["\u7518G","\u5f20\u6396"],["\u7518H","\u6b66\u5a01"],["\u7518J","\u5b9a\u897f"],["\u7518K","\u9647\u5357"],["\u7518L","\u5e73\u51c9"],["\u7518M","\u5e86\u9633"],["\u7518N","\u4e34\u590f\u56de\u65cf"],["\u7518P","\u7518\u5357\u85cf\u65cf"]]),this._initProvinceMap("\u5e7f\u4e1c",[["\u7ca4A","\u5e7f\u5dde"],["\u7ca4B","\u6df1\u5733"],["\u7ca4C","\u73e0\u6d77"],["\u7ca4D","\u6c55\u5934"],["\u7ca4E","\u4f5b\u5c71"],["\u7ca4F","\u97f6\u5173"],["\u7ca4G","\u6e5b\u6c5f"],["\u7ca4H","\u8087\u5e86"],["\u7ca4J","\u6c5f\u95e8"],["\u7ca4K","\u8302\u540d"],["\u7ca4L","\u60e0\u5dde"],["\u7ca4M","\u6885\u5dde"],["\u7ca4N","\u6c55\u5c3e"],["\u7ca4P","\u6cb3\u6e90"],["\u7ca4Q","\u9633\u6c5f"],["\u7ca4R","\u6e05\u8fdc"],["\u7ca4S","\u4e1c\u839e"],["\u7ca4T","\u4e2d\u5c71"],["\u7ca4U","\u6f6e\u5dde"],["\u7ca4V","\u63ed\u9633"]]),this._initProvinceMap("\u5e7f\u897f",[["\u6842A","\u5357\u5b81"],["\u6842B","\u67f3\u5dde"],["\u6842C","\u6842\u6797"],["\u6842D","\u68a7\u5dde"],["\u6842E","\u5317\u6d77"],["\u6842F","\u5d07\u5de6"],["\u6842G","\u6765\u5bbe"],["\u6842J","\u8d3a\u5dde"],["\u6842K","\u7389\u6797"],["\u6842L","\u767e\u8272"],["\u6842M","\u6cb3\u6c60"],["\u6842N","\u94a6\u5dde"],["\u6842P","\u9632\u57ce\u6e2f"],["\u6842R","\u8d35\u6e2f"]]),this._initProvinceMap("\u8d35\u5dde",[["\u8d35A","\u8d35\u9633"],["\u8d35B","\u516d\u76d8\u6c34"],["\u8d35C","\u9075\u4e49"],["\u8d35D","\u94dc\u4ec1"],["\u8d35E","\u9ed4\u897f\u5357"],["\u8d35F","\u6bd5\u8282"],["\u8d35G","\u5b89\u987a"],["\u8d35H","\u9ed4\u4e1c\u5357"],["\u8d35J","\u9ed4\u5357"]]),this._initProvinceMap("\u6d77\u5357",[["\u743cA","\u6d77\u53e3"],["\u743cB","\u4e09\u4e9a"],["\u743cC","\u743c\u6d77"],["\u743cD","\u4e94\u6307\u5c71"],["\u743cE","\u6d0b\u6d66"],["\u743cF","\u510b\u5dde"]]),this._initProvinceMap("\u9ed1\u9f99\u6c5f",[["\u9ed1A","\u54c8\u5c14\u6ee8"],["\u9ed1B","\u9f50\u9f50\u54c8\u5c14"],["\u9ed1C","\u7261\u4e39\u6c5f"],["\u9ed1D","\u4f73\u6728\u65af"],["\u9ed1E","\u5927\u5e86"],["\u9ed1F","\u4f0a\u6625"],["\u9ed1G","\u9e21\u897f"],["\u9ed1H","\u9e64\u5c97"],["\u9ed1J","\u53cc\u9e2d\u5c71"],["\u9ed1K","\u4e03\u53f0\u6cb3"],["\u9ed1M","\u7ee5\u5316"],["\u9ed1N","\u9ed1\u6cb3"]]),this._initProvinceMap("\u6e56\u5317",[["\u9102A","\u6b66\u6c49"],["\u9102B","\u9ec4\u77f3"],["\u9102C","\u5341\u5830"],["\u9102D","\u8346\u5dde"],["\u9102E","\u5b9c\u660c"],["\u9102F","\u8944\u9633"],["\u9102G","\u9102\u5dde"],["\u9102H","\u8346\u95e8"],["\u9102J","\u9ec4\u5188"],["\u9102K","\u5b5d\u611f"],["\u9102L","\u54b8\u5b81"],["\u9102M","\u4ed9\u6843"],["\u9102N","\u6f5c\u6c5f"]]),this._initProvinceMap("\u6e56\u5357",[["\u6e58A","\u957f\u6c99"],["\u6e58B","\u682a\u6d32"],["\u6e58C","\u6e58\u6f6d"],["\u6e58D","\u8861\u9633"],["\u6e58E","\u90b5\u9633"],["\u6e58F","\u5cb3\u9633"],["\u6e58G","\u5f20\u5bb6\u754c"],["\u6e58H","\u76ca\u9633"],["\u6e58J","\u5e38\u5fb7"],["\u6e58K","\u5a04\u5e95"],["\u6e58L","\u90f4\u5dde"],["\u6e58M","\u6c38\u5dde"],["\u6e58N","\u6000\u5316"]]),this._initProvinceMap("\u6c5f\u82cf",[["\u82cfA","\u5357\u4eac"],["\u82cfB","\u65e0\u9521"],["\u82cfC","\u5f90\u5dde"],["\u82cfD","\u5e38\u5dde"],["\u82cfE","\u82cf\u5dde"],["\u82cfF","\u5357\u901a"],["\u82cfG","\u8fde\u4e91\u6e2f"],["\u82cfH","\u6dee\u5b89"],["\u82cfJ","\u76d0\u57ce"],["\u82cfK","\u626c\u5dde"],["\u82cfL","\u9547\u6c5f"],["\u82cfM","\u6cf0\u5dde"],["\u82cfN","\u5bbf\u8fc1"]]),this._initProvinceMap("\u6c5f\u897f",[["\u8d63A","\u5357\u660c"],["\u8d63B","\u8d63\u5dde"],["\u8d63C","\u5b9c\u6625"],["\u8d63D","\u5409\u5b89"],["\u8d63E","\u4e0a\u9976"],["\u8d63F","\u629a\u5dde"],["\u8d63G","\u4e5d\u6c5f"],["\u8d63H","\u666f\u5fb7\u9547"],["\u8d63J","\u840d\u4e61"],["\u8d63K","\u65b0\u4f59"],["\u8d63L","\u9e70\u6f6d"]]),this._initProvinceMap("\u5409\u6797",[["\u5409A","\u957f\u6625"],["\u5409B","\u5409\u6797"],["\u5409C","\u56db\u5e73"],["\u5409D","\u8fbd\u6e90"],["\u5409E","\u901a\u5316"],["\u5409F","\u767d\u5c71"],["\u5409G","\u767d\u57ce"],["\u5409J","\u677e\u539f"]]),this._initProvinceMap("\u8fbd\u5b81",[["\u8fbdA","\u6c88\u9633"],["\u8fbdB","\u5927\u8fde"],["\u8fbdC","\u978d\u5c71"],["\u8fbdD","\u629a\u987a"],["\u8fbdE","\u672c\u6eaa"],["\u8fbdF","\u4e39\u4e1c"],["\u8fbdG","\u9526\u5dde"],["\u8fbdH","\u8425\u53e3"],["\u8fbdJ","\u961c\u65b0"],["\u8fbdK","\u8fbd\u9633"],["\u8fbdL","\u76d8\u9526"],["\u8fbdM","\u94c1\u5cad"],["\u8fbdN","\u671d\u9633"],["\u8fbdP","\u846b\u82a6\u5c9b"]]),this._initProvinceMap("\u5185\u8499\u53e4",[["\u8499A","\u547c\u548c\u6d69\u7279"],["\u8499B","\u5305\u5934"],["\u8499C","\u4e4c\u6d77"],["\u8499D","\u8d64\u5cf0"],["\u8499E","\u547c\u4f26\u8d1d\u5c14"],["\u8499F","\u5174\u5b89\u76df"],["\u8499G","\u901a\u8fbd"],["\u8499H","\u9521\u6797\u90ed\u52d2\u76df"],["\u8499J","\u4e4c\u5170\u5bdf\u5e03"],["\u8499K","\u9102\u5c14\u591a\u65af"],["\u8499L","\u5df4\u5f66\u6dd6\u5c14"],["\u8499M","\u963f\u62c9\u5584\u76df"]]),this._initProvinceMap("\u5b81\u590f",[["\u5b81A","\u94f6\u5ddd"],["\u5b81B","\u77f3\u5634\u5c71"],["\u5b81C","\u5434\u5fe0"],["\u5b81D","\u56fa\u539f"],["\u5b81E","\u4e2d\u536b"]]),this._initProvinceMap("\u9752\u6d77",[["\u9752A","\u897f\u5b81"],["\u9752B","\u6d77\u4e1c"],["\u9752C","\u6d77\u5317"],["\u9752D","\u9ec4\u5357"],["\u9752E","\u6d77\u5357"],["\u9752F","\u679c\u6d1b"],["\u9752G","\u7389\u6811"],["\u9752H","\u6d77\u897f"]]),this._initProvinceMap("\u9655\u897f",[["\u9655A","\u897f\u5b89"],["\u9655B","\u94dc\u5ddd"],["\u9655C","\u5b9d\u9e21"],["\u9655D","\u54b8\u9633"],["\u9655E","\u6e2d\u5357"],["\u9655F","\u6c49\u4e2d"],["\u9655G","\u5b89\u5eb7"],["\u9655H","\u5546\u6d1b"],["\u9655J","\u5ef6\u5b89"],["\u9655K","\u6986\u6797"]]),this._initProvinceMap("\u56db\u5ddd",[["\u5dddA","\u6210\u90fd"],["\u5dddB","\u7ef5\u9633"],["\u5dddC","\u81ea\u8d21"],["\u5dddD","\u6500\u679d\u82b1"],["\u5dddE","\u6cf8\u5dde"],["\u5dddF","\u5fb7\u9633"],["\u5dddH","\u5e7f\u5143"],["\u5dddJ","\u9042\u5b81"],["\u5dddK","\u5185\u6c5f"],["\u5dddL","\u4e50\u5c71"],["\u5dddM","\u8d44\u9633"],["\u5dddQ","\u5b9c\u5bbe"],["\u5dddR","\u5357\u5145"],["\u5dddS","\u8fbe\u5dde"],["\u5dddT","\u96c5\u5b89"]]),this._initProvinceMap("\u65b0\u7586",[["\u65b0A","\u4e4c\u9c81\u6728\u9f50"],["\u65b0B","\u660c\u5409"],["\u65b0C","\u77f3\u6cb3\u5b50"],["\u65b0D","\u594e\u5c6f"],["\u65b0F","\u4f0a\u7281"],["\u65b0G","\u5854\u57ce"],["\u65b0H","\u963f\u52d2\u6cf0"],["\u65b0J","\u514b\u62c9\u739b\u4f9d"],["\u65b0K","\u5410\u9c81\u756a"],["\u65b0L","\u54c8\u5bc6"],["\u65b0N","\u963f\u514b\u82cf"],["\u65b0Q","\u5580\u4ec0"],["\u65b0R","\u548c\u7530"]]),this._initProvinceMap("\u897f\u85cf",[["\u85cfA","\u62c9\u8428"],["\u85cfB","\u660c\u90fd"],["\u85cfC","\u5c71\u5357"],["\u85cfD","\u65e5\u5580\u5219"],["\u85cfE","\u90a3\u66f2"],["\u85cfF","\u963f\u91cc\u5730\u533a"],["\u85cfG","\u6797\u829d"]]),this._initProvinceMap("\u4e91\u5357",[["\u4e91A","\u6606\u660e"],["\u4e91C","\u662d\u901a"],["\u4e91D","\u66f2\u9756"],["\u4e91F","\u7389\u6eaa"],["\u4e91H","\u6587\u5c71"],["\u4e91J","\u666e\u6d31"],["\u4e91K","\u897f\u53cc\u7248\u7eb3"],["\u4e91L","\u5927\u7406"],["\u4e91M","\u4fdd\u5c71"],["\u4e91P","\u4e3d\u6c5f"],["\u4e91Q","\u6012\u6c5f"],["\u4e91S","\u4e34\u6ca7"]]),this._initProvinceMap("\u6d59\u6c5f",[["\u6d59A","\u676d\u5dde"],["\u6d59B","\u5b81\u6ce2"],["\u6d59C","\u6e29\u5dde"],["\u6d59D","\u7ecd\u5174"],["\u6d59E","\u6e56\u5dde"],["\u6d59F","\u5609\u5174"],["\u6d59G","\u91d1\u534e"],["\u6d59H","\u8862\u5dde"],["\u6d59J","\u53f0\u5dde"],["\u6d59K","\u4e3d\u6c34"],["\u6d59L","\u821f\u5c71"]]),this._initProvinceMap("\u4e0a\u6d77",[["\u6caaA","\u4e0a\u6d77"]]),this._initProvinceMap("\u5317\u4eac",[["\u4eacA","\u5317\u4eac"]]),this._initProvinceMap("\u5929\u6d25",[["\u6d25A","\u5929\u6d25"]]),this._initProvinceMap("\u91cd\u5e86",[["\u6e1dA","\u91cd\u5e86"]])}return t.prototype._initProvinceMap=function(t,e){var i=this,o=new Map;e.forEach(function(t){var e=t[0],n=t[1];o.set(e,n),i._chinaPlateMap.set(e,n),i._chinaPlates.push([e,n])}),this._provincePlateMap.set(t,o)},t.prototype.getCity=function(t){return this._chinaPlateMap.get(t)},t.prototype.getChinaCitesAndPlates=function(){var t=[],e=[];this.shuffleArray(this._chinaPlates);for(var i=0;i<20;i++)e.push(this._chinaPlates[i][0]),t.push(this._chinaPlates[i][1]);return this.shuffleArray(e),{cities:t,plates:e}},t.prototype.getCitiesAndPlates=function(t,e){var i,o;void 0===e&&(e=20);var n=this._provincePlateMap.get(t),a=0;if(n){for(var s=[],r=[],c=n.entries(),l=c.next();!l.done&&a++<e;)r.push(l.value[0]),s.push(l.value[1]),l=c.next();this.shuffleArray(this._chinaPlates);for(var h=0;h<20&&a<20&&20!=a;h++)n.has(this._chinaPlates[h][0])||(r.push(this._chinaPlates[h][0]),s.push(this._chinaPlates[h][1]),a++);for(this.shuffleArray(s),this.shuffleArray(r),h=0;h<r.length;h++)n.get(r[h])===s[h]&&(h!==r.length-1?(i=[s[h+1],s[h]],s[h]=i[0],s[h+1]=i[1]):(o=[s[0],s[h]],s[h]=o[0],s[0]=o[1]));return{cities:s,plates:r}}},t.prototype.shuffleArray=function(t){for(var e,i=t.length-1;i>0;i--){var o=Math.floor(Math.random()*i);e=[t[o],t[i]],t[i]=e[0],t[o]=e[1]}},__decorate([n],t)}());i.default=a,cc._RF.pop()},{}],sheepGuardianMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"23a26/WbcpA94ydkakhKneO","sheepGuardianMainGame"),Object.defineProperty(i,"__esModule",{value:!0}),i.SheepGuardianMapObject=void 0;var o,n=__importDefault(t("../../miniGamePackage/SubPackageManager")),a=t("./maxFlowSolver"),s=cc._decorator,r=s.ccclass,c=s.property;(function(t){t[t.Empty=0]="Empty",t[t.Barrier=1]="Barrier",t[t.Sheep=2]="Sheep",t[t.Wolf=3]="Wolf"})(o=i.SheepGuardianMapObject||(i.SheepGuardianMapObject={}));var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mapSpriteNode=null,e.remainingBarrierCounter=null,e.barrierSpriteFrame=null,e.barrier2SpriteFrame=null,e.sheepSpriteFrame=null,e.wolfSkeletonData=null,e.trueIconFrame=null,e.ShowGridLinesButSprite=null,e.ShowGridLinesButLabel=null,e.greenButBG=null,e.greyButBG=null,e._mapData=[],e._mapSprites=[],e._mapSpriteRowNodes=[],e._barrierPositions=[],e._sheepPositions=[],e._wolfPositions=[],e._barrierOrder=[],e._boardSize=10,e._tileSize=700/e._boardSize,e._remainingBarrierCount=30,e._remainingHunterCount=0,e._nowLevel=1,e._defeat=!1,e._graphics=null,e._isShowGridLines=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"mapOffset",{get:function(){return cc.v2(-this._boardSize*this._tileSize/2+this._tileSize/2,-this._boardSize*this._tileSize/2+this._tileSize/2-150)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remainingBarrierCount",{get:function(){return this._remainingBarrierCount},set:function(t){this._remainingBarrierCount=t,this.remainingBarrierCounter&&(t<0&&(t=0),this.remainingBarrierCounter.string="x"+t)},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.mapSpriteNode&&(this._graphics=this.mapSpriteNode.addComponent(cc.Graphics)),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStartAndMove,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchStartAndMove,this),this._startLevel()},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStartAndMove,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchStartAndMove,this)},e.prototype._Level1=function(){for(var t=Math.round(this._boardSize/2),e=Math.round(t/2),i=0;i<e;i++)this._barrierPositions.push(cc.v2(t,i)),this._barrierPositions.push(cc.v2(t,this._boardSize-i-1));this._sheepPositions.push(cc.v2(t,t)),this._wolfPositions.push(cc.v2(e,e)),this._wolfPositions.push(cc.v2(e,3*e)),this._wolfPositions.push(cc.v2(3*e,e)),this._wolfPositions.push(cc.v2(3*e,3*e))},e.prototype._Level2=function(){for(var t=Math.round(this._boardSize/3),e=Math.round(this._boardSize/4),i=0;i<this._boardSize;i++)this._barrierPositions.push(cc.v2(t-2,i));for(i=0;i<t;i++)this._barrierPositions.push(cc.v2(2*t,i)),this._barrierPositions.push(cc.v2(2*t,this._boardSize-i));this._sheepPositions.push(cc.v2(e-2,e)),this._sheepPositions.push(cc.v2(e-2,2*e)),this._sheepPositions.push(cc.v2(2*e,e)),this._sheepPositions.push(cc.v2(2*e,3*e)),this._sheepPositions.push(cc.v2(3*e,2*e)),this._sheepPositions.push(cc.v2(3*e,3*e)),this._wolfPositions.push(cc.v2(e-2,3*e)),this._wolfPositions.push(cc.v2(2*e,2*e)),this._wolfPositions.push(cc.v2(3*e+1,e))},e.prototype._LevelRandom=function(){for(var t=this._boardSize,e=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},i=[],n=0;n<this._boardSize;n++){i[n]=[];for(var a=0;a<this._boardSize;a++)i[n][a]=o.Empty}this._sheepPositions=[],this._wolfPositions=[],this._barrierPositions=[];var s=e(1,5),r=e(1,5),c=Math.round(t*t/8),l=e(c,2*c),h=function(e,n,a){for(var s=[],r=1;r<=n;r++)s.push(cc.v2(r,0)),s.push(cc.v2(-r,0));for(r=1;r<=a;r++)s.push(cc.v2(0,r)),s.push(cc.v2(0,-r));if(n&&a)for(r=-n;r<=n;r++)for(var c=-a;c<=a;c++)s.push(cc.v2(r,c));for(var l=0,h=s;l<h.length;l++){var u=h[l],d=e.x+u.x,p=e.y+u.y;if(d>=0&&d<t&&p>=0&&p<t&&i[d][p]!=o.Empty)return!1}return!0},u=function(e,i){for(var o=[],n=0;n<t;n++)for(var a=0;a<t;a++){var s=cc.v2(n,a);h(s,e,i)&&o.push(s)}return o},d=this.shuffleArray(u(0,0));for(n=0;n<r&&d.length>0;++n)(f=d.pop())&&h(f,2,0)&&(i[f.x][f.y]=o.Wolf,this._wolfPositions.push(f));var p=this.shuffleArray(u(3,1));for(n=0;n<s&&p.length>0;++n)(f=p.pop())&&h(f,2,0)&&(i[f.x][f.y]=o.Sheep,this._sheepPositions.push(f));var m=this.shuffleArray(u(1,0));for(n=0;n<l&&m.length>0;++n){var f;(f=m.pop())&&(i[f.x][f.y]=o.Barrier,this._barrierPositions.push(f))}},e.prototype._startLevel=function(){if(this._mapSpriteRowNodes=[],this.mapSpriteNode&&this.mapSpriteNode.destroyAllChildren(),this._barrierPositions=[],this._sheepPositions=[],this._wolfPositions=[],this._barrierOrder=[],this._remainingHunterCount=0,this._defeat=!1,3===this._nowLevel?this._boardSize=10:this._nowLevel>3?this._boardSize++:this._boardSize=20,this._tileSize=700/this._boardSize,1===this._nowLevel)this._Level1(),this.isShowGridLines=!1,this.remainingBarrierCount=30;else if(2===this._nowLevel)this._Level2(),this.remainingBarrierCount=30;else{3===this._nowLevel&&(this.isShowGridLines=!0);do{this._LevelRandom(),this._initMapData(),this.remainingBarrierCount=a.createFlowGraph(this._boardSize,this._mapData,this._wolfPositions,this._sheepPositions)}while(0===this.remainingBarrierCount)}this._initMapData(),this._initMapSprites(),this._renderMap()},e.prototype._initMapData=function(){var t=this;this._mapData=[];for(var e=0;e<this._boardSize;e++){this._mapData[e]=[];for(var i=0;i<this._boardSize;i++)this._mapData[e][i]=o.Empty}this._barrierPositions.forEach(function(e){e.x<0||e.x>t._boardSize-1||e.y<0||e.y>t._boardSize-1||(t._mapData[e.x][e.y]=o.Barrier)}),this._wolfPositions.forEach(function(e){e.x<0||e.x>t._boardSize-1||e.y<0||e.y>t._boardSize-1||(t._mapData[e.x][e.y]=o.Wolf)}),this._sheepPositions.forEach(function(e){e.x<0||e.x>t._boardSize-1||e.y<0||e.y>t._boardSize-1||(t._mapData[e.x][e.y]=o.Sheep)})},e.prototype._initMapSprites=function(){this._mapSprites=[];for(var t=0;t<this._boardSize;t++)this._mapSprites[t]=[];for(var e=this._boardSize-1;e>=0;e--){var i=new cc.Node;for(this._mapSpriteRowNodes.push(i),this.mapSpriteNode&&this.mapSpriteNode.addChild(i),t=0;t<this._boardSize;t++){var n=new cc.Node;i.addChild(n);var a;a=this._mapData[t][e]===o.Wolf?n.addComponent(sp.Skeleton):n.addComponent(cc.Sprite),this._mapSprites[t][e]=a,n.setPosition(cc.v2(t*this._tileSize,e*this._tileSize).add(this.mapOffset))}}this._drawGridLines()},e.prototype._drawGridLines=function(){if(this._graphics){var t=this._graphics;t.lineWidth=2,t.strokeColor=cc.Color.BLUE,t.clear();for(var e=this._tileSize/2,i=0;i<=this._boardSize;++i){var o=i*this._tileSize+this.mapOffset.y;t.moveTo(this.mapOffset.x-e,o-e),t.lineTo(this._boardSize*this._tileSize+this.mapOffset.x-e,o-e)}for(var n=0;n<=this._boardSize;++n){var a=n*this._tileSize+this.mapOffset.x;t.moveTo(a-e,this.mapOffset.y-e),t.lineTo(a-e,this._boardSize*this._tileSize+this.mapOffset.y-e)}!0===this.isShowGridLines&&t.stroke()}},e.prototype._renderMap=function(){for(var t=0;t<this._boardSize;t++)for(var e=0;e<this._boardSize;e++)this._updateSprite(t,e)},e.prototype._updateSprite=function(t,e){if(this.barrierSpriteFrame&&this.sheepSpriteFrame&&this.wolfSkeletonData&&this.barrier2SpriteFrame){var i=this._mapSprites[t][e];if(this._mapData[t][e]===o.Barrier)(i=i).spriteFrame=this.barrierSpriteFrame,this._barrierOrder.length&&(i.spriteFrame=this.barrier2SpriteFrame),i.node.color=cc.Color.WHITE,i.node.setContentSize(cc.size(this._tileSize,this._tileSize));else if(this._mapData[t][e]===o.Sheep)(i=i).spriteFrame=this.sheepSpriteFrame,Math.random()>.5&&(i.node.scaleX*=-1),i.node.color=cc.Color.WHITE,i.node.setContentSize(cc.size(2.3*this._tileSize,1*this._tileSize));else{if(this._mapData[t][e]!==o.Wolf)return void i.node.setContentSize(cc.size(0,0));(i=i).skeletonData=this.wolfSkeletonData,i.animation="idle",i.node.color=cc.Color.WHITE,i.node.setScale(cc.v2(2.9*this._tileSize/127,1.3*this._tileSize/74)),Math.random()>.5&&(i.node.scaleX*=-1)}}},e.prototype.onTouchStartAndMove=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation()).sub(this.mapOffset).add(cc.v2(this._tileSize/2,this._tileSize/2)),i=Math.floor(e.x/this._tileSize),n=Math.floor(e.y/this._tileSize);if(i>=0&&i<this._boardSize&&n>=0&&n<this._boardSize&&this.remainingBarrierCount>0){var a=i-1<0||this._mapData[i-1][n]!==o.Wolf&&this._mapData[i-1][n]!==o.Sheep,s=i+1>=this._boardSize||this._mapData[i+1][n]!==o.Wolf&&this._mapData[i+1][n]!==o.Sheep;a&&s&&this._mapData[i][n]===o.Empty&&(this._mapData[i][n]=o.Barrier,this._barrierOrder.push(cc.v2(i,n)),this._barrierPositions.push(cc.v2(i,n)),this.remainingBarrierCount--,this._updateSprite(i,n),0===this.remainingBarrierCount&&(this.remainingBarrierCount=-1,this._startHunt()))}},e.prototype.revertBarrier=function(){if(this._barrierOrder.length&&this.remainingBarrierCount>0){this._barrierPositions.pop();var t=this._barrierOrder.pop();this.remainingBarrierCount++,t&&(this._mapData[t.x][t.y]=o.Empty,this._updateSprite(t.x,t.y))}},e.prototype._startHunt=function(){for(var t=this,e=function(e){var o=i._mapSprites[e.x][e.y].node,n=i._findPath(e,i._sheepPositions);if(n){!0===n.found&&(i._defeat=!0),i._remainingHunterCount++;var a=cc.tween(o);o.getComponent(sp.Skeleton).animation="bite";for(var s=function(e){var n=cc.v2(e.x*i._tileSize,e.y*i._tileSize).add(i.mapOffset);a=a.call(function(){n.x>o.getPosition().x&&(o.scaleX=Math.abs(o.scaleX)),n.x<o.getPosition().x&&(o.scaleX=-Math.abs(o.scaleX))}).to(.1,{x:n.x,y:n.y}).call(function(){o.setParent(t._mapSpriteRowNodes[t._boardSize-1-e.y])})},r=0,c=n.path;r<c.length;r++)s(c[r]);(a=a.call(function(){t._remainingHunterCount--,0===t._remainingHunterCount&&t._checkGameOver()})).start()}},i=this,o=0,n=this._wolfPositions;o<n.length;o++)e(n[o])},e.prototype._checkGameOver=function(){var t=this;if(!0===this._defeat)n.default.instance.gotoResultWithLoading(!1,this.node.parent);else if(this._nowLevel++,13===this._nowLevel)n.default.instance.gotoResultWithLoading(!0,this.node.parent);else{var e=cc.v2(0,-100),i=new cc.Node;i.parent=this.node,i.setPosition(e);var o=i.addComponent(cc.Sprite);this.trueIconFrame&&(o.spriteFrame=this.trueIconFrame),o.sizeMode=cc.Sprite.SizeMode.CUSTOM,i.setContentSize(400,300),cc.tween(i).to(.1,{scale:1.5}).to(.1,{scale:.8}).to(.1,{scale:1.2}).to(.1,{scale:.9}).to(.6,{scale:1}).call(function(){t._startLevel(),i.destroy()}).start()}},e.prototype.onClickExit=function(){n.default.instance.getModel().gameExit()},Object.defineProperty(e.prototype,"isShowGridLines",{get:function(){return this._isShowGridLines},set:function(t){this.ShowGridLinesButSprite&&this.ShowGridLinesButLabel&&(!t&&this.greenButBG&&(this.ShowGridLinesButSprite.spriteFrame=this.greenButBG,this.ShowGridLinesButLabel.string="\u663e\u793a\n\u7f51\u683c"),t&&this.greyButBG&&(this.ShowGridLinesButSprite.spriteFrame=this.greyButBG,this.ShowGridLinesButLabel.string="\u9690\u85cf\n\u7f51\u683c"),this._isShowGridLines=t,this._drawGridLines())},enumerable:!1,configurable:!0}),e.prototype.onClickShowGridLines=function(){this.isShowGridLines?this.isShowGridLines=!1:this.isShowGridLines=!0},e.prototype._findPath=function(t,e){for(var i=[],n=[],a=[],s=!1,r=1/0,c=t,l=0;l<this._boardSize;l++){i[l]=[],n[l]=[];for(var h=0;h<this._boardSize;h++)i[l][h]=!1,n[l][h]=cc.v2(-1,-1)}for(i[t.x][t.y]=!0,a.push(t);a.length>0;){var u=a.shift();if(u){if(this._mapData[u.x][u.y]===o.Sheep){t=u,s=!0;break}for(var d=0,p=this._getNeighbors(u);d<p.length;d++){var m=p[d];if(l=m.x,h=m.y,!i[l][h]){i[l][h]=!0,n[l][h]=u,a.push(m);for(var f=0,g=e;f<g.length;f++){var _=g[f],y=Math.abs(l-_.x)+Math.abs(h-_.y);y<r&&(r=y,c=m)}}}}}s||(t=c);for(var v=[],b=t;!b.equals(cc.v2(-1,-1));)v.unshift(b),b=n[b.x][b.y];return{path:v,found:s}},e.prototype.shuffleArray=function(t){for(var e,i=t.length-1;i>0;i--){var o=Math.floor(Math.random()*(i+1));e=[t[o],t[i]],t[i]=e[0],t[o]=e[1]}return t},e.prototype._getNeighbors=function(t){var e=[],i=[cc.v2(-1,0),cc.v2(1,0),cc.v2(0,-1),cc.v2(0,1)],n=[cc.v2(-1,-1),cc.v2(-1,1),cc.v2(1,-1),cc.v2(1,1)];i=this.shuffleArray(i),n=this.shuffleArray(n);for(var a=0,s=i;a<s.length;a++){var r=s[a],c=t.x+r.x,l=t.y+r.y;c<0||c>=this._boardSize||l<0||l>=this._boardSize||this._mapData[c][l]!==o.Barrier&&e.push(cc.v2(c,l))}for(var h=0,u=n;h<u.length;h++)if(r=u[h],c=t.x+r.x,l=t.y+r.y,!(c<0||c>=this._boardSize||l<0||l>=this._boardSize)&&this._mapData[c][l]!==o.Barrier){var d=this._mapData[t.x+r.x][t.y]!==o.Barrier,p=this._mapData[t.x][t.y+r.y]!==o.Barrier;(d||p)&&e.push(cc.v2(c,l))}return e},__decorate([c(cc.Node)],e.prototype,"mapSpriteNode",void 0),__decorate([c(cc.Label)],e.prototype,"remainingBarrierCounter",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"barrierSpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"barrier2SpriteFrame",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"sheepSpriteFrame",void 0),__decorate([c(sp.SkeletonData)],e.prototype,"wolfSkeletonData",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"trueIconFrame",void 0),__decorate([c(cc.Sprite)],e.prototype,"ShowGridLinesButSprite",void 0),__decorate([c(cc.Label)],e.prototype,"ShowGridLinesButLabel",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"greenButBG",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"greyButBG",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./maxFlowSolver":"maxFlowSolver"}],sheepGuardianModel:[function(t,e,i){"use strict";cc._RF.push(e,"acd82OYX1NPjbhF3pD/MNbE","sheepGuardianModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/sheepGuardian/sheepGuardianMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.sheepGuardian)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],sheepGuardianbubbleController:[function(t,e,i){"use strict";cc._RF.push(e,"9e5d14TMKpMwoKFsa4nla4z","sheepGuardianbubbleController"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.minY=0,e.maxY=0,e.minX=0,e.maxX=0,e.minSpawnInterval=1,e.maxSpawnInterval=5,e.bubbleSpriteFrame=null,e._spawnBubbleTimer=0,e}return __extends(e,t),e.prototype.update=function(t){this._spawnBubbleTimer-=t,this._spawnBubbleTimer<=0&&(this._spawnBubbleTimer=this.randomFloat(this.minSpawnInterval,this.maxSpawnInterval),this.spawnBubble())},e.prototype.spawnBubble=function(){var t=new cc.Node("Bubble"),e=t.addComponent(cc.Sprite);this.bubbleSpriteFrame&&(e.spriteFrame=this.bubbleSpriteFrame);var i=this.randomFloat(this.minX,this.maxX),o=this.randomFloat(.5,1.5);this.node.addChild(t),t.setPosition(i,this.minY),t.setScale(o);var n=this.randomFloat(2,3),a=new cc.Vec3(i,this.maxY),s=1.5*o,r=cc.tween(t);r=r.to(n,{position:a,scale:s},{easing:"cubicOut"}).call(function(){t.destroy()}).start()},e.prototype.randomFloat=function(t,e){return t+Math.random()*(e-t)},__decorate([a({type:cc.Float})],e.prototype,"minY",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxY",void 0),__decorate([a({type:cc.Float})],e.prototype,"minX",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxX",void 0),__decorate([a({type:cc.Float})],e.prototype,"minSpawnInterval",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxSpawnInterval",void 0),__decorate([a({type:cc.SpriteFrame})],e.prototype,"bubbleSpriteFrame",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],skiRushCoinShape:[function(t,e,i){"use strict";cc._RF.push(e,"0a5f8wghjBCh4zcEuTGq/Uc","skiRushCoinShape"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=(o.property,function(){function t(){this._ch=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]],this.xian=[[0,0,0,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,0,1,0,1,0],[0,0,0,0,0,0,0,1,0,0,0],[0,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,0,0,1,0,0,0],[0,1,0,1,1,1,0,1,0,0,0],[0,1,0,0,0,0,0,1,0,0,0],[0,1,0,1,1,1,0,1,0,1,0],[0,1,0,1,0,1,0,0,1,0,0],[0,1,0,1,1,1,0,1,0,1,0],[1,0,0,0,0,0,1,0,0,0,1]],this.yu=[[0,0,0,0,1,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,0,0],[0,0,1,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,1,0,0,0,1,0],[0,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,1,0,0,0,1,0],[0,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1]],this.zhi=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,1],[0,1,1,0,0,0,0,0,0,1,0],[0,0,1,1,1,1,1,1,1,0,0]],this.wang=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0],[0,0,0,1,1,1,1,1,1,0,0],[0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1]],this.xyzw=[this.xian,this._ch,this._ch,this.yu,this._ch,this._ch,this.zhi,this._ch,this._ch,this.wang],this._en=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],this.F=[[0,1,1,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,1,0,0],[0,1,1,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0,0,0],[0,1,1,1,1,1,1,1,0,0,0],[0,1,1,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0,0]],this.S=[[0,0,1,1,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,1,1,0,0,0,1,1,0,0],[0,0,1,1,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,0,1,1,0,0],[0,0,1,1,0,0,0,1,1,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,1,0,0]],this.H=[[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,1,1,1,1,1,1,0],[0,0,1,1,1,1,1,1,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0]],this.k=[[0,0,1,1,0,0,0,1,1,0,0],[0,0,1,1,0,0,1,1,0,0,0],[0,0,1,1,0,1,1,0,0,0,0],[0,0,1,1,1,1,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,0],[0,0,1,1,1,1,0,0,0,0,0],[0,0,1,1,0,1,1,0,0,0,0],[0,0,1,1,0,0,1,1,0,0,0],[0,0,1,1,0,0,0,1,1,0,0],[0,0,1,1,0,0,0,0,1,1,0]],this.i=[[0,0,0,1,1,1,1,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0],[0,0,0,1,1,1,1,0,0,0,0]],this.N=[[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,1,0,0,0,1,1,0],[0,0,1,1,1,1,0,0,1,1,0],[0,0,1,1,1,1,1,0,1,1,0],[0,0,1,1,0,1,1,1,1,1,0],[0,0,1,1,0,0,1,1,1,1,0],[0,0,1,1,0,0,0,1,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0]],this.G=[[0,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,0],[0,1,1,0,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0,0],[0,1,1,0,1,1,1,1,1,1,0],[0,1,1,0,1,1,1,1,1,1,0],[0,1,1,0,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,0,1,1,0],[0,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,0]],this.D=[[0,0,1,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,0,0,1,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,1,0,0,0]],this.O=[[0,0,0,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,0,0],[0,1,1,0,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,0,1,1,0],[0,0,1,1,1,1,1,1,1,0,0],[0,0,0,1,1,1,1,1,0,0,0]],this.M=[[1,1,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,1,1],[1,1,1,0,0,0,0,0,1,1,1],[1,1,1,0,0,0,0,0,1,1,1],[1,1,1,1,0,0,0,1,1,1,1],[1,1,1,1,0,0,0,1,1,1,1],[1,1,0,1,1,0,1,1,0,1,1],[1,1,0,1,1,1,1,1,0,1,1],[1,1,0,0,1,1,1,0,0,1,1],[1,1,0,0,0,1,0,0,0,1,1]],this.FISHKINGDOMS=[this.F,this.i,this.S,this.H,this._ch,this._ch,this.k,this.i,this.N,this.G,this.D,this.O,this.M,this.S]}return __decorate([n],t)}());i.default=a,cc._RF.pop()},{}],skiRushMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"e8ce4LVEplNX4hBzs7ODZGO","skiRushMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o,n,a,s,r=__importStar(t("../../miniGamePackage/SubPackageManager")),c=__importDefault(t("../../miniGamePackage/helpModel/diffLayerBG/diffLayerBG")),l=t("../../miniGamePackage/types-miniGame"),h=__importDefault(t("./skiRushCoinShape")),u=cc._decorator,d=u.ccclass,p=u.property;(function(t){t[t.floor=0]="floor",t[t.car=1]="car",t[t.stone=2]="stone",t[t.jumpBoard=3]="jumpBoard",t[t.corn=4]="corn"})(o||(o={})),function(t){t[t.tree=-10]="tree",t[t.milestone=-9]="milestone",t[t.jumpBoard=-8]="jumpBoard",t[t.stone=-7]="stone",t[t.coin=-6]="coin",t[t.snow=2]="snow"}(n||(n={})),function(t){t[t.zoom0=-1]="zoom0",t[t.eatCoin=0]="eatCoin",t[t.zoom1=1]="zoom1",t[t.zoom2=2]="zoom2",t[t.zoom3=3]="zoom3",t[t.snowSlide=4]="snowSlide",t[t.hitRock=5]="hitRock",t[t.die=6]="die",t[t.getZoom=7]="getZoom"}(a||(a={})),function(t){t[t.normal=0]="normal",t[t.zoom=1]="zoom",t[t.jump=2]="jump",t[t.zoomJump=3]="zoomJump",t[t.die=4]="die",t[t.tryStand=5]="tryStand"}(s||(s={}));var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bg=null,e.sceneNode=null,e.bgNode=null,e.uiNode=null,e.drawerPre=null,e.milestonePre=null,e.treePres=[],e.carNode=null,e.distanceLabel=null,e.maxDistanceLabel=null,e.cover=null,e.coverFrames=[],e.streak=null,e.streakText=[],e.jumpBoardPre=null,e.cornPre=null,e.stonePres=[],e.stoneSplicePres=[],e.playerTypeFrame=[],e.snowFrame=[],e.snowSlide=null,e.snowWarning=null,e.shareShotNode=null,e.shareNode=null,e.soundClip=[],e._world=null,e._floorMaterial=null,e._wheelMaterial=null,e._carMaterial=null,e._floors=[],e._drawers=[],e._allFloorHeights=[],e._nowFloorHeights=[],e._floorElementInterval=5,e._oneFloorLength=2e3,e._floorElementNoiseCnt=0,e._randomNoiseSeed=cc.v3(),e._floorTrees=[],e._carBody=null,e.stoneBodies=[],e.stoneNodes=[],e.coinNodes=[],e.coinShape=new h.default,e._shakeAmount=0,e.snows=[],e.snowPool=new cc.NodePool,e.coinPool=new cc.NodePool,e.treePool=new cc.NodePool,e._milestoneOffset=500,e._milestones=[],e._distance=0,e._maxDistance=0,e._isGameOver=!1,e.screenRate=1,e.camera=null,e.cameraShakeOffsetPos=cc.v2(),e.cameraSpeed=500,e.cameraOffsetPos=cc.v2(0,0),e.soundCaches=[],e.isOnTouching=!1,e.touchProtect=!1,e.isOnFloor=0,e.isOnJumpBoard=0,e.isOnStone=0,e.isHitStone=!1,e.carAngel=0,e.zoomTime=0,e.dieTime=0,e.totalDieTime=2,e.isShared=!1,e.isGameOver=!1,e.isReLifeProtect=!1,e._carPos=cc.Vec2.ZERO,e._coinPos=cc.Vec2.ZERO,e._carDir=cc.Vec2.ZERO,e.zoomCoinNum=12,e._coinNum=0,e.coinTime={value:0},e._speedLv=0,e._playerType=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"coinNum",{get:function(){return this._coinNum},set:function(t){this.coinTime.value>0?(t==this.zoomCoinNum&&(this.speedLv++,t=0),this._coinNum=t):this._coinNum=1,this.coinTime.value=100,cc.Tween.stopAllByTarget(this.coinTime),cc.tween(this.coinTime).to(.5,{value:0}).start()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speedLv",{get:function(){return this._speedLv},set:function(t){t>3&&(t=3),t<0&&(t=0),t>this._speedLv&&this.soundPlay(a.getZoom),this._speedLv=t,this.streak&&this.cover&&(this.streak.texture=this.streakText[t],this.cover.spriteFrame=this.coverFrames[t],this.streak.stroke=0==t?7:30,t&&(this.zoomTime=1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerType",{get:function(){return this._playerType},set:function(t){this._playerType=t,this.carNode&&(this.carNode.getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=this.playerTypeFrame[t])},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){this.node.angle=-90,this.uiNode&&(this.uiNode.on(cc.Node.EventType.TOUCH_START,this._touchStart,this),this.uiNode.on(cc.Node.EventType.TOUCH_END,this._touchEnd,this),this.uiNode.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEnd,this)),r.default.instance.miniGameAdapter.changeMainGameMusic(.4),cc.game.setFrameRate(60),this.camera=cc.Camera.findCamera(this.node);for(var t=0,e=this.soundClip;t<e.length;t++)e[t],this.soundCaches.push(-1);this.soundCaches[a.snowSlide]=cc.audioEngine.play(this.soundClip[a.snowSlide],!0,0),this.soundCaches[a.zoom1]=cc.audioEngine.play(this.soundClip[a.zoom1],!0,0),this.soundCaches[a.zoom2]=cc.audioEngine.play(this.soundClip[a.zoom2],!0,0),this.soundCaches[a.zoom3]=cc.audioEngine.play(this.soundClip[a.zoom3],!0,0)},e.prototype.onDisable=function(){this.uiNode&&(this.uiNode.off(cc.Node.EventType.TOUCH_START,this._touchStart,this),this.uiNode.off(cc.Node.EventType.TOUCH_END,this._touchEnd,this),this.uiNode.off(cc.Node.EventType.TOUCH_CANCEL,this._touchEnd,this)),cc.Tween.stopAllByTarget(this),cc.game.setFrameRate(30),this._world&&this._world.clear();for(var t=0;t<this.soundClip.length;t++)cc.audioEngine.uncache(this.soundClip[t]);r.default.instance.miniGameAdapter.changeMainGameMusic(1),this._gameSave(),this.camera&&(this.camera.node.setPosition(0,0),this.camera.zoomRatio=1)},e.prototype._touchStart=function(t){if(this.node.convertToNodeSpaceAR(t.getLocation()),this.dieTime>0)return this.dieTime-=.1,void(this.playerType=s.tryStand);this.jump(),this.isOnTouching=!0},e.prototype._touchEnd=function(){this.isOnTouching=!1,this.dieTime>0&&(this.playerType=s.die)},e.prototype.start=function(){r.p5Noise.noiseSeed(Math.floor(1e6*Math.random())),this._gameInit(),this._init()},e.prototype._gameInit=function(){var t=cc.sys.localStorage.getItem("miniGameSkiRush");if(t){var e=JSON.parse(t);e&&(this._maxDistance=e.maxDistance)}this.maxDistanceLabel&&(this.maxDistanceLabel.string=this._maxDistance.toString()+"m")},e.prototype._gameSave=function(){var t={maxDistance:0};t.maxDistance=Math.max(this._maxDistance,this._distance),cc.sys.localStorage.setItem("miniGameSkiRush",JSON.stringify(t))},e.prototype._init=function(){var t,e,i,n=this;if(this._randomNoiseSeed=cc.v3(Math.random(),Math.random(),Math.random()).normalize(),this._world=new r.P2.World,this._world){this._world.gravity=[0,-1e3],this._floorMaterial=new r.P2.Material(1),this._wheelMaterial=new r.P2.Material(2),this._carMaterial=new r.P2.Material(3);var a=new r.P2.ContactMaterial(this._wheelMaterial,this._floorMaterial);if(a.friction=0,this._world.addContactMaterial(a),(a=new r.P2.ContactMaterial(this._carMaterial,this._floorMaterial)).friction=0,this._world.addContactMaterial(a),this.carNode){if(this._carBody=new r.P2.Body({mass:5,position:[this.carNode.x,this.carNode.y]}),this._carBody.type=o.car,!this._carBody)return;var s=this.carNode,c=new r.P2.Circle({radius:s.width/2});c.material=this._carMaterial,null===(t=this._carBody)||void 0===t||t.addShape(c),c.position=[0,0],this._world.addBody(this._carBody),(c=new r.P2.Circle({radius:s.width/2+4})).material=this._carMaterial,null===(e=this._carBody)||void 0===e||e.addShape(c),c.sensor=!0,c.position=[0,0],this._world.addBody(this._carBody);for(var l=1.2*this.carNode.width,h=l/4-2,u=0;u<0;u++){var d=new r.P2.Body({mass:.1,position:[0,0]}),p=new r.P2.Circle({radius:h});p.material=this._wheelMaterial,d.addShape(p),null===(i=this._world)||void 0===i||i.addBody(d);var m=new r.P2.RevoluteConstraint(this._carBody,d,{localPivotA:[-l/2+(u+.5)*h*2,-15],localPivotB:[0,0],maxForce:2e5,collideConnected:!1});this._world.addConstraint(m)}}this._crateFloor(cc.v2(-this._milestoneOffset,0));var f=function(t,e,i){return t.bodyA.type==e&&t.bodyB.type==i||t.bodyA.type==i&&t.bodyB.type==e};this._world.on("beginContact",function(t){var e;(f(t,o.car,o.floor)&&(n.touchProtect||(n.isOnTouching=!1),n.isOnFloor++),f(t,o.car,o.jumpBoard)&&(n.touchProtect||(n.isOnTouching=!1),n.isOnJumpBoard++),f(t,o.car,o.stone))&&(t.bodyA.type==o.stone?(e=t.bodyA,t.shapeB):(e=t.bodyB,t.shapeA),n.hitStone(e)&&(n.isHitStone=!0,cc.tween(n).delay(.1).call(function(){var t;null===(t=n._world)||void 0===t||t.removeBody(e),n.isHitStone=!1}).start()));f(t,o.car,o.corn)}),this._world.on("endContact",function(t){f(t,o.car,o.floor)&&n.isOnFloor--,f(t,o.car,o.jumpBoard)&&n.isOnJumpBoard--})}},e.prototype.getFloorYAndAngel=function(t){var e,i=0,o=0;return this._allFloorHeights.length>1&&t>this._floors[1].position[0]?(e=Math.floor((t-this._floors[1].position[0])/this._floorElementInterval))>=0&&e<this._allFloorHeights[1].length&&(i=this._allFloorHeights[1][e],o=this._allFloorHeights[1][e+1]):((e=Math.floor((t-this._floors[0].position[0])/this._floorElementInterval))==this._allFloorHeights[0].length-1&&e--,e>=0&&(i=this._allFloorHeights[0][e],o=this._allFloorHeights[0][e+1])),{y:i,angel:Math.atan2(o-i,this._floorElementInterval)}},e.prototype._crateFloor=function(t){var e=this;this._nowFloorHeights.length&&(this._nowFloorHeights=[this._nowFloorHeights.pop()]);for(var i=0,a=0;a<this._oneFloorLength;a++){this._floorElementNoiseCnt+=1/150;var s=this._floorElementNoiseCnt;i=0,r.p5Noise.noiseDetail(2,.7),i+=r.p5Noise.noise(s*this._randomNoiseSeed.x,s*this._randomNoiseSeed.y,s*this._randomNoiseSeed.z),r.p5Noise.noiseDetail(9,1),i=600*(i+=r.p5Noise.noise(s/500))-300*this._floorElementNoiseCnt,this._nowFloorHeights.push(i)}var c=new r.P2.Heightfield({heights:this._nowFloorHeights,elementWidth:this._floorElementInterval});this._floorMaterial&&(c.material=this._floorMaterial);var l=new r.P2.Body({mass:0,position:[t.x,t.y]});if(l.type=o.floor,l.addShape(c),this._world&&(this._world.addBody(l),0==this._floors.length&&this._carBody&&(this._carBody.position[1]=this._nowFloorHeights[Math.floor(this._milestoneOffset/this._floorElementInterval)]+50),this._floors.push(l),this._allFloorHeights.push(__spreadArrays(this._nowFloorHeights))),this._floors.length>=2&&this.milestonePre&&this.sceneNode&&this.carNode){var h=cc.instantiate(this.milestonePre),u=h.getChildByName("label").getComponent(cc.Label);if(u){var d=1e3*Math.floor((this._distance+1e3)/1e3);u.string=d.toString()+"m"}var p=Math.floor(this._milestoneOffset/this._floorElementInterval);for(h.parent=this.sceneNode,h.setPosition(cc.v2(t.x+this._milestoneOffset,t.y+this._nowFloorHeights[p]));this._milestones.length&&this._milestones[0]&&this._milestones[0].position.x-this.carNode.x<-1e3;){var m=this._milestones.shift();m&&m.destroy()}this._milestones.push(h),h.zIndex=n.milestone}if(this.sceneNode&&this.carNode){var f=cc.tween(this),g=__spreadArrays(this._nowFloorHeights),_=(d=30,function(){var i=Math.random()*y._oneFloorLength;f=f.delay(.01).call(function(){if(e.sceneNode&&e.carNode){var o=Math.floor(Math.random()*e.treePres.length),a=e.treePool.get();a||(a=cc.instantiate(e.treePres[o])),a.parent=e.sceneNode,a.zIndex=n.tree,a.setPosition(t.x+i*e._floorElementInterval,t.y+g[Math.floor(i)]),e._floorTrees.push(a)}})}),y=this;for(a=0;a<d;a++)_();for(var v=function(){var t=b._floorTrees.shift();f=f.delay(.01).call(function(){t&&e.treePool.put(t)})},b=this;this._floorTrees.length&&this._floorTrees[0]&&this._floorTrees[0].position.x-this.carNode.x<-1e3;)v();f=f.start()}if(this.sceneNode&&this.carNode){var P=cc.tween(this),S=__spreadArrays(this._nowFloorHeights),M=__spreadArrays(S),w=(d=30,0);if(this._floors.length>=2){var k=function(){var i=Math.floor(Math.random()*C._oneFloorLength);if(i<20||i>=C._oneFloorLength-20)return"continue";if(Math.abs(C._nowFloorHeights[i]-C._nowFloorHeights[i-20])>20)return"continue";if(Math.abs(C._nowFloorHeights[i]-C._nowFloorHeights[i+20])>20)return"continue";for(var a=!1,s=i-20;s<=i+20;s++)if(0===M[s]){a=!0;break}if(a)return"continue";for(var c=i-20;c<=i+20;c++)M[c]=0;w++,P=P.delay(.01).call(function(){if(e.sceneNode&&e.jumpBoardPre&&e._world){var a=cc.instantiate(e.jumpBoardPre);a.parent=e.sceneNode,a.zIndex=n.jumpBoard,a.setPosition(t.x+i*e._floorElementInterval,t.y+S[Math.floor(i)]),e.stoneNodes.push(a);var s=new r.P2.Body({mass:0,position:[t.x+i*e._floorElementInterval,t.y+S[Math.floor(i)]]}),c=a.getChildByName("shape");s.type=o.jumpBoard;var l=new r.P2.Box({width:c.width,height:c.height});l.material=e._floorMaterial,s.addShape(l),l.position=[c.x,c.y],l.angle=c.angle*Math.PI/180,e._world.addBody(s),e.stoneBodies.push(s)}})},C=this;for(a=0;a<d&&w<3;a++)k()}if(w=0,this._floors.length>=2){var x=function(){var i=Math.floor(Math.random()*B._oneFloorLength);if(i<10||i>=B._oneFloorLength-10)return"continue";if(Math.abs(B._nowFloorHeights[i]-B._nowFloorHeights[i-10])>30)return"continue";if(Math.abs(B._nowFloorHeights[i]-B._nowFloorHeights[i+10])>30)return"continue";for(var a=!1,s=i-10;s<=i+10;s++)if(0===M[s]){a=!0;break}if(a)return"continue";for(var c=i-10;c<=i+10;c++)M[c]=0;w++,P=P.delay(.01).call(function(){if(e.sceneNode&&e._world){var a=Math.floor(Math.random()*e.stonePres.length),s=cc.instantiate(e.stonePres[a]);s.parent=e.sceneNode,s.zIndex=n.stone,s.setPosition(t.x+i*e._floorElementInterval,t.y+S[Math.floor(i)]),e.stoneNodes.push(s);var c=new r.P2.Body({mass:0,position:[t.x+i*e._floorElementInterval,t.y+S[Math.floor(i)]]}),l=s.getChildByName("shape");c.type=o.stone;var h=new r.P2.Box({width:l.width,height:l.height});h.material=e._floorMaterial,c.addShape(h),h.position=[l.x,l.y],e._world.addBody(c),e.stoneBodies.push(c)}})},B=this;for(a=0;a<d&&w<3;a++)x()}w=0;var T=function(i,o){o=0==o?t.y+S[Math.floor(i)]:t.y+o,P=P.delay(.01).call(function(){if(e.sceneNode&&e.cornPre&&e._world){var a=e.coinPool.get();a||(a=cc.instantiate(e.cornPre)),a.parent=e.sceneNode,a.zIndex=n.coin,a.setPosition(t.x+i*e._floorElementInterval,o),e.coinNodes.push(a)}})},F=10;for(a=0;a<d&&w<2;a++){var E=Math.floor(Math.random()*this._oneFloorLength);if(0!==M[E]){for(var N=E,G=E,A=1,R=function(t){return!!(t>=0&&t<M.length&&M[t])},I=1;I<this.zoomCoinNum&&(G==E+(I-1)*F&&R(E+I*F)&&(A++,G=E+I*F),A!=this.zoomCoinNum)&&(N==E-(I-1)*F&&R(E-I*F)&&(A++,N=E-I*F),A!=this.zoomCoinNum);I++);if(A==this.zoomCoinNum){for(var L=N;L<=G;L++)M[L]=0;w++;for(var D=0;D<this.zoomCoinNum;D++)T(N+D*F,0)}}}F=8;var O=0,z=this._nowFloorHeights[O],U=this.coinShape.FISHKINGDOMS;Math.random()>.5&&(U=this.coinShape.xyzw);for(var H=0,V=U;H<V.length;H++){for(var j=V[H],W=j.length-1;W>=0;W--)for(a=0;a<j[W].length;a++)j[W][a]&&T(O+a*F,z+(j.length-W)*F*this._floorElementInterval);O+=j[0].length*F,j!=this.coinShape._en&&j!=this.coinShape._ch||(z=this._nowFloorHeights[O]+200)}for(var q=function(){var t=K.stoneNodes.shift(),i=K.stoneBodies.shift();P=P.delay(.01).call(function(){t&&(t.zIndex==n.coin?e.coinPool.put(t):t.destroy()),i&&e._world&&e._world.removeBody(i)})},K=this;this.stoneNodes.length&&this.stoneNodes[0]&&this.stoneNodes[0].position.x-this.carNode.x<-1e3;)q();P=P.start()}if(this.drawerPre){var X=cc.instantiate(this.drawerPre.node).getComponent(cc.Graphics);X.node.parent=this.drawerPre.node.parent;var Y=t.add(cc.v2(0,this._nowFloorHeights[0]));for(a=1;a<this._nowFloorHeights.length;a++){var Z=t.add(cc.v2(a*this._floorElementInterval,this._nowFloorHeights[a]));X.moveTo(Y.x,Y.y),X.lineTo(Z.x,Z.y),Y=Z}var J=t.add(cc.v2(0,this._nowFloorHeights[0]));for(X.moveTo(J.x,J.y),a=1;a<this._nowFloorHeights.length;a++)J=t.add(cc.v2(a*this._floorElementInterval,this._nowFloorHeights[a])),X.lineTo(J.x,J.y);X.lineTo(J.x,J.y-1e5),X.lineTo(t.x,J.y-1e5),X.close(),X.fill(),this._drawers.push(X)}},e.prototype._removeFLoor=function(){var t=this._floors.shift();this._allFloorHeights.shift(),t&&this._world&&this._world.removeBody(t);var e=this._drawers.shift();e&&(e.clear(),e.node.destroy())},e.prototype.hitStone=function(t){this.soundPlay(a.hitRock);var e=t.id,i=this.stoneBodies.findIndex(function(t){return t.id===e});if(-1!=i){this.stoneBodies.splice(i,1);var o=this.stoneNodes[i];this.stoneNodes.splice(i,1);for(var s=function(t){var e=cc.instantiate(t);e.parent=o.parent,e.zIndex=n.stone,e.setPosition(o.getPosition().add(cc.v2(20*Math.random()-10,20*Math.random()-10)));var i=50*Math.random()+100;cc.tween(e).by(2,{x:400*Math.random()+1e3}).start(),cc.tween(e).by(Math.sqrt(i/500),{y:i},{easing:cc.easing.quadOut}).by(Math.sqrt((2*i+2e3)/500),{y:-2*i-2e3},{easing:cc.easing.quadIn}).delay(3).call(function(){e.destroy()}).start()},r=0,c=this.stoneSplicePres;r<c.length;r++)s(c[r]);return o.destroy(),!0}return!1},e.prototype.eatCoin=function(t){this.soundPlay(a.eatCoin),this.coinNum++;var e=t.getChildByName("light");return t.getChildByName("sp").active=!1,e.active=!0,cc.tween(e).set({scale:0}).to(.1,{scale:2},{easing:cc.easing.quadOut}).to(.5,{scale:.3},{easing:cc.easing.quadIn}).call(function(){t.destroy()}).start(),!0},e.prototype.jump=function(){var t=this;if(this._carBody&&!this.isFly()){this.speedLv>1?this.playerType=s.zoomJump:this.playerType=s.jump;var e=this.getFloorYAndAngel(this._carBody.position[0]);this._carBody.velocity[0]+=100*-Math.sin(e.angel),this._carBody.velocity[1]+=100*Math.cos(e.angel)+500,this.touchProtect=!0,cc.tween(this).delay(.5).call(function(){t.touchProtect=!1}).start()}},e.prototype.isFly=function(){return!(this.isOnFloor||this.isOnJumpBoard||this.isOnStone)},e.prototype.update=function(t){if(!this.isGameOver&&(t>.03&&(t>.04&&cc.log(t,this._distance),t=.03),!this._isGameOver&&this._world&&this.carNode&&this._carBody&&this.sceneNode)){if(this._world.step(t),this._shakeAmount>=3){var e=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1,i=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1;this.cameraShakeOffsetPos=cc.v2(e,i)}if(this._shakeAmount=Math.max(0,this._shakeAmount-Math.pow(this._shakeAmount+7,1.3)*t),this.isHitStone&&this._carBody.velocity[0]<100&&(this.isHitStone=!1,this.speedLv>0?this.speedLv--:this.dieTime=this.totalDieTime),!this.isOnFloor&&!this.isOnStone)if(this.isOnTouching)this.carAngel+=210*t;else{var o=(Math.floor(this.carAngel)%360+360)%360;o>90&&o<270?this.carAngel+=45*t:this.carAngel-=45*t}var n=this.getFloorYAndAngel(this._carBody.position[0]),r=this._carBody.position[1]-n.y;if(this.camera&&this.uiNode&&this.bgNode){var c=Math.max(1,r/500,Math.max(1,800+400*this.speedLv)/1e3),l=Math.abs(c-this.screenRate)/2+.3;Math.abs(c-this.screenRate)<t*l?this.screenRate=c:c>this.screenRate?this.screenRate+=t*l:this.screenRate-=t*l,this.camera.zoomRatio=1/this.screenRate,this.uiNode.scale=this.screenRate,this.bgNode.scale=this.screenRate}if(r<0&&(this._carBody.position[1]=n.y+30),!this.isFly()&&!this.touchProtect){this._carBody.angle=n.angel,!this.isOnFloor&&this.isOnJumpBoard&&this.jumpBoardPre&&(this._carBody.angle=this.jumpBoardPre.getChildByName("shape").angle*Math.PI/180);var h=800+400*this.speedLv;this.dieTime>0&&(h=100);var u=this._carBody.angle;this.carAngel=180*this._carBody.angle/Math.PI,Math.cos(u),Math.sin(u),this._carBody.velocity=[h*Math.cos(u),h*Math.sin(u)]}!this.isFly()||this.playerType!=s.normal&&this.playerType!=s.zoom||(this.playerType=s.jump),!this.isFly()&&!this.touchProtect&&this.dieTime<=0&&(this.playerType=s.normal,this.speedLv>0&&(this.playerType=s.zoom)),this.dieTime>0&&(this.dieTime-=t,this.playerType!=s.tryStand&&(this.playerType=s.die));for(var d=0;this.carNode.angle-this.carAngel>=180&&this.dieTime<=0;)d++,this.carNode.angle-=360;if(Math.abs(this.carNode.angle-this.carAngel)>90&&this.dieTime<=0&&(this.soundPlay(a.die),this.dieTime=this.totalDieTime),this.dieTime<=0&&d>0&&(this.speedLv+=d),this.zoomTime>0){this.dieTime>0&&(this.zoomTime=0);var p=t;this.isFly()&&(p*=.5),this.zoomTime-=p,this.zoomTime<=0&&this.speedLv--}for(var m=a.zoom1;m<=a.zoom3;m++){var f=m-a.zoom1+1;f==this.speedLv?cc.audioEngine.setVolume(this.soundCaches[m],Math.max(0,this.zoomTime)):f==this.speedLv-1?cc.audioEngine.setVolume(this.soundCaches[m],Math.min(1,1-this.zoomTime)):cc.audioEngine.setVolume(this.soundCaches[m],0)}this.carNode.setPosition(cc.v2(this._carBody.position[0],this._carBody.position[1]));for(var g=this.carAngel-this.carNode.angle;g>180;)g-=360,this.carNode.angle+=360;for(;g<-180;)g+=360,this.carNode.angle-=360;if(g>0?this.carNode.angle+=Math.min(g,720*t):this.carNode.angle-=Math.min(-g,720*t),this.streak&&this.cover){var _=cc.v2(this._carBody.velocity[0],this._carBody.velocity[1]).normalize();this.streak.node.setPosition(this.carNode.getPosition().add(_.mul(20))),this.cover.node.setPosition(this.carNode.getPosition().add(_.mul(-45)));var y=180*Math.atan2(_.y,_.x)/Math.PI;this.cover.node.angle=y}if(this.updateNodePos(t),this._distance=Math.floor(this.carNode.x/10),this.distanceLabel&&(this.distanceLabel.string=this._distance+"m"),1==this._floors.length?this.carNode.x-this._floors[0].position[0]>this._floorElementInterval*this._oneFloorLength*.5&&this._crateFloor(cc.v2(this._floors[0].position[0]+this._floorElementInterval*(this._oneFloorLength-1),0)):2==this._floors.length&&this.carNode.x-this._floors[0].position[0]>this._floorElementInterval*this._oneFloorLength*1.5&&this._removeFLoor(),this.moveSnow(t),this.checkCoin(),this.snowSlide&&this.snowWarning){var v=Math.max(1600,5e3*(1-this._distance/5e4)),b=this.carNode.x-this.snowSlide.x;b<1500?(this._shakeAmount=25*(1500-b)/1500,this.snowWarning.active=!0,cc.audioEngine.setVolume(this.soundCaches[a.snowSlide],Math.min(1,.5*(1-b/1500)))):(this.snowWarning.active=!1,cc.audioEngine.setVolume(this.soundCaches[a.snowSlide],.5*Math.min(1,0))),b>v&&(this.snowSlide.x=this.carNode.x-v),l=800*(.8+.5*this._distance/5e4),b<500&&(l=Math.min(800,l)),this.isReLifeProtect||(this.snowSlide.x+=l*t,this.snowSlide.x>this.carNode.x&&this.lose()),this.snowSlide.y=this.getFloorYAndAngel(this.snowSlide.x).y}this._distance=Math.max(this._distance,Math.floor(this.carNode.x/50)),this.distanceLabel&&(this.distanceLabel.string=this._distance.toString()+"m")}},e.prototype.updateNodePos=function(t){if(this.carNode&&this.bgNode&&this.sceneNode&&this.uiNode&&this.camera&&this._carBody){var e=cc.v2(this._carBody.velocity[0],0).div(this.cameraSpeed).mul(100),i=e.sub(this.cameraOffsetPos),o=i.mag();this.cameraOffsetPos=o<100*t?e:this.cameraOffsetPos.add(i.normalize().mul(100*t));var n=this.carNode.getPosition().add(cc.v2(500,-150).sub(this.cameraOffsetPos).mul(this.screenRate));this.camera.node.setPosition(cc.v2(n.y,-n.x).add(this.cameraShakeOffsetPos)),this.bg&&this.bg.setPosition(cc.v2(-n.x,0)),this.bgNode.setPosition(n),this.uiNode.setPosition(n)}},e.prototype.checkCoin=function(){if(this.carNode){for(var t=this.coinNodes.length-1;t>=0;t--){var e=this.coinNodes[t];e.getPosition(this._coinPos),this.carNode.getPosition(this._carPos),this._carPos.sub(this._coinPos,this._carDir),this._carDir.mag()<=e.getChildByName("shape").width&&(this.coinNodes[t]=null,this.eatCoin(e)),this._carDir.x>2e3&&(this.coinNodes[t]=null,this.coinPool.put(e))}var i=0;for(t=0;t<this.coinNodes.length;t++)null==this.coinNodes[t]?i++:i>0&&(this.coinNodes[t-i]=this.coinNodes[t]);i>0&&(this.coinNodes.length=this.coinNodes.length-i)}},e.prototype.moveSnow=function(t){var e=this;if(this.carNode){for(var i=0,o=this.snows;i<o.length;i++){var a=o[i];a.y-=500*t,a.x-=300*t*this.speedLv}this.snows.length&&this.carNode.x-this.snows[0].x>2e3&&this.snowPool.put(this.snows.shift());var s=cc.tween(this);if(!this.snows.length||this.snows[this.snows.length-1].x-this.carNode.x<2e3){var r=this.carNode.x;this.snows.length&&(r=this.snows[this.snows.length-1].x+1e3);for(var c=function(t){var i=l.carNode.y+1e3*t;s=s.delay(.01).call(function(){var t=e.snowPool.get();t||((t=new cc.Node).addComponent(cc.Sprite).spriteFrame=e.snowFrame[0]),t.angle=360*Math.random(),t.parent=e.carNode.parent,t.zIndex=n.snow,t.setPosition(r,i),e.snows.push(t)})},l=this,h=-2;h<=2;h++)c(h);s=s.start()}}},e.prototype.soundPlay=function(t){t!=a.eatCoin&&t!=a.die||cc.audioEngine.play(this.soundClip[t],!1,.7),t==a.getZoom&&cc.audioEngine.play(this.soundClip[t],!1,.2),t==a.hitRock&&cc.audioEngine.play(this.soundClip[t],!1,.5)},e.prototype.lose=function(){this.isGameOver=!0,this.shareNode&&(this.shareNode.active=!0,this.shareNode.getChildByName("label").getComponent(cc.Label).string=this._distance+"m")},e.prototype.share=function(){var t=this;if(this.isShared)this.flyText("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21");else if(this.camera){this.node.angle=0;var e=this.camera.node.getPosition();this.camera.node.setPosition(0,0),this.node.setPosition(e.y,-e.x),this.scheduleOnce(function(){t.shareShotNode&&!t.isShared&&r.default.instance.miniGameAdapter.shareScreenShotSP(t.shareShotNode,{miniGame:l.SubPackageKey.skiRush}).then(function(i){i?(t.flyText("\u5206\u4eab\u6210\u529f"),t.isGameOver=!1,t.isReLifeProtect=!0,t.dieTime=0,t.speedLv=3,t.isShared=!0,t.shareNode&&(t.shareNode.active=!1),cc.tween(t).delay(3).call(function(){return t.isReLifeProtect=!1}).start()):t.flyText("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a"),t.node.angle=-90,t.node.setPosition(0,0),t.camera&&t.camera.node.setPosition(e)}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})})}},e.prototype.flyText=function(t){if(this.distanceLabel){var e=cc.instantiate(this.distanceLabel.node),i=e.getComponent(cc.Label);e.zIndex=cc.macro.MAX_ZINDEX,i.string=t,i.fontSize=44,e.parent=this.uiNode,e.setPosition(0,0),e.opacity=255,cc.tween(e).by(1,{y:50}).by(.5,{y:50,opacity:-255}).start()}},e.prototype.onClickExit=function(){r.default.instance.getModel().gameExit()},__decorate([p(c.default)],e.prototype,"bg",void 0),__decorate([p(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([p(cc.Node)],e.prototype,"bgNode",void 0),__decorate([p(cc.Node)],e.prototype,"uiNode",void 0),__decorate([p(cc.Graphics)],e.prototype,"drawerPre",void 0),__decorate([p(cc.Node)],e.prototype,"milestonePre",void 0),__decorate([p(cc.Node)],e.prototype,"treePres",void 0),__decorate([p(cc.Node)],e.prototype,"carNode",void 0),__decorate([p(cc.Label)],e.prototype,"distanceLabel",void 0),__decorate([p(cc.Label)],e.prototype,"maxDistanceLabel",void 0),__decorate([p(cc.Sprite)],e.prototype,"cover",void 0),__decorate([p(cc.SpriteFrame)],e.prototype,"coverFrames",void 0),__decorate([p(cc.MotionStreak)],e.prototype,"streak",void 0),__decorate([p(cc.Texture2D)],e.prototype,"streakText",void 0),__decorate([p(cc.Node)],e.prototype,"jumpBoardPre",void 0),__decorate([p(cc.Node)],e.prototype,"cornPre",void 0),__decorate([p(cc.Node)],e.prototype,"stonePres",void 0),__decorate([p(cc.Node)],e.prototype,"stoneSplicePres",void 0),__decorate([p(cc.SpriteFrame)],e.prototype,"playerTypeFrame",void 0),__decorate([p(cc.SpriteFrame)],e.prototype,"snowFrame",void 0),__decorate([p(cc.Node)],e.prototype,"snowSlide",void 0),__decorate([p(cc.Node)],e.prototype,"snowWarning",void 0),__decorate([p(cc.Node)],e.prototype,"shareShotNode",void 0),__decorate([p(cc.Node)],e.prototype,"shareNode",void 0),__decorate([p([cc.AudioClip])],e.prototype,"soundClip",void 0),__decorate([d],e)}(cc.Component);i.default=m,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/helpModel/diffLayerBG/diffLayerBG":"diffLayerBG","../../miniGamePackage/types-miniGame":"types-miniGame","./skiRushCoinShape":"skiRushCoinShape"}],skiRushModel:[function(t,e,i){"use strict";cc._RF.push(e,"6c777ZXeK9KYr8arF7daCbn","skiRushModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/skiRush/skiRushMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.skiRush)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],skiRushSlide:[function(t,e,i){"use strict";cc._RF.push(e,"12ad0UeSVNFdK5DXlV0t3zR","skiRushSlide"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.balls=[],e.walls=[],e}return __extends(e,t),e.prototype.start=function(){for(var t=3;t<=12;t++){var e=cc.instantiate(this.balls[t%3]);this.balls[t]=e,e.parent=this.balls[0].parent}for(var i=0,o=this.balls;i<o.length;i++){var n=o[i];n.setPosition(0,0),this.fall(n)}for(var a=0,s=this.walls;a<s.length;a++){var r=s[a];this.moveWall(r)}},e.prototype.moveWall=function(t){var e=this,i=50*Math.random()+20,o=i/100;cc.tween(t).by(o,{x:i}).by(2*o,{x:2*-i}).by(o,{x:i}).call(function(){e.moveWall(t)}).start()},e.prototype.fall=function(t){var e=this;cc.tween(t).set({opacity:0,x:0,y:0}).delay(5*Math.random()).set({opacity:255}).parallel(cc.tween(t).by(2,{x:400+200*Math.random()}),cc.tween(t).by(2,{y:-1200},{easing:cc.easing.quadIn})).delay(2*Math.random()+3).call(function(){e.fall(t)}).start()},__decorate([a(cc.Node)],e.prototype,"balls",void 0),__decorate([a(cc.Node)],e.prototype,"walls",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],slicePigMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"9ee9a/9AtJMToU1mraRANJp","slicePigMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/texturePlus/PolygonUtil"),a=__importDefault(t("../../miniGamePackage/texturePlus/TexturePlus")),s=cc._decorator,r=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pig=null,e.drawNode=null,e.flySpriteFrame=null,e.flyCount=5,e.meatFrame=[],e.leftShieldPointNode=null,e.rightShieldPointNode=null,e.bottomCenterNode=null,e.knifeFrame=null,e.scoreProgress=null,e.dyingPig=null,e.leftShieldPoint=cc.v2(0,0),e.rightShieldPoint=cc.v2(0,0),e.bottomCenter=cc.v2(0,0),e._startPoint=cc.v2(0,0),e._endPoint=cc.v2(0,0),e._isGameOver=!1,e._pigOffsetPosition=cc.v2(0,300),e._knife=null,e._flies=[],e._score=0,e._maxScore=0,e._everyMeatScore=0,e}return __extends(e,t),e.prototype.onLoad=function(){var t=new cc.Node("Line");t.parent=this.node,this.drawNode=t.addComponent(cc.Graphics),this.drawNode.lineWidth=5,this.drawNode.strokeColor=cc.color(255,0,0),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},e.prototype.start=function(){if(this._initPig(),this.leftShieldPointNode&&(this.leftShieldPoint=this.leftShieldPointNode.getPosition()),this.rightShieldPointNode&&(this.rightShieldPoint=this.rightShieldPointNode.getPosition()),this.bottomCenterNode&&(this.bottomCenter=this.bottomCenterNode.getPosition()),this.pig){for(var t=0;t<this.flyCount;t++){var e=this._addFlyInPolygon(this.pig.polygon);e&&this._moveFlyInPolygon(e)}this._knife=new cc.Node,this._knife.setParent(this.node);var i=this._knife.addComponent(cc.Sprite);this.knifeFrame&&(i.spriteFrame=this.knifeFrame),this._knife.opacity=0,this.scoreProgress&&(this.scoreProgress.progress=0),this._maxScore=.6*this.calculatePolygonArea(this.pig.polygon)}},e.prototype._initPig=function(){if(this.pig){var t=cc.instantiate(this.pig.node);this.dyingPig=t.getComponent(a.default),this.node.addChild(t),t.opacity=0,this._pigOffsetPosition=this.pig.node.getPosition()}},e.prototype.onTouchStart=function(t){this._knife&&(this._knife.opacity=255),this._startPoint=this.node.convertToNodeSpaceAR(t.getLocation())},e.prototype.onTouchMove=function(t){var e;if(this.drawNode){this._endPoint=this.node.convertToNodeSpaceAR(t.getLocation()),this.drawNode.clear();for(var i=this._startPoint,o=this._endPoint,n=i.sub(o).mag(),a=Math.floor(n/15),s=o.sub(i).normalize(),r=0;r<a;r++){var c=i.add(s.mul(15*r)),l=c.add(s.mul(10));this.drawNode.moveTo(c.x,c.y),this.drawNode.lineTo(l.x,l.y)}var h=n-15*a;if(h>0){var u=i.add(s.mul(15*a)),d=u.add(s.mul(h));this.drawNode.moveTo(u.x,u.y),this.drawNode.lineTo(d.x,d.y)}this.drawNode.stroke(),null===(e=this._knife)||void 0===e||e.setPosition(this._endPoint)}},e.prototype.onTouchEnd=function(t){if(this._knife.opacity=0,this._endPoint=this.node.convertToNodeSpaceAR(t.getLocation()),this.pig&&this.dyingPig){var e=this._getPolygon(this.pig,this._startPoint,this._endPoint);if(e.length>1){for(var i=0;i<e.length;i++){var o=0;0===n.PolygonUtil.relationPointToPolygon(this._flies[0].getPosition(),e[i])?this.pig.polygon=e[i]:0===o?(o=1,this.dyingPig.polygon=e[i]):this.calculatePolygonArea(e[i])>this.calculatePolygonArea(this.dyingPig.polygon)&&(this.dyingPig.polygon=e[i])}this.dyingPig.node.opacity=255;for(var a=0,s=this._flies;a<s.length;a++){var r=s[a];0===n.PolygonUtil.relationPointToPolygon(r.getPosition(),this.dyingPig.polygon)&&this._GameOverIsWin(!1),-1===n.PolygonUtil.relationPointToPolygon(r.targetPosition,this.pig.polygon)&&(cc.Tween.stopAllByTarget(r),this._moveFlyInPolygon(r))}this._createMeatInPolygon(this.dyingPig.polygon)}this.drawNode&&this.drawNode.clear()}},e.prototype._getPolygon=function(t,e,i){var o=e.clone(),a=i.clone();return o=e.sub(this._pigOffsetPosition),a=i.sub(this._pigOffsetPosition),n.PolygonUtil.lineCutPolygon(o,a,t.polygon)},e.prototype._offBind=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},e.prototype._GameOverIsWin=function(t){this._isGameOver||(this._isGameOver=!0,o.default.instance.gotoResultWithLoading(t,this.node.parent))},e.prototype._createFlyNode=function(){var t=new cc.Node;return t.targetPosition=cc.v2(0,0),t.isOneScheduled=!0,t},e.prototype._addFlyInPolygon=function(t){if(!this.flySpriteFrame||!this.pig)return console.error("Fly sprite frame is not set."),null;var e=this._getRandomPointInPolygon(t),i=this._createFlyNode();return i.parent=this.pig.node,i.setPosition(e),this._flies.push(i),i.addComponent(cc.Sprite).spriteFrame=this.flySpriteFrame,i},e.prototype._moveFlyInPolygon=function(t){var e,i=this;if(this.pig)if(t.isOneScheduled){var o=null===(e=this.pig)||void 0===e?void 0:e.polygon,n=this._getRandomPointInPolygon(o);t.targetPosition=n;var a=2*Math.random()+1;cc.tween(t).to(a,{x:n.x,y:n.y}).call(function(){return i._moveFlyInPolygon(t)}).start()}else t.isOneScheduled=!0},e.prototype._getRandomPointInPolygon=function(t){var e,i=Math.min.apply(Math,t.map(function(t){return t.x})),o=Math.max.apply(Math,t.map(function(t){return t.x})),a=Math.min.apply(Math,t.map(function(t){return t.y})),s=Math.max.apply(Math,t.map(function(t){return t.y}));do{var r=Math.random()*(o-i)+i,c=Math.random()*(s-a)+a;e=new cc.Vec2(r,c)}while(n.PolygonUtil.relationPointToPolygon(e,t));return e},e.prototype._createMeatInPolygon=function(t){var e=this,i=this.calculatePolygonArea(t);console.log(i);var o=Math.ceil(i/1e4)+1;if(0!==o){var n=1/o;this._everyMeatScore=i/o;for(var a=function(i){var a=s._everyMeatScore;s.scheduleOnce(function(){e.dyingPig.node.opacity=255-255/o*(i+1);var n=new cc.Node;e.node.addChild(n);var s=n.addComponent(cc.Sprite);e.meatFrame.length&&(s.spriteFrame=e.meatFrame[Math.floor(100*Math.random())%e.meatFrame.length]);var r=e._getRandomPointInPolygon(t).add(e._pigOffsetPosition);n.setPosition(r),e._slideMeatDown(n,e.leftShieldPoint,e.rightShieldPoint,e.bottomCenter,a)},n*i)},s=this,r=0;r<o;r++)a(r)}},e.prototype._slideMeatDown=function(t,e,i,o,n){var a=this,s=t.getPosition().subtract(o).mag()/200,r=cc.tween(t).to(s,{x:o.x,y:o.y},{easing:"quadOut"}).call(function(){t.destroy()});cc.tween(t).then(r).then(cc.tween().call(function(){console.log(a._score/a._maxScore),a._score+=n,a.scoreProgress&&(a.scoreProgress.progress=a._score/a._maxScore,a.scoreProgress.progress>=1&&a._GameOverIsWin(!0))})).start()},e.prototype.calculatePolygonAverageCenter=function(t){if(t.length<3)throw new Error("A polygon should have at least 3 vertices.");for(var e=0,i=0,o=0;o<t.length;o++)e+=t[o].x,i+=t[o].y;return e/=t.length,i/=t.length,new cc.Vec2(e,i)},e.prototype.calculatePolygonArea=function(t){if(t.length<3)throw new Error("A polygon should have at least 3 vertices.");for(var e=this.calculatePolygonAverageCenter(t),i=0,o=0;o<t.length;o++){var n=t[o],a=t[(o+1)%t.length];i+=this.calculateTriangleArea(e,n,a)}return i},e.prototype.calculateTriangleArea=function(t,e,i){var o=t.sub(e).mag(),n=e.sub(i).mag(),a=i.sub(t).mag(),s=(o+n+a)/2;return Math.sqrt(s*(s-o)*(s-n)*(s-a))},e.prototype.onDisable=function(){this._offBind()},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([c(a.default)],e.prototype,"pig",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"flySpriteFrame",void 0),__decorate([c([cc.SpriteFrame])],e.prototype,"meatFrame",void 0),__decorate([c(cc.Node)],e.prototype,"leftShieldPointNode",void 0),__decorate([c(cc.Node)],e.prototype,"rightShieldPointNode",void 0),__decorate([c(cc.Node)],e.prototype,"bottomCenterNode",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"knifeFrame",void 0),__decorate([c(cc.ProgressBar)],e.prototype,"scoreProgress",void 0),__decorate([r],e)}(cc.Component);i.default=l,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/texturePlus/PolygonUtil":"PolygonUtil","../../miniGamePackage/texturePlus/TexturePlus":"TexturePlus"}],slicePigModle:[function(t,e,i){"use strict";cc._RF.push(e,"f9cceuVOIVJAJVUki4CHPk6","slicePigModle"),Object.defineProperty(i,"__esModule",{value:!0}),i.SlicePigModel=void 0;var o=t("../../miniGamePackage/SubPackageManager"),n=__importDefault(t("../../miniGamePackage/SubPackageModelBase")),a=t("../../miniGamePackage/types-miniGame"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/slicePig/slicePig",[2,!0]})})},__decorate([o.addSubPackage(a.SubPackageKey.slicePig)],e)}(n.default);i.SlicePigModel=s,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],stickPuzzleMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"4a063jBQ8xPzoH0+IonDb6A","stickPuzzleMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importDefault(t("../../miniGamePackage/SubPackageManager")),n=__importDefault(t("./stick")),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sceneNode=null,e.countDown=null,e.countDownProgressBar=null,e.stickSpriteFrame=null,e.crossingStickFrame=null,e.cornerStickFrame=null,e.endStickFrame=null,e.trueIconFrame=null,e.isCountDownAction=!1,e._gridMap=[],e._totalTime=10,e._initialTotalTime=10,e._isStartCountDown=!1,e._maxID=500,e._maxBoardSize=30,e._boardSize=10,e._gridSize=380/e._boardSize,e._stickID=0,e._stickMapping=new Map,e}return __extends(e,t),Object.defineProperty(e.prototype,"_offset",{get:function(){return cc.v2(-this._boardSize*this._gridSize/2+this._gridSize/2,-this._boardSize*this._gridSize/2+this._gridSize/2)},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){cc.game.setFrameRate(60)},e.prototype.start=function(){this.sceneNode&&this.sceneNode.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.countDown&&this.countDown.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchStart,this),this._startLevel()},e.prototype._startLevel=function(){this._boardSize++,this._initCountDown(),this._gridSize=600/this._boardSize,this._stickID=0,this._initializeGridMap(),this._stickMapping.clear()},e.prototype._initCountDown=function(){this._totalTime=this._initialTotalTime,this.countDown&&(this.countDown.string=this._totalTime.toString()),this._isStartCountDown=!1,this.isCountDownAction=!0},e.prototype._updateCountDown=function(){this._isStartCountDown&&(this._totalTime-=cc.director.getDeltaTime()),this.countDown&&this._totalTime>=0&&(this.countDown.string=Math.floor(this._totalTime).toString()),this.countDownProgressBar&&(this.countDownProgressBar.progress=this._totalTime/this._initialTotalTime),this._totalTime<=0&&this._gameOver()},e.prototype.update=function(){this._stickID<this._maxID?(this._createStickNode(),this.countDownProgressBar&&(this._initialTotalTime=this._stickMapping.size,this._initCountDown(),this.countDownProgressBar.progress=this._stickID/this._maxID)):this.isCountDownAction&&this._updateCountDown()},e.prototype._initializeGridMap=function(){this._gridMap=[];for(var t=0;t<this._boardSize;t++){this._gridMap[t]=[];for(var e=0;e<this._boardSize;e++)this._gridMap[t][e]=new cc.Vec2(0,0)}},e.prototype._getRandomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},e.prototype._generateRandomStick=function(t){if((new Date).getTime()-t>16)return[];var e=++this._stickID;if(e>this._maxID)return[];var i,o,n=[],a=this._boardSize-1,s=0===this._getRandomInt(0,1),r=0===this._getRandomInt(0,1);if(s){var c=this._getRandomInt(3,a);i=this._getRandomInt(0,r?this._boardSize-c:this._boardSize-1),o=this._getRandomInt(0,r?this._boardSize-1:this._boardSize-c);for(var l=0;l<c;l++){var h=i+(r?l:0),u=o+(r?0:l);if(0!==this._gridMap[h][u][r?"x":"y"])return this._generateRandomStick(t)}for(l=0;l<c;l++)h=i+(r?l:0),u=o+(r?0:l),n.push(new cc.Vec2(h,u)),this._gridMap[h][u][r?"x":"y"]=e}else{var d=this._getRandomInt(3,a),p=this._getRandomInt(3,a),m=this._getRandomInt(0,3);switch(m){case 0:i=this._getRandomInt(0,this._boardSize-d-1),o=this._getRandomInt(0,this._boardSize-p-1);break;case 1:i=this._getRandomInt(d,this._boardSize-1),o=this._getRandomInt(0,this._boardSize-p-1);break;case 2:i=this._getRandomInt(0,this._boardSize-d-1),o=this._getRandomInt(p,this._boardSize-1);break;default:i=this._getRandomInt(d,this._boardSize-1),o=this._getRandomInt(p,this._boardSize-1)}for(l=1;l<d;l++){var f=0==m||2==m?l:-l;if(0!==this._gridMap[i+f][o].x)return this._generateRandomStick(t)}for(l=1;l<p;l++){var g=0==m||1==m?l:-l;if(0!==this._gridMap[i][o+g].y)return this._generateRandomStick(t)}if(0!==this._gridMap[i][o].x||0!==this._gridMap[i][o].y)return this._generateRandomStick(t);for(l=d-1;l>=1;l--)f=0==m||2==m?l:-l,n.push(new cc.Vec2(i+f,o)),this._gridMap[i+f][o].x=e;for(n.push(new cc.Vec2(i,o)),this._gridMap[i][o].x=e,this._gridMap[i][o].y=e,l=1;l<p;l++)g=0==m||1==m?l:-l,n.push(new cc.Vec2(i,o+g)),this._gridMap[i][o+g].y=e}return n},e.prototype._createStickNode=function(){var t=this._generateRandomStick((new Date).getTime());if(0!==t.length){var e=new cc.Node;this.sceneNode&&this.sceneNode.addChild(e);var i=e.addComponent(n.default);i.normalStickFrame=this.stickSpriteFrame,i.endStickFrame=this.endStickFrame,i.cornerStickFrame=this.cornerStickFrame,i.crossingStickFrame=this.crossingStickFrame,i.ID=this._stickID,i.gridMap=this._gridMap,i.gridSize=this._gridSize,i.offset=this._offset,i.stickMapping=this._stickMapping,i.setGridPositions(t),this._stickMapping.set(this._stickID,i),i.launch(.1*this._stickMapping.size)}},e.prototype._onTouchStart=function(t){if(this.sceneNode&&!(this._stickID<this._maxID)){var e=this.sceneNode.convertToNodeSpaceAR(t.getLocation()).sub(this._offset),i=Math.round(e.x/this._gridSize),o=Math.round(e.y/this._gridSize);if(i>=0&&i<this._boardSize&&o>=0&&o<this._boardSize){var n=this._gridMap[i][o],a=Math.max(n.x,n.y);if(0!==a){var s=this._stickMapping.get(a);s&&s.canBeRemoved()&&(this._stickMapping.delete(s.ID),s.removeStick(),!1===this._isStartCountDown&&(this._isStartCountDown=!0),0===this._stickMapping.size&&this._gameOver())}}}},e.prototype._gameOver=function(){var t=this;if(this.countDown&&this.isCountDownAction&&(this.isCountDownAction=!1),this._totalTime<=0)o.default.instance.gotoResultWithLoading(!1,this.node.parent);else if(this._boardSize==this._maxBoardSize)o.default.instance.gotoResultWithLoading(!0,this.node.parent);else{var e=new cc.Vec2(25,-150),i=new cc.Node;i.parent=this.node,i.setPosition(e);var n=i.addComponent(cc.Sprite);this.trueIconFrame&&(n.spriteFrame=this.trueIconFrame),n.sizeMode=cc.Sprite.SizeMode.CUSTOM,i.setContentSize(450,300),cc.tween(i).to(.1,{scale:1.5}).to(.1,{scale:.8}).to(.1,{scale:1.2}).to(.1,{scale:.9}).to(.6,{scale:1}).call(function(){t._startLevel(),i.destroy()}).start()}},e.prototype._offBind=function(){this.sceneNode&&this.sceneNode.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.countDown&&this.countDown.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchStart,this)},e.prototype.onDisable=function(){cc.game.setFrameRate(30),this._offBind()},e.prototype.onClickExit=function(){o.default.instance.getModel().gameExit()},__decorate([r(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([r(cc.Label)],e.prototype,"countDown",void 0),__decorate([r(cc.ProgressBar)],e.prototype,"countDownProgressBar",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"stickSpriteFrame",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"crossingStickFrame",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"cornerStickFrame",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"endStickFrame",void 0),__decorate([r(cc.SpriteFrame)],e.prototype,"trueIconFrame",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","./stick":"stick"}],stickPuzzleModel:[function(t,e,i){"use strict";cc._RF.push(e,"1469f19kQlCIbxBOGEHBaYg","stickPuzzleModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/stickPuzzle/stickPuzzleMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.stickPuzzle)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}],stick:[function(t,e,i){"use strict";cc._RF.push(e,"957ea/c7ZFNyKXcXyEjWETg","stick"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=cc._decorator,a=n.ccclass;n.property,function(t){t[t.Normal=0]="Normal",t[t.Corner=1]="Corner",t[t.Crossing=2]="Crossing",t[t.End=3]="End"}(o||(o={}));var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.normalStickFrame=null,e.crossingStickFrame=null,e.cornerStickFrame=null,e.endStickFrame=null,e._shakeAngle=5,e._shakeDuration=.05,e.offset=cc.v2(0,0),e.gridMap=[],e.gridSize=20,e.oriGridSize=20,e.height=0,e._baseSize=49,e._scaleRatio=1,e._shakeNode=new cc.Node,e._spriteNode=new cc.Node,e.stickMapping=new Map,e.ID=0,e._biggerID=0,e._biggerPosition=cc.v2(0,0),e._isShaking=!1,e._gridPositions=[],e}return __extends(e,t),e.prototype.setGridPositions=function(t){this._gridPositions=t,this._createStickSprites()},e.prototype._createStickSprites=function(){var t=this;if(this.normalStickFrame&&this.endStickFrame&&this.cornerStickFrame&&this.crossingStickFrame){this._shakeNode.parent=this.node,this._spriteNode.parent=this.node;var e=this.gridSize/20;this.oriGridSize=this.gridSize,this._gridPositions.forEach(function(i){var o,n=t.gridMap[i.x][i.y];n.x>0&&n.x!=t.ID&&(o=t.stickMapping.get(n.x))&&(t.gridSize=Math.max(o.gridSize+e,t.gridSize)),n.y>0&&n.y!=t.ID&&(o=t.stickMapping.get(n.y))&&(t.gridSize=Math.max(o.gridSize+e,t.gridSize))}),this._scaleRatio=this.oriGridSize/this._baseSize;var i=this._getRandomColor();this._spriteNode.scale=this._scaleRatio;for(var n=0;n<this._gridPositions.length;n++){var a=this._gridPositions[n],s=new cc.Node,r=s.addComponent(cc.Sprite);this._spriteNode.addChild(s);var c=o.Normal,l=this.gridMap[a.x][a.y].x,h=this.gridMap[a.x][a.y].y;switch(l==this.ID&&h==this.ID?c=o.Corner:0!=l&&0!=h&&(c=o.Crossing),s.setPosition(cc.v2(a.x*this._baseSize,a.y*this._baseSize).add(this.offset.mul(1/this._scaleRatio))),c){case o.Normal:r.spriteFrame=this.normalStickFrame,l==this.ID&&(s.angle=90);break;case o.Corner:var u=this._gridPositions[0].sub(this._gridPositions[this._gridPositions.length-1]);0!=u.x&&(u.x=u.x>0?1:-1),0!=u.y&&(u.y=u.y>0?1:-1);var d=0;this._gridPositions[0].sub(this._gridPositions[n]).cross(this._gridPositions[this._gridPositions.length-1].sub(this._gridPositions[n]))>0&&(d=1),r.spriteFrame=this.cornerStickFrame,s.angle=180*Math.atan2(u.y,u.x)/Math.PI+180+180*d,s.setPosition(s.getPosition().add(cc.v2(12*u.x,12*-u.y))),s.zIndex=4;break;case o.Crossing:r.spriteFrame=this.crossingStickFrame,s.setPosition(s.getPosition().add(cc.v2(0,5))),h==this.ID&&(s.setPosition(s.getPosition().add(cc.v2(5,-5))),s.angle=-90),s.zIndex=2}if(0==n||n==this._gridPositions.length-1){var p=new cc.Node,m=p.addComponent(cc.Sprite);this._spriteNode.addChild(p),m.spriteFrame=this.endStickFrame,p.zIndex=3,p.color=i;var f=cc.v2(0,0);0==n?(l==this.ID&&(p.scaleX=-1),f=this._gridPositions[1].sub(this._gridPositions[0])):n==this._gridPositions.length-1&&(h==this.ID&&(p.scaleX=-1),f=this._gridPositions[this._gridPositions.length-2].sub(this._gridPositions[this._gridPositions.length-1])),p.angle=180*Math.atan2(f.y,f.x)/Math.PI+90,p.setPosition(s.getPosition().add(f.mul(-30)))}s.color=i}this.node.setPosition(this._getRandomDir())}},e.prototype.launch=function(){var t=cc.tween().to(1,{x:0,y:0},{easing:"quadIn"});cc.tween(this.node).then(t).start()},e.prototype._getRandomDir=function(t){void 0===t&&(t=1500);var e=2*Math.random()*Math.PI;return cc.v2(t*Math.sin(e),t*Math.cos(e))},e.prototype.canBeRemoved=function(){if(0==this._biggerID)for(var t=0,e=this._gridPositions;t<e.length;t++){var i=e[t],o=this.gridMap[i.x][i.y],n=Math.max(o.x,o.y);if(n>this.ID){var a=this.stickMapping.get(n),s=this.stickMapping.get(this._biggerID);(0==this._biggerID||a&&s&&a.gridSize<s.gridSize)&&(this._biggerID=n,this._biggerPosition=i)}}return!(this._biggerID>0)||(this.stickMapping.get(this._biggerID)?(this._shake(),!1):(this._biggerID=0,this._spriteNode.parent=this.node,this._spriteNode.setPosition(0,0),this.canBeRemoved()))},e.prototype._shake=function(){var t=this;if(!this._isShaking){if(this._spriteNode.parent!=this._shakeNode){this._shakeNode.setPosition(cc.v2(this._biggerPosition.x*this.oriGridSize,this._biggerPosition.y*this.oriGridSize).add(this.offset));var e=this._shakeNode.position,i=this._spriteNode.position.sub(e);this._spriteNode.parent=this._shakeNode,this._spriteNode.setPosition(i)}this._isShaking=!0;var o=cc.tween().by(this._shakeDuration,{angle:this._shakeAngle}).by(2*this._shakeDuration,{angle:2*-this._shakeAngle}).by(this._shakeDuration,{angle:this._shakeAngle}),n=cc.tween().repeat(5,o),a=cc.tween().then(n).call(function(){t._isShaking=!1});cc.tween(this._shakeNode).then(a).start()}},e.prototype.removeStick=function(){for(var t=this,e=0,i=this._gridPositions;e<i.length;e++){var o=i[e],n=this.gridMap[o.x][o.y];n.x===this.ID&&(n.x=0),n.y===this.ID&&(n.y=0)}var a=this._getRandomDir(),s=cc.tween().to(.3,{x:50,y:50}).call(function(){t.node.zIndex=2}).to(1,{x:a.x,y:a.y},{easing:"quadIn"}).call(function(){t.node.removeFromParent(),t.node.destroy()});cc.tween(this.node).then(s).start()},e.prototype._getRandomColor=function(){var t=null;do{var e=Math.floor(256*Math.random()),i=Math.floor(256*Math.random()),o=Math.floor(256*Math.random());.299*e+.587*i+.114*o>=100&&(t=new cc.Color(e,i,o))}while(!t);return t},__decorate([a],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],stikcPuzzleBubbleController:[function(t,e,i){"use strict";cc._RF.push(e,"436ddqW/tVEcr9iq3tyggtf","stikcPuzzleBubbleController"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,a=o.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.minY=0,e.maxY=0,e.minX=0,e.maxX=0,e.minSpawnInterval=1,e.maxSpawnInterval=5,e.bubbleSpriteFrame=null,e._spawnBubbleTimer=0,e}return __extends(e,t),e.prototype.update=function(t){this._spawnBubbleTimer-=t,this._spawnBubbleTimer<=0&&(this._spawnBubbleTimer=this.randomFloat(this.minSpawnInterval,this.maxSpawnInterval),this.spawnBubble())},e.prototype.spawnBubble=function(){var t=new cc.Node("Bubble"),e=t.addComponent(cc.Sprite);this.bubbleSpriteFrame&&(e.spriteFrame=this.bubbleSpriteFrame);var i=this.randomFloat(this.minX,this.maxX),o=this.randomFloat(.5,1.5);this.node.addChild(t),t.setPosition(i,this.minY),t.setScale(o);var n=this.randomFloat(2,3),a=new cc.Vec3(i,this.maxY),s=1.5*o,r=cc.tween(t);r=r.to(n,{position:a,scale:s},{easing:"cubicOut"}).call(function(){t.destroy()}).start()},e.prototype.randomFloat=function(t,e){return t+Math.random()*(e-t)},__decorate([a({type:cc.Float})],e.prototype,"minY",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxY",void 0),__decorate([a({type:cc.Float})],e.prototype,"minX",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxX",void 0),__decorate([a({type:cc.Float})],e.prototype,"minSpawnInterval",void 0),__decorate([a({type:cc.Float})],e.prototype,"maxSpawnInterval",void 0),__decorate([a({type:cc.SpriteFrame})],e.prototype,"bubbleSpriteFrame",void 0),__decorate([n],e)}(cc.Component);i.default=s,cc._RF.pop()},{}],"types-miniGame":[function(t,e,i){"use strict";cc._RF.push(e,"2d5e3ezfvdEuJD9A6FR9Atm","types-miniGame"),Object.defineProperty(i,"__esModule",{value:!0}),i.SubPackageKey=void 0,function(t){t[t.default=-1]="default",t[t.anagramsGame=0]="anagramsGame",t[t.ballFall=1]="ballFall",t[t.parkour=2]="parkour",t[t.railing=3]="railing",t[t.fishGame=4]="fishGame",t[t.bladeFly=5]="bladeFly",t[t.findCraft=6]="findCraft",t[t.unblock=7]="unblock",t[t.drawLine=8]="drawLine",t[t.screwMiniGame=9]="screwMiniGame",t[t.jigsawGame=10]="jigsawGame",t[t.brickGame=11]="brickGame",t[t.rescueHeroGame=12]="rescueHeroGame",t[t.paintWall=13]="paintWall",t[t.islandGame=14]="islandGame",t[t.bridgeCraft=15]="bridgeCraft",t[t.mazeLine=16]="mazeLine",t[t.slicePig=17]="slicePig",t[t.sheepGuardian=18]="sheepGuardian",t[t.drawHomePath=19]="drawHomePath",t[t.stickPuzzle=20]="stickPuzzle",t[t.huntEvolution=21]="huntEvolution",t[t.fishGoldBurst=22]="fishGoldBurst",t[t.fishGrow=23]="fishGrow",t[t.fishEscape=24]="fishEscape",t[t.basketball=25]="basketball",t[t.fishFly=26]="fishFly",t[t.circleMuzzle=27]="circleMuzzle",t[t.circleFish=28]="circleFish",t[t.oilRush=29]="oilRush",t[t.plates=30]="plates",t[t.numberMuzzle=31]="numberMuzzle",t[t.card2048=32]="card2048",t[t.loadCarRun=33]="loadCarRun",t[t.hanoiTower=34]="hanoiTower",t[t.digitMatch=35]="digitMatch",t[t.skiRush=36]="skiRush",t[t.watermelonMerge=37]="watermelonMerge",t[t.building=38]="building",t[t.findDifference=39]="findDifference",t[t.carCross=40]="carCross",t[t.guessPlace=41]="guessPlace",t[t.match3=42]="match3",t[t.testGame=1024]="testGame"}(i.SubPackageKey||(i.SubPackageKey={})),cc._RF.pop()},{}],watermelonMergeMainGame:[function(t,e,i){"use strict";cc._RF.push(e,"2f9b0nHhIxGFaOPlKOSpwSJ","watermelonMergeMainGame"),Object.defineProperty(i,"__esModule",{value:!0});var o=__importStar(t("../../miniGamePackage/SubPackageManager")),n=t("../../miniGamePackage/types-miniGame"),a=cc._decorator,s=a.ccclass,r=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wallNode=[],e.ballPres=[],e.spawnBallPoint=null,e.sceneNode=null,e.shadowPre=null,e.whitePre=null,e.billPres=[],e.scoreLabel=null,e.maxScoreLabel=null,e.soundClip=[],e.shareShotNode=null,e.shareNode=null,e.world=null,e.floorMaterial=null,e.ballMaterial=null,e.spawnedBody=null,e.baseSize=50,e.sizeRate=1.2,e._shakeAmount=0,e.bodyIdToDataMap=new Map,e.score=0,e.maxScore=0,e.overHeightTime=0,e.maxHeight=400,e.isGameOver=!1,e.isShared=!1,e.cnt=0,e}return __extends(e,t),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStartAndMove,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._touchStartAndMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._touchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEnd,this),o.default.instance.miniGameAdapter.changeMainGameMusic(.4),cc.game.setFrameRate(60)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._touchStartAndMove,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._touchStartAndMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._touchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._touchEnd,this),cc.game.setFrameRate(30),this.gameSave(),o.default.instance.miniGameAdapter.changeMainGameMusic(1);for(var t=0;t<this.soundClip.length;t++)cc.audioEngine.uncache(this.soundClip[t])},e.prototype.start=function(){this.setScore(0),this.setMaxScore(0),this.gameInit()},e.prototype.reInit=function(){this.setMaxScore(Math.max(this.maxScore,this.score)),this.setScore(0),this.isGameOver=!1,this.isShared=!1,this.spawnedBody=null,cc.Tween.stopAllByTarget(this),this.sceneNode&&this.sceneNode.destroyAllChildren(),this.shareNode&&(this.shareNode.active=!1),this.bodyIdToDataMap.clear(),this.init(),this.spawnDropBall()},e.prototype.init=function(){var t,e=this;this.world=new o.P2.World,this.floorMaterial=new o.P2.Material(1),this.ballMaterial=new o.P2.Material(3);var i=new o.P2.ContactMaterial(this.floorMaterial,this.ballMaterial);i.friction=1,i.restitution=.3,this.world.addContactMaterial(i),(i=new o.P2.ContactMaterial(this.ballMaterial,this.ballMaterial)).friction=1,i.restitution=.3,this.world.addContactMaterial(i),this.world.gravity=[0,-2e3];for(var n=0,a=this.wallNode;n<a.length;n++){var s=a[n],r=new o.P2.Body({mass:0,position:[s.x,s.y]}),c=new o.P2.Box({width:s.width,height:s.height});c.material=this.floorMaterial,r.addShape(c),null===(t=this.world)||void 0===t||t.addBody(r)}this.world.on("beginContact",function(t){var i=t.bodyA,o=t.bodyB,n=e.bodyIdToDataMap.get(i.id),a=e.bodyIdToDataMap.get(o.id);n&&a&&n.type==a.type&&(e.merge(n,a),e.bodyIdToDataMap.delete(i.id),e.bodyIdToDataMap.delete(o.id))})},e.prototype.gameInit=function(){this.init();var t=cc.sys.localStorage.getItem("miniGameWatermelonMerge");if(t){var e=JSON.parse(t);if(e){this.setMaxScore(e.maxScore),this.setScore(e.score),this.isShared=e.isShard;for(var i=e.pos,o=e.types,n=0;n<i.length;n++){var a=i[n],s=this.spawnBall(o[n]);if(!s)return;s.body.position=[a.x,a.y],s.node.setPosition(a),s.shadow.setPosition(this.getShadowPos(s.shadow,cc.v2(a.x,a.y)))}return void this.spawnDropBall(e.dropType)}}this.spawnDropBall()},e.prototype.gameSave=function(){var t=this,e={score:this.score,maxScore:this.maxScore,pos:[],types:[],dropType:-1,isShard:this.isShared};if(this.spawnedBody){var i=this.bodyIdToDataMap.get(this.spawnedBody.id);i&&(e.dropType=i.type)}this.bodyIdToDataMap.forEach(function(i,o){t.spawnedBody&&o==t.spawnedBody.id||(e.types.push(i.type),e.pos.push(i.node.getPosition()))}),cc.sys.localStorage.setItem("miniGameWatermelonMerge",JSON.stringify(e))},e.prototype.getShadowPos=function(t,e){return e.add(cc.v2(0,.05*-t.height))},e.prototype.setScore=function(t){t=Math.floor(t),this.score=t,this.scoreLabel&&(this.scoreLabel.string="$"+t)},e.prototype.setMaxScore=function(t){t=Math.floor(t),this.maxScore=t,this.maxScoreLabel&&(this.maxScoreLabel.string="$"+t)},e.prototype.addScore=function(t,e){if(this.scoreLabel&&this.sceneNode){this.setScore(t+this.score);var i=cc.instantiate(this.scoreLabel.node),o=i.getComponent(cc.Label);o.fontSize=44,o.string="+$"+t,i.parent=this.sceneNode,i.setPosition(e),i.zIndex=30,cc.tween(i).by(.1,{scale:.2}).by(.3,{y:50,scale:-.2},{easing:cc.easing.quadIn}).by(.3,{y:50,opacity:-255},{easing:cc.easing.quadOut}).call(function(){i.destroy()}).start()}},e.prototype.spawnDropBall=function(t){if(void 0===t&&(t=-1),this.spawnBallPoint){var e=Math.floor(6*Math.random());t>=0&&(e=t);var i=this.spawnBall(e),o=this.spawnBallPoint.getPosition();i&&(i.node.setPosition(o),i.shadow.setPosition(this.getShadowPos(i.shadow,o)),i.body.position=[o.x,o.y],i.body.gravityScale=0,this.spawnedBody=i.body)}},e.prototype.spawnBall=function(t){var e;if(this.spawnBallPoint&&this.sceneNode&&!(t>=this.ballPres.length)&&this.shadowPre&&this.ballMaterial){var i=cc.instantiate(this.ballPres[t]),n=cc.instantiate(this.shadowPre);i.parent=this.sceneNode,n.parent=this.sceneNode;var a=Math.pow(this.sizeRate,t);n.setContentSize(cc.size(this.baseSize*a,this.baseSize*a)),n.zIndex=-1,i.setContentSize(cc.size(this.baseSize*a,this.baseSize*a));var s=new o.P2.Body({mass:a*a}),r=new o.P2.Circle({radius:i.width/2});r.material=this.ballMaterial,s.addShape(r),null===(e=this.world)||void 0===e||e.addBody(s);var c={body:s,node:i,shadow:n,type:t};return this.bodyIdToDataMap.set(s.id,c),c}},e.prototype.merge=function(t,e){var i=this,o=t.type+1,n=t.node.getPosition().add(e.node.getPosition()).div(2);this.world&&(this.world.removeBody(t.body),this.world.removeBody(e.body));var a=function(t,e){t.getPosition().sub(n).mul(.5),cc.tween(t).set({zIndex:10}).to(.24,{x:n.x,y:n.y,scale:.5},{easing:cc.easing.quadIn}).call(function(){t.destroy()}).start(),i.getShadowPos(e,n),cc.tween(e).set({zIndex:9}).to(.24,{x:n.x,y:n.y,scale:.5},{easing:cc.easing.quadIn}).call(function(){e.destroy()}).start()};a(t.node,t.shadow),a(e.node,e.shadow),cc.tween(this).delay(.288).call(function(){var t=i.spawnBall(o);if(t&&(t.body.position=[n.x,n.y],t.node.setPosition(n),t.shadow.setPosition(i.getShadowPos(t.shadow,n)),i.billEffect(n,t.type),i.whitePre)){var e=cc.instantiate(i.whitePre);e.zIndex=2,e.parent=t.node;var a=Math.pow(i.sizeRate,t.type)*i.baseSize;e.setContentSize(cc.size(a,a)),cc.tween(e).set({opacity:0}).to(.1,{opacity:178.5},{easing:cc.easing.quartOut}).to(.2,{opacity:0},{easing:cc.easing.quartIn}).start()}}).start()},e.prototype.billEffect=function(t,e){if(this.sceneNode){o.default.instance.miniGameAdapter.vibrateShort(3);var i=4+e;this._shakeAmount<i&&(this._shakeAmount=i);var n=Math.floor(Math.random()*this.soundClip.length);cc.audioEngine.play(this.soundClip[n],!1,1),this.addScore(Math.pow(2,e),t);for(var a=Math.pow(this.sizeRate,e),s=this.baseSize*a,r=Math.floor(a),c=function(){var e=360*Math.random(),i=cc.v2(Math.sin(e),Math.cos(e)),o=t.add(i.mul(s)),n=Math.floor(Math.random()*l.billPres.length),a=cc.instantiate(l.billPres[n]);a.parent=l.sceneNode,a.angle=360*Math.random(),a.setPosition(o),a.zIndex=15,cc.tween(a).by(.1,{x:20*i.x,y:20*i.y,scale:.2}).by(.3,{x:20*i.x,y:20*i.y,scale:-.2,opacity:-255}).call(function(){a.destroy()}).start()},l=this,h=0;h<r;h++)c()}},e.prototype.randRemove=function(){var t,e=this,i=[];this.bodyIdToDataMap.forEach(function(t,o){e.spawnedBody&&o==e.spawnedBody.id||i.push(o)});for(var o=i.length-1;o>0;o--){var n=Math.floor(Math.random()*(o+1));t=[i[n],i[o]],i[o]=t[0],i[n]=t[1]}var a=cc.tween(this),s=function(t){a=a.delay(1/7).call(function(){var o,n=e.bodyIdToDataMap.get(i[t]);e.bodyIdToDataMap.delete(i[t]),n&&(e.billEffect(n.node.getPosition(),n.type),n.node.destroy(),null===(o=e.world)||void 0===o||o.removeBody(n.body),n.shadow.destroy())})};for(o=0;o<i.length/2;o++)s(o);a=a.start()},e.prototype.update=function(t){var e=this;if(!this.isGameOver&&(t>.02&&(t=.02),this.world)){if(this._shakeAmount>=3){var i=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1,o=(2*Math.random()-1)*Math.sqrt(this._shakeAmount)/1.1;this.node.setPosition(cc.v2(i,o))}this._shakeAmount=Math.max(0,this._shakeAmount-Math.pow(this._shakeAmount+7,1.3)*t),this.world.step(t),this.spawnedBody&&(this.spawnedBody.velocity=[0,0]);var n=!1;this.bodyIdToDataMap.forEach(function(t){var i=t.body,o=t.node;o.setPosition(i.position[0],i.position[1]),t.shadow.setPosition(e.getShadowPos(t.shadow,cc.v2(i.position[0],i.position[1]))),o.angle=180*i.angle/Math.PI,(!e.spawnedBody||i.id!=e.spawnedBody.id)&&o.y+o.height/2>e.maxHeight&&(n=!0)}),n?this.overHeightTime+=t:this.overHeightTime=0,this.overHeightTime>3&&this.gameOver()}},e.prototype.gameOver=function(){this.isGameOver=!0,this.shareNode&&(this.shareNode.active=!0,this.shareNode.getChildByName("label").getComponent(cc.Label).string="$"+this.score)},e.prototype._touchStartAndMove=function(t){this.node.convertToNodeSpaceAR(t.getLocation());var e=t.getDelta();this.spawnedBody&&(this.spawnedBody.position[0]+=e.x,this.spawnedBody.position[0]>320&&(this.spawnedBody.position[0]=320),this.spawnedBody.position[0]<-320&&(this.spawnedBody.position[0]=-320))},e.prototype._touchEnd=function(t){var e=this;this.node.convertToNodeSpaceAR(t.getLocation()),this.spawnedBody&&this.overHeightTime<=0&&(this.spawnedBody.wakeUp(),this.spawnedBody.gravityScale=1,this.spawnedBody.velocity[1]=-500,this.spawnedBody=null,this.gameSave(),cc.tween(this).delay(.2).call(function(){e.spawnDropBall()}).start())},e.prototype.share=function(){var t=this;this.isShared?this.flyText("\u4e00\u5c40\u6e38\u620f\u6700\u591a\u5206\u4eab\u4e00\u6b21"):this.shareShotNode&&!this.isShared&&o.default.instance.miniGameAdapter.shareScreenShotSP(this.shareShotNode,{miniGame:n.SubPackageKey.watermelonMerge}).then(function(e){e?(t.flyText("\u5206\u4eab\u6210\u529f"),t.isGameOver=!1,t.isShared=!0,t.overHeightTime=0,t.shareNode&&(t.shareNode.active=!1),t.randRemove()):t.flyText("\u5206\u4eab\u5931\u8d25,\u8bf7\u5206\u4eab\u5230\u6709\u6548\u7fa4\u804a")}).catch(function(t){console.log("\u5206\u4eab\u51fa\u9519",t)})},e.prototype.flyText=function(t){if(this.scoreLabel&&this.sceneNode){var e=cc.instantiate(this.scoreLabel.node),i=e.getComponent(cc.Label);e.zIndex=cc.macro.MAX_ZINDEX,i.string=t,i.fontSize=44,e.parent=this.node,e.setPosition(0,0),e.opacity=255,cc.tween(e).by(1,{y:50}).by(.5,{y:50,opacity:-255}).start()}},e.prototype.onClickExit=function(){this.isGameOver&&this.reInit(),o.default.instance.getModel().gameExit()},__decorate([r(cc.Node)],e.prototype,"wallNode",void 0),__decorate([r(cc.Node)],e.prototype,"ballPres",void 0),__decorate([r(cc.Node)],e.prototype,"spawnBallPoint",void 0),__decorate([r(cc.Node)],e.prototype,"sceneNode",void 0),__decorate([r(cc.Node)],e.prototype,"shadowPre",void 0),__decorate([r(cc.Node)],e.prototype,"whitePre",void 0),__decorate([r(cc.Node)],e.prototype,"billPres",void 0),__decorate([r(cc.Label)],e.prototype,"scoreLabel",void 0),__decorate([r(cc.Label)],e.prototype,"maxScoreLabel",void 0),__decorate([r([cc.AudioClip])],e.prototype,"soundClip",void 0),__decorate([r(cc.Node)],e.prototype,"shareShotNode",void 0),__decorate([r(cc.Node)],e.prototype,"shareNode",void 0),__decorate([s],e)}(cc.Component);i.default=c,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/types-miniGame":"types-miniGame"}],watermelonMergeModel:[function(t,e,i){"use strict";cc._RF.push(e,"01c85JMfGVDz7uVb0Ng9f4u","watermelonMergeModel"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../miniGamePackage/SubPackageManager"),n=t("../../miniGamePackage/types-miniGame"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.prepare=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return t.prototype.prepare.call(this,e),this.enterWindow="prefab/watermelonMerge/watermelonMergeMainGame",[2,!0]})})},__decorate([o.addSubPackage(n.SubPackageKey.watermelonMerge)],e)}(__importDefault(t("../../miniGamePackage/SubPackageModelBase")).default);i.default=a,cc._RF.pop()},{"../../miniGamePackage/SubPackageManager":"SubPackageManager","../../miniGamePackage/SubPackageModelBase":"SubPackageModelBase","../../miniGamePackage/types-miniGame":"types-miniGame"}]},{},["AnagramsData","AnagramsGame","AnagramsModel","BallFallGameWindow","BallFallModel","LCDNumber","basketballBubbleCtrl","basketballMainGame","basketballModel","BladeFlyBlade","BladeFlyGameWindow","BladeFlyModel","BladeFlyProgressBar","ColliderObjBase","Enemy","Friend","Self","Wall","LineLoader","LinePoint","config_BladeFly","BrickGameEdit","BrickItem","BrickLogic","BrickModel","BrickWallItem","BridgeCraftMainGame","BridgeCraftModel","buildingMainGame","buildingModel","carCrossCar","carCrossMainGame","carCrossModel","card2048Card","card2048MainGame","card2048Model","circleFishBubble","circleFishMainGame","circleFishModel","circleMuzzleMainGame","circleMuzzleModel","digitMatchCube","digitMatchMainGame","digitMatchModel","drawHomeBubbleController","drawHomePathBubbleController","drawHomePathMainGame","drawHomePathModel","personData","DrawLineData","DrawLineGame","DrawLineHeroComp","DrawLineLogic","DrawLineModel","AABB","CBB","ColliderBase","Manager","FindCraftBuyMenu","FindCraftGameWindow","FindCraftJoyStick","FindCraftModel","FindCraftPlayer","FindCraftResource","FindCraftSortingManager","config_FindCraft","findDifferenceLevel","findDifferenceMainGame","findDifferenceModel","fishEscapeBubble","fishEscapeMainGame","fishEscapeMath","fishEscapeModel","fishFlyMainGame","fishFlyModel","fishFlyRope","Catch","Escape","Idle","Patrol","StateBase","FishGameActorDisplay","FishGameBean","FishGameDynamicObjBase","FishGameEnemy","FishGameIFood","FishGameMagnet","FishGameManager","FishGameModel","FishGamePlayer","FishGameRectArea","FishGameSingleton","JoyStick","config_FishGame","fishGoldBurstBullet","fishGoldBurstEnemy","fishGoldBurstGold","fishGoldBurstGoldAni","fishGoldBurstHero","fishGoldBurstMainGame","fishGoldBurstModel","FishGrowCollider","FishGrowEnvs","FishGrowGame","FishGrowJoyStack","FishGrowModel","FishGrowMonster","FishGrowPlayer","FishGrowUI","FishGrowUtil","FollowTarget","BaseFish","EnemyFish","FishCollider","PlayerFish","guessPlaceMainGame","guessPlaceModel","guessPlacePanel","hanoiTowerDisk","hanoiTowerMainGame","hanoiTowerModel","hanoiTowerTower","huntEvolutionBullet","huntEvolutionEnemy","huntEvolutionEnemySpawner","huntEvolutionExpBall","huntEvolutionGun","huntEvolutionMainGame","huntEvolutionMapSpawner","huntEvolutionModel","huntEvolutionPlayer","huntEvolutionSkillBoard","huntEvolutionSkillManager","IslandGameLogic","IslandHeroItem","IslandModel","JigsawItem","JigsawLogic","JigsawModel","JigsawOpenBox","loadCarRunMainGame","loadCarRunModel","itemToDie","match3_Model","match3_gamelogic","MazeLineMainGame","MazeLineModle","numberMuzzleMainGame","numberMuzzleMath","numberMuzzleModel","oilRushChest","oilRushMainGame","oilRushModel","oilRushOil","PaintWallMainGame","PaintWallModel","ParkourBattleWindow","ParkourModel","ParkourNodeExtra","ParkourOpenBox","ParkourOpenBoxWindow","ParkourSelectIndex","platesMainGame","platesModel","platesPlate","RailingCurve","RailingEnd","RailingGameWindow","RailingMapUnit","RailingModel","RailingMoveCoroutine","RailingPlayer","RailingRail","RailingRailTrack","RailingRoom","config","RescueHeroItem","RescueHeroLogic","RescueHeroModel","ScrewBoard","ScrewGame2","ScrewItem","ScrewModel","ScrewSensorHoleComp","ScrewSpikeComp","maxFlowSolver","sheepGuardianMainGame","sheepGuardianModel","sheepGuardianbubbleController","skiRushCoinShape","skiRushMainGame","skiRushModel","skiRushSlide","slicePigMainGame","slicePigModle","stick","stickPuzzleMainGame","stickPuzzleModel","stikcPuzzleBubbleController","TestGame","TestMiniFeature1","TestMiniFeature2","TestMiniView","UnblockGameWindow","UnblockModel","UnblockUnit","UnblockUnitActor","config_Unblock","watermelonMergeMainGame","watermelonMergeModel","MiniGameDataManager","MiniGameLauncher","MiniGameLoading","MiniGameLvComp","MiniGameResultWindow","MiniGameScreen","MiniGameScreenItem","SubPackageManager","SubPackageModelBase","MIniGameUIFeature","MiniGameTipsManager","MiniGameUIBase","MiniGameUIManager","diffLayerBG","oneLayer","noise","P2ConvexUtil","p2","CocosHelper","CommonUtils","PolygonUtil","SysDefine","TextureAssembler","TextureMathUtil","TexturePlus","types-miniGame","AlphaSparkle","Line","MathExt","MiniGameDefer","PlatformUtils","Pool","Queue","SingleClass","SubGlobalEntity","SubResourceUtils","SubSwitchAni","TableView"]);